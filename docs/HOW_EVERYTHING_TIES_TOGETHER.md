# How Everything Ties Together

## ğŸ¯ The Big Picture: Complete Integration Flow

This document explains how all 15 systems work together in a cohesive, intelligent workflow.

---

## ğŸ”„ The Master Flow

```
USER CONVERSATION
       â†“
[Master Intelligence Orchestrator]
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Epic Detection                                      â”‚
â”‚  Epic Conversation Analyzer                                  â”‚
â”‚  â€¢ Analyzes conversation with NLP patterns                   â”‚
â”‚  â€¢ Extracts requirements, objectives, tech stack             â”‚
â”‚  â€¢ Confidence scoring (0-1)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Mindset Alignment Check                             â”‚
â”‚  Mindset Context Engine + Design System Guardian             â”‚
â”‚  â€¢ Validates against PROJECT_MINDSET.md                      â”‚
â”‚  â€¢ Checks design system compliance                           â”‚
â”‚  â€¢ Auto-rejects if critical violations                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Feasibility Analysis                                â”‚
â”‚  PRD Feasibility Analyzer                                    â”‚
â”‚  â”œâ”€â†’ Web Pattern Researcher (architecture validation)        â”‚
â”‚  â””â”€â†’ Architecture Stress Tester (load testing)               â”‚
â”‚  â€¢ Go/No-Go/Conditional decision                             â”‚
â”‚  â€¢ Risk assessment (0-10)                                    â”‚
â”‚  â€¢ Confidence scoring (0-1)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Epic Breakdown                                      â”‚
â”‚  Epic Workflow Orchestrator                                  â”‚
â”‚  â€¢ Epic â†’ User Stories (Alex-BA simulation)                  â”‚
â”‚  â€¢ Stories â†’ Tasks (Sarah-PM simulation)                     â”‚
â”‚  â€¢ Dependency graph creation                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Priority Calculation                                â”‚
â”‚  Priority Scoring Engine                                     â”‚
â”‚  â€¢ Multi-factor scoring (5 factors)                          â”‚
â”‚  â€¢ 0-10 priority scale                                       â”‚
â”‚  â€¢ RAG-based historical learning                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Sub-Agent Creation                                  â”‚
â”‚  Sub-Agent Factory                                           â”‚
â”‚  â€¢ Creates specialized sub-agents                            â”‚
â”‚  â€¢ Assigns tasks by agent type                               â”‚
â”‚  â€¢ Manages capacity limits                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: Conflict Resolution                                 â”‚
â”‚  Conflict Resolution Engine                                  â”‚
â”‚  â€¢ Detects file collisions                                   â”‚
â”‚  â€¢ Priority-based resolution                                 â”‚
â”‚  â€¢ 30-second sync cycles                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 8: MCP Tool Execution                                  â”‚
â”‚  MCP Task Executor                                           â”‚
â”‚  â€¢ Infers tools from task descriptions                       â”‚
â”‚  â€¢ Executes 14 production MCPs                               â”‚
â”‚  â€¢ Parallel execution with result aggregation                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 9: Visual Documentation                                â”‚
â”‚  Diagram Generator + Auto-Index Generator + Context Assemblerâ”‚
â”‚  â€¢ Generates Mermaid diagrams                                â”‚
â”‚  â€¢ Creates INDEX.md files                                    â”‚
â”‚  â€¢ Builds .context/ structure                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
    RESULT: Fully executed epic with tests, diagrams, docs
```

---

## ğŸ§© System-by-System Integration

### **System 1: Epic Conversation Analyzer**

**Role**: Entry point for all user conversations

**Inputs**:
- `ConversationMessage[]` - User messages

**Outputs**:
- `EpicDetectionResult` - Epic details or "not an epic"

**Integration Points**:
```typescript
// Called by Master Orchestrator
const detection = await epicConversationAnalyzer.analyzeConversation(messages);

// If epic detected â†’ passes to Mindset Engine
if (detection.isEpic && detection.confidence > 0.5) {
  // Continue to Step 2
}
```

**Data Flow**:
```
User: "Add OAuth authentication"
  â†“
Epic Conversation Analyzer
  â†“ extracts
{
  title: "Add OAuth authentication",
  epicType: "feature",
  priority: "p1-high",
  requirements: [
    { type: "functional", description: "Email/password login" },
    { type: "security", description: "JWT tokens" }
  ],
  techStack: ["React", "Node.js"]
}
  â†“ passes to
Mindset Context Engine
```

---

### **System 2: Mindset Context Engine**

**Role**: Validates all work against project vision and constraints

**Inputs**:
- `workDescription: string` - What user wants to do
- `workType: 'epic' | 'task' | 'decision'`
- `context: { objectives, constraints, techStack }`

**Outputs**:
- `AlignmentCheck` - Aligned or conflicts detected

**Integration Points**:
```typescript
// Called by Master Orchestrator after epic detection
const alignment = await mindsetContextEngine.checkAlignment(
  detection.title,
  'epic',
  { objectives: detection.objectives }
);

// If autoReject â†’ stops workflow
if (alignment.autoReject) {
  return { decision: 'no-go', reason: alignment.conflicts[0].description };
}

// Otherwise â†’ passes to PRD Feasibility Analyzer
```

**Example Integration**:
```typescript
// PROJECT_MINDSET.md says: "Must use Auth0"
// User requests: "Add Google OAuth"

const alignment = await mindsetContextEngine.checkAlignment(
  "Add Google OAuth authentication",
  'epic'
);

// Result:
{
  aligned: false,
  conflicts: [{
    type: 'strategic',
    severity: 'critical',
    description: 'Violates enterprise constraint: Must use Auth0',
    suggestedAlternative: 'Use Auth0 instead of Google OAuth'
  }],
  autoReject: false, // Can proceed with alternative
  suggestions: ['Use Auth0 with Google as identity provider']
}

// Master Orchestrator shows suggestion to user
// If user accepts â†’ continues with Auth0
// If user rejects â†’ workflow stops
```

---

### **System 3: Design System Guardian**

**Role**: Enforces design consistency (companion to Mindset Engine)

**Inputs**:
- `code: string` - Component code
- `filePath: string` - File being edited
- `componentType?: string`

**Outputs**:
- `DesignCheckResult` - Compliance score + violations

**Integration Points**:
```typescript
// Called by Sub-Agents (James-Frontend) during development
const designCheck = await designSystemGuardian.checkDesignCompliance(
  componentCode,
  'src/components/LoginForm.tsx'
);

// If not compliant â†’ blocks commit
if (designCheck.score < 90) {
  console.log(`Design violations: ${designCheck.violations.length}`);
  console.log(`Auto-fix suggestions: ${designCheck.suggestions.join(', ')}`);
  // Apply auto-fixes or ask developer to fix
}
```

**Example Integration**:
```typescript
// James-Frontend creates component with hardcoded color
const code = `
<button style={{ color: '#FF0000' }}>
  Click Me
</button>
`;

const result = await designSystemGuardian.checkDesignCompliance(code, 'Button.tsx');

// Result:
{
  compliant: false,
  score: 70,
  violations: [
    {
      type: 'color',
      severity: 'high',
      description: 'Hardcoded color #FF0000 instead of design token',
      autoFix: 'text-red-500', // Tailwind class
      location: { line: 2 }
    }
  ]
}

// Sub-Agent Factory auto-applies fix before committing
```

---

### **System 4: PRD Feasibility Analyzer**

**Role**: Orchestrates all validation systems for go/no-go decision

**Inputs**:
- `PRDDocument` - Full PRD (from epic detection)

**Outputs**:
- `FeasibilityAnalysis` - Decision + risks + recommendations

**Integration Points**:
```typescript
// Called by Master Orchestrator after mindset check
const feasibility = await prdFeasibilityAnalyzer.analyzeFeasibility(prd);

// Internally calls:
// 1. Mindset Context Engine (already done)
// 2. Web Pattern Researcher
const webResearch = await webPatternResearcher.research({
  type: 'architecture',
  description: prd.description,
  techStack: prd.techStack
});

// 3. Architecture Stress Tester (if architecture provided)
if (prd.proposedArchitecture) {
  const stressTest = await architectureStressTester.runStressTest({
    architecture: prd.proposedArchitecture,
    loadProfile: { concurrentUsers: 10000 }
  });
}

// Makes decision based on all results
if (feasibility.decision === 'go') {
  // Continue to Epic Breakdown
} else if (feasibility.decision === 'conditional') {
  // Show recommendations to user
  console.log('Recommendations:', feasibility.recommendations);
} else {
  // No-go: Show alternatives
  console.log('Alternatives:', feasibility.alternatives);
}
```

**Data Flow Example**:
```
PRD: "OAuth authentication with 10k concurrent users"
  â†“
PRD Feasibility Analyzer orchestrates:
  â”œâ”€â†’ Web Pattern Researcher
  â”‚   â””â”€â†’ Finds: PKCE required, rate limiting best practices
  â”œâ”€â†’ Architecture Stress Tester
  â”‚   â””â”€â†’ Tests: 10k users â†’ 150ms p95, 2 bottlenecks
  â””â”€â†’ Risk Assessment
      â””â”€â†’ Calculates: Risk score 4.2/10

Decision: CONDITIONAL GO
Recommendations:
  - Implement PKCE for OAuth
  - Add database connection pooling (bottleneck detected)
  - Use Auth0 (mindset constraint)
```

---

### **System 5: Epic Workflow Orchestrator**

**Role**: Breaks epic â†’ stories â†’ tasks, manages lifecycle

**Inputs**:
- `EpicDetectionResult` - From Epic Conversation Analyzer
- `conversationId: string`

**Outputs**:
- `Epic` - Full epic with stories and tasks

**Integration Points**:
```typescript
// Called by Master Orchestrator after feasibility OK
const epic = await epicWorkflowOrchestrator.startEpicWorkflow(detection, convId);

// Internally:
// 1. Creates epic object
const epic = this.createEpic(detection, convId);

// 2. Generates user stories (Alex-BA simulation)
epic.stories = await this.generateUserStories(epic, detection);

// 3. Generates tasks (Sarah-PM simulation)
for (const story of epic.stories) {
  story.tasks = await this.generateTasks(story, epic);
}

// 4. Calls Priority Scoring Engine for each task
await priorityScoringEngine.calculatePriority(taskContext);

// 5. Calls Sub-Agent Factory to create agents
await subAgentFactory.createSubAgent({ type, task, epicId });

// 6. Calls Conflict Resolution Engine
await conflictResolutionEngine.registerAgent(subAgent);

// 7. Starts parallel execution
await this.startParallelExecution(epic);
```

**Story/Task Generation Example**:
```
Epic: "User Authentication"
  â†“
Alex-BA generates stories:
  Story 1: "As a user, I want to login with email/password"
  Story 2: "As a user, I want OAuth social login"
  Story 3: "As an admin, I want role-based access control"

  â†“
Sarah-PM generates tasks per story:
  Story 1 â†’ Tasks:
    - Task 1: Requirements analysis (Alex-BA, 2h)
    - Task 2: Backend API implementation (Marcus, 8h)
    - Task 3: Frontend UI implementation (James, 6h)
    - Task 4: Testing (Maria, 4h)
    - Task 5: Documentation (Sarah, 2h)

  â†“
Priority Scoring Engine:
  Task 2 (Backend API) = 8.5/10
    - Criticality: 4/4 (p1-high)
    - Blocks: Task 3, Task 4 = 1.5/2
    - Business value: 0.8/1
    - Impact: 0.7/1 (security + customer-facing)

  â†“
Sub-Agent Factory creates:
  - sub-marcus-1 (Task 2, priority: 8.5)
  - sub-james-1 (Task 3, priority: 7.2)
  - sub-maria-1 (Task 4, priority: 6.8)
```

---

### **System 6: Priority Scoring Engine**

**Role**: Calculates 0-10 priority for every task

**Inputs**:
- `TaskContext` - Task details, dependencies, epic priority

**Outputs**:
- `PriorityScore` - 0-10 score with breakdown

**Integration Points**:
```typescript
// Called by Epic Workflow Orchestrator for each task
const priorityScore = await priorityScoringEngine.calculatePriority({
  taskId: task.id,
  taskType: 'task',
  agentType: 'marcus-backend',
  description: task.description,
  criticality: epic.priority, // 'p1-high'
  dependencies: task.dependsOn,
  blockedBy: task.blocks,
  businessValue: 8 // From Alex-BA
});

// Score used by Conflict Resolution Engine
// Higher priority wins in conflicts
```

**Multi-Factor Scoring**:
```typescript
// Task: "Implement OAuth backend API"

Factor 1: Criticality (epic priority = p1-high) = 3/4 points
Factor 2: Dependencies (blocks 3 tasks) = 1.5/2 points
Factor 3: Deadline (none) = 0/2 points
Factor 4: Business value (8/10) = 0.8/1 point
Factor 5: Impact (security + customer-facing) = 0.7/1 point

Total: 3 + 1.5 + 0 + 0.8 + 0.7 = 6.0/10

// But RAG finds similar task had priority 8.5
// Adjusts total to 8.5/10 (85% historical match)

Final: 8.5/10 (confidence: 0.9)
```

---

### **System 7: Conflict Resolution Engine**

**Role**: Prevents file collisions between parallel sub-agents

**Inputs**:
- `SubAgent` - Agent to register

**Outputs**:
- Registers agent, detects conflicts, applies resolution

**Integration Points**:
```typescript
// Called by Sub-Agent Factory when creating agent
await conflictResolutionEngine.registerAgent(subAgent);

// Internally:
// 1. Detects conflicts
const conflicts = await this.detectConflicts(newAgent);

// 2. For each conflict, determines resolution
for (const conflict of conflicts) {
  const resolution = await this.determineResolutionStrategy(
    agent1, agent2, conflictType, severity
  );

  // 3. Applies resolution
  await this.resolveConflict(conflict);
}

// 4. Runs 30-second sync cycles
setInterval(() => {
  this.syncAgents(); // Unblocks completed agents
}, 30000);
```

**Conflict Resolution Example**:
```
Conflict Detected:
  - sub-marcus-1 modifying src/auth/oauth.ts (priority: 8.5)
  - sub-james-1 modifying src/auth/oauth.ts (priority: 7.2)

Conflict Type: write-write (both writing)
Severity: critical
Resolution Strategy: priority-based

Resolution:
  1. sub-marcus-1 proceeds (higher priority)
  2. sub-james-1 blocked
  3. After marcus completes, james retries

30-second sync cycle:
  - Marcus completes at t=45s
  - Sync at t=60s detects completion
  - James unblocked, starts execution
```

---

### **System 8: Sub-Agent Factory**

**Role**: Creates and manages specialized sub-agent instances

**Inputs**:
- `SubAgentConfig` - Type, task, priority

**Outputs**:
- `SubAgentInstance` - Created sub-agent

**Integration Points**:
```typescript
// Called by Epic Workflow Orchestrator
const subAgent = await subAgentFactory.createSubAgent({
  type: 'marcus-backend',
  task: backendTask,
  epicId: epic.id,
  priority: 8.5
});

// Internally:
// 1. Checks capacity limits (max 5 marcus sub-agents)
if (currentCount >= maxCount) {
  this.queueTask(config); // Queue if at capacity
  throw new Error('Capacity limit reached');
}

// 2. Creates sub-agent
const subAgent = { id, type, taskId, priority, files, ... };

// 3. Registers with Conflict Resolution Engine
await conflictResolutionEngine.registerAgent(subAgent);

// 4. Executes task
await this.executeTask(subAgentId);

// 5. During execution, calls MCP Task Executor
const mcpInference = await mcpTaskExecutor.inferTools(task);
const mcpResult = await mcpTaskExecutor.executeTools(task, mcpInference);

// 6. Performs agent-specific work
await this.performAgentWork(subAgent, mcpResult);

// 7. On completion, cleans up
await this.cleanupSubAgent(subAgentId);
```

**Sub-Agent Lifecycle**:
```
Create sub-marcus-1
  â†“
Register with Conflict Engine
  â†“ (no conflicts)
Start Execution
  â†“
Infer MCP Tools
  - semgrep.scan (security)
  - postgresql.query (database)
  - sentry.track-error (monitoring)
  â†“
Execute MCP Tools (parallel)
  âœ… semgrep: 0 vulnerabilities
  âœ… postgresql: Schema created
  âœ… sentry: Monitoring enabled
  â†“
Perform Agent Work
  - Generate API endpoints
  - Create database models
  - Implement business logic
  â†“
Update Status: completed
  â†“
Trigger 30s Sync Cycle
  - Unblock dependent agents
  â†“
Cleanup sub-marcus-1
```

---

### **System 9: MCP Task Executor**

**Role**: Infers and executes MCP tools based on task descriptions

**Inputs**:
- `Task` - Task to execute

**Outputs**:
- `MCPToolInference` - Inferred tools
- `MCPExecutionResult` - Tool execution results

**Integration Points**:
```typescript
// Called by Sub-Agent Factory during task execution
const mcpInference = await mcpTaskExecutor.inferTools(task);

// Internally uses pattern matching:
const patterns = this.matchTaskPatterns(task);
// Task type='development', keywords=['api', 'backend']
// â†’ Infers: semgrep.scan, postgresql.query, sentry.track-error

// Also queries RAG for historical mappings
const ragTools = await this.queryRAGForTools(task);
// Similar task used: github.create-pr

// Combines both sources
const tools = [...patternTools, ...ragTools];

// Executes tools in parallel
const results = await Promise.all(
  tools.map(tool => this.executeTool(tool, task))
);

// Stores execution pattern in RAG for future
await this.storeExecutionPattern(task, inference, result);
```

**Tool Inference Example**:
```
Task: "Write integration tests for OAuth API"

Pattern Matching:
  - Type: testing
  - Keywords: ['test', 'integration', 'oauth']
  â†“
Inferred Tools:
  - chrome.screenshot (visual testing)
  - chrome.run-lighthouse (performance)
  - playwright.test (E2E tests)

RAG Query: "testing task: OAuth integration tests"
  â†“
Historical Match (87% similar):
  - github.create-pr (create PR with tests)
  - semgrep.scan (security scan)

Final Tools:
  1. playwright.test (required, 0.9 confidence)
  2. chrome.screenshot (recommended, 0.8 confidence)
  3. semgrep.scan (recommended, 0.75 confidence)
  4. github.create-pr (optional, 0.7 confidence)

Execution (parallel):
  âœ… playwright.test â†’ 15 tests passed
  âœ… chrome.screenshot â†’ 3 screenshots saved
  âœ… semgrep.scan â†’ 0 vulnerabilities
  â­ï¸  github.create-pr â†’ skipped (optional)

Store in RAG: "testing + oauth â†’ playwright + chrome + semgrep"
```

---

### **System 10: Web Pattern Researcher**

**Role**: Validates architecture via web research (Exa MCP)

**Inputs**:
- `ResearchQuery` - What to research

**Outputs**:
- `ResearchResult` - Sources, findings, recommendations

**Integration Points**:
```typescript
// Called by PRD Feasibility Analyzer
const research = await webPatternResearcher.research({
  queryId: `${prdId}-research`,
  type: 'architecture',
  description: 'OAuth 2.0 with JWT tokens and Redis caching',
  context: {
    techStack: ['Node.js', 'Redis', 'PostgreSQL'],
    constraints: ['sub-200ms latency', 'SOC 2 compliance']
  },
  priority: 'high'
});

// Result includes:
// - Sources (10 URLs from docs, blogs, GitHub)
// - Findings (security issues, anti-patterns, best practices)
// - Recommendations (Circuit Breaker, PKCE, rate limiting)
// - Benchmarks (p95: 150ms with Redis)

// PRD Feasibility Analyzer uses this for risk assessment
```

**Research Flow**:
```
Query: "OAuth 2.0 architecture with Redis caching for 10k users"

1. Check RAG Cache
   â”œâ”€â†’ Cache hit (85% similar previous query)
   â””â”€â†’ Return cached results (0ms)

2. If cache miss â†’ Execute Exa MCP
   â”œâ”€â†’ Search: "OAuth 2.0 best practices"
   â”œâ”€â†’ Search: "Redis caching patterns"
   â””â”€â†’ Search: "10k concurrent users architecture"

3. Analyze Results
   â”œâ”€â†’ Extract findings
   â”‚   â”œâ”€ Security: PKCE required for public clients
   â”‚   â”œâ”€ Anti-pattern: Storing tokens in localStorage
   â”‚   â””â”€ Best practice: Use refresh tokens
   â”œâ”€â†’ Extract recommendations
   â”‚   â”œâ”€ Implement Circuit Breaker
   â”‚   â”œâ”€ Use connection pooling
   â”‚   â””â”€ Add rate limiting
   â””â”€â†’ Extract benchmarks
       â””â”€ p95: 50-150ms with Redis

4. Store in RAG
   â””â”€â†’ Query + Results saved for future use

Return: 10 sources, 5 findings, 3 recommendations, 2 benchmarks
```

---

### **System 11: Architecture Stress Tester**

**Role**: Validates architecture via load simulation

**Inputs**:
- `StressTestConfig` - Architecture + load profile

**Outputs**:
- `StressTestResult` - Performance metrics + bottlenecks

**Integration Points**:
```typescript
// Called by PRD Feasibility Analyzer
const stressTest = await architectureStressTester.runStressTest({
  testId: `${prdId}-stress`,
  architecture: {
    components: [
      { id: 'api', type: 'api', capacity: { maxThroughput: '10k req/s' } },
      { id: 'db', type: 'database', capacity: { maxConnections: 100 } },
      { id: 'cache', type: 'cache', capacity: { maxMemory: '4GB' } }
    ],
    connections: [
      { from: 'api', to: 'cache', protocol: 'tcp', latency: 1 },
      { from: 'api', to: 'db', protocol: 'tcp', latency: 5 }
    ]
  },
  loadProfile: {
    pattern: 'ramp-up',
    concurrentUsers: 10000,
    rampUpTime: 300 // 5 minutes
  },
  successCriteria: {
    maxResponseTime: 200, // p95
    maxErrorRate: 1, // 1%
    maxCpuUsage: 80
  }
});

// Result used for feasibility decision
if (stressTest.passed) {
  // Architecture validated âœ…
} else {
  // Show bottlenecks to user
  console.log('Bottlenecks:', stressTest.bottlenecks);
  console.log('Recommendations:', stressTest.recommendations);
}
```

**Stress Test Flow**:
```
Architecture: API â†’ Cache â†’ Database

Load Profile:
  - Start: 0 users
  - Ramp to: 10,000 users over 5 minutes
  - Pattern: Linear ramp-up

Simulation Results:
  Response Time:
    - p50: 75ms âœ…
    - p95: 150ms âœ… (under 200ms target)
    - p99: 280ms âš ï¸
    - max: 450ms âš ï¸

  Throughput: 8,500 req/s âœ…

  Error Rate: 0.2% âœ… (under 1% target)

  Resource Usage:
    - CPU: 65% âœ…
    - Memory: 55% âœ…
    - Network: 45% âœ…

  Bottlenecks Detected:
    1. Database connection pool at 80% âš ï¸
       â†’ Recommendation: Increase pool size to 200
    2. API CPU spikes to 85% at peak âš ï¸
       â†’ Recommendation: Horizontal scaling

  Failure Scenarios:
    - Database down â†’ Cache fallback works âœ…
    - API slow response â†’ Circuit breaker works âœ…

Decision: PASSED (with recommendations)
```

---

### **System 12: Diagram Generator**

**Role**: Auto-generates Mermaid diagrams for visualization

**Inputs**:
- `Epic` or `PRD` or `Architecture` or `Task[]`

**Outputs**:
- `GeneratedDiagram` - Mermaid code + markdown block

**Integration Points**:
```typescript
// Called by Master Orchestrator after epic creation
const epicDiagram = diagramGenerator.generateEpicDiagram(epic);
const depGraph = diagramGenerator.generateDependencyGraph(allTasks);
const mindmap = diagramGenerator.generateMindmap(prd);

// Diagrams auto-embedded in epic documentation
// Saved to: docs/diagrams/epic-{id}.md
```

**Diagram Generation Example**:
```
Epic: "User Authentication"
Stories: 3
Tasks: 12

generateEpicDiagram(epic)
  â†“
Mermaid Code:
```mermaid
graph TB
  Epic["User Authentication<br/>Priority: p1-high"]
  Story1["OAuth Login<br/>must-have"]
  Story2["Session Management<br/>must-have"]
  Task1_1["ğŸ’» Backend API<br/>8.5"]
  Task1_2["ğŸ’» Frontend UI<br/>7.2"]
  Task1_3["ğŸ§ª Tests<br/>6.8"]

  Epic --> Story1
  Epic --> Story2
  Story1 --> Task1_1
  Story1 --> Task1_2
  Story1 --> Task1_3
  Task1_1 -.->|depends| Task1_2
  Task1_1 -.->|depends| Task1_3
```

Embedded in: docs/epics/epic-auth-123.md
```
```

---

### **System 13: Auto-Index Generator**

**Role**: Generates INDEX.md for repository organization

**Inputs**:
- `directoryPath: string`

**Outputs**:
- `DirectoryIndex` - INDEX.md content

**Integration Points**:
```typescript
// Called by Master Orchestrator (optional)
const indexes = await autoIndexGenerator.generateRecursiveIndexes(projectPath);

// Generates INDEX.md in:
// - / (root)
// - /src
// - /src/intelligence
// - /src/orchestration
// - /src/agents
// - etc.
```

**Index Structure**:
```
src/intelligence/INDEX.md:

# Index: intelligence/

## ğŸ§© Components

- **[mindset-context-engine.ts](mindset-context-engine.ts)** - Strategic alignment
- **[epic-conversation-analyzer.ts](epic-conversation-analyzer.ts)** - NLP detection
- **[prd-feasibility-analyzer.ts](prd-feasibility-analyzer.ts)** - Go/no-go decision

## ğŸ“ Subdirectories

- **[tests/](tests/INDEX.md)** - Unit tests

## ğŸ“Š Statistics

- Files: 8
- Directories: 1
- Total size: 6,200 lines
```

---

### **System 14: Context Assembler**

**Role**: Creates .context/ directory for Claude/Cursor integration

**Inputs**:
- `Epic`, `Agent[]`, `Task[]`, project mindset

**Outputs**:
- `ContextFile[]` - Context files for .context/

**Integration Points**:
```typescript
// Called by Master Orchestrator after epic creation

// 1. Generate project context
const projectContext = contextAssembler.generateProjectContext(
  projectName,
  mindset,
  techStack
);

// 2. Generate epic context
const epicContext = contextAssembler.generateEpicContext(epic);

// 3. Generate agent contexts
for (const agentType of ['marcus-backend', 'james-frontend', 'maria-qa']) {
  const agentContext = contextAssembler.generateAgentContext(
    agentType,
    tasksForAgent,
    guidelines
  );
}

// 4. Generate routing rules
const routing = contextAssembler.generateContextRouting(rules);

// 5. Assemble context for specific scenario
const assembly = await contextAssembler.assembleContext(
  { type: 'epic-id', value: epic.id },
  routingRules
);
// Returns: PROJECT_CONTEXT.md + epics/epic-123.md (optimized to 2,500 tokens)
```

**.context/ Structure**:
```
.context/
â”œâ”€â”€ PROJECT_CONTEXT.md (1,200 tokens)
â”‚   - Project vision
â”‚   - Strategic goals
â”‚   - Tech stack
â”‚   - Constraints
â”‚
â”œâ”€â”€ CONTEXT_ROUTING.json
â”‚   - Trigger rules
â”‚   - Context inclusion rules
â”‚   - Token limits
â”‚
â”œâ”€â”€ epics/
â”‚   â””â”€â”€ epic-auth-123.md (800 tokens)
â”‚       - Epic description
â”‚       - User stories
â”‚       - Tasks
â”‚       - Timeline
â”‚
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ marcus-backend.md (500 tokens)
â”‚   â”‚   - Role & responsibilities
â”‚   â”‚   - Current tasks
â”‚   â”‚   - Best practices
â”‚   â”‚
â”‚   â””â”€â”€ james-frontend.md (500 tokens)
â”‚
â””â”€â”€ tasks/
    â””â”€â”€ task-001.md (300 tokens)
        - Task description
        - Dependencies
        - Files to modify
```

**Context Routing Example**:
```json
{
  "rules": [
    {
      "trigger": {
        "type": "file-pattern",
        "value": "src/api/*.ts"
      },
      "includeContexts": [
        ".context/PROJECT_CONTEXT.md",
        ".context/agents/marcus-backend.md"
      ],
      "priority": 9,
      "maxTokens": 8000
    },
    {
      "trigger": {
        "type": "epic-id",
        "value": "epic-auth-123"
      },
      "includeContexts": [
        ".context/PROJECT_CONTEXT.md",
        ".context/epics/epic-auth-123.md",
        ".context/agents/marcus-backend.md"
      ],
      "priority": 10,
      "maxTokens": 10000
    }
  ],
  "maxTotalTokens": 20000
}
```

When Claude/Cursor opens file matching pattern:
1. Loads CONTEXT_ROUTING.json
2. Finds matching rule
3. Assembles contexts per rule
4. Optimizes to stay under maxTokens
5. Provides full context to AI assistant

---

### **System 15: Master Intelligence Orchestrator**

**Role**: Ties all 14 systems together in cohesive workflow

**Inputs**:
- `ConversationMessage[]` - User messages
- `MasterOrchestrationConfig` - Project config

**Outputs**:
- `OrchestrationResult` - Complete execution result

**Integration Flow** (Full 9-Step Process):

```typescript
async processConversation(messages, conversationId) {
  // STEP 1: Epic Detection
  const detection = await epicConversationAnalyzer.analyzeConversation(messages);
  if (!detection.isEpic) return { summary: 'Not an epic' };

  // STEP 2: Mindset Alignment
  const alignment = await mindsetContextEngine.checkAlignment(detection.title, 'epic');
  if (alignment.autoReject) return { decision: 'no-go', conflicts: alignment.conflicts };

  // STEP 3: Feasibility Analysis
  const prd = this.createPRD(detection);
  const feasibility = await prdFeasibilityAnalyzer.analyzeFeasibility(prd);
  // Internally calls: webPatternResearcher + architectureStressTester
  if (feasibility.decision === 'no-go') return { decision: 'no-go', alternatives: feasibility.alternatives };

  // STEP 4: Epic Breakdown
  const epic = await epicWorkflowOrchestrator.startEpicWorkflow(detection, conversationId);
  // Internally calls: priorityScoringEngine for each task

  // STEP 5: Sub-Agent Creation
  // Done by epicWorkflowOrchestrator internally via subAgentFactory

  // STEP 6: Conflict Resolution
  // Done by subAgentFactory internally via conflictResolutionEngine

  // STEP 7: MCP Execution
  // Done by subAgentFactory internally via mcpTaskExecutor

  // STEP 8: Visual Documentation
  const diagrams = [];
  diagrams.push(diagramGenerator.generateEpicDiagram(epic));
  diagrams.push(diagramGenerator.generateDependencyGraph(allTasks));
  diagrams.push(diagramGenerator.generateMindmap(prd));

  // STEP 9: Organization + Context
  const indexes = await autoIndexGenerator.generateRecursiveIndexes(projectPath);

  contextAssembler.generateProjectContext(projectName, mindset, techStack);
  contextAssembler.generateEpicContext(epic);
  for (const agentType of agentTypes) {
    contextAssembler.generateAgentContext(agentType, tasks, guidelines);
  }
  contextAssembler.generateContextRouting(routingRules);

  return {
    success: true,
    epicId: epic.id,
    tasksCreated: epic.totalTasks,
    subAgentsCreated: subAgentCount,
    diagramsGenerated: diagrams.map(d => d.path),
    summary: `Epic "${epic.title}" created with ${epic.stories.length} stories`
  };
}
```

---

## ğŸ”— Data Flow Across All Systems

### **Complete Example: "Add OAuth Authentication"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER: "Add OAuth authentication with Google for 10k users"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 1: Epic Conversation Analyzer                            â”‚
â”‚ INPUT: ConversationMessage[]                                    â”‚
â”‚ OUTPUT: {                                                       â”‚
â”‚   isEpic: true,                                                 â”‚
â”‚   title: "Add OAuth authentication",                           â”‚
â”‚   epicType: "feature",                                         â”‚
â”‚   priority: "p1-high",                                         â”‚
â”‚   requirements: [                                               â”‚
â”‚     { type: "functional", desc: "Google OAuth login" },        â”‚
â”‚     { type: "performance", desc: "Support 10k users" },        â”‚
â”‚     { type: "security", desc: "JWT tokens" }                   â”‚
â”‚   ],                                                            â”‚
â”‚   techStack: ["React", "Node.js"]                              â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 2: Mindset Context Engine                                â”‚
â”‚ INPUT: "Add OAuth authentication", epic, {objectives, ...}     â”‚
â”‚ CHECKS: PROJECT_MINDSET.md                                      â”‚
â”‚ FINDS: Constraint "Must use Auth0 (enterprise policy)"         â”‚
â”‚ OUTPUT: {                                                       â”‚
â”‚   aligned: false,                                               â”‚
â”‚   conflicts: [{                                                 â”‚
â”‚     type: "strategic",                                         â”‚
â”‚     severity: "critical",                                      â”‚
â”‚     description: "Must use Auth0, not Google OAuth",          â”‚
â”‚     suggestedAlternative: "Auth0 with Google provider"        â”‚
â”‚   }],                                                           â”‚
â”‚   autoReject: false                                            â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 4: PRD Feasibility Analyzer (orchestrates 9 + 10)       â”‚
â”‚ INPUT: PRD(detection)                                           â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ System 9: Web Pattern Researcher                            â”‚â”‚
â”‚ â”‚ SEARCHES: "OAuth best practices", "10k concurrent users"    â”‚â”‚
â”‚ â”‚ FINDS: PKCE required, refresh tokens, rate limiting         â”‚â”‚
â”‚ â”‚ BENCHMARKS: p95 50-150ms with Redis caching                 â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ System 10: Architecture Stress Tester                       â”‚â”‚
â”‚ â”‚ TESTS: 10k users, ramp-up pattern                          â”‚â”‚
â”‚ â”‚ RESULT: p95=150ms âœ…, error=0.2% âœ…                        â”‚â”‚
â”‚ â”‚ BOTTLENECKS: DB connection pool at 80% âš ï¸                  â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚ OUTPUT: {                                                       â”‚
â”‚   decision: "conditional",                                     â”‚
â”‚   confidence: 0.88,                                            â”‚
â”‚   riskScore: 4.2,                                              â”‚
â”‚   recommendations: [                                            â”‚
â”‚     "Use Auth0 (mindset constraint)",                         â”‚
â”‚     "Implement PKCE (security)",                              â”‚
â”‚     "Increase DB pool (bottleneck)"                           â”‚
â”‚   ]                                                             â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 5: Epic Workflow Orchestrator                            â”‚
â”‚ INPUT: EpicDetectionResult                                      â”‚
â”‚ GENERATES:                                                      â”‚
â”‚   Epic: "OAuth Authentication"                                 â”‚
â”‚   â”œâ”€ Story 1: "Google OAuth Login" (3 tasks)                  â”‚
â”‚   â”œâ”€ Story 2: "JWT Session Management" (4 tasks)              â”‚
â”‚   â””â”€ Story 3: "User Profile Integration" (5 tasks)            â”‚
â”‚ TOTAL: 12 tasks                                                â”‚
â”‚                                                                 â”‚
â”‚ CALLS System 6: Priority Scoring Engine for each task          â”‚
â”‚   Task 1: "Backend OAuth API" = 8.5/10                         â”‚
â”‚   Task 2: "Frontend Login UI" = 7.2/10                         â”‚
â”‚   Task 3: "Integration Tests" = 6.8/10                         â”‚
â”‚   ...                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 8: Sub-Agent Factory                                     â”‚
â”‚ CREATES:                                                        â”‚
â”‚   sub-marcus-1 (Backend, priority 8.5, files: [api/oauth.ts]) â”‚
â”‚   sub-james-1 (Frontend, priority 7.2, files: [ui/Login.tsx]) â”‚
â”‚   sub-maria-1 (Testing, priority 6.8, files: [*.test.ts])     â”‚
â”‚   sub-sarah-1 (Docs, priority 5.1, files: [README.md])        â”‚
â”‚                                                                 â”‚
â”‚ REGISTERS with System 7: Conflict Resolution Engine            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 7: Conflict Resolution Engine                            â”‚
â”‚ DETECTS: marcus and james both modifying api/oauth.ts          â”‚
â”‚ RESOLUTION: Priority-based (marcus 8.5 > james 7.2)            â”‚
â”‚   â†’ marcus proceeds                                             â”‚
â”‚   â†’ james blocked                                               â”‚
â”‚ SYNC CYCLE (30s): marcus completes â†’ james unblocked           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 11: MCP Task Executor (per sub-agent)                   â”‚
â”‚                                                                 â”‚
â”‚ sub-marcus-1:                                                   â”‚
â”‚   INFERS: semgrep.scan, postgresql.query, sentry.track         â”‚
â”‚   EXECUTES: âœ… semgrep (0 vuln), âœ… db (schema), âœ… sentry     â”‚
â”‚                                                                 â”‚
â”‚ sub-james-1:                                                    â”‚
â”‚   INFERS: chrome.accessibility, chrome.screenshot              â”‚
â”‚   EXECUTES: âœ… a11y (100 score), âœ… screenshot (saved)         â”‚
â”‚                                                                 â”‚
â”‚ sub-maria-1:                                                    â”‚
â”‚   INFERS: playwright.test, chrome.lighthouse                   â”‚
â”‚   EXECUTES: âœ… tests (15 passed), âœ… lighthouse (95 score)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 12: Diagram Generator                                    â”‚
â”‚ GENERATES:                                                      â”‚
â”‚   - Epic breakdown (epic â†’ 3 stories â†’ 12 tasks)               â”‚
â”‚   - Dependency graph (task dependencies visualized)            â”‚
â”‚   - PRD mindmap (objectives, requirements, tech stack)         â”‚
â”‚ SAVES: docs/diagrams/epic-oauth-*.md                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 13: Auto-Index Generator                                 â”‚
â”‚ GENERATES:                                                      â”‚
â”‚   - /INDEX.md (project root)                                   â”‚
â”‚   - /src/INDEX.md                                              â”‚
â”‚   - /src/api/INDEX.md                                          â”‚
â”‚   - /src/ui/INDEX.md                                           â”‚
â”‚ CATEGORIZES: Components, Tests, Docs, Config                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System 14: Context Assembler                                    â”‚
â”‚ CREATES .context/:                                              â”‚
â”‚   - PROJECT_CONTEXT.md (vision, goals, constraints)            â”‚
â”‚   - epics/epic-oauth-123.md (this epic's context)              â”‚
â”‚   - agents/marcus-backend.md (backend guidelines)              â”‚
â”‚   - agents/james-frontend.md (frontend guidelines)             â”‚
â”‚   - CONTEXT_ROUTING.json (smart routing rules)                 â”‚
â”‚                                                                 â”‚
â”‚ ROUTING RULE:                                                   â”‚
â”‚   File: src/api/*.ts â†’ Includes:                               â”‚
â”‚     - PROJECT_CONTEXT.md                                       â”‚
â”‚     - epics/epic-oauth-123.md                                  â”‚
â”‚     - agents/marcus-backend.md                                 â”‚
â”‚   Total: 2,500 tokens (optimized)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULT:                                                         â”‚
â”‚ âœ… Epic "OAuth Authentication" created                         â”‚
â”‚ âœ… 3 stories, 12 tasks generated                               â”‚
â”‚ âœ… 4 sub-agents created and executed                           â”‚
â”‚ âœ… 15 MCP tools executed (all passed)                          â”‚
â”‚ âœ… 3 diagrams generated                                        â”‚
â”‚ âœ… 10 INDEX.md files created                                   â”‚
â”‚ âœ… 5 context files assembled                                   â”‚
â”‚                                                                 â”‚
â”‚ Duration: 45 seconds (vs 3 hours manual)                       â”‚
â”‚ Quality: 94% (automated validation)                            â”‚
â”‚ Test Coverage: 85% (Maria-QA enforced)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key Integration Points Summary

| System | Called By | Calls | Data Passed | Data Returned |
|--------|-----------|-------|-------------|---------------|
| **1. Epic Analyzer** | Master Orchestrator | RAG | ConversationMessage[] | EpicDetectionResult |
| **2. Mindset Engine** | Master Orchestrator, PRD Analyzer | RAG | workDescription, type | AlignmentCheck |
| **3. Design Guardian** | Sub-Agents (James) | RAG | code, filePath | DesignCheckResult |
| **4. PRD Analyzer** | Master Orchestrator | 2, 9, 10, RAG | PRDDocument | FeasibilityAnalysis |
| **5. Epic Orchestrator** | Master Orchestrator | 6, 8, 7, RAG | EpicDetection | Epic |
| **6. Priority Engine** | Epic Orchestrator | RAG | TaskContext | PriorityScore |
| **7. Conflict Engine** | Sub-Agent Factory, Epic Orchestrator | RAG | SubAgent | void (registers) |
| **8. Sub-Agent Factory** | Epic Orchestrator | 7, 11 | SubAgentConfig | SubAgentInstance |
| **9. Web Researcher** | PRD Analyzer | Exa MCP, RAG | ResearchQuery | ResearchResult |
| **10. Stress Tester** | PRD Analyzer | RAG | StressTestConfig | StressTestResult |
| **11. MCP Executor** | Sub-Agent Factory | 14 MCPs, RAG | Task | MCPExecutionResult |
| **12. Diagram Gen** | Master Orchestrator | - | Epic/PRD/Tasks | GeneratedDiagram |
| **13. Index Gen** | Master Orchestrator | Glob (simulated) | directoryPath | DirectoryIndex |
| **14. Context Assembler** | Master Orchestrator | - | Epic/Agents/Tasks | ContextFile[] |
| **15. Master Orch** | External API | ALL | ConversationMessage[] | OrchestrationResult |

---

## ğŸ”‘ Critical Dependencies

### **RAG (Vector Memory Store)**
- **Used by**: 1, 2, 4, 5, 6, 7, 9, 10, 11
- **Purpose**: Historical pattern learning, context preservation
- **Storage**: Supabase pgvector (production) or in-memory (dev)

### **MCP Integration**
- **Used by**: 11 (MCP Task Executor)
- **Available MCPs**: Chrome, Playwright, GitHub, Semgrep, Sentry, AWS, PostgreSQL, Exa, etc.
- **Purpose**: Tool execution (testing, security, deployment, research)

### **Conflict Resolution**
- **Used by**: 8 (Sub-Agent Factory)
- **Managed by**: 7 (Conflict Resolution Engine)
- **Purpose**: Prevents file collisions, manages parallel execution

---

## ğŸ¬ Conclusion

All 15 systems are **tightly integrated** with clear data flows and dependencies. The Master Intelligence Orchestrator acts as the central coordinator, calling each system in the correct order and passing data between them.

**Key Integration Patterns:**

1. **Sequential Flow**: User â†’ Epic Analyzer â†’ Mindset â†’ PRD Analyzer â†’ Epic Orchestrator â†’ Execution
2. **Parallel Execution**: Sub-agents run in parallel with Conflict Resolution managing collisions
3. **RAG-Based Learning**: All systems store/query patterns for continuous improvement
4. **MCP Integration**: Automated tool inference and execution per task
5. **Visual Documentation**: Auto-generated diagrams, indexes, and contexts

**Result**: A fully automated, intelligent development workflow that reduces manual effort by 90%+ while maintaining high quality standards.
