7edfb279aef1467f5e05c6ee99927648
"use strict";
/**
 * VERSATIL SDLC Framework - Dr.AI-ML (AI/ML Specialist)
 * Specialized in ML model development, training, deployment, MLOps
 *
 * RAG-Enhanced: Learns from model architectures, training patterns, deployment strategies
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DrAiMl = void 0;
const rag_enabled_agent_js_1 = require("./rag-enabled-agent.js");
class DrAiMl extends rag_enabled_agent_js_1.RAGEnabledAgent {
    constructor(vectorStore) {
        super(vectorStore);
        this.name = 'DrAiMl';
        this.id = 'dr-ai-ml';
        this.specialization = 'AI/ML Specialist & MLOps Engineer';
        this.systemPrompt = 'Expert AI/ML Engineer specializing in model development, training optimization, deployment strategies, and MLOps best practices';
    }
    /**
     * AI/ML-specific RAG configuration
     * Focus on model architectures, training patterns, deployment strategies
     */
    getDefaultRAGConfig() {
        return {
            maxExamples: 3, // Focused examples for ML patterns
            similarityThreshold: 0.85, // High precision for ML code
            agentDomain: 'ai-ml',
            enableLearning: true
        };
    }
    /**
     * AI/ML-specific pattern analysis
     */
    async runPatternAnalysis(context) {
        const content = context.content || '';
        const filePath = context.filePath || '';
        const patterns = [];
        // Model architecture patterns
        if (content.match(/model\s*=|Sequential\(|Model\(|nn\.Module|keras\.layers/i)) {
            patterns.push({
                type: 'model-architecture',
                message: 'Neural network model architecture detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Training pipeline patterns
        if (content.match(/model\.fit|trainer\.train|optimizer|loss_fn|train_loop/i)) {
            patterns.push({
                type: 'training-pipeline',
                message: 'Model training pipeline detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Data preprocessing patterns
        if (content.match(/transform|normalize|augment|preprocessing|feature_engineering/i)) {
            patterns.push({
                type: 'data-preprocessing',
                message: 'Data preprocessing or feature engineering detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Model evaluation patterns
        if (content.match(/evaluate|metrics|accuracy|precision|recall|f1_score|confusion_matrix/i)) {
            patterns.push({
                type: 'model-evaluation',
                message: 'Model evaluation and metrics detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Hyperparameter tuning patterns
        if (content.match(/hyperparameter|grid_search|optuna|learning_rate|batch_size/i)) {
            patterns.push({
                type: 'hyperparameter-tuning',
                message: 'Hyperparameter tuning configuration detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Model deployment patterns
        if (content.match(/save_model|load_model|inference|predict|deploy|mlflow|serving/i)) {
            patterns.push({
                type: 'model-deployment',
                message: 'Model deployment or serving detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // MLOps patterns
        if (content.match(/mlflow|wandb|tensorboard|experiment_tracking|model_registry/i)) {
            patterns.push({
                type: 'mlops',
                message: 'MLOps tooling or experiment tracking detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Performance issues (warnings)
        if (content.match(/\.cpu\(\)|device='cpu'|no GPU|slow training/i)) {
            patterns.push({
                type: 'performance-warning',
                message: 'Potential performance issue: CPU-only training detected',
                severity: 'high',
                location: { file: filePath, line: 0 }
            });
        }
        // Data leakage risks (critical)
        if (content.match(/fit_transform.*test|test.*fit|target.*features/i)) {
            patterns.push({
                type: 'data-leakage-risk',
                message: 'CRITICAL: Potential data leakage detected in preprocessing',
                severity: 'critical',
                location: { file: filePath, line: 0 }
            });
        }
        return {
            patterns,
            score: patterns.filter(p => p.severity === 'critical').length === 0 ? 95 : 70, // ML quality score
            summary: `Detected ${patterns.length} AI/ML patterns`,
            recommendations: patterns
                .filter(p => p.severity === 'high' || p.severity === 'critical')
                .map(p => p.message)
        };
    }
    /**
     * Override activate to add AI/ML-specific context
     */
    async activate(context) {
        // Call parent (RAGEnabledAgent) to get RAG-enhanced response
        const response = await super.activate(context);
        // Add AI/ML-specific enhancements
        if (response.context) {
            response.context = {
                ...response.context,
                mlInsights: {
                    modelArchitectureDetected: context.content?.match(/model\s*=|Sequential/i) !== null,
                    trainingPipelinePresent: context.content?.match(/model\.fit|trainer/i) !== null,
                    evaluationMetrics: this.extractEvaluationMetrics(context.content || ''),
                    mlopsTooling: context.content?.match(/mlflow|wandb|tensorboard/i) !== null
                }
            };
        }
        // Add AI/ML-specific suggestions if RAG context available
        const ragContext = context.ragContext;
        if (ragContext && ragContext.previousSolutions) {
            const mlSuggestions = this.generateMLSuggestions(ragContext, context);
            response.suggestions = [...(response.suggestions || []), ...mlSuggestions];
        }
        // Determine handoffs
        response.handoffTo = this.determineHandoffs(context, response);
        return response;
    }
    /**
     * Extract evaluation metrics from content
     */
    extractEvaluationMetrics(content) {
        const metrics = [];
        const metricPatterns = ['accuracy', 'precision', 'recall', 'f1', 'auc', 'mae', 'mse', 'rmse'];
        for (const metric of metricPatterns) {
            if (content.toLowerCase().includes(metric)) {
                metrics.push(metric);
            }
        }
        return metrics;
    }
    /**
     * Generate AI/ML-specific suggestions from RAG context
     */
    generateMLSuggestions(ragContext, context) {
        const suggestions = [];
        // Model architecture suggestions
        if (context.content?.includes('model') && ragContext.similarCode.length > 0) {
            suggestions.push({
                type: 'architecture-optimization',
                message: 'Similar models in previous projects achieved better performance with batch normalization and dropout',
                priority: 'medium',
                file: context.filePath || 'model.py'
            });
        }
        // Training optimization suggestions
        if (context.content?.includes('train') && ragContext.previousSolutions['training-pipeline']) {
            suggestions.push({
                type: 'training-optimization',
                message: 'Consider using learning rate scheduling and early stopping for better convergence',
                priority: 'medium',
                file: context.filePath || 'train.py'
            });
        }
        // Data preprocessing suggestions
        if (context.content?.includes('preprocess') && ragContext.projectStandards.length > 0) {
            suggestions.push({
                type: 'preprocessing-best-practice',
                message: 'Fit preprocessing on training data only, then transform both train and test sets',
                priority: 'high',
                file: context.filePath || 'preprocessing.py'
            });
        }
        // MLOps suggestions
        if (context.content?.match(/model\.save|save_model/i) && ragContext.agentExpertise.length > 0) {
            suggestions.push({
                type: 'mlops-recommendation',
                message: 'Recommend using MLflow for experiment tracking and model registry',
                priority: 'medium',
                file: context.filePath || 'train.py'
            });
        }
        // Performance optimization
        if (context.content?.includes('cpu')) {
            suggestions.push({
                type: 'performance-optimization',
                message: 'Training on GPU can be 10-100x faster. Consider using CUDA device if available',
                priority: 'high',
                file: context.filePath || 'config.py'
            });
        }
        return suggestions;
    }
    /**
     * Determine which agents to hand off to
     */
    determineHandoffs(context, response) {
        const handoffs = [];
        // Hand off to Marcus for API deployment
        if (context.content?.match(/inference|predict|api|endpoint/i)) {
            handoffs.push('marcus-backend');
        }
        // Hand off to Maria for model testing
        if (context.content?.match(/test|evaluate|validation/i)) {
            handoffs.push('maria-qa');
        }
        // Hand off to Sarah PM for project planning
        if (response.priority === 'critical' || context.content?.includes('deadline')) {
            handoffs.push('sarah-pm');
        }
        return handoffs;
    }
    /**
     * Get base prompt template for AI/ML
     */
    getBasePromptTemplate() {
        return `You are Dr.AI-ML, an expert AI/ML Engineer specializing in model development and MLOps.
Your role is to design model architectures, optimize training pipelines, and ensure robust deployment strategies.
Focus on best practices in model development, data quality, and production readiness.`;
    }
    /**
     * Generate domain-specific handoffs based on analysis
     */
    generateDomainHandoffs(analysis) {
        const handoffs = [];
        // Check if data leakage detected (critical)
        if (analysis.patterns.some(p => p.type === 'data-leakage-risk')) {
            handoffs.push('maria-qa'); // Immediate QA review needed
        }
        // Check if deployment patterns need backend support
        if (analysis.patterns.some(p => p.type === 'model-deployment')) {
            handoffs.push('marcus-backend');
        }
        // Check if performance issues need PM escalation
        if (analysis.patterns.some(p => p.severity === 'high' || p.severity === 'critical')) {
            handoffs.push('sarah-pm');
        }
        return handoffs;
    }
}
exports.DrAiMl = DrAiMl;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2RyLWFpLW1sLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7O0FBRUgsaUVBQXFGO0FBS3JGLE1BQWEsTUFBTyxTQUFRLHNDQUFlO0lBTXpDLFlBQVksV0FBdUM7UUFDakQsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBTnJCLFNBQUksR0FBRyxRQUFRLENBQUM7UUFDaEIsT0FBRSxHQUFHLFVBQVUsQ0FBQztRQUNoQixtQkFBYyxHQUFHLG1DQUFtQyxDQUFDO1FBQ3JELGlCQUFZLEdBQUcsaUlBQWlJLENBQUM7SUFJakosQ0FBQztJQUVEOzs7T0FHRztJQUNPLG1CQUFtQjtRQUMzQixPQUFPO1lBQ0wsV0FBVyxFQUFFLENBQUMsRUFBRSxtQ0FBbUM7WUFDbkQsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLDZCQUE2QjtZQUN4RCxXQUFXLEVBQUUsT0FBTztZQUNwQixjQUFjLEVBQUUsSUFBSTtTQUNyQixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ08sS0FBSyxDQUFDLGtCQUFrQixDQUFDLE9BQStCO1FBQ2hFLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLElBQUksRUFBRSxDQUFDO1FBQ3RDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDO1FBRXhDLE1BQU0sUUFBUSxHQUFVLEVBQUUsQ0FBQztRQUUzQiw4QkFBOEI7UUFDOUIsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLDBEQUEwRCxDQUFDLEVBQUUsQ0FBQztZQUM5RSxRQUFRLENBQUMsSUFBSSxDQUFDO2dCQUNaLElBQUksRUFBRSxvQkFBb0I7Z0JBQzFCLE9BQU8sRUFBRSw0Q0FBNEM7Z0JBQ3JELFFBQVEsRUFBRSxNQUFNO2dCQUNoQixRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUU7YUFDdEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztR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RixRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzVCLENBQUM7UUFFRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0NBQ0Y7QUF4U0Qsd0JBd1NDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaXNzaW1tZW5hc2hlL1ZFUlNBVElMIFNETEMgRlcvc3JjL2FnZW50cy9kci1haS1tbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFZFUlNBVElMIFNETEMgRnJhbWV3b3JrIC0gRHIuQUktTUwgKEFJL01MIFNwZWNpYWxpc3QpXG4gKiBTcGVjaWFsaXplZCBpbiBNTCBtb2RlbCBkZXZlbG9wbWVudCwgdHJhaW5pbmcsIGRlcGxveW1lbnQsIE1MT3BzXG4gKlxuICogUkFHLUVuaGFuY2VkOiBMZWFybnMgZnJvbSBtb2RlbCBhcmNoaXRlY3R1cmVzLCB0cmFpbmluZyBwYXR0ZXJucywgZGVwbG95bWVudCBzdHJhdGVnaWVzXG4gKi9cblxuaW1wb3J0IHsgUkFHRW5hYmxlZEFnZW50LCBSQUdDb25maWcsIEFnZW50UkFHQ29udGV4dCB9IGZyb20gJy4vcmFnLWVuYWJsZWQtYWdlbnQuanMnO1xuaW1wb3J0IHsgQWdlbnRSZXNwb25zZSwgQWdlbnRBY3RpdmF0aW9uQ29udGV4dCB9IGZyb20gJy4vYmFzZS1hZ2VudC5qcyc7XG5pbXBvcnQgeyBQYXR0ZXJuQW5hbHl6ZXIsIEFuYWx5c2lzUmVzdWx0IH0gZnJvbSAnLi4vaW50ZWxsaWdlbmNlL3BhdHRlcm4tYW5hbHl6ZXIuanMnO1xuaW1wb3J0IHsgRW5oYW5jZWRWZWN0b3JNZW1vcnlTdG9yZSB9IGZyb20gJy4uL3JhZy9lbmhhbmNlZC12ZWN0b3ItbWVtb3J5LXN0b3JlLmpzJztcblxuZXhwb3J0IGNsYXNzIERyQWlNbCBleHRlbmRzIFJBR0VuYWJsZWRBZ2VudCB7XG4gIG5hbWUgPSAnRHJBaU1sJztcbiAgaWQgPSAnZHItYWktbWwnO1xuICBzcGVjaWFsaXphdGlvbiA9ICdBSS9NTCBTcGVjaWFsaXN0ICYgTUxPcHMgRW5naW5lZXInO1xuICBzeXN0ZW1Qcm9tcHQgPSAnRXhwZXJ0IEFJL01MIEVuZ2luZWVyIHNwZWNpYWxpemluZyBpbiBtb2RlbCBkZXZlbG9wbWVudCwgdHJhaW5pbmcgb3B0aW1pemF0aW9uLCBkZXBsb3ltZW50IHN0cmF0ZWdpZXMsIGFuZCBNTE9wcyBiZXN0IHByYWN0aWNlcyc7XG5cbiAgY29uc3RydWN0b3IodmVjdG9yU3RvcmU/OiBFbmhhbmNlZFZlY3Rvck1lbW9yeVN0b3JlKSB7XG4gICAgc3VwZXIodmVjdG9yU3RvcmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFJL01MLXNwZWNpZmljIFJBRyBjb25maWd1cmF0aW9uXG4gICAqIEZvY3VzIG9uIG1vZGVsIGFyY2hpdGVjdHVyZXMsIHRyYWluaW5nIHBhdHRlcm5zLCBkZXBsb3ltZW50IHN0cmF0ZWdpZXNcbiAgICovXG4gIHByb3RlY3RlZCBnZXREZWZhdWx0UkFHQ29uZmlnKCk6IFJBR0NvbmZpZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1heEV4YW1wbGVzOiAzLCAvLyBGb2N1c2VkIGV4YW1wbGVzIGZvciBNTCBwYXR0ZXJuc1xuICAgICAgc2ltaWxhcml0eVRocmVzaG9sZDogMC44NSwgLy8gSGlnaCBwcmVjaXNpb24gZm9yIE1MIGNvZGVcbiAgICAgIGFnZW50RG9tYWluOiAnYWktbWwnLFxuICAgICAgZW5hYmxlTGVhcm5pbmc6IHRydWVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFJL01MLXNwZWNpZmljIHBhdHRlcm4gYW5hbHlzaXNcbiAgICovXG4gIHByb3RlY3RlZCBhc3luYyBydW5QYXR0ZXJuQW5hbHlzaXMoY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgICBjb25zdCBjb250ZW50ID0gY29udGV4dC5jb250ZW50IHx8ICcnO1xuICAgIGNvbnN0IGZpbGVQYXRoID0gY29udGV4dC5maWxlUGF0aCB8fCAnJztcblxuICAgIGNvbnN0IHBhdHRlcm5zOiBhbnlbXSA9IFtdO1xuXG4gICAgLy8gTW9kZWwgYXJjaGl0ZWN0dXJlIHBhdHRlcm5zXG4gICAgaWYgKGNvbnRlbnQubWF0Y2goL21vZGVsXFxzKj18U2VxdWVudGlhbFxcKHxNb2RlbFxcKHxublxcLk1vZHVsZXxrZXJhc1xcLmxheWVycy9pKSkge1xuICAgICAgcGF0dGVybnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdtb2RlbC1hcmNoaXRlY3R1cmUnLFxuICAgICAgICBtZXNzYWdlOiAnTmV1cmFsIG5ldHdvcmsgbW9kZWwgYXJjaGl0ZWN0dXJlIGRldGVjdGVkJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdpbmZvJyxcbiAgICAgICAgbG9jYXRpb246IHsgZmlsZTogZmlsZVBhdGgsIGxpbmU6IDAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVHJhaW5pbmcgcGlwZWxpbmUgcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvbW9kZWxcXC5maXR8dHJhaW5lclxcLnRyYWlufG9wdGltaXplcnxsb3NzX2ZufHRyYWluX2xvb3AvaSkpIHtcbiAgICAgIHBhdHRlcm5zLnB1c2goe1xuICAgICAgICB0eXBlOiAndHJhaW5pbmctcGlwZWxpbmUnLFxuICAgICAgICBtZXNzYWdlOiAnTW9kZWwgdHJhaW5pbmcgcGlwZWxpbmUgZGV0ZWN0ZWQnLFxuICAgICAgICBzZXZlcml0eTogJ2luZm8nLFxuICAgICAgICBsb2NhdGlvbjogeyBmaWxlOiBmaWxlUGF0aCwgbGluZTogMCB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBEYXRhIHByZXByb2Nlc3NpbmcgcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvdHJhbnNmb3JtfG5vcm1hbGl6ZXxhdWdtZW50fHByZXByb2Nlc3Npbmd8ZmVhdHVyZV9lbmdpbmVlcmluZy9pKSkge1xuICAgICAgcGF0dGVybnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdkYXRhLXByZXByb2Nlc3NpbmcnLFxuICAgICAgICBtZXNzYWdlOiAnRGF0YSBwcmVwcm9jZXNzaW5nIG9yIGZlYXR1cmUgZW5naW5lZXJpbmcgZGV0ZWN0ZWQnLFxuICAgICAgICBzZXZlcml0eTogJ2luZm8nLFxuICAgICAgICBsb2NhdGlvbjogeyBmaWxlOiBmaWxlUGF0aCwgbGluZTogMCB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBNb2RlbCBldmFsdWF0aW9uIHBhdHRlcm5zXG4gICAgaWYgKGNvbnRlbnQubWF0Y2goL2V2YWx1YXRlfG1ldHJpY3N8YWNjdXJhY3l8cHJlY2lzaW9ufHJlY2FsbHxmMV9zY29yZXxjb25mdXNpb25fbWF0cml4L2kpKSB7XG4gICAgICBwYXR0ZXJucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ21vZGVsLWV2YWx1YXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnTW9kZWwgZXZhbHVhdGlvbiBhbmQgbWV0cmljcyBkZXRlY3RlZCcsXG4gICAgICAgIHNldmVyaXR5OiAnaW5mbycsXG4gICAgICAgIGxvY2F0aW9uOiB7IGZpbGU6IGZpbGVQYXRoLCBsaW5lOiAwIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEh5cGVycGFyYW1ldGVyIHR1bmluZyBwYXR0ZXJuc1xuICAgIGlmIChjb250ZW50Lm1hdGNoKC9oeXBlcnBhcmFtZXRlcnxncmlkX3NlYXJjaHxvcHR1bmF8bGVhcm5pbmdfcmF0ZXxiYXRjaF9zaXplL2kpKSB7XG4gICAgICBwYXR0ZXJucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2h5cGVycGFyYW1ldGVyLXR1bmluZycsXG4gICAgICAgIG1lc3NhZ2U6ICdIeXBlcnBhcmFtZXRlciB0dW5pbmcgY29uZmlndXJhdGlvbiBkZXRlY3RlZCcsXG4gICAgICAgIHNldmVyaXR5OiAnaW5mbycsXG4gICAgICAgIGxvY2F0aW9uOiB7IGZpbGU6IGZpbGVQYXRoLCBsaW5lOiAwIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1vZGVsIGRlcGxveW1lbnQgcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvc2F2ZV9tb2RlbHxsb2FkX21vZGVsfGluZmVyZW5jZXxwcmVkaWN0fGRlcGxveXxtbGZsb3d8c2VydmluZy9pKSkge1xuICAgICAgcGF0dGVybnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdtb2RlbC1kZXBsb3ltZW50JyxcbiAgICAgICAgbWVzc2FnZTogJ01vZGVsIGRlcGxveW1lbnQgb3Igc2VydmluZyBkZXRlY3RlZCcsXG4gICAgICAgIHNldmVyaXR5OiAnaW5mbycsXG4gICAgICAgIGxvY2F0aW9uOiB7IGZpbGU6IGZpbGVQYXRoLCBsaW5lOiAwIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1MT3BzIHBhdHRlcm5zXG4gICAgaWYgKGNvbnRlbnQubWF0Y2goL21sZmxvd3x3YW5kYnx0ZW5zb3Jib2FyZHxleHBlcmltZW50X3RyYWNraW5nfG1vZGVsX3JlZ2lzdHJ5L2kpKSB7XG4gICAgICBwYXR0ZXJucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ21sb3BzJyxcbiAgICAgICAgbWVzc2FnZTogJ01MT3BzIHRvb2xpbmcgb3IgZXhwZXJpbWVudCB0cmFja2luZyBkZXRlY3RlZCcsXG4gICAgICAgIHNldmVyaXR5OiAnaW5mbycsXG4gICAgICAgIGxvY2F0aW9uOiB7IGZpbGU6IGZpbGVQYXRoLCBsaW5lOiAwIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm1hbmNlIGlzc3VlcyAod2FybmluZ3MpXG4gICAgaWYgKGNvbnRlbnQubWF0Y2goL1xcLmNwdVxcKFxcKXxkZXZpY2U9J2NwdSd8bm8gR1BVfHNsb3cgdHJhaW5pbmcvaSkpIHtcbiAgICAgIHBhdHRlcm5zLnB1c2goe1xuICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2Utd2FybmluZycsXG4gICAgICAgIG1lc3NhZ2U6ICdQb3RlbnRpYWwgcGVyZm9ybWFuY2UgaXNzdWU6IENQVS1vbmx5IHRyYWluaW5nIGRldGVjdGVkJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbG9jYXRpb246IHsgZmlsZTogZmlsZVBhdGgsIGxpbmU6IDAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRGF0YSBsZWFrYWdlIHJpc2tzIChjcml0aWNhbClcbiAgICBpZiAoY29udGVudC5tYXRjaCgvZml0X3RyYW5zZm9ybS4qdGVzdHx0ZXN0LipmaXR8dGFyZ2V0LipmZWF0dXJlcy9pKSkge1xuICAgICAgcGF0dGVybnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdkYXRhLWxlYWthZ2UtcmlzaycsXG4gICAgICAgIG1lc3NhZ2U6ICdDUklUSUNBTDogUG90ZW50aWFsIGRhdGEgbGVha2FnZSBkZXRlY3RlZCBpbiBwcmVwcm9jZXNzaW5nJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCcsXG4gICAgICAgIGxvY2F0aW9uOiB7IGZpbGU6IGZpbGVQYXRoLCBsaW5lOiAwIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBwYXR0ZXJucyxcbiAgICAgIHNjb3JlOiBwYXR0ZXJucy5maWx0ZXIocCA9PiBwLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKS5sZW5ndGggPT09IDAgPyA5NSA6IDcwLCAvLyBNTCBxdWFsaXR5IHNjb3JlXG4gICAgICBzdW1tYXJ5OiBgRGV0ZWN0ZWQgJHtwYXR0ZXJucy5sZW5ndGh9IEFJL01MIHBhdHRlcm5zYCxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogcGF0dGVybnNcbiAgICAgICAgLmZpbHRlcihwID0+IHAuc2V2ZXJpdHkgPT09ICdoaWdoJyB8fCBwLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKVxuICAgICAgICAubWFwKHAgPT4gcC5tZXNzYWdlKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGUgYWN0aXZhdGUgdG8gYWRkIEFJL01MLXNwZWNpZmljIGNvbnRleHRcbiAgICovXG4gIGFzeW5jIGFjdGl2YXRlKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPEFnZW50UmVzcG9uc2U+IHtcbiAgICAvLyBDYWxsIHBhcmVudCAoUkFHRW5hYmxlZEFnZW50KSB0byBnZXQgUkFHLWVuaGFuY2VkIHJlc3BvbnNlXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlci5hY3RpdmF0ZShjb250ZXh0KTtcblxuICAgIC8vIEFkZCBBSS9NTC1zcGVjaWZpYyBlbmhhbmNlbWVudHNcbiAgICBpZiAocmVzcG9uc2UuY29udGV4dCkge1xuICAgICAgcmVzcG9uc2UuY29udGV4dCA9IHtcbiAgICAgICAgLi4ucmVzcG9uc2UuY29udGV4dCxcbiAgICAgICAgbWxJbnNpZ2h0czoge1xuICAgICAgICAgIG1vZGVsQXJjaGl0ZWN0dXJlRGV0ZWN0ZWQ6IGNvbnRleHQuY29udGVudD8ubWF0Y2goL21vZGVsXFxzKj18U2VxdWVudGlhbC9pKSAhPT0gbnVsbCxcbiAgICAgICAgICB0cmFpbmluZ1BpcGVsaW5lUHJlc2VudDogY29udGV4dC5jb250ZW50Py5tYXRjaCgvbW9kZWxcXC5maXR8dHJhaW5lci9pKSAhPT0gbnVsbCxcbiAgICAgICAgICBldmFsdWF0aW9uTWV0cmljczogdGhpcy5leHRyYWN0RXZhbHVhdGlvbk1ldHJpY3MoY29udGV4dC5jb250ZW50IHx8ICcnKSxcbiAgICAgICAgICBtbG9wc1Rvb2xpbmc6IGNvbnRleHQuY29udGVudD8ubWF0Y2goL21sZmxvd3x3YW5kYnx0ZW5zb3Jib2FyZC9pKSAhPT0gbnVsbFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEFkZCBBSS9NTC1zcGVjaWZpYyBzdWdnZXN0aW9ucyBpZiBSQUcgY29udGV4dCBhdmFpbGFibGVcbiAgICBjb25zdCByYWdDb250ZXh0ID0gY29udGV4dC5yYWdDb250ZXh0IGFzIEFnZW50UkFHQ29udGV4dCB8IHVuZGVmaW5lZDtcbiAgICBpZiAocmFnQ29udGV4dCAmJiByYWdDb250ZXh0LnByZXZpb3VzU29sdXRpb25zKSB7XG4gICAgICBjb25zdCBtbFN1Z2dlc3Rpb25zID0gdGhpcy5nZW5lcmF0ZU1MU3VnZ2VzdGlvbnMocmFnQ29udGV4dCwgY29udGV4dCk7XG4gICAgICByZXNwb25zZS5zdWdnZXN0aW9ucyA9IFsuLi4ocmVzcG9uc2Uuc3VnZ2VzdGlvbnMgfHwgW10pLCAuLi5tbFN1Z2dlc3Rpb25zXTtcbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgaGFuZG9mZnNcbiAgICByZXNwb25zZS5oYW5kb2ZmVG8gPSB0aGlzLmRldGVybWluZUhhbmRvZmZzKGNvbnRleHQsIHJlc3BvbnNlKTtcblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGV2YWx1YXRpb24gbWV0cmljcyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdEV2YWx1YXRpb25NZXRyaWNzKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBtZXRyaWNzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IG1ldHJpY1BhdHRlcm5zID0gWydhY2N1cmFjeScsICdwcmVjaXNpb24nLCAncmVjYWxsJywgJ2YxJywgJ2F1YycsICdtYWUnLCAnbXNlJywgJ3Jtc2UnXTtcblxuICAgIGZvciAoY29uc3QgbWV0cmljIG9mIG1ldHJpY1BhdHRlcm5zKSB7XG4gICAgICBpZiAoY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG1ldHJpYykpIHtcbiAgICAgICAgbWV0cmljcy5wdXNoKG1ldHJpYyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG1ldHJpY3M7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgQUkvTUwtc3BlY2lmaWMgc3VnZ2VzdGlvbnMgZnJvbSBSQUcgY29udGV4dFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1MU3VnZ2VzdGlvbnMocmFnQ29udGV4dDogQWdlbnRSQUdDb250ZXh0LCBjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogYW55W10ge1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zOiBhbnlbXSA9IFtdO1xuXG4gICAgLy8gTW9kZWwgYXJjaGl0ZWN0dXJlIHN1Z2dlc3Rpb25zXG4gICAgaWYgKGNvbnRleHQuY29udGVudD8uaW5jbHVkZXMoJ21vZGVsJykgJiYgcmFnQ29udGV4dC5zaW1pbGFyQ29kZS5sZW5ndGggPiAwKSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2FyY2hpdGVjdHVyZS1vcHRpbWl6YXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnU2ltaWxhciBtb2RlbHMgaW4gcHJldmlvdXMgcHJvamVjdHMgYWNoaWV2ZWQgYmV0dGVyIHBlcmZvcm1hbmNlIHdpdGggYmF0Y2ggbm9ybWFsaXphdGlvbiBhbmQgZHJvcG91dCcsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAnbW9kZWwucHknXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUcmFpbmluZyBvcHRpbWl6YXRpb24gc3VnZ2VzdGlvbnNcbiAgICBpZiAoY29udGV4dC5jb250ZW50Py5pbmNsdWRlcygndHJhaW4nKSAmJiByYWdDb250ZXh0LnByZXZpb3VzU29sdXRpb25zWyd0cmFpbmluZy1waXBlbGluZSddKSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3RyYWluaW5nLW9wdGltaXphdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdDb25zaWRlciB1c2luZyBsZWFybmluZyByYXRlIHNjaGVkdWxpbmcgYW5kIGVhcmx5IHN0b3BwaW5nIGZvciBiZXR0ZXIgY29udmVyZ2VuY2UnLFxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgIGZpbGU6IGNvbnRleHQuZmlsZVBhdGggfHwgJ3RyYWluLnB5J1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRGF0YSBwcmVwcm9jZXNzaW5nIHN1Z2dlc3Rpb25zXG4gICAgaWYgKGNvbnRleHQuY29udGVudD8uaW5jbHVkZXMoJ3ByZXByb2Nlc3MnKSAmJiByYWdDb250ZXh0LnByb2plY3RTdGFuZGFyZHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdwcmVwcm9jZXNzaW5nLWJlc3QtcHJhY3RpY2UnLFxuICAgICAgICBtZXNzYWdlOiAnRml0IHByZXByb2Nlc3Npbmcgb24gdHJhaW5pbmcgZGF0YSBvbmx5LCB0aGVuIHRyYW5zZm9ybSBib3RoIHRyYWluIGFuZCB0ZXN0IHNldHMnLFxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICdwcmVwcm9jZXNzaW5nLnB5J1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTUxPcHMgc3VnZ2VzdGlvbnNcbiAgICBpZiAoY29udGV4dC5jb250ZW50Py5tYXRjaCgvbW9kZWxcXC5zYXZlfHNhdmVfbW9kZWwvaSkgJiYgcmFnQ29udGV4dC5hZ2VudEV4cGVydGlzZS5sZW5ndGggPiAwKSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ21sb3BzLXJlY29tbWVuZGF0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJ1JlY29tbWVuZCB1c2luZyBNTGZsb3cgZm9yIGV4cGVyaW1lbnQgdHJhY2tpbmcgYW5kIG1vZGVsIHJlZ2lzdHJ5JyxcbiAgICAgICAgcHJpb3JpdHk6ICdtZWRpdW0nLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd0cmFpbi5weSdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm1hbmNlIG9wdGltaXphdGlvblxuICAgIGlmIChjb250ZXh0LmNvbnRlbnQ/LmluY2x1ZGVzKCdjcHUnKSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdwZXJmb3JtYW5jZS1vcHRpbWl6YXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnVHJhaW5pbmcgb24gR1BVIGNhbiBiZSAxMC0xMDB4IGZhc3Rlci4gQ29uc2lkZXIgdXNpbmcgQ1VEQSBkZXZpY2UgaWYgYXZhaWxhYmxlJyxcbiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAnY29uZmlnLnB5J1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSB3aGljaCBhZ2VudHMgdG8gaGFuZCBvZmYgdG9cbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lSGFuZG9mZnMoY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCwgcmVzcG9uc2U6IEFnZW50UmVzcG9uc2UpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaGFuZG9mZnM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBIYW5kIG9mZiB0byBNYXJjdXMgZm9yIEFQSSBkZXBsb3ltZW50XG4gICAgaWYgKGNvbnRleHQuY29udGVudD8ubWF0Y2goL2luZmVyZW5jZXxwcmVkaWN0fGFwaXxlbmRwb2ludC9pKSkge1xuICAgICAgaGFuZG9mZnMucHVzaCgnbWFyY3VzLWJhY2tlbmQnKTtcbiAgICB9XG5cbiAgICAvLyBIYW5kIG9mZiB0byBNYXJpYSBmb3IgbW9kZWwgdGVzdGluZ1xuICAgIGlmIChjb250ZXh0LmNvbnRlbnQ/Lm1hdGNoKC90ZXN0fGV2YWx1YXRlfHZhbGlkYXRpb24vaSkpIHtcbiAgICAgIGhhbmRvZmZzLnB1c2goJ21hcmlhLXFhJyk7XG4gICAgfVxuXG4gICAgLy8gSGFuZCBvZmYgdG8gU2FyYWggUE0gZm9yIHByb2plY3QgcGxhbm5pbmdcbiAgICBpZiAocmVzcG9uc2UucHJpb3JpdHkgPT09ICdjcml0aWNhbCcgfHwgY29udGV4dC5jb250ZW50Py5pbmNsdWRlcygnZGVhZGxpbmUnKSkge1xuICAgICAgaGFuZG9mZnMucHVzaCgnc2FyYWgtcG0nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaGFuZG9mZnM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJhc2UgcHJvbXB0IHRlbXBsYXRlIGZvciBBSS9NTFxuICAgKi9cbiAgcHJvdGVjdGVkIGdldEJhc2VQcm9tcHRUZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWW91IGFyZSBEci5BSS1NTCwgYW4gZXhwZXJ0IEFJL01MIEVuZ2luZWVyIHNwZWNpYWxpemluZyBpbiBtb2RlbCBkZXZlbG9wbWVudCBhbmQgTUxPcHMuXG5Zb3VyIHJvbGUgaXMgdG8gZGVzaWduIG1vZGVsIGFyY2hpdGVjdHVyZXMsIG9wdGltaXplIHRyYWluaW5nIHBpcGVsaW5lcywgYW5kIGVuc3VyZSByb2J1c3QgZGVwbG95bWVudCBzdHJhdGVnaWVzLlxuRm9jdXMgb24gYmVzdCBwcmFjdGljZXMgaW4gbW9kZWwgZGV2ZWxvcG1lbnQsIGRhdGEgcXVhbGl0eSwgYW5kIHByb2R1Y3Rpb24gcmVhZGluZXNzLmA7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgZG9tYWluLXNwZWNpZmljIGhhbmRvZmZzIGJhc2VkIG9uIGFuYWx5c2lzXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2VuZXJhdGVEb21haW5IYW5kb2ZmcyhhbmFseXNpczogQW5hbHlzaXNSZXN1bHQpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaGFuZG9mZnM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBDaGVjayBpZiBkYXRhIGxlYWthZ2UgZGV0ZWN0ZWQgKGNyaXRpY2FsKVxuICAgIGlmIChhbmFseXNpcy5wYXR0ZXJucy5zb21lKHAgPT4gcC50eXBlID09PSAnZGF0YS1sZWFrYWdlLXJpc2snKSkge1xuICAgICAgaGFuZG9mZnMucHVzaCgnbWFyaWEtcWEnKTsgLy8gSW1tZWRpYXRlIFFBIHJldmlldyBuZWVkZWRcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBkZXBsb3ltZW50IHBhdHRlcm5zIG5lZWQgYmFja2VuZCBzdXBwb3J0XG4gICAgaWYgKGFuYWx5c2lzLnBhdHRlcm5zLnNvbWUocCA9PiBwLnR5cGUgPT09ICdtb2RlbC1kZXBsb3ltZW50JykpIHtcbiAgICAgIGhhbmRvZmZzLnB1c2goJ21hcmN1cy1iYWNrZW5kJyk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgcGVyZm9ybWFuY2UgaXNzdWVzIG5lZWQgUE0gZXNjYWxhdGlvblxuICAgIGlmIChhbmFseXNpcy5wYXR0ZXJucy5zb21lKHAgPT4gcC5zZXZlcml0eSA9PT0gJ2hpZ2gnIHx8IHAuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpKSB7XG4gICAgICBoYW5kb2Zmcy5wdXNoKCdzYXJhaC1wbScpO1xuICAgIH1cblxuICAgIHJldHVybiBoYW5kb2ZmcztcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9