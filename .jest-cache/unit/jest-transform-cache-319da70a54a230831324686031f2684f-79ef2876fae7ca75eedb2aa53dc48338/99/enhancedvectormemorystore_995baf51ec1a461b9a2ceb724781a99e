15af70b74963aed034d9fe980dcbcfb0
"use strict";
/**
 * VERSATIL SDLC Framework - Enhanced Vector Memory Store
 * Advanced RAG with reranking, multimodal support, and proper vector DB
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.vectorMemoryStore = exports.EnhancedVectorMemoryStore = void 0;
const events_1 = require("events");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const logger_js_1 = require("../utils/logger.js");
const supabase_js_1 = require("@supabase/supabase-js");
class EnhancedVectorMemoryStore extends events_1.EventEmitter {
    constructor() {
        super();
        this.memories = new Map();
        this.embeddings = new Map();
        this.isSupabaseEnabled = false;
        this.edgeFunctionsEnabled = false;
        this.supabaseUrl = null;
        // Enhanced configuration
        this.config = {
            embeddingDimension: 1536, // OpenAI ada-002 dimension
            maxMemorySize: 100000,
            rerankingEnabled: true,
            multimodalEnabled: true,
            hybridSearchEnabled: true,
            defaultReranking: {
                recency: 0.15,
                relevance: 0.4,
                contextMatch: 0.25,
                agentExpertise: 0.1,
                crossModalBoost: 0.1
            }
        };
        this.logger = new logger_js_1.VERSATILLogger();
        this.indexPath = path.join(process.cwd(), '.versatil', 'rag', 'vector-index');
        this.initialize();
    }
    /**
     * Initialize Supabase connection if available
     */
    async initialize() {
        // Ensure directory exists
        await fs.promises.mkdir(this.indexPath, { recursive: true });
        // Try to initialize Supabase if configured
        await this.initializeSupabase();
        await this.loadExistingMemories();
        this.logger.info('Enhanced vector memory store initialized', {
            memoryCount: this.memories.size,
            supabaseEnabled: this.isSupabaseEnabled,
            features: {
                reranking: this.config.rerankingEnabled,
                multimodal: this.config.multimodalEnabled,
                hybridSearch: this.config.hybridSearchEnabled
            }
        }, 'rag-memory');
    }
    async initializeSupabase() {
        try {
            const supabaseUrl = process.env.SUPABASE_URL;
            const supabaseKey = process.env.SUPABASE_ANON_KEY;
            if (supabaseUrl && supabaseKey) {
                this.supabase = (0, supabase_js_1.createClient)(supabaseUrl, supabaseKey);
                this.isSupabaseEnabled = true;
                this.supabaseUrl = supabaseUrl;
                this.edgeFunctionsEnabled = true; // Enable edge functions integration
                // Ensure vector table exists
                await this.ensureVectorTable();
                this.logger.info('Supabase + Edge Functions initialized', {
                    supabaseUrl: supabaseUrl.replace(/\/.*/, '//[HIDDEN]'),
                    edgeFunctions: this.edgeFunctionsEnabled
                }, 'rag-memory');
            }
        }
        catch (error) {
            this.logger.warn('Supabase initialization failed, using local storage', { error }, 'rag-memory');
        }
    }
    /**
     * Store a memory document with vector embedding
     */
    async storeMemory(doc) {
        const id = this.generateMemoryId();
        const embedding = await this.generateMultimodalEmbedding(doc);
        const memory = {
            id,
            ...doc,
            embedding
        };
        // Store locally
        this.memories.set(id, memory);
        this.embeddings.set(id, embedding);
        // Store in vector DB if available
        if (this.isSupabaseEnabled) {
            await this.storeInSupabase(memory);
        }
        await this.persistMemory(memory);
        this.emit('memory_stored', {
            id,
            agentId: doc.metadata.agentId,
            contentType: doc.contentType
        });
        return id;
    }
    /**
     * Enhanced query with reranking and multimodal support
     */
    async queryMemoriesInternal(query) {
        const startTime = Date.now();
        let documents;
        let searchMethod = 'semantic';
        // Determine search strategy
        if (query.queryType === 'hybrid' || this.config.hybridSearchEnabled) {
            documents = await this.hybridSearch(query);
            searchMethod = 'hybrid';
        }
        else if (this.isSupabaseEnabled) {
            documents = await this.vectorSearch(query);
            searchMethod = 'vector';
        }
        else {
            documents = await this.localSemanticSearch(query);
            searchMethod = 'local-semantic';
        }
        // Apply reranking if requested or enabled by default
        let reranked = false;
        if (query.rerank !== false && this.config.rerankingEnabled) {
            documents = await this.rerankResults(documents, query);
            reranked = true;
        }
        // Limit to topK
        const topK = query.topK || 10;
        const finalDocuments = documents.slice(0, topK);
        return {
            documents: finalDocuments,
            reranked,
            queryEmbedding: await this.generateEmbedding(query.query),
            processingTime: Date.now() - startTime,
            searchMethod,
            totalMatches: documents.length
        };
    }
    /**
     * Hybrid search combining semantic and keyword matching
     */
    async hybridSearch(query) {
        // Semantic search
        const semanticResults = await this.localSemanticSearch(query);
        // Keyword search
        const keywordResults = await this.keywordSearch(query);
        // Merge and deduplicate
        const resultMap = new Map();
        // Add semantic results with boosted scores
        semanticResults.forEach(doc => {
            resultMap.set(doc.id, {
                ...doc,
                metadata: {
                    ...doc.metadata,
                    relevanceScore: (doc.metadata.relevanceScore || 0) * 1.2
                }
            });
        });
        // Add keyword results
        keywordResults.forEach(doc => {
            if (resultMap.has(doc.id)) {
                // Boost documents found by both methods
                const existing = resultMap.get(doc.id);
                existing.metadata.relevanceScore = (existing.metadata.relevanceScore || 0) + 0.3;
            }
            else {
                resultMap.set(doc.id, doc);
            }
        });
        return Array.from(resultMap.values());
    }
    /**
     * Keyword-based search
     */
    async keywordSearch(query) {
        const keywords = query.query.toLowerCase().split(' ').filter(w => w.length > 2);
        let memories = Array.from(this.memories.values());
        // Apply filters
        if (query.filters) {
            memories = this.applyFilters(memories, query.filters);
        }
        // Score by keyword matches
        const scored = memories.map(memory => {
            const content = memory.content.toLowerCase();
            const metadata = JSON.stringify(memory.metadata).toLowerCase();
            let score = 0;
            keywords.forEach(keyword => {
                if (content.includes(keyword))
                    score += 1;
                if (metadata.includes(keyword))
                    score += 0.5;
            });
            return {
                memory: {
                    ...memory,
                    metadata: { ...memory.metadata, relevanceScore: score / keywords.length }
                },
                score
            };
        });
        // Sort and filter
        return scored
            .filter(s => s.score > 0)
            .sort((a, b) => b.score - a.score)
            .map(s => s.memory);
    }
    /**
     * Advanced reranking with multiple criteria
     */
    async rerankResults(documents, query) {
        const criteria = this.config.defaultReranking;
        const now = Date.now();
        // Get project context if available
        const projectContext = await this.getProjectContext();
        // Score each document
        const reranked = documents.map(doc => {
            let finalScore = 0;
            // 1. Relevance score (from initial search)
            const relevance = doc.metadata.relevanceScore || 0;
            finalScore += relevance * criteria.relevance;
            // 2. Recency score
            const age = now - doc.metadata.timestamp;
            const recencyScore = Math.exp(-age / (30 * 24 * 60 * 60 * 1000)); // Decay over 30 days
            finalScore += recencyScore * criteria.recency;
            // 3. Context match score
            let contextScore = 0;
            if (projectContext) {
                if (doc.metadata.language === projectContext.language)
                    contextScore += 0.5;
                if (doc.metadata.framework === projectContext.framework)
                    contextScore += 0.5;
            }
            finalScore += contextScore * criteria.contextMatch;
            // 4. Agent expertise score
            const agentExpertise = this.getAgentExpertiseScore(doc.metadata.agentId, query.query);
            finalScore += agentExpertise * criteria.agentExpertise;
            // 5. Cross-modal boost
            if (doc.contentType !== 'text' && query.includeImages) {
                finalScore += criteria.crossModalBoost;
            }
            return {
                document: doc,
                finalScore
            };
        });
        // Sort by final score
        reranked.sort((a, b) => b.finalScore - a.finalScore);
        // Update relevance scores
        return reranked.map(r => ({
            ...r.document,
            metadata: {
                ...r.document.metadata,
                relevanceScore: r.finalScore
            }
        }));
    }
    /**
     * Generate embeddings for multimodal content
     */
    async generateMultimodalEmbedding(doc) {
        if (doc.contentType === 'text' || doc.contentType === 'code') {
            return this.generateEmbedding(doc.content);
        }
        else if (doc.contentType === 'image' && doc.metadata.imageData) {
            return this.generateImageEmbedding(doc.metadata.imageData);
        }
        else if (doc.contentType === 'mixed') {
            // Combine text and image embeddings
            const textEmb = await this.generateEmbedding(doc.content);
            if (doc.metadata.imageData) {
                const imgEmb = await this.generateImageEmbedding(doc.metadata.imageData);
                // Average the embeddings (simple fusion)
                return textEmb.map((val, idx) => (val + imgEmb[idx]) / 2);
            }
            return textEmb;
        }
        return this.generateEmbedding(doc.content);
    }
    /**
     * Generate embedding for images using CLIP (via Hugging Face Transformers.js)
     */
    async generateImageEmbedding(imageData) {
        try {
            // Use Hugging Face Transformers.js for CLIP embeddings
            const { pipeline } = await Promise.resolve().then(() => __importStar(require('@xenova/transformers')));
            // Create feature extraction pipeline with CLIP model
            const extractor = await pipeline('feature-extraction', 'Xenova/clip-vit-base-patch32');
            // Generate embedding from image data
            const output = await extractor(imageData, { pooling: 'mean', normalize: true });
            // Convert tensor to array
            const embedding = Array.from(output.data);
            // Resize to match configured dimension if needed
            if (embedding.length !== this.config.embeddingDimension) {
                return this.resizeEmbedding(embedding, this.config.embeddingDimension);
            }
            return embedding;
        }
        catch (error) {
            console.warn('CLIP embedding generation failed, using fallback:', error);
            // Fallback: Generate random normalized embedding
            const embedding = Array(this.config.embeddingDimension).fill(0).map(() => Math.random());
            const norm = Math.sqrt(embedding.reduce((sum, val) => sum + val * val, 0));
            return embedding.map(val => val / norm);
        }
    }
    /**
     * Resize embedding to target dimension
     */
    resizeEmbedding(embedding, targetDim) {
        if (embedding.length === targetDim)
            return embedding;
        // Simple interpolation/truncation
        if (embedding.length > targetDim) {
            // Truncate
            return embedding.slice(0, targetDim);
        }
        else {
            // Pad with zeros
            return [...embedding, ...Array(targetDim - embedding.length).fill(0)];
        }
    }
    /**
     * Store in Supabase vector database
     */
    async storeInSupabase(memory) {
        if (!this.isSupabaseEnabled)
            return;
        try {
            const { error } = await this.supabase
                .from('versatil_memories')
                .upsert({
                id: memory.id,
                content: memory.content,
                content_type: memory.contentType,
                embedding: memory.embedding,
                metadata: memory.metadata,
                agent_id: memory.metadata.agentId,
                created_at: new Date(memory.metadata.timestamp).toISOString()
            });
            if (error) {
                this.logger.error('Failed to store in Supabase', { error }, 'rag-memory');
            }
        }
        catch (error) {
            this.logger.error('Supabase storage error', { error }, 'rag-memory');
        }
    }
    /**
     * Vector search using Supabase
     */
    async vectorSearch(query) {
        if (!this.isSupabaseEnabled) {
            return this.localSemanticSearch(query);
        }
        try {
            const queryEmbedding = await this.generateEmbedding(query.query);
            // Build the RPC call
            let rpcQuery = this.supabase.rpc('match_memories', {
                query_embedding: queryEmbedding,
                match_threshold: 0.7,
                match_count: query.topK || 20
            });
            // Apply filters
            if (query.agentId) {
                rpcQuery = rpcQuery.eq('agent_id', query.agentId);
            }
            if (query.filters?.contentTypes) {
                rpcQuery = rpcQuery.in('content_type', query.filters.contentTypes);
            }
            const { data, error } = await rpcQuery;
            if (error) {
                this.logger.error('Vector search failed', { error }, 'rag-memory');
                return this.localSemanticSearch(query);
            }
            return data.map((row) => ({
                id: row.id,
                content: row.content,
                contentType: row.content_type,
                embedding: row.embedding,
                metadata: {
                    ...row.metadata,
                    relevanceScore: row.similarity
                }
            }));
        }
        catch (error) {
            this.logger.error('Vector search error', { error }, 'rag-memory');
            return this.localSemanticSearch(query);
        }
    }
    /**
     * Local semantic search (fallback)
     */
    async localSemanticSearch(query) {
        const queryEmbedding = await this.generateEmbedding(query.query);
        // Filter memories
        let filteredMemories = Array.from(this.memories.values());
        if (query.agentId) {
            filteredMemories = filteredMemories.filter(m => m.metadata.agentId === query.agentId);
        }
        if (query.filters) {
            filteredMemories = this.applyFilters(filteredMemories, query.filters);
        }
        // Calculate similarity scores
        const scoredMemories = filteredMemories.map(memory => ({
            memory,
            score: this.cosineSimilarity(queryEmbedding, memory.embedding || [])
        }));
        // Sort by relevance
        scoredMemories.sort((a, b) => b.score - a.score);
        return scoredMemories.map(({ memory, score }) => ({
            ...memory,
            metadata: { ...memory.metadata, relevanceScore: score }
        }));
    }
    /**
     * Get agent expertise score for reranking
     */
    getAgentExpertiseScore(agentId, query) {
        const expertise = {
            'enhanced-marcus': ['backend', 'api', 'database', 'typescript'],
            'enhanced-james': ['frontend', 'ui', 'react', 'css'],
            'enhanced-maria': ['testing', 'qa', 'quality', 'coverage'],
            'security-sam': ['security', 'vulnerability', 'authentication'],
            'architecture-dan': ['architecture', 'design', 'patterns', 'structure'],
            'dr-ai-ml': ['ml', 'ai', 'optimization', 'performance']
        };
        const agentKeywords = expertise[agentId] || [];
        const queryLower = query.toLowerCase();
        let score = 0;
        agentKeywords.forEach(keyword => {
            if (queryLower.includes(keyword))
                score += 0.25;
        });
        return Math.min(1, score);
    }
    /**
     * Get current project context for reranking
     */
    async getProjectContext() {
        // Try to get from environment scanner if available
        try {
            const scanner = require('../environment/environment-scanner').environmentScanner;
            return scanner.getLatestScan()?.technology;
        }
        catch {
            return null;
        }
    }
    /**
     * Ensure vector table exists in Supabase
     */
    async ensureVectorTable() {
        // This would be run via migration, but included for reference
        const createTableSQL = `
      CREATE TABLE IF NOT EXISTS versatil_memories (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        content TEXT NOT NULL,
        content_type VARCHAR(50) DEFAULT 'text',
        embedding vector(1536),
        metadata JSONB DEFAULT '{}',
        agent_id TEXT,
        created_at TIMESTAMP DEFAULT NOW(),
        updated_at TIMESTAMP DEFAULT NOW()
      );
      
      CREATE INDEX IF NOT EXISTS idx_memories_embedding 
      ON versatil_memories USING ivfflat (embedding vector_cosine_ops)
      WITH (lists = 100);
      
      CREATE INDEX IF NOT EXISTS idx_memories_agent 
      ON versatil_memories(agent_id);
      
      CREATE INDEX IF NOT EXISTS idx_memories_content_type 
      ON versatil_memories(content_type);
    `;
    }
    // ... (keep other utility methods from original)
    /**
     * Store diagram or visual content
     */
    async storeDiagram(content, diagramData, metadata) {
        return this.storeMemory({
            content,
            contentType: 'diagram',
            metadata: {
                ...metadata,
                imageData: diagramData,
                mimeType: 'image/svg+xml'
            }
        });
    }
    /**
     * Store code with syntax highlighting metadata
     */
    async storeCode(code, language, metadata) {
        return this.storeMemory({
            content: code,
            contentType: 'code',
            metadata: {
                ...metadata,
                language,
                fileType: language
            }
        });
    }
    /**
     * Generate embedding (with API integration support)
     */
    async generateEmbedding(text) {
        // Check for OpenAI API key
        if (process.env.OPENAI_API_KEY) {
            try {
                // Real OpenAI embeddings API integration
                const { OpenAI } = await Promise.resolve().then(() => __importStar(require('openai')));
                const openai = new OpenAI({
                    apiKey: process.env.OPENAI_API_KEY
                });
                const response = await openai.embeddings.create({
                    model: "text-embedding-3-small",
                    input: text,
                    dimensions: this.config.embeddingDimension
                });
                const embedding = response.data[0].embedding;
                // Ensure correct dimension
                if (embedding.length !== this.config.embeddingDimension) {
                    return this.resizeEmbedding(embedding, this.config.embeddingDimension);
                }
                return embedding;
            }
            catch (error) {
                this.logger.warn('OpenAI embedding failed, using fallback', { error }, 'rag-memory');
            }
        }
        // Fallback to simple embedding
        const embedding = Array(this.config.embeddingDimension).fill(0).map(() => Math.random());
        const norm = Math.sqrt(embedding.reduce((sum, val) => sum + val * val, 0));
        return embedding.map(val => val / norm);
    }
    // Missing method implementations
    async loadExistingMemories() {
        try {
            // Load from Supabase if configured
            const { data, error } = await this.supabase
                .from('versatil_memories')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(1000);
            if (error)
                throw error;
            if (data) {
                for (const row of data) {
                    const doc = {
                        id: row.id,
                        content: row.content,
                        contentType: row.content_type || 'text',
                        metadata: row.metadata || {},
                        embedding: row.embedding || []
                    };
                    this.memories.set(doc.id, doc);
                }
                this.logger.info(`Loaded ${data.length} existing memories from Supabase`);
            }
        }
        catch (error) {
            this.logger.warn('Could not load existing memories', { error });
        }
    }
    generateMemoryId(doc) { return `mem-${Date.now()}-${Math.random()}`; }
    async persistMemory(doc) {
        try {
            // Persist to Supabase
            const { error } = await this.supabase
                .from('versatil_memories')
                .upsert({
                id: doc.id,
                content: doc.content,
                metadata: doc.metadata,
                embedding: doc.embedding,
                created_at: new Date().toISOString()
            });
            if (error) {
                this.logger.warn('Failed to persist memory to Supabase', { error });
            }
        }
        catch (error) {
            this.logger.warn('Error persisting memory', { error });
        }
    }
    applyFilters(documents, filters) { return documents; }
    cosineSimilarity(vec1, vec2) {
        return vec1.reduce((sum, val, i) => sum + val * (vec2[i] || 0), 0);
    }
    async getAllMemories() { return Array.from(this.memories.values()); }
    async searchMemories(query, options) {
        const results = await this.queryMemoriesInternal(typeof query === 'string' ? { query } : query);
        return Array.isArray(results) ? results : (results.documents || []);
    }
    async queryMemories(query) {
        return await this.queryMemoriesInternal(typeof query === 'string' ? { query } : query);
    }
    async close() {
        this.logger.info('Closing Enhanced Vector Memory Store');
        // Clear in-memory cache
        this.memories.clear();
        // No need to close Supabase client (it's stateless)
        this.logger.info('Enhanced Vector Memory Store closed');
    }
    // ============================================================================
    // AGENT-SPECIFIC RAG METHODS WITH EDGE FUNCTION INTEGRATION
    // ============================================================================
    /**
     * Enhanced Maria (QA) RAG query using edge functions
     */
    async mariaRAG(query, context, config) {
        if (!this.edgeFunctionsEnabled || !this.supabaseUrl) {
            // Fallback to local processing
            return this.localMariaRAG(query, context, config);
        }
        try {
            const response = await fetch(`${this.supabaseUrl}/functions/v1/maria-rag`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${process.env.SUPABASE_ANON_KEY}`,
                },
                body: JSON.stringify({ query, context, config }),
            });
            if (!response.ok) {
                throw new Error(`Maria RAG edge function failed: ${response.statusText}`);
            }
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'Maria RAG processing failed');
            }
            this.logger.info('Maria RAG edge function completed', {
                similarPatterns: result.data?.ragInsights?.similarPatterns || 0,
                processingTime: result.metadata?.processingTime || 0
            }, 'maria-rag');
            return result;
        }
        catch (error) {
            this.logger.warn('Maria RAG edge function failed, using fallback', { error }, 'maria-rag');
            return this.localMariaRAG(query, context, config);
        }
    }
    /**
     * Enhanced James (Frontend) RAG query using edge functions
     */
    async jamesRAG(query, context, config) {
        if (!this.edgeFunctionsEnabled || !this.supabaseUrl) {
            // Fallback to local processing
            return this.localJamesRAG(query, context, config);
        }
        try {
            const response = await fetch(`${this.supabaseUrl}/functions/v1/james-rag`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${process.env.SUPABASE_ANON_KEY}`,
                },
                body: JSON.stringify({ query, context, config }),
            });
            if (!response.ok) {
                throw new Error(`James RAG edge function failed: ${response.statusText}`);
            }
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'James RAG processing failed');
            }
            this.logger.info('James RAG edge function completed', {
                componentPatterns: result.data?.ragInsights?.componentPatterns || 0,
                processingTime: result.metadata?.processingTime || 0
            }, 'james-rag');
            return result;
        }
        catch (error) {
            this.logger.warn('James RAG edge function failed, using fallback', { error }, 'james-rag');
            return this.localJamesRAG(query, context, config);
        }
    }
    /**
     * Enhanced Marcus (Backend) RAG query using edge functions
     */
    async marcusRAG(query, context, config) {
        if (!this.edgeFunctionsEnabled || !this.supabaseUrl) {
            // Fallback to local processing
            return this.localMarcusRAG(query, context, config);
        }
        try {
            const response = await fetch(`${this.supabaseUrl}/functions/v1/marcus-rag`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${process.env.SUPABASE_ANON_KEY}`,
                },
                body: JSON.stringify({ query, context, config }),
            });
            if (!response.ok) {
                throw new Error(`Marcus RAG edge function failed: ${response.statusText}`);
            }
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'Marcus RAG processing failed');
            }
            this.logger.info('Marcus RAG edge function completed', {
                apiPatterns: result.data?.ragInsights?.apiPatterns || 0,
                securitySolutions: result.data?.ragInsights?.securitySolutions || 0,
                processingTime: result.metadata?.processingTime || 0
            }, 'marcus-rag');
            return result;
        }
        catch (error) {
            this.logger.warn('Marcus RAG edge function failed, using fallback', { error }, 'marcus-rag');
            return this.localMarcusRAG(query, context, config);
        }
    }
    /**
     * Fallback local Maria RAG processing
     */
    async localMariaRAG(query, context, config) {
        const ragQuery = {
            query: `QA testing patterns ${query}`,
            queryType: 'semantic',
            agentId: 'enhanced-maria',
            topK: config?.maxExamples || 3,
            filters: {
                tags: ['test', 'qa', 'testing'],
                contentTypes: ['code', 'text']
            }
        };
        const results = await this.queryMemoriesInternal(ragQuery);
        return {
            success: true,
            data: {
                testPatterns: results.documents,
                qaBestPractices: [],
                projectStandards: [],
                ragInsights: {
                    similarPatterns: results.documents.length,
                    projectStandards: 0,
                    expertise: 0,
                    avgSimilarity: results.documents.reduce((sum, doc) => sum + (doc.metadata.relevanceScore || 0), 0) / results.documents.length
                }
            },
            metadata: {
                agentId: 'enhanced-maria',
                processingTime: results.processingTime,
                queryType: 'local-fallback'
            }
        };
    }
    /**
     * Fallback local James RAG processing
     */
    async localJamesRAG(query, context, config) {
        const ragQuery = {
            query: `Frontend component patterns ${query}`,
            queryType: 'semantic',
            agentId: 'enhanced-james',
            topK: config?.maxExamples || 3,
            filters: {
                tags: ['frontend', 'component', 'ui'],
                contentTypes: ['code']
            }
        };
        const results = await this.queryMemoriesInternal(ragQuery);
        return {
            success: true,
            data: {
                componentPatterns: results.documents,
                uiPatterns: [],
                performancePatterns: [],
                ragInsights: {
                    componentPatterns: results.documents.length,
                    uiPatterns: 0,
                    performanceOptimizations: 0,
                    avgSimilarity: results.documents.reduce((sum, doc) => sum + (doc.metadata.relevanceScore || 0), 0) / results.documents.length
                }
            },
            metadata: {
                agentId: 'enhanced-james',
                processingTime: results.processingTime,
                queryType: 'local-fallback'
            }
        };
    }
    /**
     * Fallback local Marcus RAG processing
     */
    async localMarcusRAG(query, context, config) {
        const ragQuery = {
            query: `Backend API patterns ${query}`,
            queryType: 'semantic',
            agentId: 'enhanced-marcus',
            topK: config?.maxExamples || 3,
            filters: {
                tags: ['backend', 'api', 'security'],
                contentTypes: ['code']
            }
        };
        const results = await this.queryMemoriesInternal(ragQuery);
        return {
            success: true,
            data: {
                apiPatterns: results.documents,
                securityPatterns: [],
                performancePatterns: [],
                databaseOptimizations: [],
                ragInsights: {
                    apiPatterns: results.documents.length,
                    securitySolutions: 0,
                    performanceOptimizations: 0,
                    databaseOptimizations: 0,
                    avgSimilarity: results.documents.reduce((sum, doc) => sum + (doc.metadata.relevanceScore || 0), 0) / results.documents.length
                }
            },
            metadata: {
                agentId: 'enhanced-marcus',
                processingTime: results.processingTime,
                queryType: 'local-fallback'
            }
        };
    }
    /**
     * Store agent-specific patterns in enhanced schema
     */
    async storeAgentPattern(agentName, pattern) {
        if (!this.isSupabaseEnabled) {
            // Fallback to local storage
            return this.storeMemory({
                content: pattern.code_content || pattern.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    tags: pattern.tags || [],
                    ...pattern.metadata
                }
            });
        }
        try {
            const { data, error } = await this.supabase
                .from('agent_code_patterns')
                .insert({
                agent_name: agentName,
                pattern_type: pattern.pattern_type || 'unknown',
                code_content: pattern.code_content || pattern.content,
                file_path: pattern.file_path,
                language: pattern.language,
                framework: pattern.framework,
                quality_score: pattern.quality_score || 80,
                metadata: pattern.metadata || {},
                tags: pattern.tags || []
            })
                .select()
                .single();
            if (error) {
                throw error;
            }
            this.logger.info('Agent pattern stored in enhanced schema', {
                agentName,
                patternType: pattern.pattern_type,
                id: data.id
            }, 'rag-memory');
            return data.id;
        }
        catch (error) {
            this.logger.error('Failed to store agent pattern', { error, agentName }, 'rag-memory');
            // Fallback to local storage
            return this.storeMemory({
                content: pattern.code_content || pattern.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    tags: pattern.tags || [],
                    ...pattern.metadata
                }
            });
        }
    }
    /**
     * Store agent solutions in enhanced schema
     */
    async storeAgentSolution(agentName, solution) {
        if (!this.isSupabaseEnabled) {
            return this.storeMemory({
                content: solution.solution_code || solution.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    problemType: solution.problem_type,
                    ...solution.metadata
                }
            });
        }
        try {
            const { data, error } = await this.supabase
                .from('agent_solutions')
                .insert({
                agent_name: agentName,
                problem_type: solution.problem_type,
                problem_description: solution.problem_description,
                solution_code: solution.solution_code,
                solution_explanation: solution.solution_explanation,
                effectiveness_score: solution.effectiveness_score || 0.8,
                dependencies: solution.dependencies || [],
                compatibility: solution.compatibility || {}
            })
                .select()
                .single();
            if (error) {
                throw error;
            }
            this.logger.info('Agent solution stored in enhanced schema', {
                agentName,
                problemType: solution.problem_type,
                id: data.id
            }, 'rag-memory');
            return data.id;
        }
        catch (error) {
            this.logger.error('Failed to store agent solution', { error, agentName }, 'rag-memory');
            return this.storeMemory({
                content: solution.solution_code || solution.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    problemType: solution.problem_type,
                    ...solution.metadata
                }
            });
        }
    }
    /**
     * Get production deployment status
     */
    getProductionStatus() {
        return {
            supabaseEnabled: this.isSupabaseEnabled,
            edgeFunctionsEnabled: this.edgeFunctionsEnabled,
            agentRAGAvailable: this.edgeFunctionsEnabled && this.supabaseUrl !== null,
            enhancedSchemaReady: this.isSupabaseEnabled
        };
    }
}
exports.EnhancedVectorMemoryStore = EnhancedVectorMemoryStore;
// Export enhanced singleton instance
exports.vectorMemoryStore = new EnhancedVectorMemoryStore();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvcmFnL2VuaGFuY2VkLXZlY3Rvci1tZW1vcnktc3RvcmUudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsbUNBQXNDO0FBQ3RDLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0Isa0RBQW9EO0FBQ3BELHVEQUFxRDtBQXVEckQsTUFBYSx5QkFBMEIsU0FBUSxxQkFBWTtJQTBCekQ7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQXpCRixhQUFRLEdBQWdDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDbEQsZUFBVSxHQUEwQixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRzlDLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUNuQyx5QkFBb0IsR0FBWSxLQUFLLENBQUM7UUFDdEMsZ0JBQVcsR0FBa0IsSUFBSSxDQUFDO1FBRTFDLHlCQUF5QjtRQUNqQixXQUFNLEdBQUc7WUFDZixrQkFBa0IsRUFBRSxJQUFJLEVBQUUsMkJBQTJCO1lBQ3JELGFBQWEsRUFBRSxNQUFNO1lBQ3JCLGdCQUFnQixFQUFFLElBQUk7WUFDdEIsaUJBQWlCLEVBQUUsSUFBSTtZQUN2QixtQkFBbUIsRUFBRSxJQUFJO1lBQ3pCLGdCQUFnQixFQUFFO2dCQUNoQixPQUFPLEVBQUUsSUFBSTtnQkFDYixTQUFTLEVBQUUsR0FBRztnQkFDZCxZQUFZLEVBQUUsSUFBSTtnQkFDbEIsY0FBYyxFQUFFLEdBQUc7Z0JBQ25CLGVBQWUsRUFBRSxHQUFHO2FBQ0E7U0FDdkIsQ0FBQztRQUlBLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSwwQkFBYyxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzlFLElBQUksQ0FBQyxVQUFVLEVBQUUs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O2FBQ1osRUFBRSxZQUFZLENBQUMsQ0FBQztZQUVqQixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUM7UUFFakIsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxnQ0FBZ0MsRUFBRSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUN4RixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQ3RCLE9BQU8sRUFBRSxRQUFRLENBQUMsYUFBYSxJQUFJLFFBQVEsQ0FBQyxPQUFPO2dCQUNuRCxXQUFXLEVBQUUsTUFBTTtnQkFDbkIsUUFBUSxFQUFFO29CQUNSLE9BQU8sRUFBRSxTQUFTO29CQUNsQixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtvQkFDckIsV0FBVyxFQUFFLFFBQVEsQ0FBQyxZQUFZO29CQUNsQyxHQUFHLFFBQVEsQ0FBQyxRQUFRO2lCQUNyQjthQUNGLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxtQkFBbUI7UUFNakIsT0FBTztZQUNMLGVBQWUsRUFBRSxJQUFJLENBQUMsaUJBQWlCO1lBQ3ZDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxvQkFBb0I7WUFDL0MsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssSUFBSTtZQUN6RSxtQkFBbUIsRUFBRSxJQUFJLENBQUMsaUJBQWlCO1NBQzVDLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUF6aUNELDhEQXlpQ0M7QUFFRCxxQ0FBcUM7QUFDeEIsUUFBQSxpQkFBaUIsR0FBRyxJQUFJLHlCQUF5QixFQUFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvcmFnL2VuaGFuY2VkLXZlY3Rvci1tZW1vcnktc3RvcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBWRVJTQVRJTCBTRExDIEZyYW1ld29yayAtIEVuaGFuY2VkIFZlY3RvciBNZW1vcnkgU3RvcmVcbiAqIEFkdmFuY2VkIFJBRyB3aXRoIHJlcmFua2luZywgbXVsdGltb2RhbCBzdXBwb3J0LCBhbmQgcHJvcGVyIHZlY3RvciBEQlxuICovXG5cbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgVkVSU0FUSUxMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXIuanMnO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuZXhwb3J0IGludGVyZmFjZSBNZW1vcnlEb2N1bWVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgY29udGVudFR5cGU6ICd0ZXh0JyB8ICdjb2RlJyB8ICdpbWFnZScgfCAnZGlhZ3JhbScgfCAnbWl4ZWQnIHwgJ2hhbmRvZmYnIHwgJ2NvbnRleHQtbWV0YWRhdGEnIHwgJ3dlYi1sZWFybmVkLXBhdHRlcm4nIHwgJ2ludGVyYWN0aW9uJyB8ICdtZXRhLWxlYXJuaW5nJyB8ICd3aW5uaW5nLXBhdHRlcm4nIHwgJ2FudGktcGF0dGVybicgfCAndGVhbS1zdHlsZSc7XG4gIGVtYmVkZGluZz86IG51bWJlcltdO1xuICBtZXRhZGF0YToge1xuICAgIGFnZW50SWQ6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgICBmaWxlVHlwZT86IHN0cmluZztcbiAgICBwcm9qZWN0Q29udGV4dD86IHN0cmluZztcbiAgICB0YWdzOiBzdHJpbmdbXTtcbiAgICByZWxldmFuY2VTY29yZT86IG51bWJlcjtcbiAgICBsYW5ndWFnZT86IHN0cmluZztcbiAgICBmcmFtZXdvcms/OiBzdHJpbmc7XG4gICAgaW1hZ2VEYXRhPzogc3RyaW5nOyAvLyBiYXNlNjQgZm9yIGltYWdlc1xuICAgIG1pbWVUeXBlPzogc3RyaW5nO1xuICAgIC8vIEFkZGl0aW9uYWwgbWV0YWRhdGEgZmllbGRzIGZvciBleHRlbmRlZCBmdW5jdGlvbmFsaXR5XG4gICAgW2tleTogc3RyaW5nXTogYW55O1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJBR1F1ZXJ5IHtcbiAgcXVlcnk6IHN0cmluZztcbiAgcXVlcnlUeXBlPzogJ3RleHQnIHwgJ3NlbWFudGljJyB8ICdoeWJyaWQnO1xuICBhZ2VudElkPzogc3RyaW5nO1xuICB0b3BLPzogbnVtYmVyO1xuICByZXJhbms/OiBib29sZWFuO1xuICBpbmNsdWRlSW1hZ2VzPzogYm9vbGVhbjtcbiAgZmlsdGVycz86IHtcbiAgICB0aW1lUmFuZ2U/OiB7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyIH07XG4gICAgdGFncz86IHN0cmluZ1tdO1xuICAgIGZpbGVUeXBlcz86IHN0cmluZ1tdO1xuICAgIGNvbnRlbnRUeXBlcz86IHN0cmluZ1tdO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlcmFua2luZ0NyaXRlcmlhIHtcbiAgcmVjZW5jeTogbnVtYmVyOyAvLyAwLTEgd2VpZ2h0XG4gIHJlbGV2YW5jZTogbnVtYmVyOyAvLyAwLTEgd2VpZ2h0XG4gIGNvbnRleHRNYXRjaDogbnVtYmVyOyAvLyAwLTEgd2VpZ2h0XG4gIGFnZW50RXhwZXJ0aXNlOiBudW1iZXI7IC8vIDAtMSB3ZWlnaHRcbiAgY3Jvc3NNb2RhbEJvb3N0OiBudW1iZXI7IC8vIDAtMSB3ZWlnaHRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSQUdSZXN1bHQge1xuICBkb2N1bWVudHM6IE1lbW9yeURvY3VtZW50W107XG4gIHJlcmFua2VkPzogYm9vbGVhbjtcbiAgcXVlcnlFbWJlZGRpbmc/OiBudW1iZXJbXTtcbiAgcHJvY2Vzc2luZ1RpbWU6IG51bWJlcjtcbiAgc2VhcmNoTWV0aG9kOiBzdHJpbmc7XG4gIHRvdGFsTWF0Y2hlczogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgRW5oYW5jZWRWZWN0b3JNZW1vcnlTdG9yZSBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHByaXZhdGUgbG9nZ2VyOiBWRVJTQVRJTExvZ2dlcjtcbiAgcHJpdmF0ZSBtZW1vcmllczogTWFwPHN0cmluZywgTWVtb3J5RG9jdW1lbnQ+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGVtYmVkZGluZ3M6IE1hcDxzdHJpbmcsIG51bWJlcltdPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBpbmRleFBhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBzdXBhYmFzZTogYW55O1xuICBwcml2YXRlIGlzU3VwYWJhc2VFbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgZWRnZUZ1bmN0aW9uc0VuYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdXBhYmFzZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIFxuICAvLyBFbmhhbmNlZCBjb25maWd1cmF0aW9uXG4gIHByaXZhdGUgY29uZmlnID0ge1xuICAgIGVtYmVkZGluZ0RpbWVuc2lvbjogMTUzNiwgLy8gT3BlbkFJIGFkYS0wMDIgZGltZW5zaW9uXG4gICAgbWF4TWVtb3J5U2l6ZTogMTAwMDAwLFxuICAgIHJlcmFua2luZ0VuYWJsZWQ6IHRydWUsXG4gICAgbXVsdGltb2RhbEVuYWJsZWQ6IHRydWUsXG4gICAgaHlicmlkU2VhcmNoRW5hYmxlZDogdHJ1ZSxcbiAgICBkZWZhdWx0UmVyYW5raW5nOiB7XG4gICAgICByZWNlbmN5OiAwLjE1LFxuICAgICAgcmVsZXZhbmNlOiAwLjQsXG4gICAgICBjb250ZXh0TWF0Y2g6IDAuMjUsXG4gICAgICBhZ2VudEV4cGVydGlzZTogMC4xLFxuICAgICAgY3Jvc3NNb2RhbEJvb3N0OiAwLjFcbiAgICB9IGFzIFJlcmFua2luZ0NyaXRlcmlhXG4gIH07XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmxvZ2dlciA9IG5ldyBWRVJTQVRJTExvZ2dlcigpO1xuICAgIHRoaXMuaW5kZXhQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICcudmVyc2F0aWwnLCAncmFnJywgJ3ZlY3Rvci1pbmRleCcpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgU3VwYWJhc2UgY29ubmVjdGlvbiBpZiBhdmFpbGFibGVcbiAgICovXG4gIHB1YmxpYyBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzXG4gICAgYXdhaXQgZnMucHJvbWlzZXMubWtkaXIodGhpcy5pbmRleFBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuXG4gICAgLy8gVHJ5IHRvIGluaXRpYWxpemUgU3VwYWJhc2UgaWYgY29uZmlndXJlZFxuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVN1cGFiYXNlKCk7XG5cbiAgICBhd2FpdCB0aGlzLmxvYWRFeGlzdGluZ01lbW9yaWVzKCk7XG5cbiAgICB0aGlzLmxvZ2dlci5pbmZvKCdFbmhhbmNlZCB2ZWN0b3IgbWVtb3J5IHN0b3JlIGluaXRpYWxpemVkJywge1xuICAgICAgbWVtb3J5Q291bnQ6IHRoaXMubWVtb3JpZXMuc2l6ZSxcbiAgICAgIHN1cGFiYXNlRW5hYmxlZDogdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCxcbiAgICAgIGZlYXR1cmVzOiB7XG4gICAgICAgIHJlcmFua2luZzogdGhpcy5jb25maWcucmVyYW5raW5nRW5hYmxlZCxcbiAgICAgICAgbXVsdGltb2RhbDogdGhpcy5jb25maWcubXVsdGltb2RhbEVuYWJsZWQsXG4gICAgICAgIGh5YnJpZFNlYXJjaDogdGhpcy5jb25maWcuaHlicmlkU2VhcmNoRW5hYmxlZFxuICAgICAgfVxuICAgIH0sICdyYWctbWVtb3J5Jyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVTdXBhYmFzZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkw7XG4gICAgICBjb25zdCBzdXBhYmFzZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05fS0VZO1xuXG4gICAgICBpZiAoc3VwYWJhc2VVcmwgJiYgc3VwYWJhc2VLZXkpIHtcbiAgICAgICAgdGhpcy5zdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkpO1xuICAgICAgICB0aGlzLmlzU3VwYWJhc2VFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdXBhYmFzZVVybCA9IHN1cGFiYXNlVXJsO1xuICAgICAgICB0aGlzLmVkZ2VGdW5jdGlvbnNFbmFibGVkID0gdHJ1ZTsgLy8gRW5hYmxlIGVkZ2UgZnVuY3Rpb25zIGludGVncmF0aW9uXG5cbiAgICAgICAgLy8gRW5zdXJlIHZlY3RvciB0YWJsZSBleGlzdHNcbiAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVWZWN0b3JUYWJsZSgpO1xuXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1N1cGFiYXNlICsgRWRnZSBGdW5jdGlvbnMgaW5pdGlhbGl6ZWQnLCB7XG4gICAgICAgICAgc3VwYWJhc2VVcmw6IHN1cGFiYXNlVXJsLnJlcGxhY2UoL1xcLy4qLywgJy8vW0hJRERFTl0nKSxcbiAgICAgICAgICBlZGdlRnVuY3Rpb25zOiB0aGlzLmVkZ2VGdW5jdGlvbnNFbmFibGVkXG4gICAgICAgIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1N1cGFiYXNlIGluaXRpYWxpemF0aW9uIGZhaWxlZCwgdXNpbmcgbG9jYWwgc3RvcmFnZScsIHsgZXJyb3IgfSwgJ3JhZy1tZW1vcnknKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgYSBtZW1vcnkgZG9jdW1lbnQgd2l0aCB2ZWN0b3IgZW1iZWRkaW5nXG4gICAqL1xuICBhc3luYyBzdG9yZU1lbW9yeShkb2M6IE9taXQ8TWVtb3J5RG9jdW1lbnQsICdpZCcgfCAnZW1iZWRkaW5nJz4pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGlkID0gdGhpcy5nZW5lcmF0ZU1lbW9yeUlkKCk7XG4gICAgY29uc3QgZW1iZWRkaW5nID0gYXdhaXQgdGhpcy5nZW5lcmF0ZU11bHRpbW9kYWxFbWJlZGRpbmcoZG9jKTtcbiAgICBcbiAgICBjb25zdCBtZW1vcnk6IE1lbW9yeURvY3VtZW50ID0ge1xuICAgICAgaWQsXG4gICAgICAuLi5kb2MsXG4gICAgICBlbWJlZGRpbmdcbiAgICB9O1xuICAgIFxuICAgIC8vIFN0b3JlIGxvY2FsbHlcbiAgICB0aGlzLm1lbW9yaWVzLnNldChpZCwgbWVtb3J5KTtcbiAgICB0aGlzLmVtYmVkZGluZ3Muc2V0KGlkLCBlbWJlZGRpbmcpO1xuICAgIFxuICAgIC8vIFN0b3JlIGluIHZlY3RvciBEQiBpZiBhdmFpbGFibGVcbiAgICBpZiAodGhpcy5pc1N1cGFiYXNlRW5hYmxlZCkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9yZUluU3VwYWJhc2UobWVtb3J5KTtcbiAgICB9XG4gICAgXG4gICAgYXdhaXQgdGhpcy5wZXJzaXN0TWVtb3J5KG1lbW9yeSk7XG4gICAgXG4gICAgdGhpcy5lbWl0KCdtZW1vcnlfc3RvcmVkJywgeyBcbiAgICAgIGlkLCBcbiAgICAgIGFnZW50SWQ6IGRvYy5tZXRhZGF0YS5hZ2VudElkLFxuICAgICAgY29udGVudFR5cGU6IGRvYy5jb250ZW50VHlwZSBcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuICAvKipcbiAgICogRW5oYW5jZWQgcXVlcnkgd2l0aCByZXJhbmtpbmcgYW5kIG11bHRpbW9kYWwgc3VwcG9ydFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBxdWVyeU1lbW9yaWVzSW50ZXJuYWwocXVlcnk6IFJBR1F1ZXJ5KTogUHJvbWlzZTxSQUdSZXN1bHQ+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGxldCBkb2N1bWVudHM6IE1lbW9yeURvY3VtZW50W107XG4gICAgbGV0IHNlYXJjaE1ldGhvZCA9ICdzZW1hbnRpYyc7XG4gICAgXG4gICAgLy8gRGV0ZXJtaW5lIHNlYXJjaCBzdHJhdGVneVxuICAgIGlmIChxdWVyeS5xdWVyeVR5cGUgPT09ICdoeWJyaWQnIHx8IHRoaXMuY29uZmlnLmh5YnJpZFNlYXJjaEVuYWJsZWQpIHtcbiAgICAgIGRvY3VtZW50cyA9IGF3YWl0IHRoaXMuaHlicmlkU2VhcmNoKHF1ZXJ5KTtcbiAgICAgIHNlYXJjaE1ldGhvZCA9ICdoeWJyaWQnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1N1cGFiYXNlRW5hYmxlZCkge1xuICAgICAgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy52ZWN0b3JTZWFyY2gocXVlcnkpO1xuICAgICAgc2VhcmNoTWV0aG9kID0gJ3ZlY3Rvcic7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvY3VtZW50cyA9IGF3YWl0IHRoaXMubG9jYWxTZW1hbnRpY1NlYXJjaChxdWVyeSk7XG4gICAgICBzZWFyY2hNZXRob2QgPSAnbG9jYWwtc2VtYW50aWMnO1xuICAgIH1cbiAgICBcbiAgICAvLyBBcHBseSByZXJhbmtpbmcgaWYgcmVxdWVzdGVkIG9yIGVuYWJsZWQgYnkgZGVmYXVsdFxuICAgIGxldCByZXJhbmtlZCA9IGZhbHNlO1xuICAgIGlmIChxdWVyeS5yZXJhbmsgIT09IGZhbHNlICYmIHRoaXMuY29uZmlnLnJlcmFua2luZ0VuYWJsZWQpIHtcbiAgICAgIGRvY3VtZW50cyA9IGF3YWl0IHRoaXMucmVyYW5rUmVzdWx0cyhkb2N1bWVudHMsIHF1ZXJ5KTtcbiAgICAgIHJlcmFua2VkID0gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgLy8gTGltaXQgdG8gdG9wS1xuICAgIGNvbnN0IHRvcEsgPSBxdWVyeS50b3BLIHx8IDEwO1xuICAgIGNvbnN0IGZpbmFsRG9jdW1lbnRzID0gZG9jdW1lbnRzLnNsaWNlKDAsIHRvcEspO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBkb2N1bWVudHM6IGZpbmFsRG9jdW1lbnRzLFxuICAgICAgcmVyYW5rZWQsXG4gICAgICBxdWVyeUVtYmVkZGluZzogYXdhaXQgdGhpcy5nZW5lcmF0ZUVtYmVkZGluZyhxdWVyeS5xdWVyeSksXG4gICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgIHNlYXJjaE1ldGhvZCxcbiAgICAgIHRvdGFsTWF0Y2hlczogZG9jdW1lbnRzLmxlbmd0aFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSHlicmlkIHNlYXJjaCBjb21iaW5pbmcgc2VtYW50aWMgYW5kIGtleXdvcmQgbWF0Y2hpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaHlicmlkU2VhcmNoKHF1ZXJ5OiBSQUdRdWVyeSk6IFByb21pc2U8TWVtb3J5RG9jdW1lbnRbXT4ge1xuICAgIC8vIFNlbWFudGljIHNlYXJjaFxuICAgIGNvbnN0IHNlbWFudGljUmVzdWx0cyA9IGF3YWl0IHRoaXMubG9jYWxTZW1hbnRpY1NlYXJjaChxdWVyeSk7XG4gICAgXG4gICAgLy8gS2V5d29yZCBzZWFyY2hcbiAgICBjb25zdCBrZXl3b3JkUmVzdWx0cyA9IGF3YWl0IHRoaXMua2V5d29yZFNlYXJjaChxdWVyeSk7XG4gICAgXG4gICAgLy8gTWVyZ2UgYW5kIGRlZHVwbGljYXRlXG4gICAgY29uc3QgcmVzdWx0TWFwID0gbmV3IE1hcDxzdHJpbmcsIE1lbW9yeURvY3VtZW50PigpO1xuICAgIFxuICAgIC8vIEFkZCBzZW1hbnRpYyByZXN1bHRzIHdpdGggYm9vc3RlZCBzY29yZXNcbiAgICBzZW1hbnRpY1Jlc3VsdHMuZm9yRWFjaChkb2MgPT4ge1xuICAgICAgcmVzdWx0TWFwLnNldChkb2MuaWQsIHtcbiAgICAgICAgLi4uZG9jLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIC4uLmRvYy5tZXRhZGF0YSxcbiAgICAgICAgICByZWxldmFuY2VTY29yZTogKGRvYy5tZXRhZGF0YS5yZWxldmFuY2VTY29yZSB8fCAwKSAqIDEuMlxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBBZGQga2V5d29yZCByZXN1bHRzXG4gICAga2V5d29yZFJlc3VsdHMuZm9yRWFjaChkb2MgPT4ge1xuICAgICAgaWYgKHJlc3VsdE1hcC5oYXMoZG9jLmlkKSkge1xuICAgICAgICAvLyBCb29zdCBkb2N1bWVudHMgZm91bmQgYnkgYm90aCBtZXRob2RzXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gcmVzdWx0TWFwLmdldChkb2MuaWQpITtcbiAgICAgICAgZXhpc3RpbmcubWV0YWRhdGEucmVsZXZhbmNlU2NvcmUgPSAoZXhpc3RpbmcubWV0YWRhdGEucmVsZXZhbmNlU2NvcmUgfHwgMCkgKyAwLjM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHRNYXAuc2V0KGRvYy5pZCwgZG9jKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gQXJyYXkuZnJvbShyZXN1bHRNYXAudmFsdWVzKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEtleXdvcmQtYmFzZWQgc2VhcmNoXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGtleXdvcmRTZWFyY2gocXVlcnk6IFJBR1F1ZXJ5KTogUHJvbWlzZTxNZW1vcnlEb2N1bWVudFtdPiB7XG4gICAgY29uc3Qga2V5d29yZHMgPSBxdWVyeS5xdWVyeS50b0xvd2VyQ2FzZSgpLnNwbGl0KCcgJykuZmlsdGVyKHcgPT4gdy5sZW5ndGggPiAyKTtcbiAgICBsZXQgbWVtb3JpZXMgPSBBcnJheS5mcm9tKHRoaXMubWVtb3JpZXMudmFsdWVzKCkpO1xuICAgIFxuICAgIC8vIEFwcGx5IGZpbHRlcnNcbiAgICBpZiAocXVlcnkuZmlsdGVycykge1xuICAgICAgbWVtb3JpZXMgPSB0aGlzLmFwcGx5RmlsdGVycyhtZW1vcmllcywgcXVlcnkuZmlsdGVycyk7XG4gICAgfVxuICAgIFxuICAgIC8vIFNjb3JlIGJ5IGtleXdvcmQgbWF0Y2hlc1xuICAgIGNvbnN0IHNjb3JlZCA9IG1lbW9yaWVzLm1hcChtZW1vcnkgPT4ge1xuICAgICAgY29uc3QgY29udGVudCA9IG1lbW9yeS5jb250ZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IEpTT04uc3RyaW5naWZ5KG1lbW9yeS5tZXRhZGF0YSkudG9Mb3dlckNhc2UoKTtcbiAgICAgIFxuICAgICAgbGV0IHNjb3JlID0gMDtcbiAgICAgIGtleXdvcmRzLmZvckVhY2goa2V5d29yZCA9PiB7XG4gICAgICAgIGlmIChjb250ZW50LmluY2x1ZGVzKGtleXdvcmQpKSBzY29yZSArPSAxO1xuICAgICAgICBpZiAobWV0YWRhdGEuaW5jbHVkZXMoa2V5d29yZCkpIHNjb3JlICs9IDAuNTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZW1vcnk6IHtcbiAgICAgICAgICAuLi5tZW1vcnksXG4gICAgICAgICAgbWV0YWRhdGE6IHsgLi4ubWVtb3J5Lm1ldGFkYXRhLCByZWxldmFuY2VTY29yZTogc2NvcmUgLyBrZXl3b3Jkcy5sZW5ndGggfVxuICAgICAgICB9LFxuICAgICAgICBzY29yZVxuICAgICAgfTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBTb3J0IGFuZCBmaWx0ZXJcbiAgICByZXR1cm4gc2NvcmVkXG4gICAgICAuZmlsdGVyKHMgPT4gcy5zY29yZSA+IDApXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpXG4gICAgICAubWFwKHMgPT4gcy5tZW1vcnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkdmFuY2VkIHJlcmFua2luZyB3aXRoIG11bHRpcGxlIGNyaXRlcmlhXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlcmFua1Jlc3VsdHMoZG9jdW1lbnRzOiBNZW1vcnlEb2N1bWVudFtdLCBxdWVyeTogUkFHUXVlcnkpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHtcbiAgICBjb25zdCBjcml0ZXJpYSA9IHRoaXMuY29uZmlnLmRlZmF1bHRSZXJhbmtpbmc7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICAvLyBHZXQgcHJvamVjdCBjb250ZXh0IGlmIGF2YWlsYWJsZVxuICAgIGNvbnN0IHByb2plY3RDb250ZXh0ID0gYXdhaXQgdGhpcy5nZXRQcm9qZWN0Q29udGV4dCgpO1xuICAgIFxuICAgIC8vIFNjb3JlIGVhY2ggZG9jdW1lbnRcbiAgICBjb25zdCByZXJhbmtlZCA9IGRvY3VtZW50cy5tYXAoZG9jID0+IHtcbiAgICAgIGxldCBmaW5hbFNjb3JlID0gMDtcbiAgICAgIFxuICAgICAgLy8gMS4gUmVsZXZhbmNlIHNjb3JlIChmcm9tIGluaXRpYWwgc2VhcmNoKVxuICAgICAgY29uc3QgcmVsZXZhbmNlID0gZG9jLm1ldGFkYXRhLnJlbGV2YW5jZVNjb3JlIHx8IDA7XG4gICAgICBmaW5hbFNjb3JlICs9IHJlbGV2YW5jZSAqIGNyaXRlcmlhLnJlbGV2YW5jZTtcbiAgICAgIFxuICAgICAgLy8gMi4gUmVjZW5jeSBzY29yZVxuICAgICAgY29uc3QgYWdlID0gbm93IC0gZG9jLm1ldGFkYXRhLnRpbWVzdGFtcDtcbiAgICAgIGNvbnN0IHJlY2VuY3lTY29yZSA9IE1hdGguZXhwKC1hZ2UgLyAoMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7IC8vIERlY2F5IG92ZXIgMzAgZGF5c1xuICAgICAgZmluYWxTY29yZSArPSByZWNlbmN5U2NvcmUgKiBjcml0ZXJpYS5yZWNlbmN5O1xuICAgICAgXG4gICAgICAvLyAzLiBDb250ZXh0IG1hdGNoIHNjb3JlXG4gICAgICBsZXQgY29udGV4dFNjb3JlID0gMDtcbiAgICAgIGlmIChwcm9qZWN0Q29udGV4dCkge1xuICAgICAgICBpZiAoZG9jLm1ldGFkYXRhLmxhbmd1YWdlID09PSBwcm9qZWN0Q29udGV4dC5sYW5ndWFnZSkgY29udGV4dFNjb3JlICs9IDAuNTtcbiAgICAgICAgaWYgKGRvYy5tZXRhZGF0YS5mcmFtZXdvcmsgPT09IHByb2plY3RDb250ZXh0LmZyYW1ld29yaykgY29udGV4dFNjb3JlICs9IDAuNTtcbiAgICAgIH1cbiAgICAgIGZpbmFsU2NvcmUgKz0gY29udGV4dFNjb3JlICogY3JpdGVyaWEuY29udGV4dE1hdGNoO1xuICAgICAgXG4gICAgICAvLyA0LiBBZ2VudCBleHBlcnRpc2Ugc2NvcmVcbiAgICAgIGNvbnN0IGFnZW50RXhwZXJ0aXNlID0gdGhpcy5nZXRBZ2VudEV4cGVydGlzZVNjb3JlKGRvYy5tZXRhZGF0YS5hZ2VudElkLCBxdWVyeS5xdWVyeSk7XG4gICAgICBmaW5hbFNjb3JlICs9IGFnZW50RXhwZXJ0aXNlICogY3JpdGVyaWEuYWdlbnRFeHBlcnRpc2U7XG4gICAgICBcbiAgICAgIC8vIDUuIENyb3NzLW1vZGFsIGJvb3N0XG4gICAgICBpZiAoZG9jLmNvbnRlbnRUeXBlICE9PSAndGV4dCcgJiYgcXVlcnkuaW5jbHVkZUltYWdlcykge1xuICAgICAgICBmaW5hbFNjb3JlICs9IGNyaXRlcmlhLmNyb3NzTW9kYWxCb29zdDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9jdW1lbnQ6IGRvYyxcbiAgICAgICAgZmluYWxTY29yZVxuICAgICAgfTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBTb3J0IGJ5IGZpbmFsIHNjb3JlXG4gICAgcmVyYW5rZWQuc29ydCgoYSwgYikgPT4gYi5maW5hbFNjb3JlIC0gYS5maW5hbFNjb3JlKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgcmVsZXZhbmNlIHNjb3Jlc1xuICAgIHJldHVybiByZXJhbmtlZC5tYXAociA9PiAoe1xuICAgICAgLi4uci5kb2N1bWVudCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIC4uLnIuZG9jdW1lbnQubWV0YWRhdGEsXG4gICAgICAgIHJlbGV2YW5jZVNjb3JlOiByLmZpbmFsU2NvcmVcbiAgICAgIH1cbiAgICB9KSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgZW1iZWRkaW5ncyBmb3IgbXVsdGltb2RhbCBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlTXVsdGltb2RhbEVtYmVkZGluZyhkb2M6IE9taXQ8TWVtb3J5RG9jdW1lbnQsICdpZCcgfCAnZW1iZWRkaW5nJz4pOiBQcm9taXNlPG51bWJlcltdPiB7XG4gICAgaWYgKGRvYy5jb250ZW50VHlwZSA9PT0gJ3RleHQnIHx8IGRvYy5jb250ZW50VHlwZSA9PT0gJ2NvZGUnKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVtYmVkZGluZyhkb2MuY29udGVudCk7XG4gICAgfSBlbHNlIGlmIChkb2MuY29udGVudFR5cGUgPT09ICdpbWFnZScgJiYgZG9jLm1ldGFkYXRhLmltYWdlRGF0YSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVJbWFnZUVtYmVkZGluZyhkb2MubWV0YWRhdGEuaW1hZ2VEYXRhKTtcbiAgICB9IGVsc2UgaWYgKGRvYy5jb250ZW50VHlwZSA9PT0gJ21peGVkJykge1xuICAgICAgLy8gQ29tYmluZSB0ZXh0IGFuZCBpbWFnZSBlbWJlZGRpbmdzXG4gICAgICBjb25zdCB0ZXh0RW1iID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUVtYmVkZGluZyhkb2MuY29udGVudCk7XG4gICAgICBpZiAoZG9jLm1ldGFkYXRhLmltYWdlRGF0YSkge1xuICAgICAgICBjb25zdCBpbWdFbWIgPSBhd2FpdCB0aGlzLmdlbmVyYXRlSW1hZ2VFbWJlZGRpbmcoZG9jLm1ldGFkYXRhLmltYWdlRGF0YSk7XG4gICAgICAgIC8vIEF2ZXJhZ2UgdGhlIGVtYmVkZGluZ3MgKHNpbXBsZSBmdXNpb24pXG4gICAgICAgIHJldHVybiB0ZXh0RW1iLm1hcCgodmFsLCBpZHgpID0+ICh2YWwgKyBpbWdFbWJbaWR4XSkgLyAyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0ZXh0RW1iO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVtYmVkZGluZyhkb2MuY29udGVudCk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgZW1iZWRkaW5nIGZvciBpbWFnZXMgdXNpbmcgQ0xJUCAodmlhIEh1Z2dpbmcgRmFjZSBUcmFuc2Zvcm1lcnMuanMpXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlSW1hZ2VFbWJlZGRpbmcoaW1hZ2VEYXRhOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBIdWdnaW5nIEZhY2UgVHJhbnNmb3JtZXJzLmpzIGZvciBDTElQIGVtYmVkZGluZ3NcbiAgICAgIGNvbnN0IHsgcGlwZWxpbmUgfSA9IGF3YWl0IGltcG9ydCgnQHhlbm92YS90cmFuc2Zvcm1lcnMnKTtcblxuICAgICAgLy8gQ3JlYXRlIGZlYXR1cmUgZXh0cmFjdGlvbiBwaXBlbGluZSB3aXRoIENMSVAgbW9kZWxcbiAgICAgIGNvbnN0IGV4dHJhY3RvciA9IGF3YWl0IHBpcGVsaW5lKCdmZWF0dXJlLWV4dHJhY3Rpb24nLCAnWGVub3ZhL2NsaXAtdml0LWJhc2UtcGF0Y2gzMicpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSBlbWJlZGRpbmcgZnJvbSBpbWFnZSBkYXRhXG4gICAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCBleHRyYWN0b3IoaW1hZ2VEYXRhLCB7IHBvb2xpbmc6ICdtZWFuJywgbm9ybWFsaXplOiB0cnVlIH0pO1xuXG4gICAgICAvLyBDb252ZXJ0IHRlbnNvciB0byBhcnJheVxuICAgICAgY29uc3QgZW1iZWRkaW5nID0gQXJyYXkuZnJvbShvdXRwdXQuZGF0YSBhcyBGbG9hdDMyQXJyYXkpO1xuXG4gICAgICAvLyBSZXNpemUgdG8gbWF0Y2ggY29uZmlndXJlZCBkaW1lbnNpb24gaWYgbmVlZGVkXG4gICAgICBpZiAoZW1iZWRkaW5nLmxlbmd0aCAhPT0gdGhpcy5jb25maWcuZW1iZWRkaW5nRGltZW5zaW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc2l6ZUVtYmVkZGluZyhlbWJlZGRpbmcsIHRoaXMuY29uZmlnLmVtYmVkZGluZ0RpbWVuc2lvbik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbWJlZGRpbmc7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ0xJUCBlbWJlZGRpbmcgZ2VuZXJhdGlvbiBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrOicsIGVycm9yKTtcblxuICAgICAgLy8gRmFsbGJhY2s6IEdlbmVyYXRlIHJhbmRvbSBub3JtYWxpemVkIGVtYmVkZGluZ1xuICAgICAgY29uc3QgZW1iZWRkaW5nID0gQXJyYXkodGhpcy5jb25maWcuZW1iZWRkaW5nRGltZW5zaW9uKS5maWxsKDApLm1hcCgoKSA9PiBNYXRoLnJhbmRvbSgpKTtcbiAgICAgIGNvbnN0IG5vcm0gPSBNYXRoLnNxcnQoZW1iZWRkaW5nLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCAqIHZhbCwgMCkpO1xuICAgICAgcmV0dXJuIGVtYmVkZGluZy5tYXAodmFsID0+IHZhbCAvIG5vcm0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemUgZW1iZWRkaW5nIHRvIHRhcmdldCBkaW1lbnNpb25cbiAgICovXG4gIHByaXZhdGUgcmVzaXplRW1iZWRkaW5nKGVtYmVkZGluZzogbnVtYmVyW10sIHRhcmdldERpbTogbnVtYmVyKTogbnVtYmVyW10ge1xuICAgIGlmIChlbWJlZGRpbmcubGVuZ3RoID09PSB0YXJnZXREaW0pIHJldHVybiBlbWJlZGRpbmc7XG5cbiAgICAvLyBTaW1wbGUgaW50ZXJwb2xhdGlvbi90cnVuY2F0aW9uXG4gICAgaWYgKGVtYmVkZGluZy5sZW5ndGggPiB0YXJnZXREaW0pIHtcbiAgICAgIC8vIFRydW5jYXRlXG4gICAgICByZXR1cm4gZW1iZWRkaW5nLnNsaWNlKDAsIHRhcmdldERpbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFBhZCB3aXRoIHplcm9zXG4gICAgICByZXR1cm4gWy4uLmVtYmVkZGluZywgLi4uQXJyYXkodGFyZ2V0RGltIC0gZW1iZWRkaW5nLmxlbmd0aCkuZmlsbCgwKV07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGluIFN1cGFiYXNlIHZlY3RvciBkYXRhYmFzZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzdG9yZUluU3VwYWJhc2UobWVtb3J5OiBNZW1vcnlEb2N1bWVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCkgcmV0dXJuO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd2ZXJzYXRpbF9tZW1vcmllcycpXG4gICAgICAgIC51cHNlcnQoe1xuICAgICAgICAgIGlkOiBtZW1vcnkuaWQsXG4gICAgICAgICAgY29udGVudDogbWVtb3J5LmNvbnRlbnQsXG4gICAgICAgICAgY29udGVudF90eXBlOiBtZW1vcnkuY29udGVudFR5cGUsXG4gICAgICAgICAgZW1iZWRkaW5nOiBtZW1vcnkuZW1iZWRkaW5nLFxuICAgICAgICAgIG1ldGFkYXRhOiBtZW1vcnkubWV0YWRhdGEsXG4gICAgICAgICAgYWdlbnRfaWQ6IG1lbW9yeS5tZXRhZGF0YS5hZ2VudElkLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKG1lbW9yeS5tZXRhZGF0YS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gc3RvcmUgaW4gU3VwYWJhc2UnLCB7IGVycm9yIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdTdXBhYmFzZSBzdG9yYWdlIGVycm9yJywgeyBlcnJvciB9LCAncmFnLW1lbW9yeScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZWN0b3Igc2VhcmNoIHVzaW5nIFN1cGFiYXNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHZlY3RvclNlYXJjaChxdWVyeTogUkFHUXVlcnkpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUVuYWJsZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsU2VtYW50aWNTZWFyY2gocXVlcnkpO1xuICAgIH1cbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcXVlcnlFbWJlZGRpbmcgPSBhd2FpdCB0aGlzLmdlbmVyYXRlRW1iZWRkaW5nKHF1ZXJ5LnF1ZXJ5KTtcbiAgICAgIFxuICAgICAgLy8gQnVpbGQgdGhlIFJQQyBjYWxsXG4gICAgICBsZXQgcnBjUXVlcnkgPSB0aGlzLnN1cGFiYXNlLnJwYygnbWF0Y2hfbWVtb3JpZXMnLCB7XG4gICAgICAgIHF1ZXJ5X2VtYmVkZGluZzogcXVlcnlFbWJlZGRpbmcsXG4gICAgICAgIG1hdGNoX3RocmVzaG9sZDogMC43LFxuICAgICAgICBtYXRjaF9jb3VudDogcXVlcnkudG9wSyB8fCAyMFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIEFwcGx5IGZpbHRlcnNcbiAgICAgIGlmIChxdWVyeS5hZ2VudElkKSB7XG4gICAgICAgIHJwY1F1ZXJ5ID0gcnBjUXVlcnkuZXEoJ2FnZW50X2lkJywgcXVlcnkuYWdlbnRJZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChxdWVyeS5maWx0ZXJzPy5jb250ZW50VHlwZXMpIHtcbiAgICAgICAgcnBjUXVlcnkgPSBycGNRdWVyeS5pbignY29udGVudF90eXBlJywgcXVlcnkuZmlsdGVycy5jb250ZW50VHlwZXMpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBycGNRdWVyeTtcbiAgICAgIFxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdWZWN0b3Igc2VhcmNoIGZhaWxlZCcsIHsgZXJyb3IgfSwgJ3JhZy1tZW1vcnknKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxTZW1hbnRpY1NlYXJjaChxdWVyeSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBkYXRhLm1hcCgocm93OiBhbnkpID0+ICh7XG4gICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgIGNvbnRlbnQ6IHJvdy5jb250ZW50LFxuICAgICAgICBjb250ZW50VHlwZTogcm93LmNvbnRlbnRfdHlwZSxcbiAgICAgICAgZW1iZWRkaW5nOiByb3cuZW1iZWRkaW5nLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIC4uLnJvdy5tZXRhZGF0YSxcbiAgICAgICAgICByZWxldmFuY2VTY29yZTogcm93LnNpbWlsYXJpdHlcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdWZWN0b3Igc2VhcmNoIGVycm9yJywgeyBlcnJvciB9LCAncmFnLW1lbW9yeScpO1xuICAgICAgcmV0dXJuIHRoaXMubG9jYWxTZW1hbnRpY1NlYXJjaChxdWVyeSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvY2FsIHNlbWFudGljIHNlYXJjaCAoZmFsbGJhY2spXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvY2FsU2VtYW50aWNTZWFyY2gocXVlcnk6IFJBR1F1ZXJ5KTogUHJvbWlzZTxNZW1vcnlEb2N1bWVudFtdPiB7XG4gICAgY29uc3QgcXVlcnlFbWJlZGRpbmcgPSBhd2FpdCB0aGlzLmdlbmVyYXRlRW1iZWRkaW5nKHF1ZXJ5LnF1ZXJ5KTtcbiAgICBcbiAgICAvLyBGaWx0ZXIgbWVtb3JpZXNcbiAgICBsZXQgZmlsdGVyZWRNZW1vcmllcyA9IEFycmF5LmZyb20odGhpcy5tZW1vcmllcy52YWx1ZXMoKSk7XG4gICAgXG4gICAgaWYgKHF1ZXJ5LmFnZW50SWQpIHtcbiAgICAgIGZpbHRlcmVkTWVtb3JpZXMgPSBmaWx0ZXJlZE1lbW9yaWVzLmZpbHRlcihtID0+IG0ubWV0YWRhdGEuYWdlbnRJZCA9PT0gcXVlcnkuYWdlbnRJZCk7XG4gICAgfVxuICAgIFxuICAgIGlmIChxdWVyeS5maWx0ZXJzKSB7XG4gICAgICBmaWx0ZXJlZE1lbW9yaWVzID0gdGhpcy5hcHBseUZpbHRlcnMoZmlsdGVyZWRNZW1vcmllcywgcXVlcnkuZmlsdGVycyk7XG4gICAgfVxuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBzaW1pbGFyaXR5IHNjb3Jlc1xuICAgIGNvbnN0IHNjb3JlZE1lbW9yaWVzID0gZmlsdGVyZWRNZW1vcmllcy5tYXAobWVtb3J5ID0+ICh7XG4gICAgICBtZW1vcnksXG4gICAgICBzY29yZTogdGhpcy5jb3NpbmVTaW1pbGFyaXR5KHF1ZXJ5RW1iZWRkaW5nLCBtZW1vcnkuZW1iZWRkaW5nIHx8IFtdKVxuICAgIH0pKTtcbiAgICBcbiAgICAvLyBTb3J0IGJ5IHJlbGV2YW5jZVxuICAgIHNjb3JlZE1lbW9yaWVzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgICBcbiAgICByZXR1cm4gc2NvcmVkTWVtb3JpZXMubWFwKCh7IG1lbW9yeSwgc2NvcmUgfSkgPT4gKHtcbiAgICAgIC4uLm1lbW9yeSxcbiAgICAgIG1ldGFkYXRhOiB7IC4uLm1lbW9yeS5tZXRhZGF0YSwgcmVsZXZhbmNlU2NvcmU6IHNjb3JlIH1cbiAgICB9KSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFnZW50IGV4cGVydGlzZSBzY29yZSBmb3IgcmVyYW5raW5nXG4gICAqL1xuICBwcml2YXRlIGdldEFnZW50RXhwZXJ0aXNlU2NvcmUoYWdlbnRJZDogc3RyaW5nLCBxdWVyeTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCBleHBlcnRpc2U6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAgICdlbmhhbmNlZC1tYXJjdXMnOiBbJ2JhY2tlbmQnLCAnYXBpJywgJ2RhdGFiYXNlJywgJ3R5cGVzY3JpcHQnXSxcbiAgICAgICdlbmhhbmNlZC1qYW1lcyc6IFsnZnJvbnRlbmQnLCAndWknLCAncmVhY3QnLCAnY3NzJ10sXG4gICAgICAnZW5oYW5jZWQtbWFyaWEnOiBbJ3Rlc3RpbmcnLCAncWEnLCAncXVhbGl0eScsICdjb3ZlcmFnZSddLFxuICAgICAgJ3NlY3VyaXR5LXNhbSc6IFsnc2VjdXJpdHknLCAndnVsbmVyYWJpbGl0eScsICdhdXRoZW50aWNhdGlvbiddLFxuICAgICAgJ2FyY2hpdGVjdHVyZS1kYW4nOiBbJ2FyY2hpdGVjdHVyZScsICdkZXNpZ24nLCAncGF0dGVybnMnLCAnc3RydWN0dXJlJ10sXG4gICAgICAnZHItYWktbWwnOiBbJ21sJywgJ2FpJywgJ29wdGltaXphdGlvbicsICdwZXJmb3JtYW5jZSddXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCBhZ2VudEtleXdvcmRzID0gZXhwZXJ0aXNlW2FnZW50SWRdIHx8IFtdO1xuICAgIGNvbnN0IHF1ZXJ5TG93ZXIgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgIFxuICAgIGxldCBzY29yZSA9IDA7XG4gICAgYWdlbnRLZXl3b3Jkcy5mb3JFYWNoKGtleXdvcmQgPT4ge1xuICAgICAgaWYgKHF1ZXJ5TG93ZXIuaW5jbHVkZXMoa2V5d29yZCkpIHNjb3JlICs9IDAuMjU7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIE1hdGgubWluKDEsIHNjb3JlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBwcm9qZWN0IGNvbnRleHQgZm9yIHJlcmFua2luZ1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRQcm9qZWN0Q29udGV4dCgpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIFRyeSB0byBnZXQgZnJvbSBlbnZpcm9ubWVudCBzY2FubmVyIGlmIGF2YWlsYWJsZVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzY2FubmVyID0gcmVxdWlyZSgnLi4vZW52aXJvbm1lbnQvZW52aXJvbm1lbnQtc2Nhbm5lcicpLmVudmlyb25tZW50U2Nhbm5lcjtcbiAgICAgIHJldHVybiBzY2FubmVyLmdldExhdGVzdFNjYW4oKT8udGVjaG5vbG9neTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmUgdmVjdG9yIHRhYmxlIGV4aXN0cyBpbiBTdXBhYmFzZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBlbnN1cmVWZWN0b3JUYWJsZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBUaGlzIHdvdWxkIGJlIHJ1biB2aWEgbWlncmF0aW9uLCBidXQgaW5jbHVkZWQgZm9yIHJlZmVyZW5jZVxuICAgIGNvbnN0IGNyZWF0ZVRhYmxlU1FMID0gYFxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdmVyc2F0aWxfbWVtb3JpZXMgKFxuICAgICAgICBpZCBVVUlEIFBSSU1BUlkgS0VZIERFRkFVTFQgZ2VuX3JhbmRvbV91dWlkKCksXG4gICAgICAgIGNvbnRlbnQgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgY29udGVudF90eXBlIFZBUkNIQVIoNTApIERFRkFVTFQgJ3RleHQnLFxuICAgICAgICBlbWJlZGRpbmcgdmVjdG9yKDE1MzYpLFxuICAgICAgICBtZXRhZGF0YSBKU09OQiBERUZBVUxUICd7fScsXG4gICAgICAgIGFnZW50X2lkIFRFWFQsXG4gICAgICAgIGNyZWF0ZWRfYXQgVElNRVNUQU1QIERFRkFVTFQgTk9XKCksXG4gICAgICAgIHVwZGF0ZWRfYXQgVElNRVNUQU1QIERFRkFVTFQgTk9XKClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9tZW1vcmllc19lbWJlZGRpbmcgXG4gICAgICBPTiB2ZXJzYXRpbF9tZW1vcmllcyBVU0lORyBpdmZmbGF0IChlbWJlZGRpbmcgdmVjdG9yX2Nvc2luZV9vcHMpXG4gICAgICBXSVRIIChsaXN0cyA9IDEwMCk7XG4gICAgICBcbiAgICAgIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9tZW1vcmllc19hZ2VudCBcbiAgICAgIE9OIHZlcnNhdGlsX21lbW9yaWVzKGFnZW50X2lkKTtcbiAgICAgIFxuICAgICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X21lbW9yaWVzX2NvbnRlbnRfdHlwZSBcbiAgICAgIE9OIHZlcnNhdGlsX21lbW9yaWVzKGNvbnRlbnRfdHlwZSk7XG4gICAgYDtcbiAgfVxuXG4gIC8vIC4uLiAoa2VlcCBvdGhlciB1dGlsaXR5IG1ldGhvZHMgZnJvbSBvcmlnaW5hbClcblxuICAvKipcbiAgICogU3RvcmUgZGlhZ3JhbSBvciB2aXN1YWwgY29udGVudFxuICAgKi9cbiAgYXN5bmMgc3RvcmVEaWFncmFtKGNvbnRlbnQ6IHN0cmluZywgZGlhZ3JhbURhdGE6IHN0cmluZywgbWV0YWRhdGE6IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuc3RvcmVNZW1vcnkoe1xuICAgICAgY29udGVudCxcbiAgICAgIGNvbnRlbnRUeXBlOiAnZGlhZ3JhbScsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5tZXRhZGF0YSxcbiAgICAgICAgaW1hZ2VEYXRhOiBkaWFncmFtRGF0YSxcbiAgICAgICAgbWltZVR5cGU6ICdpbWFnZS9zdmcreG1sJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGNvZGUgd2l0aCBzeW50YXggaGlnaGxpZ2h0aW5nIG1ldGFkYXRhXG4gICAqL1xuICBhc3luYyBzdG9yZUNvZGUoY29kZTogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBtZXRhZGF0YTogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZU1lbW9yeSh7XG4gICAgICBjb250ZW50OiBjb2RlLFxuICAgICAgY29udGVudFR5cGU6ICdjb2RlJyxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIC4uLm1ldGFkYXRhLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgZmlsZVR5cGU6IGxhbmd1YWdlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgZW1iZWRkaW5nICh3aXRoIEFQSSBpbnRlZ3JhdGlvbiBzdXBwb3J0KVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUVtYmVkZGluZyh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XG4gICAgLy8gQ2hlY2sgZm9yIE9wZW5BSSBBUEkga2V5XG4gICAgaWYgKHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBSZWFsIE9wZW5BSSBlbWJlZGRpbmdzIEFQSSBpbnRlZ3JhdGlvblxuICAgICAgICBjb25zdCB7IE9wZW5BSSB9ID0gYXdhaXQgaW1wb3J0KCdvcGVuYWknKTtcbiAgICAgICAgY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gICAgICAgICAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5haS5lbWJlZGRpbmdzLmNyZWF0ZSh7XG4gICAgICAgICAgbW9kZWw6IFwidGV4dC1lbWJlZGRpbmctMy1zbWFsbFwiLFxuICAgICAgICAgIGlucHV0OiB0ZXh0LFxuICAgICAgICAgIGRpbWVuc2lvbnM6IHRoaXMuY29uZmlnLmVtYmVkZGluZ0RpbWVuc2lvblxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBlbWJlZGRpbmcgPSByZXNwb25zZS5kYXRhWzBdLmVtYmVkZGluZztcblxuICAgICAgICAvLyBFbnN1cmUgY29ycmVjdCBkaW1lbnNpb25cbiAgICAgICAgaWYgKGVtYmVkZGluZy5sZW5ndGggIT09IHRoaXMuY29uZmlnLmVtYmVkZGluZ0RpbWVuc2lvbikge1xuICAgICAgICAgIHJldHVybiB0aGlzLnJlc2l6ZUVtYmVkZGluZyhlbWJlZGRpbmcsIHRoaXMuY29uZmlnLmVtYmVkZGluZ0RpbWVuc2lvbik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW1iZWRkaW5nO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybignT3BlbkFJIGVtYmVkZGluZyBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrJywgeyBlcnJvciB9LCAncmFnLW1lbW9yeScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIHNpbXBsZSBlbWJlZGRpbmdcbiAgICBjb25zdCBlbWJlZGRpbmcgPSBBcnJheSh0aGlzLmNvbmZpZy5lbWJlZGRpbmdEaW1lbnNpb24pLmZpbGwoMCkubWFwKCgpID0+IE1hdGgucmFuZG9tKCkpO1xuICAgIGNvbnN0IG5vcm0gPSBNYXRoLnNxcnQoZW1iZWRkaW5nLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCAqIHZhbCwgMCkpO1xuICAgIHJldHVybiBlbWJlZGRpbmcubWFwKHZhbCA9PiB2YWwgLyBub3JtKTtcbiAgfVxuXG4gIC8vIE1pc3NpbmcgbWV0aG9kIGltcGxlbWVudGF0aW9uc1xuICBwcml2YXRlIGFzeW5jIGxvYWRFeGlzdGluZ01lbW9yaWVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBMb2FkIGZyb20gU3VwYWJhc2UgaWYgY29uZmlndXJlZFxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuICAgICAgICAuZnJvbSgndmVyc2F0aWxfbWVtb3JpZXMnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG4gICAgICAgIC5saW1pdCgxMDAwKTtcblxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcblxuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgZm9yIChjb25zdCByb3cgb2YgZGF0YSkge1xuICAgICAgICAgIGNvbnN0IGRvYzogTWVtb3J5RG9jdW1lbnQgPSB7XG4gICAgICAgICAgICBpZDogcm93LmlkLFxuICAgICAgICAgICAgY29udGVudDogcm93LmNvbnRlbnQsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogcm93LmNvbnRlbnRfdHlwZSB8fCAndGV4dCcsXG4gICAgICAgICAgICBtZXRhZGF0YTogcm93Lm1ldGFkYXRhIHx8IHt9LFxuICAgICAgICAgICAgZW1iZWRkaW5nOiByb3cuZW1iZWRkaW5nIHx8IFtdXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0aGlzLm1lbW9yaWVzLnNldChkb2MuaWQsIGRvYyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGBMb2FkZWQgJHtkYXRhLmxlbmd0aH0gZXhpc3RpbmcgbWVtb3JpZXMgZnJvbSBTdXBhYmFzZWApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdDb3VsZCBub3QgbG9hZCBleGlzdGluZyBtZW1vcmllcycsIHsgZXJyb3IgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lbW9yeUlkKGRvYz86IGFueSk6IHN0cmluZyB7IHJldHVybiBgbWVtLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpfWA7IH1cblxuICBwcml2YXRlIGFzeW5jIHBlcnNpc3RNZW1vcnkoZG9jOiBNZW1vcnlEb2N1bWVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBQZXJzaXN0IHRvIFN1cGFiYXNlXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd2ZXJzYXRpbF9tZW1vcmllcycpXG4gICAgICAgIC51cHNlcnQoe1xuICAgICAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAgICAgY29udGVudDogZG9jLmNvbnRlbnQsXG4gICAgICAgICAgbWV0YWRhdGE6IGRvYy5tZXRhZGF0YSxcbiAgICAgICAgICBlbWJlZGRpbmc6IGRvYy5lbWJlZGRpbmcsXG4gICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybignRmFpbGVkIHRvIHBlcnNpc3QgbWVtb3J5IHRvIFN1cGFiYXNlJywgeyBlcnJvciB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignRXJyb3IgcGVyc2lzdGluZyBtZW1vcnknLCB7IGVycm9yIH0pO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIGFwcGx5RmlsdGVycyhkb2N1bWVudHM6IE1lbW9yeURvY3VtZW50W10sIGZpbHRlcnM6IGFueSk6IE1lbW9yeURvY3VtZW50W10geyByZXR1cm4gZG9jdW1lbnRzOyB9XG4gIHByaXZhdGUgY29zaW5lU2ltaWxhcml0eSh2ZWMxOiBudW1iZXJbXSwgdmVjMjogbnVtYmVyW10pOiBudW1iZXIge1xuICAgIHJldHVybiB2ZWMxLnJlZHVjZSgoc3VtLCB2YWwsIGkpID0+IHN1bSArIHZhbCAqICh2ZWMyW2ldIHx8IDApLCAwKTtcbiAgfVxuICBhc3luYyBnZXRBbGxNZW1vcmllcygpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHsgcmV0dXJuIEFycmF5LmZyb20odGhpcy5tZW1vcmllcy52YWx1ZXMoKSk7IH1cbiAgYXN5bmMgc2VhcmNoTWVtb3JpZXMocXVlcnk6IHN0cmluZyB8IFJBR1F1ZXJ5LCBvcHRpb25zPzogYW55KTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLnF1ZXJ5TWVtb3JpZXNJbnRlcm5hbCh0eXBlb2YgcXVlcnkgPT09ICdzdHJpbmcnID8geyBxdWVyeSB9IDogcXVlcnkpO1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHJlc3VsdHMpID8gcmVzdWx0cyA6IChyZXN1bHRzLmRvY3VtZW50cyB8fCBbXSk7XG4gIH1cbiAgYXN5bmMgcXVlcnlNZW1vcmllcyhxdWVyeTogc3RyaW5nIHwgUkFHUXVlcnkpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnF1ZXJ5TWVtb3JpZXNJbnRlcm5hbCh0eXBlb2YgcXVlcnkgPT09ICdzdHJpbmcnID8geyBxdWVyeSB9IDogcXVlcnkpO1xuICB9XG4gIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMubG9nZ2VyLmluZm8oJ0Nsb3NpbmcgRW5oYW5jZWQgVmVjdG9yIE1lbW9yeSBTdG9yZScpO1xuXG4gICAgLy8gQ2xlYXIgaW4tbWVtb3J5IGNhY2hlXG4gICAgdGhpcy5tZW1vcmllcy5jbGVhcigpO1xuXG4gICAgLy8gTm8gbmVlZCB0byBjbG9zZSBTdXBhYmFzZSBjbGllbnQgKGl0J3Mgc3RhdGVsZXNzKVxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ0VuaGFuY2VkIFZlY3RvciBNZW1vcnkgU3RvcmUgY2xvc2VkJyk7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIEFHRU5ULVNQRUNJRklDIFJBRyBNRVRIT0RTIFdJVEggRURHRSBGVU5DVElPTiBJTlRFR1JBVElPTlxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEVuaGFuY2VkIE1hcmlhIChRQSkgUkFHIHF1ZXJ5IHVzaW5nIGVkZ2UgZnVuY3Rpb25zXG4gICAqL1xuICBhc3luYyBtYXJpYVJBRyhxdWVyeTogc3RyaW5nLCBjb250ZXh0OiBhbnksIGNvbmZpZz86IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKCF0aGlzLmVkZ2VGdW5jdGlvbnNFbmFibGVkIHx8ICF0aGlzLnN1cGFiYXNlVXJsKSB7XG4gICAgICAvLyBGYWxsYmFjayB0byBsb2NhbCBwcm9jZXNzaW5nXG4gICAgICByZXR1cm4gdGhpcy5sb2NhbE1hcmlhUkFHKHF1ZXJ5LCBjb250ZXh0LCBjb25maWcpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuc3VwYWJhc2VVcmx9L2Z1bmN0aW9ucy92MS9tYXJpYS1yYWdgLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtwcm9jZXNzLmVudi5TVVBBQkFTRV9BTk9OX0tFWX1gLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHF1ZXJ5LCBjb250ZXh0LCBjb25maWcgfSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1hcmlhIFJBRyBlZGdlIGZ1bmN0aW9uIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkgYXMgYW55O1xuXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZXJyb3IgfHwgJ01hcmlhIFJBRyBwcm9jZXNzaW5nIGZhaWxlZCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdNYXJpYSBSQUcgZWRnZSBmdW5jdGlvbiBjb21wbGV0ZWQnLCB7XG4gICAgICAgIHNpbWlsYXJQYXR0ZXJuczogcmVzdWx0LmRhdGE/LnJhZ0luc2lnaHRzPy5zaW1pbGFyUGF0dGVybnMgfHwgMCxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJlc3VsdC5tZXRhZGF0YT8ucHJvY2Vzc2luZ1RpbWUgfHwgMFxuICAgICAgfSwgJ21hcmlhLXJhZycpO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ01hcmlhIFJBRyBlZGdlIGZ1bmN0aW9uIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2snLCB7IGVycm9yIH0sICdtYXJpYS1yYWcnKTtcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsTWFyaWFSQUcocXVlcnksIGNvbnRleHQsIGNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuaGFuY2VkIEphbWVzIChGcm9udGVuZCkgUkFHIHF1ZXJ5IHVzaW5nIGVkZ2UgZnVuY3Rpb25zXG4gICAqL1xuICBhc3luYyBqYW1lc1JBRyhxdWVyeTogc3RyaW5nLCBjb250ZXh0OiBhbnksIGNvbmZpZz86IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKCF0aGlzLmVkZ2VGdW5jdGlvbnNFbmFibGVkIHx8ICF0aGlzLnN1cGFiYXNlVXJsKSB7XG4gICAgICAvLyBGYWxsYmFjayB0byBsb2NhbCBwcm9jZXNzaW5nXG4gICAgICByZXR1cm4gdGhpcy5sb2NhbEphbWVzUkFHKHF1ZXJ5LCBjb250ZXh0LCBjb25maWcpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuc3VwYWJhc2VVcmx9L2Z1bmN0aW9ucy92MS9qYW1lcy1yYWdgLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtwcm9jZXNzLmVudi5TVVBBQkFTRV9BTk9OX0tFWX1gLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHF1ZXJ5LCBjb250ZXh0LCBjb25maWcgfSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEphbWVzIFJBRyBlZGdlIGZ1bmN0aW9uIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkgYXMgYW55O1xuXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZXJyb3IgfHwgJ0phbWVzIFJBRyBwcm9jZXNzaW5nIGZhaWxlZCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdKYW1lcyBSQUcgZWRnZSBmdW5jdGlvbiBjb21wbGV0ZWQnLCB7XG4gICAgICAgIGNvbXBvbmVudFBhdHRlcm5zOiByZXN1bHQuZGF0YT8ucmFnSW5zaWdodHM/LmNvbXBvbmVudFBhdHRlcm5zIHx8IDAsXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiByZXN1bHQubWV0YWRhdGE/LnByb2Nlc3NpbmdUaW1lIHx8IDBcbiAgICAgIH0sICdqYW1lcy1yYWcnKTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdKYW1lcyBSQUcgZWRnZSBmdW5jdGlvbiBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrJywgeyBlcnJvciB9LCAnamFtZXMtcmFnJyk7XG4gICAgICByZXR1cm4gdGhpcy5sb2NhbEphbWVzUkFHKHF1ZXJ5LCBjb250ZXh0LCBjb25maWcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmhhbmNlZCBNYXJjdXMgKEJhY2tlbmQpIFJBRyBxdWVyeSB1c2luZyBlZGdlIGZ1bmN0aW9uc1xuICAgKi9cbiAgYXN5bmMgbWFyY3VzUkFHKHF1ZXJ5OiBzdHJpbmcsIGNvbnRleHQ6IGFueSwgY29uZmlnPzogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoIXRoaXMuZWRnZUZ1bmN0aW9uc0VuYWJsZWQgfHwgIXRoaXMuc3VwYWJhc2VVcmwpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsIHByb2Nlc3NpbmdcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsTWFyY3VzUkFHKHF1ZXJ5LCBjb250ZXh0LCBjb25maWcpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuc3VwYWJhc2VVcmx9L2Z1bmN0aW9ucy92MS9tYXJjdXMtcmFnYCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7cHJvY2Vzcy5lbnYuU1VQQUJBU0VfQU5PTl9LRVl9YCxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBxdWVyeSwgY29udGV4dCwgY29uZmlnIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNYXJjdXMgUkFHIGVkZ2UgZnVuY3Rpb24gZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyBhbnk7XG5cbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5lcnJvciB8fCAnTWFyY3VzIFJBRyBwcm9jZXNzaW5nIGZhaWxlZCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdNYXJjdXMgUkFHIGVkZ2UgZnVuY3Rpb24gY29tcGxldGVkJywge1xuICAgICAgICBhcGlQYXR0ZXJuczogcmVzdWx0LmRhdGE/LnJhZ0luc2lnaHRzPy5hcGlQYXR0ZXJucyB8fCAwLFxuICAgICAgICBzZWN1cml0eVNvbHV0aW9uczogcmVzdWx0LmRhdGE/LnJhZ0luc2lnaHRzPy5zZWN1cml0eVNvbHV0aW9ucyB8fCAwLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmVzdWx0Lm1ldGFkYXRhPy5wcm9jZXNzaW5nVGltZSB8fCAwXG4gICAgICB9LCAnbWFyY3VzLXJhZycpO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ01hcmN1cyBSQUcgZWRnZSBmdW5jdGlvbiBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrJywgeyBlcnJvciB9LCAnbWFyY3VzLXJhZycpO1xuICAgICAgcmV0dXJuIHRoaXMubG9jYWxNYXJjdXNSQUcocXVlcnksIGNvbnRleHQsIGNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZhbGxiYWNrIGxvY2FsIE1hcmlhIFJBRyBwcm9jZXNzaW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvY2FsTWFyaWFSQUcocXVlcnk6IHN0cmluZywgY29udGV4dDogYW55LCBjb25maWc/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHJhZ1F1ZXJ5OiBSQUdRdWVyeSA9IHtcbiAgICAgIHF1ZXJ5OiBgUUEgdGVzdGluZyBwYXR0ZXJucyAke3F1ZXJ5fWAsXG4gICAgICBxdWVyeVR5cGU6ICdzZW1hbnRpYycsXG4gICAgICBhZ2VudElkOiAnZW5oYW5jZWQtbWFyaWEnLFxuICAgICAgdG9wSzogY29uZmlnPy5tYXhFeGFtcGxlcyB8fCAzLFxuICAgICAgZmlsdGVyczoge1xuICAgICAgICB0YWdzOiBbJ3Rlc3QnLCAncWEnLCAndGVzdGluZyddLFxuICAgICAgICBjb250ZW50VHlwZXM6IFsnY29kZScsICd0ZXh0J11cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMucXVlcnlNZW1vcmllc0ludGVybmFsKHJhZ1F1ZXJ5KTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGVzdFBhdHRlcm5zOiByZXN1bHRzLmRvY3VtZW50cyxcbiAgICAgICAgcWFCZXN0UHJhY3RpY2VzOiBbXSxcbiAgICAgICAgcHJvamVjdFN0YW5kYXJkczogW10sXG4gICAgICAgIHJhZ0luc2lnaHRzOiB7XG4gICAgICAgICAgc2ltaWxhclBhdHRlcm5zOiByZXN1bHRzLmRvY3VtZW50cy5sZW5ndGgsXG4gICAgICAgICAgcHJvamVjdFN0YW5kYXJkczogMCxcbiAgICAgICAgICBleHBlcnRpc2U6IDAsXG4gICAgICAgICAgYXZnU2ltaWxhcml0eTogcmVzdWx0cy5kb2N1bWVudHMucmVkdWNlKChzdW0sIGRvYykgPT4gc3VtICsgKGRvYy5tZXRhZGF0YS5yZWxldmFuY2VTY29yZSB8fCAwKSwgMCkgLyByZXN1bHRzLmRvY3VtZW50cy5sZW5ndGhcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGFnZW50SWQ6ICdlbmhhbmNlZC1tYXJpYScsXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiByZXN1bHRzLnByb2Nlc3NpbmdUaW1lLFxuICAgICAgICBxdWVyeVR5cGU6ICdsb2NhbC1mYWxsYmFjaydcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZhbGxiYWNrIGxvY2FsIEphbWVzIFJBRyBwcm9jZXNzaW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvY2FsSmFtZXNSQUcocXVlcnk6IHN0cmluZywgY29udGV4dDogYW55LCBjb25maWc/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHJhZ1F1ZXJ5OiBSQUdRdWVyeSA9IHtcbiAgICAgIHF1ZXJ5OiBgRnJvbnRlbmQgY29tcG9uZW50IHBhdHRlcm5zICR7cXVlcnl9YCxcbiAgICAgIHF1ZXJ5VHlwZTogJ3NlbWFudGljJyxcbiAgICAgIGFnZW50SWQ6ICdlbmhhbmNlZC1qYW1lcycsXG4gICAgICB0b3BLOiBjb25maWc/Lm1heEV4YW1wbGVzIHx8IDMsXG4gICAgICBmaWx0ZXJzOiB7XG4gICAgICAgIHRhZ3M6IFsnZnJvbnRlbmQnLCAnY29tcG9uZW50JywgJ3VpJ10sXG4gICAgICAgIGNvbnRlbnRUeXBlczogWydjb2RlJ11cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMucXVlcnlNZW1vcmllc0ludGVybmFsKHJhZ1F1ZXJ5KTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY29tcG9uZW50UGF0dGVybnM6IHJlc3VsdHMuZG9jdW1lbnRzLFxuICAgICAgICB1aVBhdHRlcm5zOiBbXSxcbiAgICAgICAgcGVyZm9ybWFuY2VQYXR0ZXJuczogW10sXG4gICAgICAgIHJhZ0luc2lnaHRzOiB7XG4gICAgICAgICAgY29tcG9uZW50UGF0dGVybnM6IHJlc3VsdHMuZG9jdW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICB1aVBhdHRlcm5zOiAwLFxuICAgICAgICAgIHBlcmZvcm1hbmNlT3B0aW1pemF0aW9uczogMCxcbiAgICAgICAgICBhdmdTaW1pbGFyaXR5OiByZXN1bHRzLmRvY3VtZW50cy5yZWR1Y2UoKHN1bSwgZG9jKSA9PiBzdW0gKyAoZG9jLm1ldGFkYXRhLnJlbGV2YW5jZVNjb3JlIHx8IDApLCAwKSAvIHJlc3VsdHMuZG9jdW1lbnRzLmxlbmd0aFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgYWdlbnRJZDogJ2VuaGFuY2VkLWphbWVzJyxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJlc3VsdHMucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgIHF1ZXJ5VHlwZTogJ2xvY2FsLWZhbGxiYWNrJ1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRmFsbGJhY2sgbG9jYWwgTWFyY3VzIFJBRyBwcm9jZXNzaW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvY2FsTWFyY3VzUkFHKHF1ZXJ5OiBzdHJpbmcsIGNvbnRleHQ6IGFueSwgY29uZmlnPzogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCByYWdRdWVyeTogUkFHUXVlcnkgPSB7XG4gICAgICBxdWVyeTogYEJhY2tlbmQgQVBJIHBhdHRlcm5zICR7cXVlcnl9YCxcbiAgICAgIHF1ZXJ5VHlwZTogJ3NlbWFudGljJyxcbiAgICAgIGFnZW50SWQ6ICdlbmhhbmNlZC1tYXJjdXMnLFxuICAgICAgdG9wSzogY29uZmlnPy5tYXhFeGFtcGxlcyB8fCAzLFxuICAgICAgZmlsdGVyczoge1xuICAgICAgICB0YWdzOiBbJ2JhY2tlbmQnLCAnYXBpJywgJ3NlY3VyaXR5J10sXG4gICAgICAgIGNvbnRlbnRUeXBlczogWydjb2RlJ11cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMucXVlcnlNZW1vcmllc0ludGVybmFsKHJhZ1F1ZXJ5KTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgYXBpUGF0dGVybnM6IHJlc3VsdHMuZG9jdW1lbnRzLFxuICAgICAgICBzZWN1cml0eVBhdHRlcm5zOiBbXSxcbiAgICAgICAgcGVyZm9ybWFuY2VQYXR0ZXJuczogW10sXG4gICAgICAgIGRhdGFiYXNlT3B0aW1pemF0aW9uczogW10sXG4gICAgICAgIHJhZ0luc2lnaHRzOiB7XG4gICAgICAgICAgYXBpUGF0dGVybnM6IHJlc3VsdHMuZG9jdW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICBzZWN1cml0eVNvbHV0aW9uczogMCxcbiAgICAgICAgICBwZXJmb3JtYW5jZU9wdGltaXphdGlvbnM6IDAsXG4gICAgICAgICAgZGF0YWJhc2VPcHRpbWl6YXRpb25zOiAwLFxuICAgICAgICAgIGF2Z1NpbWlsYXJpdHk6IHJlc3VsdHMuZG9jdW1lbnRzLnJlZHVjZSgoc3VtLCBkb2MpID0+IHN1bSArIChkb2MubWV0YWRhdGEucmVsZXZhbmNlU2NvcmUgfHwgMCksIDApIC8gcmVzdWx0cy5kb2N1bWVudHMubGVuZ3RoXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBhZ2VudElkOiAnZW5oYW5jZWQtbWFyY3VzJyxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJlc3VsdHMucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgIHF1ZXJ5VHlwZTogJ2xvY2FsLWZhbGxiYWNrJ1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgYWdlbnQtc3BlY2lmaWMgcGF0dGVybnMgaW4gZW5oYW5jZWQgc2NoZW1hXG4gICAqL1xuICBhc3luYyBzdG9yZUFnZW50UGF0dGVybihhZ2VudE5hbWU6IHN0cmluZywgcGF0dGVybjogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMuaXNTdXBhYmFzZUVuYWJsZWQpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsIHN0b3JhZ2VcbiAgICAgIHJldHVybiB0aGlzLnN0b3JlTWVtb3J5KHtcbiAgICAgICAgY29udGVudDogcGF0dGVybi5jb2RlX2NvbnRlbnQgfHwgcGF0dGVybi5jb250ZW50LFxuICAgICAgICBjb250ZW50VHlwZTogJ2NvZGUnLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGFnZW50SWQ6IGFnZW50TmFtZSxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgdGFnczogcGF0dGVybi50YWdzIHx8IFtdLFxuICAgICAgICAgIC4uLnBhdHRlcm4ubWV0YWRhdGFcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2FnZW50X2NvZGVfcGF0dGVybnMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBhZ2VudF9uYW1lOiBhZ2VudE5hbWUsXG4gICAgICAgICAgcGF0dGVybl90eXBlOiBwYXR0ZXJuLnBhdHRlcm5fdHlwZSB8fCAndW5rbm93bicsXG4gICAgICAgICAgY29kZV9jb250ZW50OiBwYXR0ZXJuLmNvZGVfY29udGVudCB8fCBwYXR0ZXJuLmNvbnRlbnQsXG4gICAgICAgICAgZmlsZV9wYXRoOiBwYXR0ZXJuLmZpbGVfcGF0aCxcbiAgICAgICAgICBsYW5ndWFnZTogcGF0dGVybi5sYW5ndWFnZSxcbiAgICAgICAgICBmcmFtZXdvcms6IHBhdHRlcm4uZnJhbWV3b3JrLFxuICAgICAgICAgIHF1YWxpdHlfc2NvcmU6IHBhdHRlcm4ucXVhbGl0eV9zY29yZSB8fCA4MCxcbiAgICAgICAgICBtZXRhZGF0YTogcGF0dGVybi5tZXRhZGF0YSB8fCB7fSxcbiAgICAgICAgICB0YWdzOiBwYXR0ZXJuLnRhZ3MgfHwgW11cbiAgICAgICAgfSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdBZ2VudCBwYXR0ZXJuIHN0b3JlZCBpbiBlbmhhbmNlZCBzY2hlbWEnLCB7XG4gICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgcGF0dGVyblR5cGU6IHBhdHRlcm4ucGF0dGVybl90eXBlLFxuICAgICAgICBpZDogZGF0YS5pZFxuICAgICAgfSwgJ3JhZy1tZW1vcnknKTtcblxuICAgICAgcmV0dXJuIGRhdGEuaWQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBzdG9yZSBhZ2VudCBwYXR0ZXJuJywgeyBlcnJvciwgYWdlbnROYW1lIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgICAvLyBGYWxsYmFjayB0byBsb2NhbCBzdG9yYWdlXG4gICAgICByZXR1cm4gdGhpcy5zdG9yZU1lbW9yeSh7XG4gICAgICAgIGNvbnRlbnQ6IHBhdHRlcm4uY29kZV9jb250ZW50IHx8IHBhdHRlcm4uY29udGVudCxcbiAgICAgICAgY29udGVudFR5cGU6ICdjb2RlJyxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBhZ2VudElkOiBhZ2VudE5hbWUsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIHRhZ3M6IHBhdHRlcm4udGFncyB8fCBbXSxcbiAgICAgICAgICAuLi5wYXR0ZXJuLm1ldGFkYXRhXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBhZ2VudCBzb2x1dGlvbnMgaW4gZW5oYW5jZWQgc2NoZW1hXG4gICAqL1xuICBhc3luYyBzdG9yZUFnZW50U29sdXRpb24oYWdlbnROYW1lOiBzdHJpbmcsIHNvbHV0aW9uOiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RvcmVNZW1vcnkoe1xuICAgICAgICBjb250ZW50OiBzb2x1dGlvbi5zb2x1dGlvbl9jb2RlIHx8IHNvbHV0aW9uLmNvbnRlbnQsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnY29kZScsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgYWdlbnRJZDogYWdlbnROYW1lLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICBwcm9ibGVtVHlwZTogc29sdXRpb24ucHJvYmxlbV90eXBlLFxuICAgICAgICAgIC4uLnNvbHV0aW9uLm1ldGFkYXRhXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhZ2VudF9zb2x1dGlvbnMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBhZ2VudF9uYW1lOiBhZ2VudE5hbWUsXG4gICAgICAgICAgcHJvYmxlbV90eXBlOiBzb2x1dGlvbi5wcm9ibGVtX3R5cGUsXG4gICAgICAgICAgcHJvYmxlbV9kZXNjcmlwdGlvbjogc29sdXRpb24ucHJvYmxlbV9kZXNjcmlwdGlvbixcbiAgICAgICAgICBzb2x1dGlvbl9jb2RlOiBzb2x1dGlvbi5zb2x1dGlvbl9jb2RlLFxuICAgICAgICAgIHNvbHV0aW9uX2V4cGxhbmF0aW9uOiBzb2x1dGlvbi5zb2x1dGlvbl9leHBsYW5hdGlvbixcbiAgICAgICAgICBlZmZlY3RpdmVuZXNzX3Njb3JlOiBzb2x1dGlvbi5lZmZlY3RpdmVuZXNzX3Njb3JlIHx8IDAuOCxcbiAgICAgICAgICBkZXBlbmRlbmNpZXM6IHNvbHV0aW9uLmRlcGVuZGVuY2llcyB8fCBbXSxcbiAgICAgICAgICBjb21wYXRpYmlsaXR5OiBzb2x1dGlvbi5jb21wYXRpYmlsaXR5IHx8IHt9XG4gICAgICAgIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuaW5mbygnQWdlbnQgc29sdXRpb24gc3RvcmVkIGluIGVuaGFuY2VkIHNjaGVtYScsIHtcbiAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICBwcm9ibGVtVHlwZTogc29sdXRpb24ucHJvYmxlbV90eXBlLFxuICAgICAgICBpZDogZGF0YS5pZFxuICAgICAgfSwgJ3JhZy1tZW1vcnknKTtcblxuICAgICAgcmV0dXJuIGRhdGEuaWQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBzdG9yZSBhZ2VudCBzb2x1dGlvbicsIHsgZXJyb3IsIGFnZW50TmFtZSB9LCAncmFnLW1lbW9yeScpO1xuICAgICAgcmV0dXJuIHRoaXMuc3RvcmVNZW1vcnkoe1xuICAgICAgICBjb250ZW50OiBzb2x1dGlvbi5zb2x1dGlvbl9jb2RlIHx8IHNvbHV0aW9uLmNvbnRlbnQsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnY29kZScsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgYWdlbnRJZDogYWdlbnROYW1lLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICBwcm9ibGVtVHlwZTogc29sdXRpb24ucHJvYmxlbV90eXBlLFxuICAgICAgICAgIC4uLnNvbHV0aW9uLm1ldGFkYXRhXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcHJvZHVjdGlvbiBkZXBsb3ltZW50IHN0YXR1c1xuICAgKi9cbiAgZ2V0UHJvZHVjdGlvblN0YXR1cygpOiB7XG4gICAgc3VwYWJhc2VFbmFibGVkOiBib29sZWFuO1xuICAgIGVkZ2VGdW5jdGlvbnNFbmFibGVkOiBib29sZWFuO1xuICAgIGFnZW50UkFHQXZhaWxhYmxlOiBib29sZWFuO1xuICAgIGVuaGFuY2VkU2NoZW1hUmVhZHk6IGJvb2xlYW47XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBzdXBhYmFzZUVuYWJsZWQ6IHRoaXMuaXNTdXBhYmFzZUVuYWJsZWQsXG4gICAgICBlZGdlRnVuY3Rpb25zRW5hYmxlZDogdGhpcy5lZGdlRnVuY3Rpb25zRW5hYmxlZCxcbiAgICAgIGFnZW50UkFHQXZhaWxhYmxlOiB0aGlzLmVkZ2VGdW5jdGlvbnNFbmFibGVkICYmIHRoaXMuc3VwYWJhc2VVcmwgIT09IG51bGwsXG4gICAgICBlbmhhbmNlZFNjaGVtYVJlYWR5OiB0aGlzLmlzU3VwYWJhc2VFbmFibGVkXG4gICAgfTtcbiAgfVxufVxuXG4vLyBFeHBvcnQgZW5oYW5jZWQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgdmVjdG9yTWVtb3J5U3RvcmUgPSBuZXcgRW5oYW5jZWRWZWN0b3JNZW1vcnlTdG9yZSgpO1xuIl0sInZlcnNpb24iOjN9