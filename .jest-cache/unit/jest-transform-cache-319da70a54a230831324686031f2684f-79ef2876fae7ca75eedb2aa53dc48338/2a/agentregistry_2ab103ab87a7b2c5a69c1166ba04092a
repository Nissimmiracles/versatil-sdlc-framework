5a268866714ca1d2fa3019303f40558a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.agentRegistry = exports.log = exports.AgentRegistry = void 0;
const enhanced_maria_js_1 = require("./enhanced-maria.js");
const enhanced_james_js_1 = require("./enhanced-james.js");
const enhanced_marcus_js_1 = require("./enhanced-marcus.js");
const sarah_pm_js_1 = require("./sarah-pm.js");
const alex_ba_js_1 = require("./alex-ba.js");
const dr_ai_ml_js_1 = require("./dr-ai-ml.js");
const devops_dan_js_1 = require("./devops-dan.js");
const security_sam_js_1 = require("./security-sam.js");
const architecture_dan_js_1 = require("./architecture-dan.js");
const deployment_orchestrator_js_1 = require("./deployment-orchestrator.js");
const introspective_agent_js_1 = require("./introspective-agent.js");
const simulation_qa_js_1 = require("./simulation-qa.js");
class AgentRegistry {
    constructor(logger, skipAutoRegister = false) {
        this.logger = logger;
        this.agents = new Map();
        if (!skipAutoRegister) {
            this.registerAllAgents();
        }
    }
    registerAllAgents() {
        this.agents.set('enhanced-maria', new enhanced_maria_js_1.EnhancedMaria());
        this.agents.set('enhanced-james', new enhanced_james_js_1.EnhancedJames());
        this.agents.set('enhanced-marcus', new enhanced_marcus_js_1.EnhancedMarcus());
        this.agents.set('sarah-pm', new sarah_pm_js_1.SarahPm());
        this.agents.set('alex-ba', new alex_ba_js_1.AlexBa());
        this.agents.set('dr-ai-ml', new dr_ai_ml_js_1.DrAiMl());
        this.agents.set('devops-dan', new devops_dan_js_1.DevopsDan());
        this.agents.set('security-sam', new security_sam_js_1.SecuritySam());
        this.agents.set('architecture-dan', new architecture_dan_js_1.ArchitectureDan());
        this.agents.set('deployment-orchestrator', new deployment_orchestrator_js_1.DeploymentOrchestrator());
        this.agents.set('introspective-agent', new introspective_agent_js_1.IntrospectiveAgent());
        this.agents.set('simulation-qa', new simulation_qa_js_1.SimulationQa());
    }
    getAgent(id) {
        return this.agents.get(id);
    }
    getAllAgents() {
        return Array.from(this.agents.values());
    }
    listAgents() {
        return this.getAllAgents();
    }
    registerAgent(agentOrId, agent) {
        let id;
        let agentToRegister;
        if (typeof agentOrId === 'string') {
            // Old signature: registerAgent(id, agent)
            id = agentOrId;
            agentToRegister = agent;
        }
        else {
            // New signature: registerAgent(agent)
            agentToRegister = agentOrId;
            id = agentToRegister.id;
        }
        if (this.agents.has(id)) {
            throw new Error(`Agent with ID ${id} is already registered`);
        }
        this.agents.set(id, agentToRegister);
    }
    getRegisteredAgents() {
        return this.getAllAgents();
    }
    getAgentForFile(filePath) {
        // Match file patterns to agents
        const patterns = {
            'enhanced-maria': ['*.test.*', '*.spec.*', '__tests__/**'],
            'enhanced-james': ['*.tsx', '*.jsx', '*.vue', '*.css', '*.scss'],
            'enhanced-marcus': ['*.api.*', 'routes/**', 'controllers/**', 'services/**'],
            'dr-ai-ml': ['*.py', '*.ipynb', 'models/**', 'ml/**']
        };
        for (const [agentId, filePatterns] of Object.entries(patterns)) {
            for (const pattern of filePatterns) {
                const regexPattern = pattern
                    .replace(/\*\*/g, '.*')
                    .replace(/\*/g, '[^/]*')
                    .replace(/\./g, '\\.');
                if (new RegExp(regexPattern).test(filePath)) {
                    return this.agents.get(agentId) || null;
                }
            }
        }
        return null;
    }
    getAgentsForFilePattern(pattern) {
        return this.getAllAgents();
    }
    getStatus() {
        return {
            totalAgents: this.agents.size,
            agents: Array.from(this.agents.entries()).map(([id, agent]) => ({
                id,
                name: agent.name,
                specialization: agent.specialization
            }))
        };
    }
    isHealthy() {
        return this.agents.size > 0;
    }
    getAgentMetadata(id) {
        const agent = this.agents.get(id);
        if (!agent)
            return undefined;
        const metadata = {
            name: agent.name,
            specialization: agent.specialization,
            autoActivate: false,
            priority: id === 'introspective-agent' ? 4 : 3,
            triggers: {
                keywords: this.getKeywordsForAgent(id),
                patterns: [],
                fileTypes: []
            },
            collaborators: this.getCollaboratorIds(id)
        };
        // Add MCP tools for introspective agent
        if (id === 'introspective-agent') {
            metadata.mcpTools = ['Read MCP', 'Bash MCP', 'WebFetch MCP'];
        }
        return metadata;
    }
    getCollaborators(id) {
        const collaboratorIds = this.getCollaboratorIds(id);
        return collaboratorIds
            .map(collabId => this.agents.get(collabId))
            .filter((agent) => agent !== undefined);
    }
    getKeywordsForAgent(id) {
        const keywordMap = {
            'introspective-agent': ['introspection', 'optimization', 'performance', 'learning'],
            'enhanced-maria': ['test', 'quality', 'coverage', 'validation'],
            'enhanced-james': ['ui', 'frontend', 'component', 'accessibility'],
            'enhanced-marcus': ['api', 'backend', 'security', 'database'],
            'sarah-pm': ['project', 'sprint', 'milestone', 'timeline'],
            'alex-ba': ['requirements', 'business', 'analysis', 'stakeholder'],
            'dr-ai-ml': ['machine learning', 'model', 'training', 'prediction']
        };
        return keywordMap[id] || [];
    }
    getCollaboratorIds(id) {
        const collabMap = {
            'introspective-agent': ['enhanced-maria', 'enhanced-james', 'enhanced-marcus'],
            'enhanced-maria': ['enhanced-james', 'enhanced-marcus'],
            'enhanced-james': ['enhanced-maria', 'enhanced-marcus'],
            'enhanced-marcus': ['enhanced-maria', 'enhanced-james'],
            'sarah-pm': ['enhanced-maria', 'enhanced-james', 'enhanced-marcus', 'alex-ba'],
            'alex-ba': ['sarah-pm', 'enhanced-maria'],
            'dr-ai-ml': ['enhanced-marcus', 'enhanced-maria']
        };
        return collabMap[id] || [];
    }
}
exports.AgentRegistry = AgentRegistry;
exports.log = console;
// Export singleton instance for easy import
exports.agentRegistry = new AgentRegistry();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2FnZW50LXJlZ2lzdHJ5LnRzIiwibWFwcGluZ3MiOiI7OztBQUVBLDJEQUFvRDtBQUNwRCwyREFBb0Q7QUFDcEQsNkRBQXNEO0FBQ3RELCtDQUF3QztBQUN4Qyw2Q0FBc0M7QUFDdEMsK0NBQXVDO0FBQ3ZDLG1EQUE0QztBQUM1Qyx1REFBZ0Q7QUFDaEQsK0RBQXdEO0FBQ3hELDZFQUFzRTtBQUN0RSxxRUFBOEQ7QUFDOUQseURBQWtEO0FBRWxELE1BQWEsYUFBYTtJQUd4QixZQUFvQixNQUFZLEVBQUUsbUJBQTRCLEtBQUs7UUFBL0MsV0FBTSxHQUFOLE1BQU0sQ0FBTTtRQUZ4QixXQUFNLEdBQUcsSUFBSSxHQUFHLEVBQXFCLENBQUM7UUFHNUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDM0IsQ0FBQztJQUNILENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxpQ0FBYSxFQUFFLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLGlDQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLElBQUksbUNBQWMsRUFBRSxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUkscUJBQU8sRUFBRSxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksbUJBQU0sRUFBRSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksb0JBQU0sRUFBRSxDQUFDLENBQUM7UUFD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bW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2FnZW50LXJlZ2lzdHJ5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZFUlNBVElMTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyLmpzJztcbmltcG9ydCB7IEJhc2VBZ2VudCB9IGZyb20gJy4vYmFzZS1hZ2VudC5qcyc7XG5pbXBvcnQgeyBFbmhhbmNlZE1hcmlhIH0gZnJvbSAnLi9lbmhhbmNlZC1tYXJpYS5qcyc7XG5pbXBvcnQgeyBFbmhhbmNlZEphbWVzIH0gZnJvbSAnLi9lbmhhbmNlZC1qYW1lcy5qcyc7XG5pbXBvcnQgeyBFbmhhbmNlZE1hcmN1cyB9IGZyb20gJy4vZW5oYW5jZWQtbWFyY3VzLmpzJztcbmltcG9ydCB7IFNhcmFoUG0gfSBmcm9tICcuL3NhcmFoLXBtLmpzJztcbmltcG9ydCB7IEFsZXhCYSB9IGZyb20gJy4vYWxleC1iYS5qcyc7XG5pbXBvcnQgeyBEckFpTWwgfSBmcm9tICcuL2RyLWFpLW1sLmpzJztcbmltcG9ydCB7IERldm9wc0RhbiB9IGZyb20gJy4vZGV2b3BzLWRhbi5qcyc7XG5pbXBvcnQgeyBTZWN1cml0eVNhbSB9IGZyb20gJy4vc2VjdXJpdHktc2FtLmpzJztcbmltcG9ydCB7IEFyY2hpdGVjdHVyZURhbiB9IGZyb20gJy4vYXJjaGl0ZWN0dXJlLWRhbi5qcyc7XG5pbXBvcnQgeyBEZXBsb3ltZW50T3JjaGVzdHJhdG9yIH0gZnJvbSAnLi9kZXBsb3ltZW50LW9yY2hlc3RyYXRvci5qcyc7XG5pbXBvcnQgeyBJbnRyb3NwZWN0aXZlQWdlbnQgfSBmcm9tICcuL2ludHJvc3BlY3RpdmUtYWdlbnQuanMnO1xuaW1wb3J0IHsgU2ltdWxhdGlvblFhIH0gZnJvbSAnLi9zaW11bGF0aW9uLXFhLmpzJztcblxuZXhwb3J0IGNsYXNzIEFnZW50UmVnaXN0cnkge1xuICBwcml2YXRlIGFnZW50cyA9IG5ldyBNYXA8c3RyaW5nLCBCYXNlQWdlbnQ+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2dnZXI/OiBhbnksIHNraXBBdXRvUmVnaXN0ZXI6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIGlmICghc2tpcEF1dG9SZWdpc3Rlcikge1xuICAgICAgdGhpcy5yZWdpc3RlckFsbEFnZW50cygpO1xuICAgIH1cbiAgfVxuICBcbiAgcHJpdmF0ZSByZWdpc3RlckFsbEFnZW50cygpOiB2b2lkIHtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2VuaGFuY2VkLW1hcmlhJywgbmV3IEVuaGFuY2VkTWFyaWEoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdlbmhhbmNlZC1qYW1lcycsIG5ldyBFbmhhbmNlZEphbWVzKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZW5oYW5jZWQtbWFyY3VzJywgbmV3IEVuaGFuY2VkTWFyY3VzKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnc2FyYWgtcG0nLCBuZXcgU2FyYWhQbSgpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2FsZXgtYmEnLCBuZXcgQWxleEJhKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZHItYWktbWwnLCBuZXcgRHJBaU1sKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZGV2b3BzLWRhbicsIG5ldyBEZXZvcHNEYW4oKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdzZWN1cml0eS1zYW0nLCBuZXcgU2VjdXJpdHlTYW0oKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdhcmNoaXRlY3R1cmUtZGFuJywgbmV3IEFyY2hpdGVjdHVyZURhbigpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2RlcGxveW1lbnQtb3JjaGVzdHJhdG9yJywgbmV3IERlcGxveW1lbnRPcmNoZXN0cmF0b3IoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdpbnRyb3NwZWN0aXZlLWFnZW50JywgbmV3IEludHJvc3BlY3RpdmVBZ2VudCgpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ3NpbXVsYXRpb24tcWEnLCBuZXcgU2ltdWxhdGlvblFhKCkpO1xuICB9XG4gIFxuICBnZXRBZ2VudChpZDogc3RyaW5nKTogQmFzZUFnZW50IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5hZ2VudHMuZ2V0KGlkKTtcbiAgfVxuICBcbiAgZ2V0QWxsQWdlbnRzKCk6IEJhc2VBZ2VudFtdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmFnZW50cy52YWx1ZXMoKSk7XG4gIH1cblxuICBsaXN0QWdlbnRzKCk6IEJhc2VBZ2VudFtdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBbGxBZ2VudHMoKTtcbiAgfVxuXG4gIHJlZ2lzdGVyQWdlbnQoYWdlbnRPcklkOiBCYXNlQWdlbnQgfCBzdHJpbmcsIGFnZW50PzogQmFzZUFnZW50KTogdm9pZCB7XG4gICAgbGV0IGlkOiBzdHJpbmc7XG4gICAgbGV0IGFnZW50VG9SZWdpc3RlcjogQmFzZUFnZW50O1xuXG4gICAgaWYgKHR5cGVvZiBhZ2VudE9ySWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAvLyBPbGQgc2lnbmF0dXJlOiByZWdpc3RlckFnZW50KGlkLCBhZ2VudClcbiAgICAgIGlkID0gYWdlbnRPcklkO1xuICAgICAgYWdlbnRUb1JlZ2lzdGVyID0gYWdlbnQhO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOZXcgc2lnbmF0dXJlOiByZWdpc3RlckFnZW50KGFnZW50KVxuICAgICAgYWdlbnRUb1JlZ2lzdGVyID0gYWdlbnRPcklkO1xuICAgICAgaWQgPSBhZ2VudFRvUmVnaXN0ZXIuaWQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYWdlbnRzLmhhcyhpZCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQWdlbnQgd2l0aCBJRCAke2lkfSBpcyBhbHJlYWR5IHJlZ2lzdGVyZWRgKTtcbiAgICB9XG4gICAgdGhpcy5hZ2VudHMuc2V0KGlkLCBhZ2VudFRvUmVnaXN0ZXIpO1xuICB9XG5cbiAgZ2V0UmVnaXN0ZXJlZEFnZW50cygpOiBCYXNlQWdlbnRbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsQWdlbnRzKCk7XG4gIH1cblxuICBnZXRBZ2VudEZvckZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IEJhc2VBZ2VudCB8IG51bGwge1xuICAgIC8vIE1hdGNoIGZpbGUgcGF0dGVybnMgdG8gYWdlbnRzXG4gICAgY29uc3QgcGF0dGVybnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAgICdlbmhhbmNlZC1tYXJpYSc6IFsnKi50ZXN0LionLCAnKi5zcGVjLionLCAnX190ZXN0c19fLyoqJ10sXG4gICAgICAnZW5oYW5jZWQtamFtZXMnOiBbJyoudHN4JywgJyouanN4JywgJyoudnVlJywgJyouY3NzJywgJyouc2NzcyddLFxuICAgICAgJ2VuaGFuY2VkLW1hcmN1cyc6IFsnKi5hcGkuKicsICdyb3V0ZXMvKionLCAnY29udHJvbGxlcnMvKionLCAnc2VydmljZXMvKionXSxcbiAgICAgICdkci1haS1tbCc6IFsnKi5weScsICcqLmlweW5iJywgJ21vZGVscy8qKicsICdtbC8qKiddXG4gICAgfTtcblxuICAgIGZvciAoY29uc3QgW2FnZW50SWQsIGZpbGVQYXR0ZXJuc10gb2YgT2JqZWN0LmVudHJpZXMocGF0dGVybnMpKSB7XG4gICAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgZmlsZVBhdHRlcm5zKSB7XG4gICAgICAgIGNvbnN0IHJlZ2V4UGF0dGVybiA9IHBhdHRlcm5cbiAgICAgICAgICAucmVwbGFjZSgvXFwqXFwqL2csICcuKicpXG4gICAgICAgICAgLnJlcGxhY2UoL1xcKi9nLCAnW14vXSonKVxuICAgICAgICAgIC5yZXBsYWNlKC9cXC4vZywgJ1xcXFwuJyk7XG5cbiAgICAgICAgaWYgKG5ldyBSZWdFeHAocmVnZXhQYXR0ZXJuKS50ZXN0KGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmFnZW50cy5nZXQoYWdlbnRJZCkgfHwgbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZ2V0QWdlbnRzRm9yRmlsZVBhdHRlcm4ocGF0dGVybjogc3RyaW5nKTogQmFzZUFnZW50W10ge1xuICAgIHJldHVybiB0aGlzLmdldEFsbEFnZW50cygpO1xuICB9XG5cbiAgZ2V0U3RhdHVzKCk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsQWdlbnRzOiB0aGlzLmFnZW50cy5zaXplLFxuICAgICAgYWdlbnRzOiBBcnJheS5mcm9tKHRoaXMuYWdlbnRzLmVudHJpZXMoKSkubWFwKChbaWQsIGFnZW50XSkgPT4gKHtcbiAgICAgICAgaWQsXG4gICAgICAgIG5hbWU6IGFnZW50Lm5hbWUsXG4gICAgICAgIHNwZWNpYWxpemF0aW9uOiBhZ2VudC5zcGVjaWFsaXphdGlvblxuICAgICAgfSkpXG4gICAgfTtcbiAgfVxuXG4gIGlzSGVhbHRoeSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5hZ2VudHMuc2l6ZSA+IDA7XG4gIH1cblxuICBnZXRBZ2VudE1ldGFkYXRhKGlkOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IGFnZW50ID0gdGhpcy5hZ2VudHMuZ2V0KGlkKTtcbiAgICBpZiAoIWFnZW50KSByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgbWV0YWRhdGE6IGFueSA9IHtcbiAgICAgIG5hbWU6IGFnZW50Lm5hbWUsXG4gICAgICBzcGVjaWFsaXphdGlvbjogYWdlbnQuc3BlY2lhbGl6YXRpb24sXG4gICAgICBhdXRvQWN0aXZhdGU6IGZhbHNlLFxuICAgICAgcHJpb3JpdHk6IGlkID09PSAnaW50cm9zcGVjdGl2ZS1hZ2VudCcgPyA0IDogMyxcbiAgICAgIHRyaWdnZXJzOiB7XG4gICAgICAgIGtleXdvcmRzOiB0aGlzLmdldEtleXdvcmRzRm9yQWdlbnQoaWQpLFxuICAgICAgICBwYXR0ZXJuczogW10sXG4gICAgICAgIGZpbGVUeXBlczogW11cbiAgICAgIH0sXG4gICAgICBjb2xsYWJvcmF0b3JzOiB0aGlzLmdldENvbGxhYm9yYXRvcklkcyhpZClcbiAgICB9O1xuXG4gICAgLy8gQWRkIE1DUCB0b29scyBmb3IgaW50cm9zcGVjdGl2ZSBhZ2VudFxuICAgIGlmIChpZCA9PT0gJ2ludHJvc3BlY3RpdmUtYWdlbnQnKSB7XG4gICAgICBtZXRhZGF0YS5tY3BUb29scyA9IFsnUmVhZCBNQ1AnLCAnQmFzaCBNQ1AnLCAnV2ViRmV0Y2ggTUNQJ107XG4gICAgfVxuXG4gICAgcmV0dXJuIG1ldGFkYXRhO1xuICB9XG5cbiAgZ2V0Q29sbGFib3JhdG9ycyhpZDogc3RyaW5nKTogQmFzZUFnZW50W10ge1xuICAgIGNvbnN0IGNvbGxhYm9yYXRvcklkcyA9IHRoaXMuZ2V0Q29sbGFib3JhdG9ySWRzKGlkKTtcbiAgICByZXR1cm4gY29sbGFib3JhdG9ySWRzXG4gICAgICAubWFwKGNvbGxhYklkID0+IHRoaXMuYWdlbnRzLmdldChjb2xsYWJJZCkpXG4gICAgICAuZmlsdGVyKChhZ2VudCk6IGFnZW50IGlzIEJhc2VBZ2VudCA9PiBhZ2VudCAhPT0gdW5kZWZpbmVkKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0S2V5d29yZHNGb3JBZ2VudChpZDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGtleXdvcmRNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAgICdpbnRyb3NwZWN0aXZlLWFnZW50JzogWydpbnRyb3NwZWN0aW9uJywgJ29wdGltaXphdGlvbicsICdwZXJmb3JtYW5jZScsICdsZWFybmluZyddLFxuICAgICAgJ2VuaGFuY2VkLW1hcmlhJzogWyd0ZXN0JywgJ3F1YWxpdHknLCAnY292ZXJhZ2UnLCAndmFsaWRhdGlvbiddLFxuICAgICAgJ2VuaGFuY2VkLWphbWVzJzogWyd1aScsICdmcm9udGVuZCcsICdjb21wb25lbnQnLCAnYWNjZXNzaWJpbGl0eSddLFxuICAgICAgJ2VuaGFuY2VkLW1hcmN1cyc6IFsnYXBpJywgJ2JhY2tlbmQnLCAnc2VjdXJpdHknLCAnZGF0YWJhc2UnXSxcbiAgICAgICdzYXJhaC1wbSc6IFsncHJvamVjdCcsICdzcHJpbnQnLCAnbWlsZXN0b25lJywgJ3RpbWVsaW5lJ10sXG4gICAgICAnYWxleC1iYSc6IFsncmVxdWlyZW1lbnRzJywgJ2J1c2luZXNzJywgJ2FuYWx5c2lzJywgJ3N0YWtlaG9sZGVyJ10sXG4gICAgICAnZHItYWktbWwnOiBbJ21hY2hpbmUgbGVhcm5pbmcnLCAnbW9kZWwnLCAndHJhaW5pbmcnLCAncHJlZGljdGlvbiddXG4gICAgfTtcbiAgICByZXR1cm4ga2V5d29yZE1hcFtpZF0gfHwgW107XG4gIH1cblxuICBwcml2YXRlIGdldENvbGxhYm9yYXRvcklkcyhpZDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGNvbGxhYk1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgJ2ludHJvc3BlY3RpdmUtYWdlbnQnOiBbJ2VuaGFuY2VkLW1hcmlhJywgJ2VuaGFuY2VkLWphbWVzJywgJ2VuaGFuY2VkLW1hcmN1cyddLFxuICAgICAgJ2VuaGFuY2VkLW1hcmlhJzogWydlbmhhbmNlZC1qYW1lcycsICdlbmhhbmNlZC1tYXJjdXMnXSxcbiAgICAgICdlbmhhbmNlZC1qYW1lcyc6IFsnZW5oYW5jZWQtbWFyaWEnLCAnZW5oYW5jZWQtbWFyY3VzJ10sXG4gICAgICAnZW5oYW5jZWQtbWFyY3VzJzogWydlbmhhbmNlZC1tYXJpYScsICdlbmhhbmNlZC1qYW1lcyddLFxuICAgICAgJ3NhcmFoLXBtJzogWydlbmhhbmNlZC1tYXJpYScsICdlbmhhbmNlZC1qYW1lcycsICdlbmhhbmNlZC1tYXJjdXMnLCAnYWxleC1iYSddLFxuICAgICAgJ2FsZXgtYmEnOiBbJ3NhcmFoLXBtJywgJ2VuaGFuY2VkLW1hcmlhJ10sXG4gICAgICAnZHItYWktbWwnOiBbJ2VuaGFuY2VkLW1hcmN1cycsICdlbmhhbmNlZC1tYXJpYSddXG4gICAgfTtcbiAgICByZXR1cm4gY29sbGFiTWFwW2lkXSB8fCBbXTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgbG9nID0gY29uc29sZTtcblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZSBmb3IgZWFzeSBpbXBvcnRcbmV4cG9ydCBjb25zdCBhZ2VudFJlZ2lzdHJ5ID0gbmV3IEFnZW50UmVnaXN0cnkoKTtcbiJdLCJ2ZXJzaW9uIjozfQ==