18e3e3be02462f59c7d30f59342e4b21
"use strict";
/**
 * VERSATIL SDLC Framework - Sarah PM (Project Manager)
 * Specialized in sprint planning, milestone tracking, team coordination
 *
 * RAG-Enhanced: Learns from project patterns, sprint velocity, team dynamics
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SarahPm = void 0;
const rag_enabled_agent_js_1 = require("./rag-enabled-agent.js");
class SarahPm extends rag_enabled_agent_js_1.RAGEnabledAgent {
    constructor(vectorStore) {
        super(vectorStore);
        this.name = 'SarahPm';
        this.id = 'sarah-pm';
        this.specialization = 'Project Manager & Sprint Coordinator';
        this.systemPrompt = 'Experienced Project Manager specializing in Agile/Scrum methodology, sprint planning, team coordination, and milestone tracking';
    }
    /**
     * PM-specific RAG configuration
     * Focus on project patterns, sprint velocity, team dynamics
     */
    getDefaultRAGConfig() {
        return {
            maxExamples: 5, // More examples for better sprint planning
            similarityThreshold: 0.75, // Slightly lower - more historical data
            agentDomain: 'project-management',
            enableLearning: true
        };
    }
    /**
     * PM-specific pattern analysis
     */
    async runPatternAnalysis(context) {
        const content = context.content || '';
        const filePath = context.filePath || '';
        // Detect PM-related patterns
        const patterns = [];
        // Sprint planning patterns
        if (content.match(/sprint|iteration|milestone|deadline/i)) {
            patterns.push({
                type: 'sprint-planning',
                message: 'Sprint planning or milestone tracking detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Task coordination patterns
        if (content.match(/task|story|epic|backlog|TODO/i)) {
            patterns.push({
                type: 'task-coordination',
                message: 'Task management activity detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Team communication patterns
        if (content.match(/standup|review|retrospective|demo/i)) {
            patterns.push({
                type: 'team-communication',
                message: 'Agile ceremony or team communication detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        // Risk assessment patterns
        if (content.match(/risk|blocker|dependency|blocked/i)) {
            patterns.push({
                type: 'risk-assessment',
                message: 'Project risk or blocker detected',
                severity: 'high',
                location: { file: filePath, line: 0 }
            });
        }
        // Velocity tracking
        if (content.match(/velocity|burndown|capacity|points/i)) {
            patterns.push({
                type: 'velocity-tracking',
                message: 'Sprint velocity or capacity planning detected',
                severity: 'info',
                location: { file: filePath, line: 0 }
            });
        }
        return {
            patterns,
            score: patterns.length > 0 ? 85 : 100, // PM quality score
            summary: `Detected ${patterns.length} PM patterns`,
            recommendations: patterns
                .filter(p => p.severity === 'high' || p.severity === 'critical')
                .map(p => p.message)
        };
    }
    /**
     * Override activate to add PM-specific context
     */
    async activate(context) {
        // Call parent (RAGEnabledAgent) to get RAG-enhanced response
        const response = await super.activate(context);
        // Add PM-specific enhancements
        if (response.context) {
            response.context = {
                ...response.context,
                pmInsights: {
                    sprintPlanningDetected: context.content?.includes('sprint') || false,
                    milestoneTracking: context.content?.includes('milestone') || false,
                    teamCoordination: context.content?.includes('team') || false,
                    riskAssessment: context.content?.includes('risk') || false
                }
            };
        }
        // Add PM-specific suggestions if RAG context available
        const ragContext = context.ragContext;
        if (ragContext && ragContext.previousSolutions) {
            const pmSuggestions = this.generatePMSuggestions(ragContext, context);
            response.suggestions = [...(response.suggestions || []), ...pmSuggestions];
        }
        // Determine handoffs
        response.handoffTo = this.determineHandoffs(context, response);
        return response;
    }
    /**
     * Generate PM-specific suggestions from RAG context
     */
    generatePMSuggestions(ragContext, context) {
        const suggestions = [];
        // Sprint velocity suggestions
        if (context.content?.includes('velocity') && ragContext.previousSolutions['velocity-tracking']) {
            suggestions.push({
                type: 'velocity-optimization',
                message: 'Historical velocity data suggests planning for 80% capacity to account for interruptions',
                priority: 'medium',
                file: context.filePath || 'sprint-planning'
            });
        }
        // Risk mitigation suggestions
        if (context.content?.includes('risk') && ragContext.previousSolutions['risk-assessment']) {
            suggestions.push({
                type: 'risk-mitigation',
                message: 'Similar risks in previous sprints were mitigated by early stakeholder communication',
                priority: 'high',
                file: context.filePath || 'risk-register'
            });
        }
        // Team coordination suggestions
        if (context.content?.includes('team') && ragContext.agentExpertise.length > 0) {
            suggestions.push({
                type: 'team-coordination',
                message: 'Previous team coordination patterns suggest daily standups at 9:30 AM work best',
                priority: 'low',
                file: context.filePath || 'team-calendar'
            });
        }
        return suggestions;
    }
    /**
     * Determine which agents to hand off to
     */
    determineHandoffs(context, response) {
        const handoffs = [];
        // Hand off to Maria if quality concerns detected
        if (response.priority === 'high' || response.priority === 'critical') {
            handoffs.push('maria-qa');
        }
        // Hand off to Alex-BA for requirements clarification
        if (context.content?.includes('requirement') || context.content?.includes('user story')) {
            handoffs.push('alex-ba');
        }
        return handoffs;
    }
    /**
     * Get base prompt template for PM
     */
    getBasePromptTemplate() {
        return `You are Sarah PM, an expert Project Manager specializing in Agile/Scrum methodology.
Your role is to coordinate sprint planning, track milestones, assess risks, and ensure team alignment.
Focus on practical project management guidance based on historical data and best practices.`;
    }
    /**
     * Generate domain-specific handoffs based on analysis
     */
    generateDomainHandoffs(analysis) {
        const handoffs = [];
        // Check if QA involvement needed
        if (analysis.patterns.some(p => p.type === 'risk-assessment' && (p.severity === 'high' || p.severity === 'critical'))) {
            handoffs.push('maria-qa');
        }
        // Check if requirements clarification needed
        if (analysis.patterns.some(p => p.type === 'task-coordination')) {
            handoffs.push('alex-ba');
        }
        return handoffs;
    }
}
exports.SarahPm = SarahPm;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL3NhcmFoLXBtLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7O0FBRUgsaUVBQXFGO0FBS3JGLE1BQWEsT0FBUSxTQUFRLHNDQUFlO0lBTTFDLFlBQVksV0FBdUM7UUFDakQsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBTnJCLFNBQUksR0FBRyxTQUFTLENBQUM7UUFDakIsT0FBRSxHQUFHLFVBQVUsQ0FBQztRQUNoQixtQkFBYyxHQUFHLHNDQUFzQyxDQUFDO1FBQ3hELGlCQUFZLEdBQUcsaUlBQWlJLENBQUM7SUFJakosQ0FBQztJQUVEOzs7T0FHRztJQUNPLG1CQUFtQjtRQUMzQixPQUFPO1lBQ0wsV0FBVyxFQUFFLENBQUMsRUFBRSwyQ0FBMkM7WUFDM0QsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLHdDQUF3QztZQUNuRSxXQUFXLEVBQUUsb0JBQW9CO1lBQ2pDLGNBQWMsRUFBRSxJQUFJO1NBQ3JCLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDTyxLQUFLLENBQUMsa0JBQWtCLENBQUMsT0FBK0I7UUFDaEUsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDdEMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUM7UUFFeEMsNkJBQTZCO1FBQzdCLE1BQU0sUUFBUSxHQUFVLEVBQUUsQ0FBQztRQUUzQiwyQkFBMkI7UUFDM0IsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLHNDQUFzQyxDQUFDLEVBQUUsQ0FBQztZQUMxRCxRQUFRLENBQUMsSUFBSSxDQUFDO2dCQUNaLElBQUksRUFBRSxpQkFBaUI7Z0JBQ3ZCLE9BQU8sRUFBRSxnREFBZ0Q7Z0JBQ3pELFFBQVEsRUFBRSxNQUFNO2dCQUNoQixRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUU7YUFDdEMsQ0FBQyxD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LENBQUM7UUFFRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQ7O09BRUc7SUFDTyxxQkFBcUI7UUFDN0IsT0FBTzs7NEZBRWlGLENBQUM7SUFDM0YsQ0FBQztJQUVEOztPQUVHO0lBQ08sc0JBQXNCLENBQUMsUUFBd0I7UUFDdkQsTUFBTSxRQUFRLEdBQWEsRUFBRSxDQUFDO1FBRTlCLGlDQUFpQztRQUNqQyxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxpQkFBaUIsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLENBQUMsQ0FBQyxRQUFRLEtBQUssVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3RILFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDNUIsQ0FBQztRQUVELDZDQUE2QztRQUM3QyxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxtQkFBbUIsQ0FBQyxFQUFFLENBQUM7WUFDaEUsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzQixDQUFDO1FBRUQsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztDQUNGO0FBbk5ELDBCQW1OQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbmlzc2ltbWVuYXNoZS9WRVJTQVRJTCBTRExDIEZXL3NyYy9hZ2VudHMvc2FyYWgtcG0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBWRVJTQVRJTCBTRExDIEZyYW1ld29yayAtIFNhcmFoIFBNIChQcm9qZWN0IE1hbmFnZXIpXG4gKiBTcGVjaWFsaXplZCBpbiBzcHJpbnQgcGxhbm5pbmcsIG1pbGVzdG9uZSB0cmFja2luZywgdGVhbSBjb29yZGluYXRpb25cbiAqXG4gKiBSQUctRW5oYW5jZWQ6IExlYXJucyBmcm9tIHByb2plY3QgcGF0dGVybnMsIHNwcmludCB2ZWxvY2l0eSwgdGVhbSBkeW5hbWljc1xuICovXG5cbmltcG9ydCB7IFJBR0VuYWJsZWRBZ2VudCwgUkFHQ29uZmlnLCBBZ2VudFJBR0NvbnRleHQgfSBmcm9tICcuL3JhZy1lbmFibGVkLWFnZW50LmpzJztcbmltcG9ydCB7IEFnZW50UmVzcG9uc2UsIEFnZW50QWN0aXZhdGlvbkNvbnRleHQgfSBmcm9tICcuL2Jhc2UtYWdlbnQuanMnO1xuaW1wb3J0IHsgUGF0dGVybkFuYWx5emVyLCBBbmFseXNpc1Jlc3VsdCB9IGZyb20gJy4uL2ludGVsbGlnZW5jZS9wYXR0ZXJuLWFuYWx5emVyLmpzJztcbmltcG9ydCB7IEVuaGFuY2VkVmVjdG9yTWVtb3J5U3RvcmUgfSBmcm9tICcuLi9yYWcvZW5oYW5jZWQtdmVjdG9yLW1lbW9yeS1zdG9yZS5qcyc7XG5cbmV4cG9ydCBjbGFzcyBTYXJhaFBtIGV4dGVuZHMgUkFHRW5hYmxlZEFnZW50IHtcbiAgbmFtZSA9ICdTYXJhaFBtJztcbiAgaWQgPSAnc2FyYWgtcG0nO1xuICBzcGVjaWFsaXphdGlvbiA9ICdQcm9qZWN0IE1hbmFnZXIgJiBTcHJpbnQgQ29vcmRpbmF0b3InO1xuICBzeXN0ZW1Qcm9tcHQgPSAnRXhwZXJpZW5jZWQgUHJvamVjdCBNYW5hZ2VyIHNwZWNpYWxpemluZyBpbiBBZ2lsZS9TY3J1bSBtZXRob2RvbG9neSwgc3ByaW50IHBsYW5uaW5nLCB0ZWFtIGNvb3JkaW5hdGlvbiwgYW5kIG1pbGVzdG9uZSB0cmFja2luZyc7XG5cbiAgY29uc3RydWN0b3IodmVjdG9yU3RvcmU/OiBFbmhhbmNlZFZlY3Rvck1lbW9yeVN0b3JlKSB7XG4gICAgc3VwZXIodmVjdG9yU3RvcmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBNLXNwZWNpZmljIFJBRyBjb25maWd1cmF0aW9uXG4gICAqIEZvY3VzIG9uIHByb2plY3QgcGF0dGVybnMsIHNwcmludCB2ZWxvY2l0eSwgdGVhbSBkeW5hbWljc1xuICAgKi9cbiAgcHJvdGVjdGVkIGdldERlZmF1bHRSQUdDb25maWcoKTogUkFHQ29uZmlnIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWF4RXhhbXBsZXM6IDUsIC8vIE1vcmUgZXhhbXBsZXMgZm9yIGJldHRlciBzcHJpbnQgcGxhbm5pbmdcbiAgICAgIHNpbWlsYXJpdHlUaHJlc2hvbGQ6IDAuNzUsIC8vIFNsaWdodGx5IGxvd2VyIC0gbW9yZSBoaXN0b3JpY2FsIGRhdGFcbiAgICAgIGFnZW50RG9tYWluOiAncHJvamVjdC1tYW5hZ2VtZW50JyxcbiAgICAgIGVuYWJsZUxlYXJuaW5nOiB0cnVlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQTS1zcGVjaWZpYyBwYXR0ZXJuIGFuYWx5c2lzXG4gICAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgcnVuUGF0dGVybkFuYWx5c2lzKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc3QgY29udGVudCA9IGNvbnRleHQuY29udGVudCB8fCAnJztcbiAgICBjb25zdCBmaWxlUGF0aCA9IGNvbnRleHQuZmlsZVBhdGggfHwgJyc7XG5cbiAgICAvLyBEZXRlY3QgUE0tcmVsYXRlZCBwYXR0ZXJuc1xuICAgIGNvbnN0IHBhdHRlcm5zOiBhbnlbXSA9IFtdO1xuXG4gICAgLy8gU3ByaW50IHBsYW5uaW5nIHBhdHRlcm5zXG4gICAgaWYgKGNvbnRlbnQubWF0Y2goL3NwcmludHxpdGVyYXRpb258bWlsZXN0b25lfGRlYWRsaW5lL2kpKSB7XG4gICAgICBwYXR0ZXJucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3NwcmludC1wbGFubmluZycsXG4gICAgICAgIG1lc3NhZ2U6ICdTcHJpbnQgcGxhbm5pbmcgb3IgbWlsZXN0b25lIHRyYWNraW5nIGRldGVjdGVkJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdpbmZvJyxcbiAgICAgICAgbG9jYXRpb246IHsgZmlsZTogZmlsZVBhdGgsIGxpbmU6IDAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVGFzayBjb29yZGluYXRpb24gcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvdGFza3xzdG9yeXxlcGljfGJhY2tsb2d8VE9ETy9pKSkge1xuICAgICAgcGF0dGVybnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICd0YXNrLWNvb3JkaW5hdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdUYXNrIG1hbmFnZW1lbnQgYWN0aXZpdHkgZGV0ZWN0ZWQnLFxuICAgICAgICBzZXZlcml0eTogJ2luZm8nLFxuICAgICAgICBsb2NhdGlvbjogeyBmaWxlOiBmaWxlUGF0aCwgbGluZTogMCB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUZWFtIGNvbW11bmljYXRpb24gcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvc3RhbmR1cHxyZXZpZXd8cmV0cm9zcGVjdGl2ZXxkZW1vL2kpKSB7XG4gICAgICBwYXR0ZXJucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3RlYW0tY29tbXVuaWNhdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdBZ2lsZSBjZXJlbW9ueSBvciB0ZWFtIGNvbW11bmljYXRpb24gZGV0ZWN0ZWQnLFxuICAgICAgICBzZXZlcml0eTogJ2luZm8nLFxuICAgICAgICBsb2NhdGlvbjogeyBmaWxlOiBmaWxlUGF0aCwgbGluZTogMCB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSaXNrIGFzc2Vzc21lbnQgcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvcmlza3xibG9ja2VyfGRlcGVuZGVuY3l8YmxvY2tlZC9pKSkge1xuICAgICAgcGF0dGVybnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdyaXNrLWFzc2Vzc21lbnQnLFxuICAgICAgICBtZXNzYWdlOiAnUHJvamVjdCByaXNrIG9yIGJsb2NrZXIgZGV0ZWN0ZWQnLFxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxuICAgICAgICBsb2NhdGlvbjogeyBmaWxlOiBmaWxlUGF0aCwgbGluZTogMCB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBWZWxvY2l0eSB0cmFja2luZ1xuICAgIGlmIChjb250ZW50Lm1hdGNoKC92ZWxvY2l0eXxidXJuZG93bnxjYXBhY2l0eXxwb2ludHMvaSkpIHtcbiAgICAgIHBhdHRlcm5zLnB1c2goe1xuICAgICAgICB0eXBlOiAndmVsb2NpdHktdHJhY2tpbmcnLFxuICAgICAgICBtZXNzYWdlOiAnU3ByaW50IHZlbG9jaXR5IG9yIGNhcGFjaXR5IHBsYW5uaW5nIGRldGVjdGVkJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdpbmZvJyxcbiAgICAgICAgbG9jYXRpb246IHsgZmlsZTogZmlsZVBhdGgsIGxpbmU6IDAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdHRlcm5zLFxuICAgICAgc2NvcmU6IHBhdHRlcm5zLmxlbmd0aCA+IDAgPyA4NSA6IDEwMCwgLy8gUE0gcXVhbGl0eSBzY29yZVxuICAgICAgc3VtbWFyeTogYERldGVjdGVkICR7cGF0dGVybnMubGVuZ3RofSBQTSBwYXR0ZXJuc2AsXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHBhdHRlcm5zXG4gICAgICAgIC5maWx0ZXIocCA9PiBwLnNldmVyaXR5ID09PSAnaGlnaCcgfHwgcC5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJylcbiAgICAgICAgLm1hcChwID0+IHAubWVzc2FnZSlcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlIGFjdGl2YXRlIHRvIGFkZCBQTS1zcGVjaWZpYyBjb250ZXh0XG4gICAqL1xuICBhc3luYyBhY3RpdmF0ZShjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogUHJvbWlzZTxBZ2VudFJlc3BvbnNlPiB7XG4gICAgLy8gQ2FsbCBwYXJlbnQgKFJBR0VuYWJsZWRBZ2VudCkgdG8gZ2V0IFJBRy1lbmhhbmNlZCByZXNwb25zZVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3VwZXIuYWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAvLyBBZGQgUE0tc3BlY2lmaWMgZW5oYW5jZW1lbnRzXG4gICAgaWYgKHJlc3BvbnNlLmNvbnRleHQpIHtcbiAgICAgIHJlc3BvbnNlLmNvbnRleHQgPSB7XG4gICAgICAgIC4uLnJlc3BvbnNlLmNvbnRleHQsXG4gICAgICAgIHBtSW5zaWdodHM6IHtcbiAgICAgICAgICBzcHJpbnRQbGFubmluZ0RldGVjdGVkOiBjb250ZXh0LmNvbnRlbnQ/LmluY2x1ZGVzKCdzcHJpbnQnKSB8fCBmYWxzZSxcbiAgICAgICAgICBtaWxlc3RvbmVUcmFja2luZzogY29udGV4dC5jb250ZW50Py5pbmNsdWRlcygnbWlsZXN0b25lJykgfHwgZmFsc2UsXG4gICAgICAgICAgdGVhbUNvb3JkaW5hdGlvbjogY29udGV4dC5jb250ZW50Py5pbmNsdWRlcygndGVhbScpIHx8IGZhbHNlLFxuICAgICAgICAgIHJpc2tBc3Nlc3NtZW50OiBjb250ZXh0LmNvbnRlbnQ/LmluY2x1ZGVzKCdyaXNrJykgfHwgZmFsc2VcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBBZGQgUE0tc3BlY2lmaWMgc3VnZ2VzdGlvbnMgaWYgUkFHIGNvbnRleHQgYXZhaWxhYmxlXG4gICAgY29uc3QgcmFnQ29udGV4dCA9IGNvbnRleHQucmFnQ29udGV4dCBhcyBBZ2VudFJBR0NvbnRleHQgfCB1bmRlZmluZWQ7XG4gICAgaWYgKHJhZ0NvbnRleHQgJiYgcmFnQ29udGV4dC5wcmV2aW91c1NvbHV0aW9ucykge1xuICAgICAgY29uc3QgcG1TdWdnZXN0aW9ucyA9IHRoaXMuZ2VuZXJhdGVQTVN1Z2dlc3Rpb25zKHJhZ0NvbnRleHQsIGNvbnRleHQpO1xuICAgICAgcmVzcG9uc2Uuc3VnZ2VzdGlvbnMgPSBbLi4uKHJlc3BvbnNlLnN1Z2dlc3Rpb25zIHx8IFtdKSwgLi4ucG1TdWdnZXN0aW9uc107XG4gICAgfVxuXG4gICAgLy8gRGV0ZXJtaW5lIGhhbmRvZmZzXG4gICAgcmVzcG9uc2UuaGFuZG9mZlRvID0gdGhpcy5kZXRlcm1pbmVIYW5kb2Zmcyhjb250ZXh0LCByZXNwb25zZSk7XG5cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgUE0tc3BlY2lmaWMgc3VnZ2VzdGlvbnMgZnJvbSBSQUcgY29udGV4dFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVBNU3VnZ2VzdGlvbnMocmFnQ29udGV4dDogQWdlbnRSQUdDb250ZXh0LCBjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogYW55W10ge1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zOiBhbnlbXSA9IFtdO1xuXG4gICAgLy8gU3ByaW50IHZlbG9jaXR5IHN1Z2dlc3Rpb25zXG4gICAgaWYgKGNvbnRleHQuY29udGVudD8uaW5jbHVkZXMoJ3ZlbG9jaXR5JykgJiYgcmFnQ29udGV4dC5wcmV2aW91c1NvbHV0aW9uc1sndmVsb2NpdHktdHJhY2tpbmcnXSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICd2ZWxvY2l0eS1vcHRpbWl6YXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnSGlzdG9yaWNhbCB2ZWxvY2l0eSBkYXRhIHN1Z2dlc3RzIHBsYW5uaW5nIGZvciA4MCUgY2FwYWNpdHkgdG8gYWNjb3VudCBmb3IgaW50ZXJydXB0aW9ucycsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAnc3ByaW50LXBsYW5uaW5nJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmlzayBtaXRpZ2F0aW9uIHN1Z2dlc3Rpb25zXG4gICAgaWYgKGNvbnRleHQuY29udGVudD8uaW5jbHVkZXMoJ3Jpc2snKSAmJiByYWdDb250ZXh0LnByZXZpb3VzU29sdXRpb25zWydyaXNrLWFzc2Vzc21lbnQnXSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdyaXNrLW1pdGlnYXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnU2ltaWxhciByaXNrcyBpbiBwcmV2aW91cyBzcHJpbnRzIHdlcmUgbWl0aWdhdGVkIGJ5IGVhcmx5IHN0YWtlaG9sZGVyIGNvbW11bmljYXRpb24nLFxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICdyaXNrLXJlZ2lzdGVyJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVGVhbSBjb29yZGluYXRpb24gc3VnZ2VzdGlvbnNcbiAgICBpZiAoY29udGV4dC5jb250ZW50Py5pbmNsdWRlcygndGVhbScpICYmIHJhZ0NvbnRleHQuYWdlbnRFeHBlcnRpc2UubGVuZ3RoID4gMCkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICd0ZWFtLWNvb3JkaW5hdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdQcmV2aW91cyB0ZWFtIGNvb3JkaW5hdGlvbiBwYXR0ZXJucyBzdWdnZXN0IGRhaWx5IHN0YW5kdXBzIGF0IDk6MzAgQU0gd29yayBiZXN0JyxcbiAgICAgICAgcHJpb3JpdHk6ICdsb3cnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd0ZWFtLWNhbGVuZGFyJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSB3aGljaCBhZ2VudHMgdG8gaGFuZCBvZmYgdG9cbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lSGFuZG9mZnMoY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCwgcmVzcG9uc2U6IEFnZW50UmVzcG9uc2UpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaGFuZG9mZnM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBIYW5kIG9mZiB0byBNYXJpYSBpZiBxdWFsaXR5IGNvbmNlcm5zIGRldGVjdGVkXG4gICAgaWYgKHJlc3BvbnNlLnByaW9yaXR5ID09PSAnaGlnaCcgfHwgcmVzcG9uc2UucHJpb3JpdHkgPT09ICdjcml0aWNhbCcpIHtcbiAgICAgIGhhbmRvZmZzLnB1c2goJ21hcmlhLXFhJyk7XG4gICAgfVxuXG4gICAgLy8gSGFuZCBvZmYgdG8gQWxleC1CQSBmb3IgcmVxdWlyZW1lbnRzIGNsYXJpZmljYXRpb25cbiAgICBpZiAoY29udGV4dC5jb250ZW50Py5pbmNsdWRlcygncmVxdWlyZW1lbnQnKSB8fCBjb250ZXh0LmNvbnRlbnQ/LmluY2x1ZGVzKCd1c2VyIHN0b3J5JykpIHtcbiAgICAgIGhhbmRvZmZzLnB1c2goJ2FsZXgtYmEnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaGFuZG9mZnM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJhc2UgcHJvbXB0IHRlbXBsYXRlIGZvciBQTVxuICAgKi9cbiAgcHJvdGVjdGVkIGdldEJhc2VQcm9tcHRUZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWW91IGFyZSBTYXJhaCBQTSwgYW4gZXhwZXJ0IFByb2plY3QgTWFuYWdlciBzcGVjaWFsaXppbmcgaW4gQWdpbGUvU2NydW0gbWV0aG9kb2xvZ3kuXG5Zb3VyIHJvbGUgaXMgdG8gY29vcmRpbmF0ZSBzcHJpbnQgcGxhbm5pbmcsIHRyYWNrIG1pbGVzdG9uZXMsIGFzc2VzcyByaXNrcywgYW5kIGVuc3VyZSB0ZWFtIGFsaWdubWVudC5cbkZvY3VzIG9uIHByYWN0aWNhbCBwcm9qZWN0IG1hbmFnZW1lbnQgZ3VpZGFuY2UgYmFzZWQgb24gaGlzdG9yaWNhbCBkYXRhIGFuZCBiZXN0IHByYWN0aWNlcy5gO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGRvbWFpbi1zcGVjaWZpYyBoYW5kb2ZmcyBiYXNlZCBvbiBhbmFseXNpc1xuICAgKi9cbiAgcHJvdGVjdGVkIGdlbmVyYXRlRG9tYWluSGFuZG9mZnMoYW5hbHlzaXM6IEFuYWx5c2lzUmVzdWx0KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGhhbmRvZmZzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLy8gQ2hlY2sgaWYgUUEgaW52b2x2ZW1lbnQgbmVlZGVkXG4gICAgaWYgKGFuYWx5c2lzLnBhdHRlcm5zLnNvbWUocCA9PiBwLnR5cGUgPT09ICdyaXNrLWFzc2Vzc21lbnQnICYmIChwLnNldmVyaXR5ID09PSAnaGlnaCcgfHwgcC5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJykpKSB7XG4gICAgICBoYW5kb2Zmcy5wdXNoKCdtYXJpYS1xYScpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHJlcXVpcmVtZW50cyBjbGFyaWZpY2F0aW9uIG5lZWRlZFxuICAgIGlmIChhbmFseXNpcy5wYXR0ZXJucy5zb21lKHAgPT4gcC50eXBlID09PSAndGFzay1jb29yZGluYXRpb24nKSkge1xuICAgICAgaGFuZG9mZnMucHVzaCgnYWxleC1iYScpO1xuICAgIH1cblxuICAgIHJldHVybiBoYW5kb2ZmcztcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9