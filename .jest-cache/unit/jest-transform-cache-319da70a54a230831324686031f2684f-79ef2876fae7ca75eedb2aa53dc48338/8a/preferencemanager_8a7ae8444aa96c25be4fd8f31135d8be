9a798c2b87f7633b408ededcff5edbc3
"use strict";
/**
 * VERSATIL SDLC Framework - Preference Manager
 * Manage user preferences for framework behavior
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultPreferenceManager = exports.PreferenceManager = void 0;
const fs = __importStar(require("fs/promises"));
const path = __importStar(require("path"));
const os = __importStar(require("os"));
class PreferenceManager {
    constructor() {
        this.preferencesVersion = '1.0.0';
        this.versatilHome = path.join(os.homedir(), '.versatil');
        this.preferencesFile = path.join(this.versatilHome, 'preferences.json');
    }
    /**
     * Get user preferences
     */
    async getPreferences() {
        try {
            const data = await fs.readFile(this.preferencesFile, 'utf-8');
            const preferences = JSON.parse(data);
            // Migrate if needed
            if (preferences.version !== this.preferencesVersion) {
                return await this.migratePreferences(preferences);
            }
            return preferences;
        }
        catch {
            // Return defaults if file doesn't exist
            return this.getDefaultPreferences();
        }
    }
    /**
     * Save user preferences
     */
    async savePreferences(preferences) {
        const current = await this.getPreferences();
        const updated = {
            ...current,
            ...preferences,
            lastModified: new Date().toISOString(),
            version: this.preferencesVersion
        };
        await fs.mkdir(this.versatilHome, { recursive: true });
        await fs.writeFile(this.preferencesFile, JSON.stringify(updated, null, 2));
        console.log('âœ… Preferences saved');
    }
    /**
     * Reset to default preferences
     */
    async resetToDefaults() {
        const defaults = this.getDefaultPreferences();
        await fs.mkdir(this.versatilHome, { recursive: true });
        await fs.writeFile(this.preferencesFile, JSON.stringify(defaults, null, 2));
        console.log('âœ… Preferences reset to defaults');
    }
    /**
     * Get specific preference
     */
    async getPreference(key) {
        const preferences = await this.getPreferences();
        return preferences[key];
    }
    /**
     * Set specific preference
     */
    async setPreference(key, value) {
        const preferences = await this.getPreferences();
        preferences[key] = value;
        preferences.lastModified = new Date().toISOString();
        await fs.mkdir(this.versatilHome, { recursive: true });
        await fs.writeFile(this.preferencesFile, JSON.stringify(preferences, null, 2));
        console.log(`âœ… Preference updated: ${key}`);
    }
    /**
     * Update multiple preferences
     */
    async updatePreferences(updates) {
        await this.savePreferences(updates);
    }
    /**
     * Validate preferences
     */
    validatePreferences(preferences) {
        const errors = [];
        // Validate update behavior
        if (preferences.updateBehavior && !['auto', 'notify', 'manual'].includes(preferences.updateBehavior)) {
            errors.push(`Invalid updateBehavior: ${preferences.updateBehavior}`);
        }
        // Validate update channel
        if (preferences.updateChannel && !['stable', 'beta', 'alpha', 'nightly'].includes(preferences.updateChannel)) {
            errors.push(`Invalid updateChannel: ${preferences.updateChannel}`);
        }
        // Validate safety level
        if (preferences.safetyLevel && !['conservative', 'balanced', 'fast'].includes(preferences.safetyLevel)) {
            errors.push(`Invalid safetyLevel: ${preferences.safetyLevel}`);
        }
        // Validate check frequency
        if (preferences.checkFrequency !== undefined) {
            if (typeof preferences.checkFrequency !== 'number' || preferences.checkFrequency < 0) {
                errors.push(`Invalid checkFrequency: ${preferences.checkFrequency}`);
            }
        }
        // Validate rollback behavior
        if (preferences.rollbackBehavior && !['auto', 'prompt', 'manual'].includes(preferences.rollbackBehavior)) {
            errors.push(`Invalid rollbackBehavior: ${preferences.rollbackBehavior}`);
        }
        // Validate max rollback points
        if (preferences.maxRollbackPoints !== undefined) {
            if (typeof preferences.maxRollbackPoints !== 'number' || preferences.maxRollbackPoints < 0) {
                errors.push(`Invalid maxRollbackPoints: ${preferences.maxRollbackPoints}`);
            }
        }
        // Validate notification level
        if (preferences.notificationLevel &&
            !['all', 'important', 'critical', 'none'].includes(preferences.notificationLevel)) {
            errors.push(`Invalid notificationLevel: ${preferences.notificationLevel}`);
        }
        return {
            valid: errors.length === 0,
            errors
        };
    }
    /**
     * Get default preferences
     */
    getDefaultPreferences() {
        return {
            // Update preferences (user's chosen defaults)
            updateBehavior: 'notify', // User chose "Guided"
            updateChannel: 'stable',
            safetyLevel: 'balanced',
            checkFrequency: 24, // Check daily
            autoInstallSecurity: true,
            // Rollback preferences
            rollbackBehavior: 'prompt',
            maxRollbackPoints: 5,
            rollbackOnFailure: true,
            // Notification preferences
            notificationLevel: 'important',
            notifyOnUpdateAvailable: true,
            notifyOnUpdateInstalled: true,
            notifyOnSecurityUpdate: true,
            notifyOnBreakingChange: true,
            // Telemetry preferences
            enableTelemetry: true,
            shareErrorReports: true,
            shareUsageStatistics: false,
            // Advanced preferences
            backupBeforeUpdate: true,
            validateAfterUpdate: true,
            allowPrerelease: false,
            skipOptionalDependencies: false,
            // Metadata
            createdAt: new Date().toISOString(),
            lastModified: new Date().toISOString(),
            version: this.preferencesVersion
        };
    }
    /**
     * Get preferences summary
     */
    async getSummary() {
        const prefs = await this.getPreferences();
        const lines = [];
        lines.push('âš™ï¸  User Preferences:');
        lines.push('');
        lines.push('ðŸ“¦ Updates:');
        lines.push(`   Behavior: ${prefs.updateBehavior}`);
        lines.push(`   Channel: ${prefs.updateChannel}`);
        lines.push(`   Safety: ${prefs.safetyLevel}`);
        lines.push(`   Check Frequency: Every ${prefs.checkFrequency}h`);
        lines.push(`   Auto-install Security: ${prefs.autoInstallSecurity ? 'Yes' : 'No'}`);
        lines.push('');
        lines.push('ðŸ”„ Rollback:');
        lines.push(`   Behavior: ${prefs.rollbackBehavior}`);
        lines.push(`   Max Points: ${prefs.maxRollbackPoints}`);
        lines.push(`   Auto-rollback on Failure: ${prefs.rollbackOnFailure ? 'Yes' : 'No'}`);
        lines.push('');
        lines.push('ðŸ”” Notifications:');
        lines.push(`   Level: ${prefs.notificationLevel}`);
        lines.push(`   Update Available: ${prefs.notifyOnUpdateAvailable ? 'Yes' : 'No'}`);
        lines.push(`   Update Installed: ${prefs.notifyOnUpdateInstalled ? 'Yes' : 'No'}`);
        lines.push(`   Security Updates: ${prefs.notifyOnSecurityUpdate ? 'Yes' : 'No'}`);
        lines.push(`   Breaking Changes: ${prefs.notifyOnBreakingChange ? 'Yes' : 'No'}`);
        lines.push('');
        lines.push('ðŸ“Š Telemetry:');
        lines.push(`   Enabled: ${prefs.enableTelemetry ? 'Yes' : 'No'}`);
        lines.push(`   Error Reports: ${prefs.shareErrorReports ? 'Yes' : 'No'}`);
        lines.push(`   Usage Statistics: ${prefs.shareUsageStatistics ? 'Yes' : 'No'}`);
        lines.push('');
        lines.push('ðŸ”§ Advanced:');
        lines.push(`   Backup Before Update: ${prefs.backupBeforeUpdate ? 'Yes' : 'No'}`);
        lines.push(`   Validate After Update: ${prefs.validateAfterUpdate ? 'Yes' : 'No'}`);
        lines.push(`   Allow Prerelease: ${prefs.allowPrerelease ? 'Yes' : 'No'}`);
        return lines.join('\n');
    }
    /**
     * Export preferences to JSON
     */
    async exportPreferences(outputPath) {
        const preferences = await this.getPreferences();
        await fs.writeFile(outputPath, JSON.stringify(preferences, null, 2));
        console.log(`âœ… Preferences exported to: ${outputPath}`);
    }
    /**
     * Import preferences from JSON
     */
    async importPreferences(inputPath) {
        const data = await fs.readFile(inputPath, 'utf-8');
        const preferences = JSON.parse(data);
        const validation = this.validatePreferences(preferences);
        if (!validation.valid) {
            throw new Error(`Invalid preferences: ${validation.errors.join(', ')}`);
        }
        await this.savePreferences(preferences);
        console.log(`âœ… Preferences imported from: ${inputPath}`);
    }
    /**
     * Migrate preferences from old version
     */
    async migratePreferences(oldPreferences) {
        console.log('ðŸ”„ Migrating preferences to new version...');
        const defaults = this.getDefaultPreferences();
        // Merge old preferences with defaults (defaults for new fields)
        const migrated = {
            ...defaults,
            ...oldPreferences,
            version: this.preferencesVersion,
            lastModified: new Date().toISOString()
        };
        // Save migrated preferences
        await fs.mkdir(this.versatilHome, { recursive: true });
        await fs.writeFile(this.preferencesFile, JSON.stringify(migrated, null, 2));
        console.log('âœ… Preferences migrated');
        return migrated;
    }
    /**
     * Check if setup wizard should run
     */
    async shouldRunSetupWizard() {
        try {
            await fs.access(this.preferencesFile);
            return false; // Preferences exist
        }
        catch {
            return true; // Preferences don't exist
        }
    }
}
exports.PreferenceManager = PreferenceManager;
/**
 * Default preference manager instance
 */
exports.defaultPreferenceManager = new PreferenceManager();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvY29uZmlnL3ByZWZlcmVuY2UtbWFuYWdlci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxnREFBa0M7QUFDbEMsMkNBQTZCO0FBQzdCLHVDQUF5QjtBQWtEekIsTUFBYSxpQkFBaUI7SUFLNUI7UUFGaUIsdUJBQWtCLEdBQUcsT0FBTyxDQUFDO1FBRzVDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsY0FBYztRQUNsQixJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksR0FBRyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUM5RCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXJDLG9CQUFvQjtZQUNwQixJQUFJLFdBQVcsQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7Z0JBQ3BELE9BQU8sTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDcEQsQ0FBQztZQUVELE9BQU8sV0FBVyxDQUFDO1FBQ3JCLENBQUM7UUFBQyxNQUFNLENBQUM7WUFDUCx3Q0FBd0M7WUFDeEMsT0FBTyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUN0QyxDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGVBQWUsQ0FBQyxXQUFxQztRQUN6RCxNQUFN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QixNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVFLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUV0QyxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsb0JBQW9CO1FBQ3hCLElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDdEMsT0FBTyxLQUFLLENBQUMsQ0FBQyxvQkFBb0I7UUFDcEMsQ0FBQztRQUFDLE1BQU0sQ0FBQztZQUNQLE9BQU8sSUFBSSxDQUFDLENBQUMsMEJBQTBCO1FBQ3pDLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUF4U0QsOENBd1NDO0FBRUQ7O0dBRUc7QUFDVSxRQUFBLHdCQUF3QixHQUFHLElBQUksaUJBQWlCLEVBQUUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbmlzc2ltbWVuYXNoZS9WRVJTQVRJTCBTRExDIEZXL3NyYy9jb25maWcvcHJlZmVyZW5jZS1tYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVkVSU0FUSUwgU0RMQyBGcmFtZXdvcmsgLSBQcmVmZXJlbmNlIE1hbmFnZXJcbiAqIE1hbmFnZSB1c2VyIHByZWZlcmVuY2VzIGZvciBmcmFtZXdvcmsgYmVoYXZpb3JcbiAqL1xuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xuXG5leHBvcnQgdHlwZSBVcGRhdGVDaGFubmVsID0gJ3N0YWJsZScgfCAnYmV0YScgfCAnYWxwaGEnIHwgJ25pZ2h0bHknO1xuZXhwb3J0IHR5cGUgVXBkYXRlQmVoYXZpb3IgPSAnYXV0bycgfCAnbm90aWZ5JyB8ICdtYW51YWwnO1xuZXhwb3J0IHR5cGUgU2FmZXR5TGV2ZWwgPSAnY29uc2VydmF0aXZlJyB8ICdiYWxhbmNlZCcgfCAnZmFzdCc7XG5leHBvcnQgdHlwZSBSb2xsYmFja0JlaGF2aW9yID0gJ2F1dG8nIHwgJ3Byb21wdCcgfCAnbWFudWFsJztcbmV4cG9ydCB0eXBlIE5vdGlmaWNhdGlvbkxldmVsID0gJ2FsbCcgfCAnaW1wb3J0YW50JyB8ICdjcml0aWNhbCcgfCAnbm9uZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlclByZWZlcmVuY2VzIHtcbiAgLy8gVXBkYXRlIHByZWZlcmVuY2VzXG4gIHVwZGF0ZUJlaGF2aW9yOiBVcGRhdGVCZWhhdmlvcjtcbiAgdXBkYXRlQ2hhbm5lbDogVXBkYXRlQ2hhbm5lbDtcbiAgc2FmZXR5TGV2ZWw6IFNhZmV0eUxldmVsO1xuICBjaGVja0ZyZXF1ZW5jeTogbnVtYmVyOyAvLyBob3Vyc1xuICBhdXRvSW5zdGFsbFNlY3VyaXR5OiBib29sZWFuO1xuXG4gIC8vIFJvbGxiYWNrIHByZWZlcmVuY2VzXG4gIHJvbGxiYWNrQmVoYXZpb3I6IFJvbGxiYWNrQmVoYXZpb3I7XG4gIG1heFJvbGxiYWNrUG9pbnRzOiBudW1iZXI7XG4gIHJvbGxiYWNrT25GYWlsdXJlOiBib29sZWFuO1xuXG4gIC8vIE5vdGlmaWNhdGlvbiBwcmVmZXJlbmNlc1xuICBub3RpZmljYXRpb25MZXZlbDogTm90aWZpY2F0aW9uTGV2ZWw7XG4gIG5vdGlmeU9uVXBkYXRlQXZhaWxhYmxlOiBib29sZWFuO1xuICBub3RpZnlPblVwZGF0ZUluc3RhbGxlZDogYm9vbGVhbjtcbiAgbm90aWZ5T25TZWN1cml0eVVwZGF0ZTogYm9vbGVhbjtcbiAgbm90aWZ5T25CcmVha2luZ0NoYW5nZTogYm9vbGVhbjtcblxuICAvLyBUZWxlbWV0cnkgcHJlZmVyZW5jZXNcbiAgZW5hYmxlVGVsZW1ldHJ5OiBib29sZWFuO1xuICBzaGFyZUVycm9yUmVwb3J0czogYm9vbGVhbjtcbiAgc2hhcmVVc2FnZVN0YXRpc3RpY3M6IGJvb2xlYW47XG5cbiAgLy8gQWR2YW5jZWQgcHJlZmVyZW5jZXNcbiAgYmFja3VwQmVmb3JlVXBkYXRlOiBib29sZWFuO1xuICB2YWxpZGF0ZUFmdGVyVXBkYXRlOiBib29sZWFuO1xuICBhbGxvd1ByZXJlbGVhc2U6IGJvb2xlYW47XG4gIHNraXBPcHRpb25hbERlcGVuZGVuY2llczogYm9vbGVhbjtcblxuICAvLyBVc2VyIGluZm8gKG9wdGlvbmFsKVxuICB1c2VySWQ/OiBzdHJpbmc7XG4gIHVzZXJFbWFpbD86IHN0cmluZztcbiAgb3JnYW5pemF0aW9uSWQ/OiBzdHJpbmc7XG5cbiAgLy8gTWV0YWRhdGFcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gIGxhc3RNb2RpZmllZDogc3RyaW5nO1xuICB2ZXJzaW9uOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBQcmVmZXJlbmNlTWFuYWdlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgdmVyc2F0aWxIb21lOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcHJlZmVyZW5jZXNGaWxlOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcHJlZmVyZW5jZXNWZXJzaW9uID0gJzEuMC4wJztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnZlcnNhdGlsSG9tZSA9IHBhdGguam9pbihvcy5ob21lZGlyKCksICcudmVyc2F0aWwnKTtcbiAgICB0aGlzLnByZWZlcmVuY2VzRmlsZSA9IHBhdGguam9pbih0aGlzLnZlcnNhdGlsSG9tZSwgJ3ByZWZlcmVuY2VzLmpzb24nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlciBwcmVmZXJlbmNlc1xuICAgKi9cbiAgYXN5bmMgZ2V0UHJlZmVyZW5jZXMoKTogUHJvbWlzZTxVc2VyUHJlZmVyZW5jZXM+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKHRoaXMucHJlZmVyZW5jZXNGaWxlLCAndXRmLTgnKTtcbiAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgLy8gTWlncmF0ZSBpZiBuZWVkZWRcbiAgICAgIGlmIChwcmVmZXJlbmNlcy52ZXJzaW9uICE9PSB0aGlzLnByZWZlcmVuY2VzVmVyc2lvbikge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5taWdyYXRlUHJlZmVyZW5jZXMocHJlZmVyZW5jZXMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJlZmVyZW5jZXM7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBSZXR1cm4gZGVmYXVsdHMgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XG4gICAgICByZXR1cm4gdGhpcy5nZXREZWZhdWx0UHJlZmVyZW5jZXMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2F2ZSB1c2VyIHByZWZlcmVuY2VzXG4gICAqL1xuICBhc3luYyBzYXZlUHJlZmVyZW5jZXMocHJlZmVyZW5jZXM6IFBhcnRpYWw8VXNlclByZWZlcmVuY2VzPik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGN1cnJlbnQgPSBhd2FpdCB0aGlzLmdldFByZWZlcmVuY2VzKCk7XG5cbiAgICBjb25zdCB1cGRhdGVkOiBVc2VyUHJlZmVyZW5jZXMgPSB7XG4gICAgICAuLi5jdXJyZW50LFxuICAgICAgLi4ucHJlZmVyZW5jZXMsXG4gICAgICBsYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHZlcnNpb246IHRoaXMucHJlZmVyZW5jZXNWZXJzaW9uXG4gICAgfTtcblxuICAgIGF3YWl0IGZzLm1rZGlyKHRoaXMudmVyc2F0aWxIb21lLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUodGhpcy5wcmVmZXJlbmNlc0ZpbGUsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWQsIG51bGwsIDIpKTtcblxuICAgIGNvbnNvbGUubG9nKCfinIUgUHJlZmVyZW5jZXMgc2F2ZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0byBkZWZhdWx0IHByZWZlcmVuY2VzXG4gICAqL1xuICBhc3luYyByZXNldFRvRGVmYXVsdHMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGVmYXVsdHMgPSB0aGlzLmdldERlZmF1bHRQcmVmZXJlbmNlcygpO1xuICAgIGF3YWl0IGZzLm1rZGlyKHRoaXMudmVyc2F0aWxIb21lLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUodGhpcy5wcmVmZXJlbmNlc0ZpbGUsIEpTT04uc3RyaW5naWZ5KGRlZmF1bHRzLCBudWxsLCAyKSk7XG5cbiAgICBjb25zb2xlLmxvZygn4pyFIFByZWZlcmVuY2VzIHJlc2V0IHRvIGRlZmF1bHRzJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNwZWNpZmljIHByZWZlcmVuY2VcbiAgICovXG4gIGFzeW5jIGdldFByZWZlcmVuY2U8SyBleHRlbmRzIGtleW9mIFVzZXJQcmVmZXJlbmNlcz4oa2V5OiBLKTogUHJvbWlzZTxVc2VyUHJlZmVyZW5jZXNbS10+IHtcbiAgICBjb25zdCBwcmVmZXJlbmNlcyA9IGF3YWl0IHRoaXMuZ2V0UHJlZmVyZW5jZXMoKTtcbiAgICByZXR1cm4gcHJlZmVyZW5jZXNba2V5XTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgc3BlY2lmaWMgcHJlZmVyZW5jZVxuICAgKi9cbiAgYXN5bmMgc2V0UHJlZmVyZW5jZTxLIGV4dGVuZHMga2V5b2YgVXNlclByZWZlcmVuY2VzPihrZXk6IEssIHZhbHVlOiBVc2VyUHJlZmVyZW5jZXNbS10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwcmVmZXJlbmNlcyA9IGF3YWl0IHRoaXMuZ2V0UHJlZmVyZW5jZXMoKTtcbiAgICBwcmVmZXJlbmNlc1trZXldID0gdmFsdWU7XG4gICAgcHJlZmVyZW5jZXMubGFzdE1vZGlmaWVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG4gICAgYXdhaXQgZnMubWtkaXIodGhpcy52ZXJzYXRpbEhvbWUsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZSh0aGlzLnByZWZlcmVuY2VzRmlsZSwgSlNPTi5zdHJpbmdpZnkocHJlZmVyZW5jZXMsIG51bGwsIDIpKTtcblxuICAgIGNvbnNvbGUubG9nKGDinIUgUHJlZmVyZW5jZSB1cGRhdGVkOiAke2tleX1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgbXVsdGlwbGUgcHJlZmVyZW5jZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVByZWZlcmVuY2VzKHVwZGF0ZXM6IFBhcnRpYWw8VXNlclByZWZlcmVuY2VzPik6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2F2ZVByZWZlcmVuY2VzKHVwZGF0ZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHByZWZlcmVuY2VzXG4gICAqL1xuICB2YWxpZGF0ZVByZWZlcmVuY2VzKHByZWZlcmVuY2VzOiBQYXJ0aWFsPFVzZXJQcmVmZXJlbmNlcz4pOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcnM6IHN0cmluZ1tdIH0ge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIFZhbGlkYXRlIHVwZGF0ZSBiZWhhdmlvclxuICAgIGlmIChwcmVmZXJlbmNlcy51cGRhdGVCZWhhdmlvciAmJiAhWydhdXRvJywgJ25vdGlmeScsICdtYW51YWwnXS5pbmNsdWRlcyhwcmVmZXJlbmNlcy51cGRhdGVCZWhhdmlvcikpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIHVwZGF0ZUJlaGF2aW9yOiAke3ByZWZlcmVuY2VzLnVwZGF0ZUJlaGF2aW9yfWApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHVwZGF0ZSBjaGFubmVsXG4gICAgaWYgKHByZWZlcmVuY2VzLnVwZGF0ZUNoYW5uZWwgJiYgIVsnc3RhYmxlJywgJ2JldGEnLCAnYWxwaGEnLCAnbmlnaHRseSddLmluY2x1ZGVzKHByZWZlcmVuY2VzLnVwZGF0ZUNoYW5uZWwpKSB7XG4gICAgICBlcnJvcnMucHVzaChgSW52YWxpZCB1cGRhdGVDaGFubmVsOiAke3ByZWZlcmVuY2VzLnVwZGF0ZUNoYW5uZWx9YCk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgc2FmZXR5IGxldmVsXG4gICAgaWYgKHByZWZlcmVuY2VzLnNhZmV0eUxldmVsICYmICFbJ2NvbnNlcnZhdGl2ZScsICdiYWxhbmNlZCcsICdmYXN0J10uaW5jbHVkZXMocHJlZmVyZW5jZXMuc2FmZXR5TGV2ZWwpKSB7XG4gICAgICBlcnJvcnMucHVzaChgSW52YWxpZCBzYWZldHlMZXZlbDogJHtwcmVmZXJlbmNlcy5zYWZldHlMZXZlbH1gKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBjaGVjayBmcmVxdWVuY3lcbiAgICBpZiAocHJlZmVyZW5jZXMuY2hlY2tGcmVxdWVuY3kgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKHR5cGVvZiBwcmVmZXJlbmNlcy5jaGVja0ZyZXF1ZW5jeSAhPT0gJ251bWJlcicgfHwgcHJlZmVyZW5jZXMuY2hlY2tGcmVxdWVuY3kgPCAwKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIGNoZWNrRnJlcXVlbmN5OiAke3ByZWZlcmVuY2VzLmNoZWNrRnJlcXVlbmN5fWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHJvbGxiYWNrIGJlaGF2aW9yXG4gICAgaWYgKHByZWZlcmVuY2VzLnJvbGxiYWNrQmVoYXZpb3IgJiYgIVsnYXV0bycsICdwcm9tcHQnLCAnbWFudWFsJ10uaW5jbHVkZXMocHJlZmVyZW5jZXMucm9sbGJhY2tCZWhhdmlvcikpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIHJvbGxiYWNrQmVoYXZpb3I6ICR7cHJlZmVyZW5jZXMucm9sbGJhY2tCZWhhdmlvcn1gKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBtYXggcm9sbGJhY2sgcG9pbnRzXG4gICAgaWYgKHByZWZlcmVuY2VzLm1heFJvbGxiYWNrUG9pbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICh0eXBlb2YgcHJlZmVyZW5jZXMubWF4Um9sbGJhY2tQb2ludHMgIT09ICdudW1iZXInIHx8IHByZWZlcmVuY2VzLm1heFJvbGxiYWNrUG9pbnRzIDwgMCkge1xuICAgICAgICBlcnJvcnMucHVzaChgSW52YWxpZCBtYXhSb2xsYmFja1BvaW50czogJHtwcmVmZXJlbmNlcy5tYXhSb2xsYmFja1BvaW50c31gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBub3RpZmljYXRpb24gbGV2ZWxcbiAgICBpZiAoXG4gICAgICBwcmVmZXJlbmNlcy5ub3RpZmljYXRpb25MZXZlbCAmJlxuICAgICAgIVsnYWxsJywgJ2ltcG9ydGFudCcsICdjcml0aWNhbCcsICdub25lJ10uaW5jbHVkZXMocHJlZmVyZW5jZXMubm90aWZpY2F0aW9uTGV2ZWwpXG4gICAgKSB7XG4gICAgICBlcnJvcnMucHVzaChgSW52YWxpZCBub3RpZmljYXRpb25MZXZlbDogJHtwcmVmZXJlbmNlcy5ub3RpZmljYXRpb25MZXZlbH1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvcnNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZWZhdWx0IHByZWZlcmVuY2VzXG4gICAqL1xuICBnZXREZWZhdWx0UHJlZmVyZW5jZXMoKTogVXNlclByZWZlcmVuY2VzIHtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gVXBkYXRlIHByZWZlcmVuY2VzICh1c2VyJ3MgY2hvc2VuIGRlZmF1bHRzKVxuICAgICAgdXBkYXRlQmVoYXZpb3I6ICdub3RpZnknLCAvLyBVc2VyIGNob3NlIFwiR3VpZGVkXCJcbiAgICAgIHVwZGF0ZUNoYW5uZWw6ICdzdGFibGUnLFxuICAgICAgc2FmZXR5TGV2ZWw6ICdiYWxhbmNlZCcsXG4gICAgICBjaGVja0ZyZXF1ZW5jeTogMjQsIC8vIENoZWNrIGRhaWx5XG4gICAgICBhdXRvSW5zdGFsbFNlY3VyaXR5OiB0cnVlLFxuXG4gICAgICAvLyBSb2xsYmFjayBwcmVmZXJlbmNlc1xuICAgICAgcm9sbGJhY2tCZWhhdmlvcjogJ3Byb21wdCcsXG4gICAgICBtYXhSb2xsYmFja1BvaW50czogNSxcbiAgICAgIHJvbGxiYWNrT25GYWlsdXJlOiB0cnVlLFxuXG4gICAgICAvLyBOb3RpZmljYXRpb24gcHJlZmVyZW5jZXNcbiAgICAgIG5vdGlmaWNhdGlvbkxldmVsOiAnaW1wb3J0YW50JyxcbiAgICAgIG5vdGlmeU9uVXBkYXRlQXZhaWxhYmxlOiB0cnVlLFxuICAgICAgbm90aWZ5T25VcGRhdGVJbnN0YWxsZWQ6IHRydWUsXG4gICAgICBub3RpZnlPblNlY3VyaXR5VXBkYXRlOiB0cnVlLFxuICAgICAgbm90aWZ5T25CcmVha2luZ0NoYW5nZTogdHJ1ZSxcblxuICAgICAgLy8gVGVsZW1ldHJ5IHByZWZlcmVuY2VzXG4gICAgICBlbmFibGVUZWxlbWV0cnk6IHRydWUsXG4gICAgICBzaGFyZUVycm9yUmVwb3J0czogdHJ1ZSxcbiAgICAgIHNoYXJlVXNhZ2VTdGF0aXN0aWNzOiBmYWxzZSxcblxuICAgICAgLy8gQWR2YW5jZWQgcHJlZmVyZW5jZXNcbiAgICAgIGJhY2t1cEJlZm9yZVVwZGF0ZTogdHJ1ZSxcbiAgICAgIHZhbGlkYXRlQWZ0ZXJVcGRhdGU6IHRydWUsXG4gICAgICBhbGxvd1ByZXJlbGVhc2U6IGZhbHNlLFxuICAgICAgc2tpcE9wdGlvbmFsRGVwZW5kZW5jaWVzOiBmYWxzZSxcblxuICAgICAgLy8gTWV0YWRhdGFcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgbGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB2ZXJzaW9uOiB0aGlzLnByZWZlcmVuY2VzVmVyc2lvblxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHByZWZlcmVuY2VzIHN1bW1hcnlcbiAgICovXG4gIGFzeW5jIGdldFN1bW1hcnkoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBwcmVmcyA9IGF3YWl0IHRoaXMuZ2V0UHJlZmVyZW5jZXMoKTtcblxuICAgIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgbGluZXMucHVzaCgn4pqZ77iPICBVc2VyIFByZWZlcmVuY2VzOicpO1xuICAgIGxpbmVzLnB1c2goJycpO1xuXG4gICAgbGluZXMucHVzaCgn8J+TpiBVcGRhdGVzOicpO1xuICAgIGxpbmVzLnB1c2goYCAgIEJlaGF2aW9yOiAke3ByZWZzLnVwZGF0ZUJlaGF2aW9yfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIENoYW5uZWw6ICR7cHJlZnMudXBkYXRlQ2hhbm5lbH1gKTtcbiAgICBsaW5lcy5wdXNoKGAgICBTYWZldHk6ICR7cHJlZnMuc2FmZXR5TGV2ZWx9YCk7XG4gICAgbGluZXMucHVzaChgICAgQ2hlY2sgRnJlcXVlbmN5OiBFdmVyeSAke3ByZWZzLmNoZWNrRnJlcXVlbmN5fWhgKTtcbiAgICBsaW5lcy5wdXNoKGAgICBBdXRvLWluc3RhbGwgU2VjdXJpdHk6ICR7cHJlZnMuYXV0b0luc3RhbGxTZWN1cml0eSA/ICdZZXMnIDogJ05vJ31gKTtcbiAgICBsaW5lcy5wdXNoKCcnKTtcblxuICAgIGxpbmVzLnB1c2goJ/CflIQgUm9sbGJhY2s6Jyk7XG4gICAgbGluZXMucHVzaChgICAgQmVoYXZpb3I6ICR7cHJlZnMucm9sbGJhY2tCZWhhdmlvcn1gKTtcbiAgICBsaW5lcy5wdXNoKGAgICBNYXggUG9pbnRzOiAke3ByZWZzLm1heFJvbGxiYWNrUG9pbnRzfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIEF1dG8tcm9sbGJhY2sgb24gRmFpbHVyZTogJHtwcmVmcy5yb2xsYmFja09uRmFpbHVyZSA/ICdZZXMnIDogJ05vJ31gKTtcbiAgICBsaW5lcy5wdXNoKCcnKTtcblxuICAgIGxpbmVzLnB1c2goJ/CflJQgTm90aWZpY2F0aW9uczonKTtcbiAgICBsaW5lcy5wdXNoKGAgICBMZXZlbDogJHtwcmVmcy5ub3RpZmljYXRpb25MZXZlbH1gKTtcbiAgICBsaW5lcy5wdXNoKGAgICBVcGRhdGUgQXZhaWxhYmxlOiAke3ByZWZzLm5vdGlmeU9uVXBkYXRlQXZhaWxhYmxlID8gJ1llcycgOiAnTm8nfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIFVwZGF0ZSBJbnN0YWxsZWQ6ICR7cHJlZnMubm90aWZ5T25VcGRhdGVJbnN0YWxsZWQgPyAnWWVzJyA6ICdObyd9YCk7XG4gICAgbGluZXMucHVzaChgICAgU2VjdXJpdHkgVXBkYXRlczogJHtwcmVmcy5ub3RpZnlPblNlY3VyaXR5VXBkYXRlID8gJ1llcycgOiAnTm8nfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIEJyZWFraW5nIENoYW5nZXM6ICR7cHJlZnMubm90aWZ5T25CcmVha2luZ0NoYW5nZSA/ICdZZXMnIDogJ05vJ31gKTtcbiAgICBsaW5lcy5wdXNoKCcnKTtcblxuICAgIGxpbmVzLnB1c2goJ/Cfk4ogVGVsZW1ldHJ5OicpO1xuICAgIGxpbmVzLnB1c2goYCAgIEVuYWJsZWQ6ICR7cHJlZnMuZW5hYmxlVGVsZW1ldHJ5ID8gJ1llcycgOiAnTm8nfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIEVycm9yIFJlcG9ydHM6ICR7cHJlZnMuc2hhcmVFcnJvclJlcG9ydHMgPyAnWWVzJyA6ICdObyd9YCk7XG4gICAgbGluZXMucHVzaChgICAgVXNhZ2UgU3RhdGlzdGljczogJHtwcmVmcy5zaGFyZVVzYWdlU3RhdGlzdGljcyA/ICdZZXMnIDogJ05vJ31gKTtcbiAgICBsaW5lcy5wdXNoKCcnKTtcblxuICAgIGxpbmVzLnB1c2goJ/CflKcgQWR2YW5jZWQ6Jyk7XG4gICAgbGluZXMucHVzaChgICAgQmFja3VwIEJlZm9yZSBVcGRhdGU6ICR7cHJlZnMuYmFja3VwQmVmb3JlVXBkYXRlID8gJ1llcycgOiAnTm8nfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIFZhbGlkYXRlIEFmdGVyIFVwZGF0ZTogJHtwcmVmcy52YWxpZGF0ZUFmdGVyVXBkYXRlID8gJ1llcycgOiAnTm8nfWApO1xuICAgIGxpbmVzLnB1c2goYCAgIEFsbG93IFByZXJlbGVhc2U6ICR7cHJlZnMuYWxsb3dQcmVyZWxlYXNlID8gJ1llcycgOiAnTm8nfWApO1xuXG4gICAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBwcmVmZXJlbmNlcyB0byBKU09OXG4gICAqL1xuICBhc3luYyBleHBvcnRQcmVmZXJlbmNlcyhvdXRwdXRQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwcmVmZXJlbmNlcyA9IGF3YWl0IHRoaXMuZ2V0UHJlZmVyZW5jZXMoKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUob3V0cHV0UGF0aCwgSlNPTi5zdHJpbmdpZnkocHJlZmVyZW5jZXMsIG51bGwsIDIpKTtcblxuICAgIGNvbnNvbGUubG9nKGDinIUgUHJlZmVyZW5jZXMgZXhwb3J0ZWQgdG86ICR7b3V0cHV0UGF0aH1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbXBvcnQgcHJlZmVyZW5jZXMgZnJvbSBKU09OXG4gICAqL1xuICBhc3luYyBpbXBvcnRQcmVmZXJlbmNlcyhpbnB1dFBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmcy5yZWFkRmlsZShpbnB1dFBhdGgsICd1dGYtOCcpO1xuICAgIGNvbnN0IHByZWZlcmVuY2VzID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlUHJlZmVyZW5jZXMocHJlZmVyZW5jZXMpO1xuXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcHJlZmVyZW5jZXM6ICR7dmFsaWRhdGlvbi5lcnJvcnMuam9pbignLCAnKX1gKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnNhdmVQcmVmZXJlbmNlcyhwcmVmZXJlbmNlcyk7XG5cbiAgICBjb25zb2xlLmxvZyhg4pyFIFByZWZlcmVuY2VzIGltcG9ydGVkIGZyb206ICR7aW5wdXRQYXRofWApO1xuICB9XG5cbiAgLyoqXG4gICAqIE1pZ3JhdGUgcHJlZmVyZW5jZXMgZnJvbSBvbGQgdmVyc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBtaWdyYXRlUHJlZmVyZW5jZXMob2xkUHJlZmVyZW5jZXM6IGFueSk6IFByb21pc2U8VXNlclByZWZlcmVuY2VzPiB7XG4gICAgY29uc29sZS5sb2coJ/CflIQgTWlncmF0aW5nIHByZWZlcmVuY2VzIHRvIG5ldyB2ZXJzaW9uLi4uJyk7XG5cbiAgICBjb25zdCBkZWZhdWx0cyA9IHRoaXMuZ2V0RGVmYXVsdFByZWZlcmVuY2VzKCk7XG5cbiAgICAvLyBNZXJnZSBvbGQgcHJlZmVyZW5jZXMgd2l0aCBkZWZhdWx0cyAoZGVmYXVsdHMgZm9yIG5ldyBmaWVsZHMpXG4gICAgY29uc3QgbWlncmF0ZWQ6IFVzZXJQcmVmZXJlbmNlcyA9IHtcbiAgICAgIC4uLmRlZmF1bHRzLFxuICAgICAgLi4ub2xkUHJlZmVyZW5jZXMsXG4gICAgICB2ZXJzaW9uOiB0aGlzLnByZWZlcmVuY2VzVmVyc2lvbixcbiAgICAgIGxhc3RNb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcblxuICAgIC8vIFNhdmUgbWlncmF0ZWQgcHJlZmVyZW5jZXNcbiAgICBhd2FpdCBmcy5ta2Rpcih0aGlzLnZlcnNhdGlsSG9tZSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKHRoaXMucHJlZmVyZW5jZXNGaWxlLCBKU09OLnN0cmluZ2lmeShtaWdyYXRlZCwgbnVsbCwgMikpO1xuXG4gICAgY29uc29sZS5sb2coJ+KchSBQcmVmZXJlbmNlcyBtaWdyYXRlZCcpO1xuXG4gICAgcmV0dXJuIG1pZ3JhdGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHNldHVwIHdpemFyZCBzaG91bGQgcnVuXG4gICAqL1xuICBhc3luYyBzaG91bGRSdW5TZXR1cFdpemFyZCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMuYWNjZXNzKHRoaXMucHJlZmVyZW5jZXNGaWxlKTtcbiAgICAgIHJldHVybiBmYWxzZTsgLy8gUHJlZmVyZW5jZXMgZXhpc3RcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiB0cnVlOyAvLyBQcmVmZXJlbmNlcyBkb24ndCBleGlzdFxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIERlZmF1bHQgcHJlZmVyZW5jZSBtYW5hZ2VyIGluc3RhbmNlXG4gKi9cbmV4cG9ydCBjb25zdCBkZWZhdWx0UHJlZmVyZW5jZU1hbmFnZXIgPSBuZXcgUHJlZmVyZW5jZU1hbmFnZXIoKTtcbiJdLCJ2ZXJzaW9uIjozfQ==