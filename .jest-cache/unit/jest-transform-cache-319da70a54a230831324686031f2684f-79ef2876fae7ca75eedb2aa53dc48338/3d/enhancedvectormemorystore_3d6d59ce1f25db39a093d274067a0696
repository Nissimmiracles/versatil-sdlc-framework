cc16957900c6e1bbd4951f7b7c627067
"use strict";
/**
 * VERSATIL SDLC Framework - Enhanced Vector Memory Store
 * Advanced RAG with reranking, multimodal support, and proper vector DB
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.vectorMemoryStore = exports.EnhancedVectorMemoryStore = void 0;
const events_1 = require("events");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const logger_js_1 = require("../utils/logger.js");
const supabase_js_1 = require("@supabase/supabase-js");
class EnhancedVectorMemoryStore extends events_1.EventEmitter {
    constructor() {
        super();
        this.memories = new Map();
        this.embeddings = new Map();
        this.isSupabaseEnabled = false;
        this.edgeFunctionsEnabled = false;
        this.supabaseUrl = null;
        // Enhanced configuration
        this.config = {
            embeddingDimension: 1536, // OpenAI ada-002 dimension
            maxMemorySize: 100000,
            rerankingEnabled: true,
            multimodalEnabled: true,
            hybridSearchEnabled: true,
            defaultReranking: {
                recency: 0.15,
                relevance: 0.4,
                contextMatch: 0.25,
                agentExpertise: 0.1,
                crossModalBoost: 0.1
            }
        };
        this.logger = new logger_js_1.VERSATILLogger();
        this.indexPath = path.join(process.cwd(), '.versatil', 'rag', 'vector-index');
        this.initialize();
    }
    /**
     * Initialize Supabase connection if available
     */
    async initialize() {
        // Ensure directory exists
        await fs.promises.mkdir(this.indexPath, { recursive: true });
        // Try to initialize Supabase if configured
        await this.initializeSupabase();
        await this.loadExistingMemories();
        this.logger.info('Enhanced vector memory store initialized', {
            memoryCount: this.memories.size,
            supabaseEnabled: this.isSupabaseEnabled,
            features: {
                reranking: this.config.rerankingEnabled,
                multimodal: this.config.multimodalEnabled,
                hybridSearch: this.config.hybridSearchEnabled
            }
        }, 'rag-memory');
    }
    async initializeSupabase() {
        try {
            const supabaseUrl = process.env.SUPABASE_URL;
            const supabaseKey = process.env.SUPABASE_ANON_KEY;
            if (supabaseUrl && supabaseKey) {
                this.supabase = (0, supabase_js_1.createClient)(supabaseUrl, supabaseKey);
                this.isSupabaseEnabled = true;
                this.supabaseUrl = supabaseUrl;
                this.edgeFunctionsEnabled = true; // Enable edge functions integration
                // Ensure vector table exists
                await this.ensureVectorTable();
                this.logger.info('Supabase + Edge Functions initialized', {
                    supabaseUrl: supabaseUrl.replace(/\/.*/, '//[HIDDEN]'),
                    edgeFunctions: this.edgeFunctionsEnabled
                }, 'rag-memory');
            }
        }
        catch (error) {
            this.logger.warn('Supabase initialization failed, using local storage', { error }, 'rag-memory');
        }
    }
    /**
     * Store a memory document with vector embedding
     */
    async storeMemory(doc) {
        const id = this.generateMemoryId();
        const embedding = await this.generateMultimodalEmbedding(doc);
        const memory = {
            id,
            ...doc,
            embedding
        };
        // Store locally
        this.memories.set(id, memory);
        this.embeddings.set(id, embedding);
        // Store in vector DB if available
        if (this.isSupabaseEnabled) {
            await this.storeInSupabase(memory);
        }
        await this.persistMemory(memory);
        this.emit('memory_stored', {
            id,
            agentId: doc.metadata.agentId,
            contentType: doc.contentType
        });
        return id;
    }
    /**
     * Enhanced query with reranking and multimodal support
     */
    async queryMemoriesInternal(query) {
        const startTime = Date.now();
        let documents;
        let searchMethod = 'semantic';
        // Determine search strategy
        if (query.queryType === 'hybrid' || this.config.hybridSearchEnabled) {
            documents = await this.hybridSearch(query);
            searchMethod = 'hybrid';
        }
        else if (this.isSupabaseEnabled) {
            documents = await this.vectorSearch(query);
            searchMethod = 'vector';
        }
        else {
            documents = await this.localSemanticSearch(query);
            searchMethod = 'local-semantic';
        }
        // Apply reranking if requested or enabled by default
        let reranked = false;
        if (query.rerank !== false && this.config.rerankingEnabled) {
            documents = await this.rerankResults(documents, query);
            reranked = true;
        }
        // Limit to topK
        const topK = query.topK || 10;
        const finalDocuments = documents.slice(0, topK);
        return {
            documents: finalDocuments,
            reranked,
            queryEmbedding: await this.generateEmbedding(query.query),
            processingTime: Date.now() - startTime,
            searchMethod,
            totalMatches: documents.length
        };
    }
    /**
     * Hybrid search combining semantic and keyword matching
     */
    async hybridSearch(query) {
        // Semantic search
        const semanticResults = await this.localSemanticSearch(query);
        // Keyword search
        const keywordResults = await this.keywordSearch(query);
        // Merge and deduplicate
        const resultMap = new Map();
        // Add semantic results with boosted scores
        semanticResults.forEach(doc => {
            resultMap.set(doc.id, {
                ...doc,
                metadata: {
                    ...doc.metadata,
                    relevanceScore: (doc.metadata.relevanceScore || 0) * 1.2
                }
            });
        });
        // Add keyword results
        keywordResults.forEach(doc => {
            if (resultMap.has(doc.id)) {
                // Boost documents found by both methods
                const existing = resultMap.get(doc.id);
                existing.metadata.relevanceScore = (existing.metadata.relevanceScore || 0) + 0.3;
            }
            else {
                resultMap.set(doc.id, doc);
            }
        });
        return Array.from(resultMap.values());
    }
    /**
     * Keyword-based search
     */
    async keywordSearch(query) {
        const keywords = query.query.toLowerCase().split(' ').filter(w => w.length > 2);
        let memories = Array.from(this.memories.values());
        // Apply filters
        if (query.filters) {
            memories = this.applyFilters(memories, query.filters);
        }
        // Score by keyword matches
        const scored = memories.map(memory => {
            const content = memory.content.toLowerCase();
            const metadata = JSON.stringify(memory.metadata).toLowerCase();
            let score = 0;
            keywords.forEach(keyword => {
                if (content.includes(keyword))
                    score += 1;
                if (metadata.includes(keyword))
                    score += 0.5;
            });
            return {
                memory: {
                    ...memory,
                    metadata: { ...memory.metadata, relevanceScore: score / keywords.length }
                },
                score
            };
        });
        // Sort and filter
        return scored
            .filter(s => s.score > 0)
            .sort((a, b) => b.score - a.score)
            .map(s => s.memory);
    }
    /**
     * Advanced reranking with multiple criteria
     */
    async rerankResults(documents, query) {
        const criteria = this.config.defaultReranking;
        const now = Date.now();
        // Get project context if available
        const projectContext = await this.getProjectContext();
        // Score each document
        const reranked = documents.map(doc => {
            let finalScore = 0;
            // 1. Relevance score (from initial search)
            const relevance = doc.metadata.relevanceScore || 0;
            finalScore += relevance * criteria.relevance;
            // 2. Recency score
            const age = now - doc.metadata.timestamp;
            const recencyScore = Math.exp(-age / (30 * 24 * 60 * 60 * 1000)); // Decay over 30 days
            finalScore += recencyScore * criteria.recency;
            // 3. Context match score
            let contextScore = 0;
            if (projectContext) {
                if (doc.metadata.language === projectContext.language)
                    contextScore += 0.5;
                if (doc.metadata.framework === projectContext.framework)
                    contextScore += 0.5;
            }
            finalScore += contextScore * criteria.contextMatch;
            // 4. Agent expertise score
            const agentExpertise = this.getAgentExpertiseScore(doc.metadata.agentId, query.query);
            finalScore += agentExpertise * criteria.agentExpertise;
            // 5. Cross-modal boost
            if (doc.contentType !== 'text' && query.includeImages) {
                finalScore += criteria.crossModalBoost;
            }
            return {
                document: doc,
                finalScore
            };
        });
        // Sort by final score
        reranked.sort((a, b) => b.finalScore - a.finalScore);
        // Update relevance scores
        return reranked.map(r => ({
            ...r.document,
            metadata: {
                ...r.document.metadata,
                relevanceScore: r.finalScore
            }
        }));
    }
    /**
     * Generate embeddings for multimodal content
     */
    async generateMultimodalEmbedding(doc) {
        if (doc.contentType === 'text' || doc.contentType === 'code') {
            return this.generateEmbedding(doc.content);
        }
        else if (doc.contentType === 'image' && doc.metadata.imageData) {
            return this.generateImageEmbedding(doc.metadata.imageData);
        }
        else if (doc.contentType === 'mixed') {
            // Combine text and image embeddings
            const textEmb = await this.generateEmbedding(doc.content);
            if (doc.metadata.imageData) {
                const imgEmb = await this.generateImageEmbedding(doc.metadata.imageData);
                // Average the embeddings (simple fusion)
                return textEmb.map((val, idx) => (val + imgEmb[idx]) / 2);
            }
            return textEmb;
        }
        return this.generateEmbedding(doc.content);
    }
    /**
     * Generate embedding for images
     */
    async generateImageEmbedding(imageData) {
        // TODO: Integrate with multimodal embedding model (CLIP, etc.)
        // For now, return placeholder
        const embedding = Array(this.config.embeddingDimension).fill(0).map(() => Math.random());
        const norm = Math.sqrt(embedding.reduce((sum, val) => sum + val * val, 0));
        return embedding.map(val => val / norm);
    }
    /**
     * Store in Supabase vector database
     */
    async storeInSupabase(memory) {
        if (!this.isSupabaseEnabled)
            return;
        try {
            const { error } = await this.supabase
                .from('versatil_memories')
                .upsert({
                id: memory.id,
                content: memory.content,
                content_type: memory.contentType,
                embedding: memory.embedding,
                metadata: memory.metadata,
                agent_id: memory.metadata.agentId,
                created_at: new Date(memory.metadata.timestamp).toISOString()
            });
            if (error) {
                this.logger.error('Failed to store in Supabase', { error }, 'rag-memory');
            }
        }
        catch (error) {
            this.logger.error('Supabase storage error', { error }, 'rag-memory');
        }
    }
    /**
     * Vector search using Supabase
     */
    async vectorSearch(query) {
        if (!this.isSupabaseEnabled) {
            return this.localSemanticSearch(query);
        }
        try {
            const queryEmbedding = await this.generateEmbedding(query.query);
            // Build the RPC call
            let rpcQuery = this.supabase.rpc('match_memories', {
                query_embedding: queryEmbedding,
                match_threshold: 0.7,
                match_count: query.topK || 20
            });
            // Apply filters
            if (query.agentId) {
                rpcQuery = rpcQuery.eq('agent_id', query.agentId);
            }
            if (query.filters?.contentTypes) {
                rpcQuery = rpcQuery.in('content_type', query.filters.contentTypes);
            }
            const { data, error } = await rpcQuery;
            if (error) {
                this.logger.error('Vector search failed', { error }, 'rag-memory');
                return this.localSemanticSearch(query);
            }
            return data.map((row) => ({
                id: row.id,
                content: row.content,
                contentType: row.content_type,
                embedding: row.embedding,
                metadata: {
                    ...row.metadata,
                    relevanceScore: row.similarity
                }
            }));
        }
        catch (error) {
            this.logger.error('Vector search error', { error }, 'rag-memory');
            return this.localSemanticSearch(query);
        }
    }
    /**
     * Local semantic search (fallback)
     */
    async localSemanticSearch(query) {
        const queryEmbedding = await this.generateEmbedding(query.query);
        // Filter memories
        let filteredMemories = Array.from(this.memories.values());
        if (query.agentId) {
            filteredMemories = filteredMemories.filter(m => m.metadata.agentId === query.agentId);
        }
        if (query.filters) {
            filteredMemories = this.applyFilters(filteredMemories, query.filters);
        }
        // Calculate similarity scores
        const scoredMemories = filteredMemories.map(memory => ({
            memory,
            score: this.cosineSimilarity(queryEmbedding, memory.embedding || [])
        }));
        // Sort by relevance
        scoredMemories.sort((a, b) => b.score - a.score);
        return scoredMemories.map(({ memory, score }) => ({
            ...memory,
            metadata: { ...memory.metadata, relevanceScore: score }
        }));
    }
    /**
     * Get agent expertise score for reranking
     */
    getAgentExpertiseScore(agentId, query) {
        const expertise = {
            'enhanced-marcus': ['backend', 'api', 'database', 'typescript'],
            'enhanced-james': ['frontend', 'ui', 'react', 'css'],
            'enhanced-maria': ['testing', 'qa', 'quality', 'coverage'],
            'security-sam': ['security', 'vulnerability', 'authentication'],
            'architecture-dan': ['architecture', 'design', 'patterns', 'structure'],
            'dr-ai-ml': ['ml', 'ai', 'optimization', 'performance']
        };
        const agentKeywords = expertise[agentId] || [];
        const queryLower = query.toLowerCase();
        let score = 0;
        agentKeywords.forEach(keyword => {
            if (queryLower.includes(keyword))
                score += 0.25;
        });
        return Math.min(1, score);
    }
    /**
     * Get current project context for reranking
     */
    async getProjectContext() {
        // Try to get from environment scanner if available
        try {
            const scanner = require('../environment/environment-scanner').environmentScanner;
            return scanner.getLatestScan()?.technology;
        }
        catch {
            return null;
        }
    }
    /**
     * Ensure vector table exists in Supabase
     */
    async ensureVectorTable() {
        // This would be run via migration, but included for reference
        const createTableSQL = `
      CREATE TABLE IF NOT EXISTS versatil_memories (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        content TEXT NOT NULL,
        content_type VARCHAR(50) DEFAULT 'text',
        embedding vector(1536),
        metadata JSONB DEFAULT '{}',
        agent_id TEXT,
        created_at TIMESTAMP DEFAULT NOW(),
        updated_at TIMESTAMP DEFAULT NOW()
      );
      
      CREATE INDEX IF NOT EXISTS idx_memories_embedding 
      ON versatil_memories USING ivfflat (embedding vector_cosine_ops)
      WITH (lists = 100);
      
      CREATE INDEX IF NOT EXISTS idx_memories_agent 
      ON versatil_memories(agent_id);
      
      CREATE INDEX IF NOT EXISTS idx_memories_content_type 
      ON versatil_memories(content_type);
    `;
    }
    // ... (keep other utility methods from original)
    /**
     * Store diagram or visual content
     */
    async storeDiagram(content, diagramData, metadata) {
        return this.storeMemory({
            content,
            contentType: 'diagram',
            metadata: {
                ...metadata,
                imageData: diagramData,
                mimeType: 'image/svg+xml'
            }
        });
    }
    /**
     * Store code with syntax highlighting metadata
     */
    async storeCode(code, language, metadata) {
        return this.storeMemory({
            content: code,
            contentType: 'code',
            metadata: {
                ...metadata,
                language,
                fileType: language
            }
        });
    }
    /**
     * Generate embedding (with API integration support)
     */
    async generateEmbedding(text) {
        // Check for OpenAI API key
        if (process.env.OPENAI_API_KEY) {
            try {
                // TODO: Integrate with OpenAI embeddings API
                // const response = await openai.embeddings.create({
                //   model: "text-embedding-3-small",
                //   input: text,
                // });
                // return response.data[0].embedding;
            }
            catch (error) {
                this.logger.warn('OpenAI embedding failed, using fallback', { error }, 'rag-memory');
            }
        }
        // Fallback to simple embedding
        const embedding = Array(this.config.embeddingDimension).fill(0).map(() => Math.random());
        const norm = Math.sqrt(embedding.reduce((sum, val) => sum + val * val, 0));
        return embedding.map(val => val / norm);
    }
    // Missing method implementations
    async loadExistingMemories() { }
    generateMemoryId(doc) { return `mem-${Date.now()}-${Math.random()}`; }
    async persistMemory(doc) { }
    applyFilters(documents, filters) { return documents; }
    cosineSimilarity(vec1, vec2) {
        return vec1.reduce((sum, val, i) => sum + val * (vec2[i] || 0), 0);
    }
    async getAllMemories() { return Array.from(this.memories.values()); }
    async searchMemories(query, options) {
        const results = await this.queryMemoriesInternal(typeof query === 'string' ? { query } : query);
        return Array.isArray(results) ? results : (results.documents || []);
    }
    async queryMemories(query) {
        return await this.queryMemoriesInternal(typeof query === 'string' ? { query } : query);
    }
    async close() { }
    // ============================================================================
    // AGENT-SPECIFIC RAG METHODS WITH EDGE FUNCTION INTEGRATION
    // ============================================================================
    /**
     * Enhanced Maria (QA) RAG query using edge functions
     */
    async mariaRAG(query, context, config) {
        if (!this.edgeFunctionsEnabled || !this.supabaseUrl) {
            // Fallback to local processing
            return this.localMariaRAG(query, context, config);
        }
        try {
            const response = await fetch(`${this.supabaseUrl}/functions/v1/maria-rag`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${process.env.SUPABASE_ANON_KEY}`,
                },
                body: JSON.stringify({ query, context, config }),
            });
            if (!response.ok) {
                throw new Error(`Maria RAG edge function failed: ${response.statusText}`);
            }
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'Maria RAG processing failed');
            }
            this.logger.info('Maria RAG edge function completed', {
                similarPatterns: result.data?.ragInsights?.similarPatterns || 0,
                processingTime: result.metadata?.processingTime || 0
            }, 'maria-rag');
            return result;
        }
        catch (error) {
            this.logger.warn('Maria RAG edge function failed, using fallback', { error }, 'maria-rag');
            return this.localMariaRAG(query, context, config);
        }
    }
    /**
     * Enhanced James (Frontend) RAG query using edge functions
     */
    async jamesRAG(query, context, config) {
        if (!this.edgeFunctionsEnabled || !this.supabaseUrl) {
            // Fallback to local processing
            return this.localJamesRAG(query, context, config);
        }
        try {
            const response = await fetch(`${this.supabaseUrl}/functions/v1/james-rag`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${process.env.SUPABASE_ANON_KEY}`,
                },
                body: JSON.stringify({ query, context, config }),
            });
            if (!response.ok) {
                throw new Error(`James RAG edge function failed: ${response.statusText}`);
            }
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'James RAG processing failed');
            }
            this.logger.info('James RAG edge function completed', {
                componentPatterns: result.data?.ragInsights?.componentPatterns || 0,
                processingTime: result.metadata?.processingTime || 0
            }, 'james-rag');
            return result;
        }
        catch (error) {
            this.logger.warn('James RAG edge function failed, using fallback', { error }, 'james-rag');
            return this.localJamesRAG(query, context, config);
        }
    }
    /**
     * Enhanced Marcus (Backend) RAG query using edge functions
     */
    async marcusRAG(query, context, config) {
        if (!this.edgeFunctionsEnabled || !this.supabaseUrl) {
            // Fallback to local processing
            return this.localMarcusRAG(query, context, config);
        }
        try {
            const response = await fetch(`${this.supabaseUrl}/functions/v1/marcus-rag`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${process.env.SUPABASE_ANON_KEY}`,
                },
                body: JSON.stringify({ query, context, config }),
            });
            if (!response.ok) {
                throw new Error(`Marcus RAG edge function failed: ${response.statusText}`);
            }
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'Marcus RAG processing failed');
            }
            this.logger.info('Marcus RAG edge function completed', {
                apiPatterns: result.data?.ragInsights?.apiPatterns || 0,
                securitySolutions: result.data?.ragInsights?.securitySolutions || 0,
                processingTime: result.metadata?.processingTime || 0
            }, 'marcus-rag');
            return result;
        }
        catch (error) {
            this.logger.warn('Marcus RAG edge function failed, using fallback', { error }, 'marcus-rag');
            return this.localMarcusRAG(query, context, config);
        }
    }
    /**
     * Fallback local Maria RAG processing
     */
    async localMariaRAG(query, context, config) {
        const ragQuery = {
            query: `QA testing patterns ${query}`,
            queryType: 'semantic',
            agentId: 'enhanced-maria',
            topK: config?.maxExamples || 3,
            filters: {
                tags: ['test', 'qa', 'testing'],
                contentTypes: ['code', 'text']
            }
        };
        const results = await this.queryMemoriesInternal(ragQuery);
        return {
            success: true,
            data: {
                testPatterns: results.documents,
                qaBestPractices: [],
                projectStandards: [],
                ragInsights: {
                    similarPatterns: results.documents.length,
                    projectStandards: 0,
                    expertise: 0,
                    avgSimilarity: results.documents.reduce((sum, doc) => sum + (doc.metadata.relevanceScore || 0), 0) / results.documents.length
                }
            },
            metadata: {
                agentId: 'enhanced-maria',
                processingTime: results.processingTime,
                queryType: 'local-fallback'
            }
        };
    }
    /**
     * Fallback local James RAG processing
     */
    async localJamesRAG(query, context, config) {
        const ragQuery = {
            query: `Frontend component patterns ${query}`,
            queryType: 'semantic',
            agentId: 'enhanced-james',
            topK: config?.maxExamples || 3,
            filters: {
                tags: ['frontend', 'component', 'ui'],
                contentTypes: ['code']
            }
        };
        const results = await this.queryMemoriesInternal(ragQuery);
        return {
            success: true,
            data: {
                componentPatterns: results.documents,
                uiPatterns: [],
                performancePatterns: [],
                ragInsights: {
                    componentPatterns: results.documents.length,
                    uiPatterns: 0,
                    performanceOptimizations: 0,
                    avgSimilarity: results.documents.reduce((sum, doc) => sum + (doc.metadata.relevanceScore || 0), 0) / results.documents.length
                }
            },
            metadata: {
                agentId: 'enhanced-james',
                processingTime: results.processingTime,
                queryType: 'local-fallback'
            }
        };
    }
    /**
     * Fallback local Marcus RAG processing
     */
    async localMarcusRAG(query, context, config) {
        const ragQuery = {
            query: `Backend API patterns ${query}`,
            queryType: 'semantic',
            agentId: 'enhanced-marcus',
            topK: config?.maxExamples || 3,
            filters: {
                tags: ['backend', 'api', 'security'],
                contentTypes: ['code']
            }
        };
        const results = await this.queryMemoriesInternal(ragQuery);
        return {
            success: true,
            data: {
                apiPatterns: results.documents,
                securityPatterns: [],
                performancePatterns: [],
                databaseOptimizations: [],
                ragInsights: {
                    apiPatterns: results.documents.length,
                    securitySolutions: 0,
                    performanceOptimizations: 0,
                    databaseOptimizations: 0,
                    avgSimilarity: results.documents.reduce((sum, doc) => sum + (doc.metadata.relevanceScore || 0), 0) / results.documents.length
                }
            },
            metadata: {
                agentId: 'enhanced-marcus',
                processingTime: results.processingTime,
                queryType: 'local-fallback'
            }
        };
    }
    /**
     * Store agent-specific patterns in enhanced schema
     */
    async storeAgentPattern(agentName, pattern) {
        if (!this.isSupabaseEnabled) {
            // Fallback to local storage
            return this.storeMemory({
                content: pattern.code_content || pattern.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    tags: pattern.tags || [],
                    ...pattern.metadata
                }
            });
        }
        try {
            const { data, error } = await this.supabase
                .from('agent_code_patterns')
                .insert({
                agent_name: agentName,
                pattern_type: pattern.pattern_type || 'unknown',
                code_content: pattern.code_content || pattern.content,
                file_path: pattern.file_path,
                language: pattern.language,
                framework: pattern.framework,
                quality_score: pattern.quality_score || 80,
                metadata: pattern.metadata || {},
                tags: pattern.tags || []
            })
                .select()
                .single();
            if (error) {
                throw error;
            }
            this.logger.info('Agent pattern stored in enhanced schema', {
                agentName,
                patternType: pattern.pattern_type,
                id: data.id
            }, 'rag-memory');
            return data.id;
        }
        catch (error) {
            this.logger.error('Failed to store agent pattern', { error, agentName }, 'rag-memory');
            // Fallback to local storage
            return this.storeMemory({
                content: pattern.code_content || pattern.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    tags: pattern.tags || [],
                    ...pattern.metadata
                }
            });
        }
    }
    /**
     * Store agent solutions in enhanced schema
     */
    async storeAgentSolution(agentName, solution) {
        if (!this.isSupabaseEnabled) {
            return this.storeMemory({
                content: solution.solution_code || solution.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    problemType: solution.problem_type,
                    ...solution.metadata
                }
            });
        }
        try {
            const { data, error } = await this.supabase
                .from('agent_solutions')
                .insert({
                agent_name: agentName,
                problem_type: solution.problem_type,
                problem_description: solution.problem_description,
                solution_code: solution.solution_code,
                solution_explanation: solution.solution_explanation,
                effectiveness_score: solution.effectiveness_score || 0.8,
                dependencies: solution.dependencies || [],
                compatibility: solution.compatibility || {}
            })
                .select()
                .single();
            if (error) {
                throw error;
            }
            this.logger.info('Agent solution stored in enhanced schema', {
                agentName,
                problemType: solution.problem_type,
                id: data.id
            }, 'rag-memory');
            return data.id;
        }
        catch (error) {
            this.logger.error('Failed to store agent solution', { error, agentName }, 'rag-memory');
            return this.storeMemory({
                content: solution.solution_code || solution.content,
                contentType: 'code',
                metadata: {
                    agentId: agentName,
                    timestamp: Date.now(),
                    problemType: solution.problem_type,
                    ...solution.metadata
                }
            });
        }
    }
    /**
     * Get production deployment status
     */
    getProductionStatus() {
        return {
            supabaseEnabled: this.isSupabaseEnabled,
            edgeFunctionsEnabled: this.edgeFunctionsEnabled,
            agentRAGAvailable: this.edgeFunctionsEnabled && this.supabaseUrl !== null,
            enhancedSchemaReady: this.isSupabaseEnabled
        };
    }
}
exports.EnhancedVectorMemoryStore = EnhancedVectorMemoryStore;
// Export enhanced singleton instance
exports.vectorMemoryStore = new EnhancedVectorMemoryStore();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvcmFnL2VuaGFuY2VkLXZlY3Rvci1tZW1vcnktc3RvcmUudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsbUNBQXNDO0FBQ3RDLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0Isa0RBQW9EO0FBQ3BELHVEQUFxRDtBQXVEckQsTUFBYSx5QkFBMEIsU0FBUSxxQkFBWTtJQTBCekQ7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQXpCRixhQUFRLEdBQWdDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDbEQsZUFBVSxHQUEwQixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRzlDLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUNuQyx5QkFBb0IsR0FBWSxLQUFLLENBQUM7UUFDdEMsZ0JBQVcsR0FBa0IsSUFBSSxDQUFDO1FBRTFDLHlCQUF5QjtRQUNqQixXQUFNLEdBQUc7WUFDZixrQkFBa0IsRUFBRSxJQUFJLEVBQUUsMkJBQTJCO1lBQ3JELGFBQWEsRUFBRSxNQUFNO1lBQ3JCLGdCQUFnQixFQUFFLElBQUk7WUFDdEIsaUJBQWlCLEVBQUUsSUFBSTtZQUN2QixtQkFBbUIsRUFBRSxJQUFJO1lBQ3pCLGdCQUFnQixFQUFFO2dCQUNoQixPQUFPLEVBQUUsSUFBSTtnQkFDYixTQUFTLEVBQUUsR0FBRztnQkFDZCxZQUFZLEVBQUUsSUFBSTtnQkFDbEIsY0FBYyxFQUFFLEdBQUc7Z0JBQ25CLGVBQWUsRUFBRSxHQUFHO2FBQ0E7U0FDdkIsQ0FBQztRQUlBLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSwwQkFBYyxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzlFLElBQUksQ0FBQyxVQUFVLEVBQUUs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RUFBRSxRQUFRLENBQUMsWUFBWTtvQkFDbEMsR0FBRyxRQUFRLENBQUMsUUFBUTtpQkFDckI7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsbUJBQW1CO1FBTWpCLE9BQU87WUFDTCxlQUFlLEVBQUUsSUFBSSxDQUFDLGlCQUFpQjtZQUN2QyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsb0JBQW9CO1lBQy9DLGlCQUFpQixFQUFFLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLElBQUk7WUFDekUsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLGlCQUFpQjtTQUM1QyxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBNTdCRCw4REE0N0JDO0FBRUQscUNBQXFDO0FBQ3hCLFFBQUEsaUJBQWlCLEdBQUcsSUFBSSx5QkFBeUIsRUFBRSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaXNzaW1tZW5hc2hlL1ZFUlNBVElMIFNETEMgRlcvc3JjL3JhZy9lbmhhbmNlZC12ZWN0b3ItbWVtb3J5LXN0b3JlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVkVSU0FUSUwgU0RMQyBGcmFtZXdvcmsgLSBFbmhhbmNlZCBWZWN0b3IgTWVtb3J5IFN0b3JlXG4gKiBBZHZhbmNlZCBSQUcgd2l0aCByZXJhbmtpbmcsIG11bHRpbW9kYWwgc3VwcG9ydCwgYW5kIHByb3BlciB2ZWN0b3IgREJcbiAqL1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFZFUlNBVElMTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyLmpzJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVtb3J5RG9jdW1lbnQge1xuICBpZDogc3RyaW5nO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIGNvbnRlbnRUeXBlOiAndGV4dCcgfCAnY29kZScgfCAnaW1hZ2UnIHwgJ2RpYWdyYW0nIHwgJ21peGVkJyB8ICdoYW5kb2ZmJyB8ICdjb250ZXh0LW1ldGFkYXRhJyB8ICd3ZWItbGVhcm5lZC1wYXR0ZXJuJyB8ICdpbnRlcmFjdGlvbicgfCAnbWV0YS1sZWFybmluZycgfCAnd2lubmluZy1wYXR0ZXJuJyB8ICdhbnRpLXBhdHRlcm4nIHwgJ3RlYW0tc3R5bGUnO1xuICBlbWJlZGRpbmc/OiBudW1iZXJbXTtcbiAgbWV0YWRhdGE6IHtcbiAgICBhZ2VudElkOiBzdHJpbmc7XG4gICAgdGltZXN0YW1wOiBudW1iZXI7XG4gICAgZmlsZVR5cGU/OiBzdHJpbmc7XG4gICAgcHJvamVjdENvbnRleHQ/OiBzdHJpbmc7XG4gICAgdGFnczogc3RyaW5nW107XG4gICAgcmVsZXZhbmNlU2NvcmU/OiBudW1iZXI7XG4gICAgbGFuZ3VhZ2U/OiBzdHJpbmc7XG4gICAgZnJhbWV3b3JrPzogc3RyaW5nO1xuICAgIGltYWdlRGF0YT86IHN0cmluZzsgLy8gYmFzZTY0IGZvciBpbWFnZXNcbiAgICBtaW1lVHlwZT86IHN0cmluZztcbiAgICAvLyBBZGRpdGlvbmFsIG1ldGFkYXRhIGZpZWxkcyBmb3IgZXh0ZW5kZWQgZnVuY3Rpb25hbGl0eVxuICAgIFtrZXk6IHN0cmluZ106IGFueTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSQUdRdWVyeSB7XG4gIHF1ZXJ5OiBzdHJpbmc7XG4gIHF1ZXJ5VHlwZT86ICd0ZXh0JyB8ICdzZW1hbnRpYycgfCAnaHlicmlkJztcbiAgYWdlbnRJZD86IHN0cmluZztcbiAgdG9wSz86IG51bWJlcjtcbiAgcmVyYW5rPzogYm9vbGVhbjtcbiAgaW5jbHVkZUltYWdlcz86IGJvb2xlYW47XG4gIGZpbHRlcnM/OiB7XG4gICAgdGltZVJhbmdlPzogeyBzdGFydDogbnVtYmVyOyBlbmQ6IG51bWJlciB9O1xuICAgIHRhZ3M/OiBzdHJpbmdbXTtcbiAgICBmaWxlVHlwZXM/OiBzdHJpbmdbXTtcbiAgICBjb250ZW50VHlwZXM/OiBzdHJpbmdbXTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXJhbmtpbmdDcml0ZXJpYSB7XG4gIHJlY2VuY3k6IG51bWJlcjsgLy8gMC0xIHdlaWdodFxuICByZWxldmFuY2U6IG51bWJlcjsgLy8gMC0xIHdlaWdodFxuICBjb250ZXh0TWF0Y2g6IG51bWJlcjsgLy8gMC0xIHdlaWdodFxuICBhZ2VudEV4cGVydGlzZTogbnVtYmVyOyAvLyAwLTEgd2VpZ2h0XG4gIGNyb3NzTW9kYWxCb29zdDogbnVtYmVyOyAvLyAwLTEgd2VpZ2h0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUkFHUmVzdWx0IHtcbiAgZG9jdW1lbnRzOiBNZW1vcnlEb2N1bWVudFtdO1xuICByZXJhbmtlZD86IGJvb2xlYW47XG4gIHF1ZXJ5RW1iZWRkaW5nPzogbnVtYmVyW107XG4gIHByb2Nlc3NpbmdUaW1lOiBudW1iZXI7XG4gIHNlYXJjaE1ldGhvZDogc3RyaW5nO1xuICB0b3RhbE1hdGNoZXM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIEVuaGFuY2VkVmVjdG9yTWVtb3J5U3RvcmUgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwcml2YXRlIGxvZ2dlcjogVkVSU0FUSUxMb2dnZXI7XG4gIHByaXZhdGUgbWVtb3JpZXM6IE1hcDxzdHJpbmcsIE1lbW9yeURvY3VtZW50PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBlbWJlZGRpbmdzOiBNYXA8c3RyaW5nLCBudW1iZXJbXT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgaW5kZXhQYXRoOiBzdHJpbmc7XG4gIHByaXZhdGUgc3VwYWJhc2U6IGFueTtcbiAgcHJpdmF0ZSBpc1N1cGFiYXNlRW5hYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGVkZ2VGdW5jdGlvbnNFbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgc3VwYWJhc2VVcmw6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBcbiAgLy8gRW5oYW5jZWQgY29uZmlndXJhdGlvblxuICBwcml2YXRlIGNvbmZpZyA9IHtcbiAgICBlbWJlZGRpbmdEaW1lbnNpb246IDE1MzYsIC8vIE9wZW5BSSBhZGEtMDAyIGRpbWVuc2lvblxuICAgIG1heE1lbW9yeVNpemU6IDEwMDAwMCxcbiAgICByZXJhbmtpbmdFbmFibGVkOiB0cnVlLFxuICAgIG11bHRpbW9kYWxFbmFibGVkOiB0cnVlLFxuICAgIGh5YnJpZFNlYXJjaEVuYWJsZWQ6IHRydWUsXG4gICAgZGVmYXVsdFJlcmFua2luZzoge1xuICAgICAgcmVjZW5jeTogMC4xNSxcbiAgICAgIHJlbGV2YW5jZTogMC40LFxuICAgICAgY29udGV4dE1hdGNoOiAwLjI1LFxuICAgICAgYWdlbnRFeHBlcnRpc2U6IDAuMSxcbiAgICAgIGNyb3NzTW9kYWxCb29zdDogMC4xXG4gICAgfSBhcyBSZXJhbmtpbmdDcml0ZXJpYVxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5sb2dnZXIgPSBuZXcgVkVSU0FUSUxMb2dnZXIoKTtcbiAgICB0aGlzLmluZGV4UGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLnZlcnNhdGlsJywgJ3JhZycsICd2ZWN0b3ItaW5kZXgnKTtcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIFN1cGFiYXNlIGNvbm5lY3Rpb24gaWYgYXZhaWxhYmxlXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0c1xuICAgIGF3YWl0IGZzLnByb21pc2VzLm1rZGlyKHRoaXMuaW5kZXhQYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcblxuICAgIC8vIFRyeSB0byBpbml0aWFsaXplIFN1cGFiYXNlIGlmIGNvbmZpZ3VyZWRcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVTdXBhYmFzZSgpO1xuXG4gICAgYXdhaXQgdGhpcy5sb2FkRXhpc3RpbmdNZW1vcmllcygpO1xuXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnRW5oYW5jZWQgdmVjdG9yIG1lbW9yeSBzdG9yZSBpbml0aWFsaXplZCcsIHtcbiAgICAgIG1lbW9yeUNvdW50OiB0aGlzLm1lbW9yaWVzLnNpemUsXG4gICAgICBzdXBhYmFzZUVuYWJsZWQ6IHRoaXMuaXNTdXBhYmFzZUVuYWJsZWQsXG4gICAgICBmZWF0dXJlczoge1xuICAgICAgICByZXJhbmtpbmc6IHRoaXMuY29uZmlnLnJlcmFua2luZ0VuYWJsZWQsXG4gICAgICAgIG11bHRpbW9kYWw6IHRoaXMuY29uZmlnLm11bHRpbW9kYWxFbmFibGVkLFxuICAgICAgICBoeWJyaWRTZWFyY2g6IHRoaXMuY29uZmlnLmh5YnJpZFNlYXJjaEVuYWJsZWRcbiAgICAgIH1cbiAgICB9LCAncmFnLW1lbW9yeScpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplU3VwYWJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMO1xuICAgICAgY29uc3Qgc3VwYWJhc2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9BTk9OX0tFWTtcblxuICAgICAgaWYgKHN1cGFiYXNlVXJsICYmIHN1cGFiYXNlS2V5KSB7XG4gICAgICAgIHRoaXMuc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlS2V5KTtcbiAgICAgICAgdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuc3VwYWJhc2VVcmwgPSBzdXBhYmFzZVVybDtcbiAgICAgICAgdGhpcy5lZGdlRnVuY3Rpb25zRW5hYmxlZCA9IHRydWU7IC8vIEVuYWJsZSBlZGdlIGZ1bmN0aW9ucyBpbnRlZ3JhdGlvblxuXG4gICAgICAgIC8vIEVuc3VyZSB2ZWN0b3IgdGFibGUgZXhpc3RzXG4gICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlVmVjdG9yVGFibGUoKTtcblxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdTdXBhYmFzZSArIEVkZ2UgRnVuY3Rpb25zIGluaXRpYWxpemVkJywge1xuICAgICAgICAgIHN1cGFiYXNlVXJsOiBzdXBhYmFzZVVybC5yZXBsYWNlKC9cXC8uKi8sICcvL1tISURERU5dJyksXG4gICAgICAgICAgZWRnZUZ1bmN0aW9uczogdGhpcy5lZGdlRnVuY3Rpb25zRW5hYmxlZFxuICAgICAgICB9LCAncmFnLW1lbW9yeScpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdTdXBhYmFzZSBpbml0aWFsaXphdGlvbiBmYWlsZWQsIHVzaW5nIGxvY2FsIHN0b3JhZ2UnLCB7IGVycm9yIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGEgbWVtb3J5IGRvY3VtZW50IHdpdGggdmVjdG9yIGVtYmVkZGluZ1xuICAgKi9cbiAgYXN5bmMgc3RvcmVNZW1vcnkoZG9jOiBPbWl0PE1lbW9yeURvY3VtZW50LCAnaWQnIHwgJ2VtYmVkZGluZyc+KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2VuZXJhdGVNZW1vcnlJZCgpO1xuICAgIGNvbnN0IGVtYmVkZGluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVNdWx0aW1vZGFsRW1iZWRkaW5nKGRvYyk7XG4gICAgXG4gICAgY29uc3QgbWVtb3J5OiBNZW1vcnlEb2N1bWVudCA9IHtcbiAgICAgIGlkLFxuICAgICAgLi4uZG9jLFxuICAgICAgZW1iZWRkaW5nXG4gICAgfTtcbiAgICBcbiAgICAvLyBTdG9yZSBsb2NhbGx5XG4gICAgdGhpcy5tZW1vcmllcy5zZXQoaWQsIG1lbW9yeSk7XG4gICAgdGhpcy5lbWJlZGRpbmdzLnNldChpZCwgZW1iZWRkaW5nKTtcbiAgICBcbiAgICAvLyBTdG9yZSBpbiB2ZWN0b3IgREIgaWYgYXZhaWxhYmxlXG4gICAgaWYgKHRoaXMuaXNTdXBhYmFzZUVuYWJsZWQpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RvcmVJblN1cGFiYXNlKG1lbW9yeSk7XG4gICAgfVxuICAgIFxuICAgIGF3YWl0IHRoaXMucGVyc2lzdE1lbW9yeShtZW1vcnkpO1xuICAgIFxuICAgIHRoaXMuZW1pdCgnbWVtb3J5X3N0b3JlZCcsIHsgXG4gICAgICBpZCwgXG4gICAgICBhZ2VudElkOiBkb2MubWV0YWRhdGEuYWdlbnRJZCxcbiAgICAgIGNvbnRlbnRUeXBlOiBkb2MuY29udGVudFR5cGUgXG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIGlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuaGFuY2VkIHF1ZXJ5IHdpdGggcmVyYW5raW5nIGFuZCBtdWx0aW1vZGFsIHN1cHBvcnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcXVlcnlNZW1vcmllc0ludGVybmFsKHF1ZXJ5OiBSQUdRdWVyeSk6IFByb21pc2U8UkFHUmVzdWx0PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgZG9jdW1lbnRzOiBNZW1vcnlEb2N1bWVudFtdO1xuICAgIGxldCBzZWFyY2hNZXRob2QgPSAnc2VtYW50aWMnO1xuICAgIFxuICAgIC8vIERldGVybWluZSBzZWFyY2ggc3RyYXRlZ3lcbiAgICBpZiAocXVlcnkucXVlcnlUeXBlID09PSAnaHlicmlkJyB8fCB0aGlzLmNvbmZpZy5oeWJyaWRTZWFyY2hFbmFibGVkKSB7XG4gICAgICBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmh5YnJpZFNlYXJjaChxdWVyeSk7XG4gICAgICBzZWFyY2hNZXRob2QgPSAnaHlicmlkJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNTdXBhYmFzZUVuYWJsZWQpIHtcbiAgICAgIGRvY3VtZW50cyA9IGF3YWl0IHRoaXMudmVjdG9yU2VhcmNoKHF1ZXJ5KTtcbiAgICAgIHNlYXJjaE1ldGhvZCA9ICd2ZWN0b3InO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmxvY2FsU2VtYW50aWNTZWFyY2gocXVlcnkpO1xuICAgICAgc2VhcmNoTWV0aG9kID0gJ2xvY2FsLXNlbWFudGljJztcbiAgICB9XG4gICAgXG4gICAgLy8gQXBwbHkgcmVyYW5raW5nIGlmIHJlcXVlc3RlZCBvciBlbmFibGVkIGJ5IGRlZmF1bHRcbiAgICBsZXQgcmVyYW5rZWQgPSBmYWxzZTtcbiAgICBpZiAocXVlcnkucmVyYW5rICE9PSBmYWxzZSAmJiB0aGlzLmNvbmZpZy5yZXJhbmtpbmdFbmFibGVkKSB7XG4gICAgICBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLnJlcmFua1Jlc3VsdHMoZG9jdW1lbnRzLCBxdWVyeSk7XG4gICAgICByZXJhbmtlZCA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIC8vIExpbWl0IHRvIHRvcEtcbiAgICBjb25zdCB0b3BLID0gcXVlcnkudG9wSyB8fCAxMDtcbiAgICBjb25zdCBmaW5hbERvY3VtZW50cyA9IGRvY3VtZW50cy5zbGljZSgwLCB0b3BLKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgZG9jdW1lbnRzOiBmaW5hbERvY3VtZW50cyxcbiAgICAgIHJlcmFua2VkLFxuICAgICAgcXVlcnlFbWJlZGRpbmc6IGF3YWl0IHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcocXVlcnkucXVlcnkpLFxuICAgICAgcHJvY2Vzc2luZ1RpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICBzZWFyY2hNZXRob2QsXG4gICAgICB0b3RhbE1hdGNoZXM6IGRvY3VtZW50cy5sZW5ndGhcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEh5YnJpZCBzZWFyY2ggY29tYmluaW5nIHNlbWFudGljIGFuZCBrZXl3b3JkIG1hdGNoaW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGh5YnJpZFNlYXJjaChxdWVyeTogUkFHUXVlcnkpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHtcbiAgICAvLyBTZW1hbnRpYyBzZWFyY2hcbiAgICBjb25zdCBzZW1hbnRpY1Jlc3VsdHMgPSBhd2FpdCB0aGlzLmxvY2FsU2VtYW50aWNTZWFyY2gocXVlcnkpO1xuICAgIFxuICAgIC8vIEtleXdvcmQgc2VhcmNoXG4gICAgY29uc3Qga2V5d29yZFJlc3VsdHMgPSBhd2FpdCB0aGlzLmtleXdvcmRTZWFyY2gocXVlcnkpO1xuICAgIFxuICAgIC8vIE1lcmdlIGFuZCBkZWR1cGxpY2F0ZVxuICAgIGNvbnN0IHJlc3VsdE1hcCA9IG5ldyBNYXA8c3RyaW5nLCBNZW1vcnlEb2N1bWVudD4oKTtcbiAgICBcbiAgICAvLyBBZGQgc2VtYW50aWMgcmVzdWx0cyB3aXRoIGJvb3N0ZWQgc2NvcmVzXG4gICAgc2VtYW50aWNSZXN1bHRzLmZvckVhY2goZG9jID0+IHtcbiAgICAgIHJlc3VsdE1hcC5zZXQoZG9jLmlkLCB7XG4gICAgICAgIC4uLmRvYyxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAuLi5kb2MubWV0YWRhdGEsXG4gICAgICAgICAgcmVsZXZhbmNlU2NvcmU6IChkb2MubWV0YWRhdGEucmVsZXZhbmNlU2NvcmUgfHwgMCkgKiAxLjJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgXG4gICAgLy8gQWRkIGtleXdvcmQgcmVzdWx0c1xuICAgIGtleXdvcmRSZXN1bHRzLmZvckVhY2goZG9jID0+IHtcbiAgICAgIGlmIChyZXN1bHRNYXAuaGFzKGRvYy5pZCkpIHtcbiAgICAgICAgLy8gQm9vc3QgZG9jdW1lbnRzIGZvdW5kIGJ5IGJvdGggbWV0aG9kc1xuICAgICAgICBjb25zdCBleGlzdGluZyA9IHJlc3VsdE1hcC5nZXQoZG9jLmlkKSE7XG4gICAgICAgIGV4aXN0aW5nLm1ldGFkYXRhLnJlbGV2YW5jZVNjb3JlID0gKGV4aXN0aW5nLm1ldGFkYXRhLnJlbGV2YW5jZVNjb3JlIHx8IDApICsgMC4zO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0TWFwLnNldChkb2MuaWQsIGRvYyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIEFycmF5LmZyb20ocmVzdWx0TWFwLnZhbHVlcygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBLZXl3b3JkLWJhc2VkIHNlYXJjaFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBrZXl3b3JkU2VhcmNoKHF1ZXJ5OiBSQUdRdWVyeSk6IFByb21pc2U8TWVtb3J5RG9jdW1lbnRbXT4ge1xuICAgIGNvbnN0IGtleXdvcmRzID0gcXVlcnkucXVlcnkudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpLmZpbHRlcih3ID0+IHcubGVuZ3RoID4gMik7XG4gICAgbGV0IG1lbW9yaWVzID0gQXJyYXkuZnJvbSh0aGlzLm1lbW9yaWVzLnZhbHVlcygpKTtcbiAgICBcbiAgICAvLyBBcHBseSBmaWx0ZXJzXG4gICAgaWYgKHF1ZXJ5LmZpbHRlcnMpIHtcbiAgICAgIG1lbW9yaWVzID0gdGhpcy5hcHBseUZpbHRlcnMobWVtb3JpZXMsIHF1ZXJ5LmZpbHRlcnMpO1xuICAgIH1cbiAgICBcbiAgICAvLyBTY29yZSBieSBrZXl3b3JkIG1hdGNoZXNcbiAgICBjb25zdCBzY29yZWQgPSBtZW1vcmllcy5tYXAobWVtb3J5ID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBtZW1vcnkuY29udGVudC50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSBKU09OLnN0cmluZ2lmeShtZW1vcnkubWV0YWRhdGEpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBcbiAgICAgIGxldCBzY29yZSA9IDA7XG4gICAgICBrZXl3b3Jkcy5mb3JFYWNoKGtleXdvcmQgPT4ge1xuICAgICAgICBpZiAoY29udGVudC5pbmNsdWRlcyhrZXl3b3JkKSkgc2NvcmUgKz0gMTtcbiAgICAgICAgaWYgKG1ldGFkYXRhLmluY2x1ZGVzKGtleXdvcmQpKSBzY29yZSArPSAwLjU7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVtb3J5OiB7XG4gICAgICAgICAgLi4ubWVtb3J5LFxuICAgICAgICAgIG1ldGFkYXRhOiB7IC4uLm1lbW9yeS5tZXRhZGF0YSwgcmVsZXZhbmNlU2NvcmU6IHNjb3JlIC8ga2V5d29yZHMubGVuZ3RoIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2NvcmVcbiAgICAgIH07XG4gICAgfSk7XG4gICAgXG4gICAgLy8gU29ydCBhbmQgZmlsdGVyXG4gICAgcmV0dXJuIHNjb3JlZFxuICAgICAgLmZpbHRlcihzID0+IHMuc2NvcmUgPiAwKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKVxuICAgICAgLm1hcChzID0+IHMubWVtb3J5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZHZhbmNlZCByZXJhbmtpbmcgd2l0aCBtdWx0aXBsZSBjcml0ZXJpYVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByZXJhbmtSZXN1bHRzKGRvY3VtZW50czogTWVtb3J5RG9jdW1lbnRbXSwgcXVlcnk6IFJBR1F1ZXJ5KTogUHJvbWlzZTxNZW1vcnlEb2N1bWVudFtdPiB7XG4gICAgY29uc3QgY3JpdGVyaWEgPSB0aGlzLmNvbmZpZy5kZWZhdWx0UmVyYW5raW5nO1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgXG4gICAgLy8gR2V0IHByb2plY3QgY29udGV4dCBpZiBhdmFpbGFibGVcbiAgICBjb25zdCBwcm9qZWN0Q29udGV4dCA9IGF3YWl0IHRoaXMuZ2V0UHJvamVjdENvbnRleHQoKTtcbiAgICBcbiAgICAvLyBTY29yZSBlYWNoIGRvY3VtZW50XG4gICAgY29uc3QgcmVyYW5rZWQgPSBkb2N1bWVudHMubWFwKGRvYyA9PiB7XG4gICAgICBsZXQgZmluYWxTY29yZSA9IDA7XG4gICAgICBcbiAgICAgIC8vIDEuIFJlbGV2YW5jZSBzY29yZSAoZnJvbSBpbml0aWFsIHNlYXJjaClcbiAgICAgIGNvbnN0IHJlbGV2YW5jZSA9IGRvYy5tZXRhZGF0YS5yZWxldmFuY2VTY29yZSB8fCAwO1xuICAgICAgZmluYWxTY29yZSArPSByZWxldmFuY2UgKiBjcml0ZXJpYS5yZWxldmFuY2U7XG4gICAgICBcbiAgICAgIC8vIDIuIFJlY2VuY3kgc2NvcmVcbiAgICAgIGNvbnN0IGFnZSA9IG5vdyAtIGRvYy5tZXRhZGF0YS50aW1lc3RhbXA7XG4gICAgICBjb25zdCByZWNlbmN5U2NvcmUgPSBNYXRoLmV4cCgtYWdlIC8gKDMwICogMjQgKiA2MCAqIDYwICogMTAwMCkpOyAvLyBEZWNheSBvdmVyIDMwIGRheXNcbiAgICAgIGZpbmFsU2NvcmUgKz0gcmVjZW5jeVNjb3JlICogY3JpdGVyaWEucmVjZW5jeTtcbiAgICAgIFxuICAgICAgLy8gMy4gQ29udGV4dCBtYXRjaCBzY29yZVxuICAgICAgbGV0IGNvbnRleHRTY29yZSA9IDA7XG4gICAgICBpZiAocHJvamVjdENvbnRleHQpIHtcbiAgICAgICAgaWYgKGRvYy5tZXRhZGF0YS5sYW5ndWFnZSA9PT0gcHJvamVjdENvbnRleHQubGFuZ3VhZ2UpIGNvbnRleHRTY29yZSArPSAwLjU7XG4gICAgICAgIGlmIChkb2MubWV0YWRhdGEuZnJhbWV3b3JrID09PSBwcm9qZWN0Q29udGV4dC5mcmFtZXdvcmspIGNvbnRleHRTY29yZSArPSAwLjU7XG4gICAgICB9XG4gICAgICBmaW5hbFNjb3JlICs9IGNvbnRleHRTY29yZSAqIGNyaXRlcmlhLmNvbnRleHRNYXRjaDtcbiAgICAgIFxuICAgICAgLy8gNC4gQWdlbnQgZXhwZXJ0aXNlIHNjb3JlXG4gICAgICBjb25zdCBhZ2VudEV4cGVydGlzZSA9IHRoaXMuZ2V0QWdlbnRFeHBlcnRpc2VTY29yZShkb2MubWV0YWRhdGEuYWdlbnRJZCwgcXVlcnkucXVlcnkpO1xuICAgICAgZmluYWxTY29yZSArPSBhZ2VudEV4cGVydGlzZSAqIGNyaXRlcmlhLmFnZW50RXhwZXJ0aXNlO1xuICAgICAgXG4gICAgICAvLyA1LiBDcm9zcy1tb2RhbCBib29zdFxuICAgICAgaWYgKGRvYy5jb250ZW50VHlwZSAhPT0gJ3RleHQnICYmIHF1ZXJ5LmluY2x1ZGVJbWFnZXMpIHtcbiAgICAgICAgZmluYWxTY29yZSArPSBjcml0ZXJpYS5jcm9zc01vZGFsQm9vc3Q7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvY3VtZW50OiBkb2MsXG4gICAgICAgIGZpbmFsU2NvcmVcbiAgICAgIH07XG4gICAgfSk7XG4gICAgXG4gICAgLy8gU29ydCBieSBmaW5hbCBzY29yZVxuICAgIHJlcmFua2VkLnNvcnQoKGEsIGIpID0+IGIuZmluYWxTY29yZSAtIGEuZmluYWxTY29yZSk7XG4gICAgXG4gICAgLy8gVXBkYXRlIHJlbGV2YW5jZSBzY29yZXNcbiAgICByZXR1cm4gcmVyYW5rZWQubWFwKHIgPT4gKHtcbiAgICAgIC4uLnIuZG9jdW1lbnQsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5yLmRvY3VtZW50Lm1ldGFkYXRhLFxuICAgICAgICByZWxldmFuY2VTY29yZTogci5maW5hbFNjb3JlXG4gICAgICB9XG4gICAgfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGVtYmVkZGluZ3MgZm9yIG11bHRpbW9kYWwgY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZU11bHRpbW9kYWxFbWJlZGRpbmcoZG9jOiBPbWl0PE1lbW9yeURvY3VtZW50LCAnaWQnIHwgJ2VtYmVkZGluZyc+KTogUHJvbWlzZTxudW1iZXJbXT4ge1xuICAgIGlmIChkb2MuY29udGVudFR5cGUgPT09ICd0ZXh0JyB8fCBkb2MuY29udGVudFR5cGUgPT09ICdjb2RlJykge1xuICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcoZG9jLmNvbnRlbnQpO1xuICAgIH0gZWxzZSBpZiAoZG9jLmNvbnRlbnRUeXBlID09PSAnaW1hZ2UnICYmIGRvYy5tZXRhZGF0YS5pbWFnZURhdGEpIHtcbiAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlSW1hZ2VFbWJlZGRpbmcoZG9jLm1ldGFkYXRhLmltYWdlRGF0YSk7XG4gICAgfSBlbHNlIGlmIChkb2MuY29udGVudFR5cGUgPT09ICdtaXhlZCcpIHtcbiAgICAgIC8vIENvbWJpbmUgdGV4dCBhbmQgaW1hZ2UgZW1iZWRkaW5nc1xuICAgICAgY29uc3QgdGV4dEVtYiA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcoZG9jLmNvbnRlbnQpO1xuICAgICAgaWYgKGRvYy5tZXRhZGF0YS5pbWFnZURhdGEpIHtcbiAgICAgICAgY29uc3QgaW1nRW1iID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUltYWdlRW1iZWRkaW5nKGRvYy5tZXRhZGF0YS5pbWFnZURhdGEpO1xuICAgICAgICAvLyBBdmVyYWdlIHRoZSBlbWJlZGRpbmdzIChzaW1wbGUgZnVzaW9uKVxuICAgICAgICByZXR1cm4gdGV4dEVtYi5tYXAoKHZhbCwgaWR4KSA9PiAodmFsICsgaW1nRW1iW2lkeF0pIC8gMik7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGV4dEVtYjtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcoZG9jLmNvbnRlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGVtYmVkZGluZyBmb3IgaW1hZ2VzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlSW1hZ2VFbWJlZGRpbmcoaW1hZ2VEYXRhOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XG4gICAgLy8gVE9ETzogSW50ZWdyYXRlIHdpdGggbXVsdGltb2RhbCBlbWJlZGRpbmcgbW9kZWwgKENMSVAsIGV0Yy4pXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIHBsYWNlaG9sZGVyXG4gICAgY29uc3QgZW1iZWRkaW5nID0gQXJyYXkodGhpcy5jb25maWcuZW1iZWRkaW5nRGltZW5zaW9uKS5maWxsKDApLm1hcCgoKSA9PiBNYXRoLnJhbmRvbSgpKTtcbiAgICBjb25zdCBub3JtID0gTWF0aC5zcXJ0KGVtYmVkZGluZy5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyB2YWwgKiB2YWwsIDApKTtcbiAgICByZXR1cm4gZW1iZWRkaW5nLm1hcCh2YWwgPT4gdmFsIC8gbm9ybSk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgaW4gU3VwYWJhc2UgdmVjdG9yIGRhdGFiYXNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHN0b3JlSW5TdXBhYmFzZShtZW1vcnk6IE1lbW9yeURvY3VtZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmlzU3VwYWJhc2VFbmFibGVkKSByZXR1cm47XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3ZlcnNhdGlsX21lbW9yaWVzJylcbiAgICAgICAgLnVwc2VydCh7XG4gICAgICAgICAgaWQ6IG1lbW9yeS5pZCxcbiAgICAgICAgICBjb250ZW50OiBtZW1vcnkuY29udGVudCxcbiAgICAgICAgICBjb250ZW50X3R5cGU6IG1lbW9yeS5jb250ZW50VHlwZSxcbiAgICAgICAgICBlbWJlZGRpbmc6IG1lbW9yeS5lbWJlZGRpbmcsXG4gICAgICAgICAgbWV0YWRhdGE6IG1lbW9yeS5tZXRhZGF0YSxcbiAgICAgICAgICBhZ2VudF9pZDogbWVtb3J5Lm1ldGFkYXRhLmFnZW50SWQsXG4gICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUobWVtb3J5Lm1ldGFkYXRhLnRpbWVzdGFtcCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBzdG9yZSBpbiBTdXBhYmFzZScsIHsgZXJyb3IgfSwgJ3JhZy1tZW1vcnknKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1N1cGFiYXNlIHN0b3JhZ2UgZXJyb3InLCB7IGVycm9yIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlY3RvciBzZWFyY2ggdXNpbmcgU3VwYWJhc2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdmVjdG9yU2VhcmNoKHF1ZXJ5OiBSQUdRdWVyeSk6IFByb21pc2U8TWVtb3J5RG9jdW1lbnRbXT4ge1xuICAgIGlmICghdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHRoaXMubG9jYWxTZW1hbnRpY1NlYXJjaChxdWVyeSk7XG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeUVtYmVkZGluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcocXVlcnkucXVlcnkpO1xuICAgICAgXG4gICAgICAvLyBCdWlsZCB0aGUgUlBDIGNhbGxcbiAgICAgIGxldCBycGNRdWVyeSA9IHRoaXMuc3VwYWJhc2UucnBjKCdtYXRjaF9tZW1vcmllcycsIHtcbiAgICAgICAgcXVlcnlfZW1iZWRkaW5nOiBxdWVyeUVtYmVkZGluZyxcbiAgICAgICAgbWF0Y2hfdGhyZXNob2xkOiAwLjcsXG4gICAgICAgIG1hdGNoX2NvdW50OiBxdWVyeS50b3BLIHx8IDIwXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgZmlsdGVyc1xuICAgICAgaWYgKHF1ZXJ5LmFnZW50SWQpIHtcbiAgICAgICAgcnBjUXVlcnkgPSBycGNRdWVyeS5lcSgnYWdlbnRfaWQnLCBxdWVyeS5hZ2VudElkKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHF1ZXJ5LmZpbHRlcnM/LmNvbnRlbnRUeXBlcykge1xuICAgICAgICBycGNRdWVyeSA9IHJwY1F1ZXJ5LmluKCdjb250ZW50X3R5cGUnLCBxdWVyeS5maWx0ZXJzLmNvbnRlbnRUeXBlcyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHJwY1F1ZXJ5O1xuICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1ZlY3RvciBzZWFyY2ggZmFpbGVkJywgeyBlcnJvciB9LCAncmFnLW1lbW9yeScpO1xuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbFNlbWFudGljU2VhcmNoKHF1ZXJ5KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGRhdGEubWFwKChyb3c6IGFueSkgPT4gKHtcbiAgICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgICAgY29udGVudDogcm93LmNvbnRlbnQsXG4gICAgICAgIGNvbnRlbnRUeXBlOiByb3cuY29udGVudF90eXBlLFxuICAgICAgICBlbWJlZGRpbmc6IHJvdy5lbWJlZGRpbmcsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgLi4ucm93Lm1ldGFkYXRhLFxuICAgICAgICAgIHJlbGV2YW5jZVNjb3JlOiByb3cuc2ltaWxhcml0eVxuICAgICAgICB9XG4gICAgICB9KSk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1ZlY3RvciBzZWFyY2ggZXJyb3InLCB7IGVycm9yIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgICByZXR1cm4gdGhpcy5sb2NhbFNlbWFudGljU2VhcmNoKHF1ZXJ5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9jYWwgc2VtYW50aWMgc2VhcmNoIChmYWxsYmFjaylcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9jYWxTZW1hbnRpY1NlYXJjaChxdWVyeTogUkFHUXVlcnkpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHtcbiAgICBjb25zdCBxdWVyeUVtYmVkZGluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVFbWJlZGRpbmcocXVlcnkucXVlcnkpO1xuICAgIFxuICAgIC8vIEZpbHRlciBtZW1vcmllc1xuICAgIGxldCBmaWx0ZXJlZE1lbW9yaWVzID0gQXJyYXkuZnJvbSh0aGlzLm1lbW9yaWVzLnZhbHVlcygpKTtcbiAgICBcbiAgICBpZiAocXVlcnkuYWdlbnRJZCkge1xuICAgICAgZmlsdGVyZWRNZW1vcmllcyA9IGZpbHRlcmVkTWVtb3JpZXMuZmlsdGVyKG0gPT4gbS5tZXRhZGF0YS5hZ2VudElkID09PSBxdWVyeS5hZ2VudElkKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHF1ZXJ5LmZpbHRlcnMpIHtcbiAgICAgIGZpbHRlcmVkTWVtb3JpZXMgPSB0aGlzLmFwcGx5RmlsdGVycyhmaWx0ZXJlZE1lbW9yaWVzLCBxdWVyeS5maWx0ZXJzKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHNpbWlsYXJpdHkgc2NvcmVzXG4gICAgY29uc3Qgc2NvcmVkTWVtb3JpZXMgPSBmaWx0ZXJlZE1lbW9yaWVzLm1hcChtZW1vcnkgPT4gKHtcbiAgICAgIG1lbW9yeSxcbiAgICAgIHNjb3JlOiB0aGlzLmNvc2luZVNpbWlsYXJpdHkocXVlcnlFbWJlZGRpbmcsIG1lbW9yeS5lbWJlZGRpbmcgfHwgW10pXG4gICAgfSkpO1xuICAgIFxuICAgIC8vIFNvcnQgYnkgcmVsZXZhbmNlXG4gICAgc2NvcmVkTWVtb3JpZXMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICAgIFxuICAgIHJldHVybiBzY29yZWRNZW1vcmllcy5tYXAoKHsgbWVtb3J5LCBzY29yZSB9KSA9PiAoe1xuICAgICAgLi4ubWVtb3J5LFxuICAgICAgbWV0YWRhdGE6IHsgLi4ubWVtb3J5Lm1ldGFkYXRhLCByZWxldmFuY2VTY29yZTogc2NvcmUgfVxuICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWdlbnQgZXhwZXJ0aXNlIHNjb3JlIGZvciByZXJhbmtpbmdcbiAgICovXG4gIHByaXZhdGUgZ2V0QWdlbnRFeHBlcnRpc2VTY29yZShhZ2VudElkOiBzdHJpbmcsIHF1ZXJ5OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IGV4cGVydGlzZTogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgJ2VuaGFuY2VkLW1hcmN1cyc6IFsnYmFja2VuZCcsICdhcGknLCAnZGF0YWJhc2UnLCAndHlwZXNjcmlwdCddLFxuICAgICAgJ2VuaGFuY2VkLWphbWVzJzogWydmcm9udGVuZCcsICd1aScsICdyZWFjdCcsICdjc3MnXSxcbiAgICAgICdlbmhhbmNlZC1tYXJpYSc6IFsndGVzdGluZycsICdxYScsICdxdWFsaXR5JywgJ2NvdmVyYWdlJ10sXG4gICAgICAnc2VjdXJpdHktc2FtJzogWydzZWN1cml0eScsICd2dWxuZXJhYmlsaXR5JywgJ2F1dGhlbnRpY2F0aW9uJ10sXG4gICAgICAnYXJjaGl0ZWN0dXJlLWRhbic6IFsnYXJjaGl0ZWN0dXJlJywgJ2Rlc2lnbicsICdwYXR0ZXJucycsICdzdHJ1Y3R1cmUnXSxcbiAgICAgICdkci1haS1tbCc6IFsnbWwnLCAnYWknLCAnb3B0aW1pemF0aW9uJywgJ3BlcmZvcm1hbmNlJ11cbiAgICB9O1xuICAgIFxuICAgIGNvbnN0IGFnZW50S2V5d29yZHMgPSBleHBlcnRpc2VbYWdlbnRJZF0gfHwgW107XG4gICAgY29uc3QgcXVlcnlMb3dlciA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgXG4gICAgbGV0IHNjb3JlID0gMDtcbiAgICBhZ2VudEtleXdvcmRzLmZvckVhY2goa2V5d29yZCA9PiB7XG4gICAgICBpZiAocXVlcnlMb3dlci5pbmNsdWRlcyhrZXl3b3JkKSkgc2NvcmUgKz0gMC4yNTtcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gTWF0aC5taW4oMSwgc2NvcmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHByb2plY3QgY29udGV4dCBmb3IgcmVyYW5raW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldFByb2plY3RDb250ZXh0KCk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gVHJ5IHRvIGdldCBmcm9tIGVudmlyb25tZW50IHNjYW5uZXIgaWYgYXZhaWxhYmxlXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNjYW5uZXIgPSByZXF1aXJlKCcuLi9lbnZpcm9ubWVudC9lbnZpcm9ubWVudC1zY2FubmVyJykuZW52aXJvbm1lbnRTY2FubmVyO1xuICAgICAgcmV0dXJuIHNjYW5uZXIuZ2V0TGF0ZXN0U2NhbigpPy50ZWNobm9sb2d5O1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuc3VyZSB2ZWN0b3IgdGFibGUgZXhpc3RzIGluIFN1cGFiYXNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZVZlY3RvclRhYmxlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFRoaXMgd291bGQgYmUgcnVuIHZpYSBtaWdyYXRpb24sIGJ1dCBpbmNsdWRlZCBmb3IgcmVmZXJlbmNlXG4gICAgY29uc3QgY3JlYXRlVGFibGVTUUwgPSBgXG4gICAgICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB2ZXJzYXRpbF9tZW1vcmllcyAoXG4gICAgICAgIGlkIFVVSUQgUFJJTUFSWSBLRVkgREVGQVVMVCBnZW5fcmFuZG9tX3V1aWQoKSxcbiAgICAgICAgY29udGVudCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBjb250ZW50X3R5cGUgVkFSQ0hBUig1MCkgREVGQVVMVCAndGV4dCcsXG4gICAgICAgIGVtYmVkZGluZyB2ZWN0b3IoMTUzNiksXG4gICAgICAgIG1ldGFkYXRhIEpTT05CIERFRkFVTFQgJ3t9JyxcbiAgICAgICAgYWdlbnRfaWQgVEVYVCxcbiAgICAgICAgY3JlYXRlZF9hdCBUSU1FU1RBTVAgREVGQVVMVCBOT1coKSxcbiAgICAgICAgdXBkYXRlZF9hdCBUSU1FU1RBTVAgREVGQVVMVCBOT1coKVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X21lbW9yaWVzX2VtYmVkZGluZyBcbiAgICAgIE9OIHZlcnNhdGlsX21lbW9yaWVzIFVTSU5HIGl2ZmZsYXQgKGVtYmVkZGluZyB2ZWN0b3JfY29zaW5lX29wcylcbiAgICAgIFdJVEggKGxpc3RzID0gMTAwKTtcbiAgICAgIFxuICAgICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X21lbW9yaWVzX2FnZW50IFxuICAgICAgT04gdmVyc2F0aWxfbWVtb3JpZXMoYWdlbnRfaWQpO1xuICAgICAgXG4gICAgICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfbWVtb3JpZXNfY29udGVudF90eXBlIFxuICAgICAgT04gdmVyc2F0aWxfbWVtb3JpZXMoY29udGVudF90eXBlKTtcbiAgICBgO1xuICB9XG5cbiAgLy8gLi4uIChrZWVwIG90aGVyIHV0aWxpdHkgbWV0aG9kcyBmcm9tIG9yaWdpbmFsKVxuXG4gIC8qKlxuICAgKiBTdG9yZSBkaWFncmFtIG9yIHZpc3VhbCBjb250ZW50XG4gICAqL1xuICBhc3luYyBzdG9yZURpYWdyYW0oY29udGVudDogc3RyaW5nLCBkaWFncmFtRGF0YTogc3RyaW5nLCBtZXRhZGF0YTogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZU1lbW9yeSh7XG4gICAgICBjb250ZW50LFxuICAgICAgY29udGVudFR5cGU6ICdkaWFncmFtJyxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIC4uLm1ldGFkYXRhLFxuICAgICAgICBpbWFnZURhdGE6IGRpYWdyYW1EYXRhLFxuICAgICAgICBtaW1lVHlwZTogJ2ltYWdlL3N2Zyt4bWwnXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgY29kZSB3aXRoIHN5bnRheCBoaWdobGlnaHRpbmcgbWV0YWRhdGFcbiAgICovXG4gIGFzeW5jIHN0b3JlQ29kZShjb2RlOiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIG1ldGFkYXRhOiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLnN0b3JlTWVtb3J5KHtcbiAgICAgIGNvbnRlbnQ6IGNvZGUsXG4gICAgICBjb250ZW50VHlwZTogJ2NvZGUnLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICAgIGxhbmd1YWdlLFxuICAgICAgICBmaWxlVHlwZTogbGFuZ3VhZ2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBlbWJlZGRpbmcgKHdpdGggQVBJIGludGVncmF0aW9uIHN1cHBvcnQpXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlRW1iZWRkaW5nKHRleHQ6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyW10+IHtcbiAgICAvLyBDaGVjayBmb3IgT3BlbkFJIEFQSSBrZXlcbiAgICBpZiAocHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRPRE86IEludGVncmF0ZSB3aXRoIE9wZW5BSSBlbWJlZGRpbmdzIEFQSVxuICAgICAgICAvLyBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5haS5lbWJlZGRpbmdzLmNyZWF0ZSh7XG4gICAgICAgIC8vICAgbW9kZWw6IFwidGV4dC1lbWJlZGRpbmctMy1zbWFsbFwiLFxuICAgICAgICAvLyAgIGlucHV0OiB0ZXh0LFxuICAgICAgICAvLyB9KTtcbiAgICAgICAgLy8gcmV0dXJuIHJlc3BvbnNlLmRhdGFbMF0uZW1iZWRkaW5nO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybignT3BlbkFJIGVtYmVkZGluZyBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrJywgeyBlcnJvciB9LCAncmFnLW1lbW9yeScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIHNpbXBsZSBlbWJlZGRpbmdcbiAgICBjb25zdCBlbWJlZGRpbmcgPSBBcnJheSh0aGlzLmNvbmZpZy5lbWJlZGRpbmdEaW1lbnNpb24pLmZpbGwoMCkubWFwKCgpID0+IE1hdGgucmFuZG9tKCkpO1xuICAgIGNvbnN0IG5vcm0gPSBNYXRoLnNxcnQoZW1iZWRkaW5nLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCAqIHZhbCwgMCkpO1xuICAgIHJldHVybiBlbWJlZGRpbmcubWFwKHZhbCA9PiB2YWwgLyBub3JtKTtcbiAgfVxuXG4gIC8vIE1pc3NpbmcgbWV0aG9kIGltcGxlbWVudGF0aW9uc1xuICBwcml2YXRlIGFzeW5jIGxvYWRFeGlzdGluZ01lbW9yaWVzKCk6IFByb21pc2U8dm9pZD4ge31cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1lbW9yeUlkKGRvYz86IGFueSk6IHN0cmluZyB7IHJldHVybiBgbWVtLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpfWA7IH1cbiAgcHJpdmF0ZSBhc3luYyBwZXJzaXN0TWVtb3J5KGRvYzogTWVtb3J5RG9jdW1lbnQpOiBQcm9taXNlPHZvaWQ+IHt9XG4gIHByaXZhdGUgYXBwbHlGaWx0ZXJzKGRvY3VtZW50czogTWVtb3J5RG9jdW1lbnRbXSwgZmlsdGVyczogYW55KTogTWVtb3J5RG9jdW1lbnRbXSB7IHJldHVybiBkb2N1bWVudHM7IH1cbiAgcHJpdmF0ZSBjb3NpbmVTaW1pbGFyaXR5KHZlYzE6IG51bWJlcltdLCB2ZWMyOiBudW1iZXJbXSk6IG51bWJlciB7XG4gICAgcmV0dXJuIHZlYzEucmVkdWNlKChzdW0sIHZhbCwgaSkgPT4gc3VtICsgdmFsICogKHZlYzJbaV0gfHwgMCksIDApO1xuICB9XG4gIGFzeW5jIGdldEFsbE1lbW9yaWVzKCk6IFByb21pc2U8TWVtb3J5RG9jdW1lbnRbXT4geyByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLm1lbW9yaWVzLnZhbHVlcygpKTsgfVxuICBhc3luYyBzZWFyY2hNZW1vcmllcyhxdWVyeTogc3RyaW5nIHwgUkFHUXVlcnksIG9wdGlvbnM/OiBhbnkpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMucXVlcnlNZW1vcmllc0ludGVybmFsKHR5cGVvZiBxdWVyeSA9PT0gJ3N0cmluZycgPyB7IHF1ZXJ5IH0gOiBxdWVyeSk7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocmVzdWx0cykgPyByZXN1bHRzIDogKHJlc3VsdHMuZG9jdW1lbnRzIHx8IFtdKTtcbiAgfVxuICBhc3luYyBxdWVyeU1lbW9yaWVzKHF1ZXJ5OiBzdHJpbmcgfCBSQUdRdWVyeSk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucXVlcnlNZW1vcmllc0ludGVybmFsKHR5cGVvZiBxdWVyeSA9PT0gJ3N0cmluZycgPyB7IHF1ZXJ5IH0gOiBxdWVyeSk7XG4gIH1cbiAgYXN5bmMgY2xvc2UoKTogUHJvbWlzZTx2b2lkPiB7fVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQUdFTlQtU1BFQ0lGSUMgUkFHIE1FVEhPRFMgV0lUSCBFREdFIEZVTkNUSU9OIElOVEVHUkFUSU9OXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogRW5oYW5jZWQgTWFyaWEgKFFBKSBSQUcgcXVlcnkgdXNpbmcgZWRnZSBmdW5jdGlvbnNcbiAgICovXG4gIGFzeW5jIG1hcmlhUkFHKHF1ZXJ5OiBzdHJpbmcsIGNvbnRleHQ6IGFueSwgY29uZmlnPzogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoIXRoaXMuZWRnZUZ1bmN0aW9uc0VuYWJsZWQgfHwgIXRoaXMuc3VwYWJhc2VVcmwpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsIHByb2Nlc3NpbmdcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsTWFyaWFSQUcocXVlcnksIGNvbnRleHQsIGNvbmZpZyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5zdXBhYmFzZVVybH0vZnVuY3Rpb25zL3YxL21hcmlhLXJhZ2AsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3Byb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05fS0VZfWAsXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcXVlcnksIGNvbnRleHQsIGNvbmZpZyB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTWFyaWEgUkFHIGVkZ2UgZnVuY3Rpb24gZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyBhbnk7XG5cbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5lcnJvciB8fCAnTWFyaWEgUkFHIHByb2Nlc3NpbmcgZmFpbGVkJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ01hcmlhIFJBRyBlZGdlIGZ1bmN0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgc2ltaWxhclBhdHRlcm5zOiByZXN1bHQuZGF0YT8ucmFnSW5zaWdodHM/LnNpbWlsYXJQYXR0ZXJucyB8fCAwLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmVzdWx0Lm1ldGFkYXRhPy5wcm9jZXNzaW5nVGltZSB8fCAwXG4gICAgICB9LCAnbWFyaWEtcmFnJyk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignTWFyaWEgUkFHIGVkZ2UgZnVuY3Rpb24gZmFpbGVkLCB1c2luZyBmYWxsYmFjaycsIHsgZXJyb3IgfSwgJ21hcmlhLXJhZycpO1xuICAgICAgcmV0dXJuIHRoaXMubG9jYWxNYXJpYVJBRyhxdWVyeSwgY29udGV4dCwgY29uZmlnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5oYW5jZWQgSmFtZXMgKEZyb250ZW5kKSBSQUcgcXVlcnkgdXNpbmcgZWRnZSBmdW5jdGlvbnNcbiAgICovXG4gIGFzeW5jIGphbWVzUkFHKHF1ZXJ5OiBzdHJpbmcsIGNvbnRleHQ6IGFueSwgY29uZmlnPzogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoIXRoaXMuZWRnZUZ1bmN0aW9uc0VuYWJsZWQgfHwgIXRoaXMuc3VwYWJhc2VVcmwpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsIHByb2Nlc3NpbmdcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsSmFtZXNSQUcocXVlcnksIGNvbnRleHQsIGNvbmZpZyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5zdXBhYmFzZVVybH0vZnVuY3Rpb25zL3YxL2phbWVzLXJhZ2AsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3Byb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05fS0VZfWAsXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcXVlcnksIGNvbnRleHQsIGNvbmZpZyB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSmFtZXMgUkFHIGVkZ2UgZnVuY3Rpb24gZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyBhbnk7XG5cbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5lcnJvciB8fCAnSmFtZXMgUkFHIHByb2Nlc3NpbmcgZmFpbGVkJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0phbWVzIFJBRyBlZGdlIGZ1bmN0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgY29tcG9uZW50UGF0dGVybnM6IHJlc3VsdC5kYXRhPy5yYWdJbnNpZ2h0cz8uY29tcG9uZW50UGF0dGVybnMgfHwgMCxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJlc3VsdC5tZXRhZGF0YT8ucHJvY2Vzc2luZ1RpbWUgfHwgMFxuICAgICAgfSwgJ2phbWVzLXJhZycpO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0phbWVzIFJBRyBlZGdlIGZ1bmN0aW9uIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2snLCB7IGVycm9yIH0sICdqYW1lcy1yYWcnKTtcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsSmFtZXNSQUcocXVlcnksIGNvbnRleHQsIGNvbmZpZyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuaGFuY2VkIE1hcmN1cyAoQmFja2VuZCkgUkFHIHF1ZXJ5IHVzaW5nIGVkZ2UgZnVuY3Rpb25zXG4gICAqL1xuICBhc3luYyBtYXJjdXNSQUcocXVlcnk6IHN0cmluZywgY29udGV4dDogYW55LCBjb25maWc/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIGlmICghdGhpcy5lZGdlRnVuY3Rpb25zRW5hYmxlZCB8fCAhdGhpcy5zdXBhYmFzZVVybCkge1xuICAgICAgLy8gRmFsbGJhY2sgdG8gbG9jYWwgcHJvY2Vzc2luZ1xuICAgICAgcmV0dXJuIHRoaXMubG9jYWxNYXJjdXNSQUcocXVlcnksIGNvbnRleHQsIGNvbmZpZyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5zdXBhYmFzZVVybH0vZnVuY3Rpb25zL3YxL21hcmN1cy1yYWdgLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtwcm9jZXNzLmVudi5TVVBBQkFTRV9BTk9OX0tFWX1gLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHF1ZXJ5LCBjb250ZXh0LCBjb25maWcgfSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1hcmN1cyBSQUcgZWRnZSBmdW5jdGlvbiBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpIGFzIGFueTtcblxuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yIHx8ICdNYXJjdXMgUkFHIHByb2Nlc3NpbmcgZmFpbGVkJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ01hcmN1cyBSQUcgZWRnZSBmdW5jdGlvbiBjb21wbGV0ZWQnLCB7XG4gICAgICAgIGFwaVBhdHRlcm5zOiByZXN1bHQuZGF0YT8ucmFnSW5zaWdodHM/LmFwaVBhdHRlcm5zIHx8IDAsXG4gICAgICAgIHNlY3VyaXR5U29sdXRpb25zOiByZXN1bHQuZGF0YT8ucmFnSW5zaWdodHM/LnNlY3VyaXR5U29sdXRpb25zIHx8IDAsXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiByZXN1bHQubWV0YWRhdGE/LnByb2Nlc3NpbmdUaW1lIHx8IDBcbiAgICAgIH0sICdtYXJjdXMtcmFnJyk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignTWFyY3VzIFJBRyBlZGdlIGZ1bmN0aW9uIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2snLCB7IGVycm9yIH0sICdtYXJjdXMtcmFnJyk7XG4gICAgICByZXR1cm4gdGhpcy5sb2NhbE1hcmN1c1JBRyhxdWVyeSwgY29udGV4dCwgY29uZmlnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmFsbGJhY2sgbG9jYWwgTWFyaWEgUkFHIHByb2Nlc3NpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9jYWxNYXJpYVJBRyhxdWVyeTogc3RyaW5nLCBjb250ZXh0OiBhbnksIGNvbmZpZz86IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgcmFnUXVlcnk6IFJBR1F1ZXJ5ID0ge1xuICAgICAgcXVlcnk6IGBRQSB0ZXN0aW5nIHBhdHRlcm5zICR7cXVlcnl9YCxcbiAgICAgIHF1ZXJ5VHlwZTogJ3NlbWFudGljJyxcbiAgICAgIGFnZW50SWQ6ICdlbmhhbmNlZC1tYXJpYScsXG4gICAgICB0b3BLOiBjb25maWc/Lm1heEV4YW1wbGVzIHx8IDMsXG4gICAgICBmaWx0ZXJzOiB7XG4gICAgICAgIHRhZ3M6IFsndGVzdCcsICdxYScsICd0ZXN0aW5nJ10sXG4gICAgICAgIGNvbnRlbnRUeXBlczogWydjb2RlJywgJ3RleHQnXVxuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5xdWVyeU1lbW9yaWVzSW50ZXJuYWwocmFnUXVlcnkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICB0ZXN0UGF0dGVybnM6IHJlc3VsdHMuZG9jdW1lbnRzLFxuICAgICAgICBxYUJlc3RQcmFjdGljZXM6IFtdLFxuICAgICAgICBwcm9qZWN0U3RhbmRhcmRzOiBbXSxcbiAgICAgICAgcmFnSW5zaWdodHM6IHtcbiAgICAgICAgICBzaW1pbGFyUGF0dGVybnM6IHJlc3VsdHMuZG9jdW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICBwcm9qZWN0U3RhbmRhcmRzOiAwLFxuICAgICAgICAgIGV4cGVydGlzZTogMCxcbiAgICAgICAgICBhdmdTaW1pbGFyaXR5OiByZXN1bHRzLmRvY3VtZW50cy5yZWR1Y2UoKHN1bSwgZG9jKSA9PiBzdW0gKyAoZG9jLm1ldGFkYXRhLnJlbGV2YW5jZVNjb3JlIHx8IDApLCAwKSAvIHJlc3VsdHMuZG9jdW1lbnRzLmxlbmd0aFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgYWdlbnRJZDogJ2VuaGFuY2VkLW1hcmlhJyxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IHJlc3VsdHMucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgIHF1ZXJ5VHlwZTogJ2xvY2FsLWZhbGxiYWNrJ1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRmFsbGJhY2sgbG9jYWwgSmFtZXMgUkFHIHByb2Nlc3NpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9jYWxKYW1lc1JBRyhxdWVyeTogc3RyaW5nLCBjb250ZXh0OiBhbnksIGNvbmZpZz86IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgcmFnUXVlcnk6IFJBR1F1ZXJ5ID0ge1xuICAgICAgcXVlcnk6IGBGcm9udGVuZCBjb21wb25lbnQgcGF0dGVybnMgJHtxdWVyeX1gLFxuICAgICAgcXVlcnlUeXBlOiAnc2VtYW50aWMnLFxuICAgICAgYWdlbnRJZDogJ2VuaGFuY2VkLWphbWVzJyxcbiAgICAgIHRvcEs6IGNvbmZpZz8ubWF4RXhhbXBsZXMgfHwgMyxcbiAgICAgIGZpbHRlcnM6IHtcbiAgICAgICAgdGFnczogWydmcm9udGVuZCcsICdjb21wb25lbnQnLCAndWknXSxcbiAgICAgICAgY29udGVudFR5cGVzOiBbJ2NvZGUnXVxuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5xdWVyeU1lbW9yaWVzSW50ZXJuYWwocmFnUXVlcnkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBjb21wb25lbnRQYXR0ZXJuczogcmVzdWx0cy5kb2N1bWVudHMsXG4gICAgICAgIHVpUGF0dGVybnM6IFtdLFxuICAgICAgICBwZXJmb3JtYW5jZVBhdHRlcm5zOiBbXSxcbiAgICAgICAgcmFnSW5zaWdodHM6IHtcbiAgICAgICAgICBjb21wb25lbnRQYXR0ZXJuczogcmVzdWx0cy5kb2N1bWVudHMubGVuZ3RoLFxuICAgICAgICAgIHVpUGF0dGVybnM6IDAsXG4gICAgICAgICAgcGVyZm9ybWFuY2VPcHRpbWl6YXRpb25zOiAwLFxuICAgICAgICAgIGF2Z1NpbWlsYXJpdHk6IHJlc3VsdHMuZG9jdW1lbnRzLnJlZHVjZSgoc3VtLCBkb2MpID0+IHN1bSArIChkb2MubWV0YWRhdGEucmVsZXZhbmNlU2NvcmUgfHwgMCksIDApIC8gcmVzdWx0cy5kb2N1bWVudHMubGVuZ3RoXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBhZ2VudElkOiAnZW5oYW5jZWQtamFtZXMnLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmVzdWx0cy5wcm9jZXNzaW5nVGltZSxcbiAgICAgICAgcXVlcnlUeXBlOiAnbG9jYWwtZmFsbGJhY2snXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGYWxsYmFjayBsb2NhbCBNYXJjdXMgUkFHIHByb2Nlc3NpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9jYWxNYXJjdXNSQUcocXVlcnk6IHN0cmluZywgY29udGV4dDogYW55LCBjb25maWc/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHJhZ1F1ZXJ5OiBSQUdRdWVyeSA9IHtcbiAgICAgIHF1ZXJ5OiBgQmFja2VuZCBBUEkgcGF0dGVybnMgJHtxdWVyeX1gLFxuICAgICAgcXVlcnlUeXBlOiAnc2VtYW50aWMnLFxuICAgICAgYWdlbnRJZDogJ2VuaGFuY2VkLW1hcmN1cycsXG4gICAgICB0b3BLOiBjb25maWc/Lm1heEV4YW1wbGVzIHx8IDMsXG4gICAgICBmaWx0ZXJzOiB7XG4gICAgICAgIHRhZ3M6IFsnYmFja2VuZCcsICdhcGknLCAnc2VjdXJpdHknXSxcbiAgICAgICAgY29udGVudFR5cGVzOiBbJ2NvZGUnXVxuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5xdWVyeU1lbW9yaWVzSW50ZXJuYWwocmFnUXVlcnkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBhcGlQYXR0ZXJuczogcmVzdWx0cy5kb2N1bWVudHMsXG4gICAgICAgIHNlY3VyaXR5UGF0dGVybnM6IFtdLFxuICAgICAgICBwZXJmb3JtYW5jZVBhdHRlcm5zOiBbXSxcbiAgICAgICAgZGF0YWJhc2VPcHRpbWl6YXRpb25zOiBbXSxcbiAgICAgICAgcmFnSW5zaWdodHM6IHtcbiAgICAgICAgICBhcGlQYXR0ZXJuczogcmVzdWx0cy5kb2N1bWVudHMubGVuZ3RoLFxuICAgICAgICAgIHNlY3VyaXR5U29sdXRpb25zOiAwLFxuICAgICAgICAgIHBlcmZvcm1hbmNlT3B0aW1pemF0aW9uczogMCxcbiAgICAgICAgICBkYXRhYmFzZU9wdGltaXphdGlvbnM6IDAsXG4gICAgICAgICAgYXZnU2ltaWxhcml0eTogcmVzdWx0cy5kb2N1bWVudHMucmVkdWNlKChzdW0sIGRvYykgPT4gc3VtICsgKGRvYy5tZXRhZGF0YS5yZWxldmFuY2VTY29yZSB8fCAwKSwgMCkgLyByZXN1bHRzLmRvY3VtZW50cy5sZW5ndGhcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGFnZW50SWQ6ICdlbmhhbmNlZC1tYXJjdXMnLFxuICAgICAgICBwcm9jZXNzaW5nVGltZTogcmVzdWx0cy5wcm9jZXNzaW5nVGltZSxcbiAgICAgICAgcXVlcnlUeXBlOiAnbG9jYWwtZmFsbGJhY2snXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBhZ2VudC1zcGVjaWZpYyBwYXR0ZXJucyBpbiBlbmhhbmNlZCBzY2hlbWFcbiAgICovXG4gIGFzeW5jIHN0b3JlQWdlbnRQYXR0ZXJuKGFnZW50TmFtZTogc3RyaW5nLCBwYXR0ZXJuOiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCkge1xuICAgICAgLy8gRmFsbGJhY2sgdG8gbG9jYWwgc3RvcmFnZVxuICAgICAgcmV0dXJuIHRoaXMuc3RvcmVNZW1vcnkoe1xuICAgICAgICBjb250ZW50OiBwYXR0ZXJuLmNvZGVfY29udGVudCB8fCBwYXR0ZXJuLmNvbnRlbnQsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnY29kZScsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgYWdlbnRJZDogYWdlbnROYW1lLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICB0YWdzOiBwYXR0ZXJuLnRhZ3MgfHwgW10sXG4gICAgICAgICAgLi4ucGF0dGVybi5tZXRhZGF0YVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuICAgICAgICAuZnJvbSgnYWdlbnRfY29kZV9wYXR0ZXJucycpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIGFnZW50X25hbWU6IGFnZW50TmFtZSxcbiAgICAgICAgICBwYXR0ZXJuX3R5cGU6IHBhdHRlcm4ucGF0dGVybl90eXBlIHx8ICd1bmtub3duJyxcbiAgICAgICAgICBjb2RlX2NvbnRlbnQ6IHBhdHRlcm4uY29kZV9jb250ZW50IHx8IHBhdHRlcm4uY29udGVudCxcbiAgICAgICAgICBmaWxlX3BhdGg6IHBhdHRlcm4uZmlsZV9wYXRoLFxuICAgICAgICAgIGxhbmd1YWdlOiBwYXR0ZXJuLmxhbmd1YWdlLFxuICAgICAgICAgIGZyYW1ld29yazogcGF0dGVybi5mcmFtZXdvcmssXG4gICAgICAgICAgcXVhbGl0eV9zY29yZTogcGF0dGVybi5xdWFsaXR5X3Njb3JlIHx8IDgwLFxuICAgICAgICAgIG1ldGFkYXRhOiBwYXR0ZXJuLm1ldGFkYXRhIHx8IHt9LFxuICAgICAgICAgIHRhZ3M6IHBhdHRlcm4udGFncyB8fCBbXVxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0FnZW50IHBhdHRlcm4gc3RvcmVkIGluIGVuaGFuY2VkIHNjaGVtYScsIHtcbiAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICBwYXR0ZXJuVHlwZTogcGF0dGVybi5wYXR0ZXJuX3R5cGUsXG4gICAgICAgIGlkOiBkYXRhLmlkXG4gICAgICB9LCAncmFnLW1lbW9yeScpO1xuXG4gICAgICByZXR1cm4gZGF0YS5pZDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHN0b3JlIGFnZW50IHBhdHRlcm4nLCB7IGVycm9yLCBhZ2VudE5hbWUgfSwgJ3JhZy1tZW1vcnknKTtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsIHN0b3JhZ2VcbiAgICAgIHJldHVybiB0aGlzLnN0b3JlTWVtb3J5KHtcbiAgICAgICAgY29udGVudDogcGF0dGVybi5jb2RlX2NvbnRlbnQgfHwgcGF0dGVybi5jb250ZW50LFxuICAgICAgICBjb250ZW50VHlwZTogJ2NvZGUnLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGFnZW50SWQ6IGFnZW50TmFtZSxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgdGFnczogcGF0dGVybi50YWdzIHx8IFtdLFxuICAgICAgICAgIC4uLnBhdHRlcm4ubWV0YWRhdGFcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGFnZW50IHNvbHV0aW9ucyBpbiBlbmhhbmNlZCBzY2hlbWFcbiAgICovXG4gIGFzeW5jIHN0b3JlQWdlbnRTb2x1dGlvbihhZ2VudE5hbWU6IHN0cmluZywgc29sdXRpb246IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLmlzU3VwYWJhc2VFbmFibGVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9yZU1lbW9yeSh7XG4gICAgICAgIGNvbnRlbnQ6IHNvbHV0aW9uLnNvbHV0aW9uX2NvZGUgfHwgc29sdXRpb24uY29udGVudCxcbiAgICAgICAgY29udGVudFR5cGU6ICdjb2RlJyxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBhZ2VudElkOiBhZ2VudE5hbWUsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIHByb2JsZW1UeXBlOiBzb2x1dGlvbi5wcm9ibGVtX3R5cGUsXG4gICAgICAgICAgLi4uc29sdXRpb24ubWV0YWRhdGFcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2FnZW50X3NvbHV0aW9ucycpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIGFnZW50X25hbWU6IGFnZW50TmFtZSxcbiAgICAgICAgICBwcm9ibGVtX3R5cGU6IHNvbHV0aW9uLnByb2JsZW1fdHlwZSxcbiAgICAgICAgICBwcm9ibGVtX2Rlc2NyaXB0aW9uOiBzb2x1dGlvbi5wcm9ibGVtX2Rlc2NyaXB0aW9uLFxuICAgICAgICAgIHNvbHV0aW9uX2NvZGU6IHNvbHV0aW9uLnNvbHV0aW9uX2NvZGUsXG4gICAgICAgICAgc29sdXRpb25fZXhwbGFuYXRpb246IHNvbHV0aW9uLnNvbHV0aW9uX2V4cGxhbmF0aW9uLFxuICAgICAgICAgIGVmZmVjdGl2ZW5lc3Nfc2NvcmU6IHNvbHV0aW9uLmVmZmVjdGl2ZW5lc3Nfc2NvcmUgfHwgMC44LFxuICAgICAgICAgIGRlcGVuZGVuY2llczogc29sdXRpb24uZGVwZW5kZW5jaWVzIHx8IFtdLFxuICAgICAgICAgIGNvbXBhdGliaWxpdHk6IHNvbHV0aW9uLmNvbXBhdGliaWxpdHkgfHwge31cbiAgICAgICAgfSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdBZ2VudCBzb2x1dGlvbiBzdG9yZWQgaW4gZW5oYW5jZWQgc2NoZW1hJywge1xuICAgICAgICBhZ2VudE5hbWUsXG4gICAgICAgIHByb2JsZW1UeXBlOiBzb2x1dGlvbi5wcm9ibGVtX3R5cGUsXG4gICAgICAgIGlkOiBkYXRhLmlkXG4gICAgICB9LCAncmFnLW1lbW9yeScpO1xuXG4gICAgICByZXR1cm4gZGF0YS5pZDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHN0b3JlIGFnZW50IHNvbHV0aW9uJywgeyBlcnJvciwgYWdlbnROYW1lIH0sICdyYWctbWVtb3J5Jyk7XG4gICAgICByZXR1cm4gdGhpcy5zdG9yZU1lbW9yeSh7XG4gICAgICAgIGNvbnRlbnQ6IHNvbHV0aW9uLnNvbHV0aW9uX2NvZGUgfHwgc29sdXRpb24uY29udGVudCxcbiAgICAgICAgY29udGVudFR5cGU6ICdjb2RlJyxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBhZ2VudElkOiBhZ2VudE5hbWUsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIHByb2JsZW1UeXBlOiBzb2x1dGlvbi5wcm9ibGVtX3R5cGUsXG4gICAgICAgICAgLi4uc29sdXRpb24ubWV0YWRhdGFcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwcm9kdWN0aW9uIGRlcGxveW1lbnQgc3RhdHVzXG4gICAqL1xuICBnZXRQcm9kdWN0aW9uU3RhdHVzKCk6IHtcbiAgICBzdXBhYmFzZUVuYWJsZWQ6IGJvb2xlYW47XG4gICAgZWRnZUZ1bmN0aW9uc0VuYWJsZWQ6IGJvb2xlYW47XG4gICAgYWdlbnRSQUdBdmFpbGFibGU6IGJvb2xlYW47XG4gICAgZW5oYW5jZWRTY2hlbWFSZWFkeTogYm9vbGVhbjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1cGFiYXNlRW5hYmxlZDogdGhpcy5pc1N1cGFiYXNlRW5hYmxlZCxcbiAgICAgIGVkZ2VGdW5jdGlvbnNFbmFibGVkOiB0aGlzLmVkZ2VGdW5jdGlvbnNFbmFibGVkLFxuICAgICAgYWdlbnRSQUdBdmFpbGFibGU6IHRoaXMuZWRnZUZ1bmN0aW9uc0VuYWJsZWQgJiYgdGhpcy5zdXBhYmFzZVVybCAhPT0gbnVsbCxcbiAgICAgIGVuaGFuY2VkU2NoZW1hUmVhZHk6IHRoaXMuaXNTdXBhYmFzZUVuYWJsZWRcbiAgICB9O1xuICB9XG59XG5cbi8vIEV4cG9ydCBlbmhhbmNlZCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCB2ZWN0b3JNZW1vcnlTdG9yZSA9IG5ldyBFbmhhbmNlZFZlY3Rvck1lbW9yeVN0b3JlKCk7XG4iXSwidmVyc2lvbiI6M30=