ef49c42a7df4ed63e5e7be3d4d3a1fad
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseAgent = exports.Recommendation = exports.Issue = exports.ValidationResults = exports.AgentActivationContext = exports.AgentResponse = void 0;
const types_1 = require("../types");
Object.defineProperty(exports, "AgentResponse", { enumerable: true, get: function () { return types_1.AgentResponse; } });
Object.defineProperty(exports, "AgentActivationContext", { enumerable: true, get: function () { return types_1.AgentActivationContext; } });
Object.defineProperty(exports, "ValidationResults", { enumerable: true, get: function () { return types_1.ValidationResults; } });
Object.defineProperty(exports, "Issue", { enumerable: true, get: function () { return types_1.Issue; } });
Object.defineProperty(exports, "Recommendation", { enumerable: true, get: function () { return types_1.Recommendation; } });
class BaseAgent {
    constructor(id, specialization) {
        this.id = id || 'base-agent';
        this.specialization = specialization || 'Base Agent';
        this.name = this.extractAgentName(this.id);
    }
    async runStandardValidation(context) {
        const issues = [];
        const warnings = [];
        const content = context.content || '';
        // Check for debugging code
        if (content.includes('console.log') || content.includes('console.warn')) {
            issues.push({
                type: 'debugging-code',
                severity: 'medium',
                message: 'Console.log detected in production code',
                file: context.filePath || 'unknown'
            });
        }
        if (content.includes('debugger')) {
            issues.push({
                type: 'debugging-code',
                severity: 'high',
                message: 'Debugger statement in production code',
                file: context.filePath || 'unknown'
            });
        }
        // Security issue detection
        if (content.includes('eval(') || content.includes('Function(')) {
            issues.push({
                type: 'security-risk',
                severity: 'high',
                message: 'Use of eval() detected - security risk',
                file: context.filePath || 'unknown'
            });
        }
        if (content.match(/innerHTML\s*=/)) {
            issues.push({
                type: 'security-risk',
                severity: 'high',
                message: 'Direct innerHTML assignment can lead to XSS',
                file: context.filePath || 'unknown'
            });
        }
        // Detect hardcoded passwords
        if (content.match(/password\s*=\s*["'][^"']+["']/i)) {
            issues.push({
                type: 'security-risk',
                severity: 'critical',
                message: 'Hardcoded password detected',
                file: context.filePath || 'unknown'
            });
        }
        // Performance issue detection
        if (content.match(/for\s*\([^)]*\)\s*\{[\s\S]*?for\s*\([^)]*\)\s*\{/)) {
            issues.push({
                type: 'performance',
                severity: 'medium',
                message: 'Nested loops detected - potential performance issue',
                file: context.filePath || 'unknown'
            });
        }
        if (content.includes('.map(') && content.includes('.filter(')) {
            const mapFilterCount = (content.match(/\.map\(/g) || []).length + (content.match(/\.filter\(/g) || []).length;
            if (mapFilterCount > 3) {
                issues.push({
                    type: 'performance',
                    severity: 'low',
                    message: 'Multiple array iterations - consider combining operations',
                    file: context.filePath || 'unknown'
                });
            }
        }
        // Code quality issues
        if (content.includes('any') && content.includes('interface')) {
            issues.push({
                type: 'code-quality',
                severity: 'low',
                message: 'Avoid using "any" type in interfaces',
                file: context.filePath || 'unknown'
            });
        }
        // Technical debt markers
        if (content.includes('// HACK:') || content.includes('/* HACK')) {
            issues.push({
                type: 'code-quality',
                severity: 'medium',
                message: 'HACK comment indicates technical debt',
                file: context.filePath || 'unknown'
            });
        }
        // Deep nesting detection
        const nestingLevel = (content.match(/if\s*\([^)]*\)\s*\{[^}]*if\s*\([^)]*\)\s*\{[^}]*if\s*\([^)]*\)\s*\{/g) || []).length;
        if (nestingLevel > 0) {
            issues.push({
                type: 'code-quality',
                severity: 'medium',
                message: 'Deep nesting detected (3+ levels) - consider refactoring',
                file: context.filePath || 'unknown'
            });
        }
        // Check for TODO comments
        if (content.includes('// TODO') || content.includes('// FIXME')) {
            warnings.push('TODO/FIXME comments found in code');
        }
        const score = Math.max(0, 100 - (issues.length * 10) - (warnings.length * 5));
        // Extract security concerns
        const securityConcerns = issues
            .filter(i => i.type === 'security-risk')
            .map(i => i.message);
        return {
            score,
            issues,
            warnings,
            recommendations: [],
            crossFileAnalysis: {
                inconsistencies: [],
                suggestions: []
            },
            performanceMetrics: {
                analysisTime: Date.now(),
                filesAnalyzed: 1
            },
            securityConcerns
        };
    }
    async runAgentSpecificValidation(context) {
        return {};
    }
    generateStandardRecommendations(results) {
        const recommendations = [];
        if (results.issues && results.issues.length > 0) {
            const criticalIssues = results.issues.filter(i => i.severity === 'critical');
            const highIssues = results.issues.filter(i => i.severity === 'high');
            const securityIssues = results.issues.filter(i => i.type === 'security' || i.type === 'security-risk' || i.type?.includes('security'));
            if (criticalIssues.length > 0) {
                recommendations.push({
                    type: 'critical-fix',
                    message: `Fix ${criticalIssues.length} critical issues immediately`,
                    priority: 'critical',
                    estimatedEffort: 'high'
                });
            }
            if (highIssues.length > 0) {
                recommendations.push({
                    type: 'high-priority-fix',
                    message: `Address ${highIssues.length} high priority issues`,
                    priority: 'high',
                    estimatedEffort: 'medium'
                });
            }
            if (securityIssues.length > 0) {
                recommendations.push({
                    type: 'security-improvement',
                    message: `Resolve ${securityIssues.length} security vulnerabilities`,
                    priority: 'high',
                    estimatedEffort: 'medium'
                });
            }
        }
        return recommendations;
    }
    calculateStandardPriority(results) {
        if (results.issues && results.issues.length > 0) {
            const hasCritical = results.issues.some(i => i.severity === 'critical');
            if (hasCritical)
                return 'critical';
            const hasHigh = results.issues.some(i => i.severity === 'high');
            if (hasHigh)
                return 'high';
            const hasMedium = results.issues.some(i => i.severity === 'medium');
            if (hasMedium)
                return 'medium';
        }
        return 'low';
    }
    async analyze(context) {
        return this.activate(context);
    }
    async runTests(context) {
        return { success: true, message: 'Tests not implemented for this agent' };
    }
    async analyzeArchitecture(context) {
        return { success: true, message: 'Architecture analysis not implemented for this agent' };
    }
    async manageDeployment(context) {
        return { success: true, message: 'Deployment management not implemented for this agent' };
    }
    analyzeCrossFileConsistency(context) {
        // Extract filename from path
        const filename = context.filePath?.split('/').pop() || context.filePath || 'unknown';
        return {
            [filename]: this.specialization
        };
    }
    hasConfigurationInconsistencies(context) {
        // Handle both string and object with content property
        const content = typeof context === 'string' ? context : (context?.content || '');
        // Detect mixed environment variable and hardcoded values
        if (content.includes('process.env') && content.match(/["']http:\/\/[^"']+["']/)) {
            return true;
        }
        // Detect inconsistent configuration patterns
        if (content.includes('const config') && content.includes('fallback')) {
            if (content.includes('process.env') && content.match(/:\s*["'][^"']+["']/)) {
                return true;
            }
        }
        return false;
    }
    mergeValidationResults(target, source) {
        if (source.issues) {
            target.issues = [...(target.issues || []), ...source.issues];
        }
        if (source.warnings) {
            target.warnings = [...(target.warnings || []), ...source.warnings];
        }
        if (source.recommendations) {
            target.recommendations = [...(target.recommendations || []), ...source.recommendations];
        }
        if (source.score !== undefined) {
            target.score = Math.min(target.score, source.score); // Take the lower score
        }
        if (source.crossFileAnalysis) {
            target.crossFileAnalysis = {
                ...(target.crossFileAnalysis || {}),
                ...source.crossFileAnalysis
            };
        }
        if (source.performanceMetrics) {
            target.performanceMetrics = {
                ...(target.performanceMetrics || {}),
                ...source.performanceMetrics
            };
        }
        if (source.securityConcerns) {
            target.securityConcerns = [...(target.securityConcerns || []), ...source.securityConcerns];
        }
    }
    extractAgentName(id) {
        // Convert 'enhanced-maria-qa' to 'Enhanced Maria Qa'
        return id.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');
    }
    getScoreEmoji(score) {
        if (score >= 90)
            return '🟢';
        if (score >= 80)
            return '🟡';
        if (score >= 70)
            return '🟠';
        return '🔴';
    }
}
exports.BaseAgent = BaseAgent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2Jhc2UtYWdlbnQudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsb0NBQTJHO0FBRWxHLDhGQUZBLHFCQUFhLE9BRUE7QUFBRSx1R0FGQSw4QkFBc0IsT0FFQTtBQUFFLGtHQUZBLHlCQUFpQixPQUVBO0FBQUUsc0ZBRkEsYUFBSyxPQUVBO0FBQUUsK0ZBRkEsc0JBQWMsT0FFQTtBQUV4RixNQUFzQixTQUFTO0lBTTdCLFlBQVksRUFBVyxFQUFFLGNBQXVCO1FBQzlDLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLFlBQVksQ0FBQztRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLGNBQWMsSUFBSSxZQUFZLENBQUM7UUFDckQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFJUyxLQUFLLENBQUMscUJBQXFCLENBQUMsT0FBK0I7UUFDbkUsTUFBTSxNQUFNLEdBQVksRUFBRSxDQUFDO1FBQzNCLE1BQU0sUUFBUSxHQUFhLEVBQUUsQ0FBQztRQUM5QixNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQztRQUV0QywyQkFBMkI7UUFDM0IsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztZQUN4RSxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNWLElBQUksRUFBRSxnQkFBZ0I7Z0JBQ3RCLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixPQUFPLEVBQUUseUNBQXlDO2dCQUNsRCxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNqQyxNQUFN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Q0FBQyxFQUFVO1FBQ25DLHFEQUFxRDtRQUNyRCxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FDM0QsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDZCxDQUFDO0lBRVMsYUFBYSxDQUFDLEtBQWE7UUFDbkMsSUFBSSxLQUFLLElBQUksRUFBRTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQzdCLElBQUksS0FBSyxJQUFJLEVBQUU7WUFBRSxPQUFPLElBQUksQ0FBQztRQUM3QixJQUFJLEtBQUssSUFBSSxFQUFFO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDN0IsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUF0U0QsOEJBc1NDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaXNzaW1tZW5hc2hlL1ZFUlNBVElMIFNETEMgRlcvc3JjL2FnZW50cy9iYXNlLWFnZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFnZW50UmVzcG9uc2UsIEFnZW50QWN0aXZhdGlvbkNvbnRleHQsIFZhbGlkYXRpb25SZXN1bHRzLCBJc3N1ZSwgUmVjb21tZW5kYXRpb24gfSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCB7IEFnZW50UmVzcG9uc2UsIEFnZW50QWN0aXZhdGlvbkNvbnRleHQsIFZhbGlkYXRpb25SZXN1bHRzLCBJc3N1ZSwgUmVjb21tZW5kYXRpb24gfTtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VBZ2VudCB7XG4gIG5hbWU6IHN0cmluZztcbiAgaWQ6IHN0cmluZztcbiAgc3BlY2lhbGl6YXRpb246IHN0cmluZztcbiAgYWJzdHJhY3Qgc3lzdGVtUHJvbXB0OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoaWQ/OiBzdHJpbmcsIHNwZWNpYWxpemF0aW9uPzogc3RyaW5nKSB7XG4gICAgdGhpcy5pZCA9IGlkIHx8ICdiYXNlLWFnZW50JztcbiAgICB0aGlzLnNwZWNpYWxpemF0aW9uID0gc3BlY2lhbGl6YXRpb24gfHwgJ0Jhc2UgQWdlbnQnO1xuICAgIHRoaXMubmFtZSA9IHRoaXMuZXh0cmFjdEFnZW50TmFtZSh0aGlzLmlkKTtcbiAgfVxuXG4gIGFic3RyYWN0IGFjdGl2YXRlKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPEFnZW50UmVzcG9uc2U+O1xuXG4gIHByb3RlY3RlZCBhc3luYyBydW5TdGFuZGFyZFZhbGlkYXRpb24oY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdHM+IHtcbiAgICBjb25zdCBpc3N1ZXM6IElzc3VlW10gPSBbXTtcbiAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBjb250ZW50ID0gY29udGV4dC5jb250ZW50IHx8ICcnO1xuXG4gICAgLy8gQ2hlY2sgZm9yIGRlYnVnZ2luZyBjb2RlXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ2NvbnNvbGUubG9nJykgfHwgY29udGVudC5pbmNsdWRlcygnY29uc29sZS53YXJuJykpIHtcbiAgICAgIGlzc3Vlcy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2RlYnVnZ2luZy1jb2RlJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxuICAgICAgICBtZXNzYWdlOiAnQ29uc29sZS5sb2cgZGV0ZWN0ZWQgaW4gcHJvZHVjdGlvbiBjb2RlJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdkZWJ1Z2dlcicpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdkZWJ1Z2dpbmctY29kZScsXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCcsXG4gICAgICAgIG1lc3NhZ2U6ICdEZWJ1Z2dlciBzdGF0ZW1lbnQgaW4gcHJvZHVjdGlvbiBjb2RlJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNlY3VyaXR5IGlzc3VlIGRldGVjdGlvblxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdldmFsKCcpIHx8IGNvbnRlbnQuaW5jbHVkZXMoJ0Z1bmN0aW9uKCcpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzZWN1cml0eS1yaXNrJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbWVzc2FnZTogJ1VzZSBvZiBldmFsKCkgZGV0ZWN0ZWQgLSBzZWN1cml0eSByaXNrJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjb250ZW50Lm1hdGNoKC9pbm5lckhUTUxcXHMqPS8pKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzZWN1cml0eS1yaXNrJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbWVzc2FnZTogJ0RpcmVjdCBpbm5lckhUTUwgYXNzaWdubWVudCBjYW4gbGVhZCB0byBYU1MnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0IGhhcmRjb2RlZCBwYXNzd29yZHNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvcGFzc3dvcmRcXHMqPVxccypbXCInXVteXCInXStbXCInXS9pKSkge1xuICAgICAgaXNzdWVzLnB1c2goe1xuICAgICAgICB0eXBlOiAnc2VjdXJpdHktcmlzaycsXG4gICAgICAgIHNldmVyaXR5OiAnY3JpdGljYWwnLFxuICAgICAgICBtZXNzYWdlOiAnSGFyZGNvZGVkIHBhc3N3b3JkIGRldGVjdGVkJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm1hbmNlIGlzc3VlIGRldGVjdGlvblxuICAgIGlmIChjb250ZW50Lm1hdGNoKC9mb3JcXHMqXFwoW14pXSpcXClcXHMqXFx7W1xcc1xcU10qP2ZvclxccypcXChbXildKlxcKVxccypcXHsvKSkge1xuICAgICAgaXNzdWVzLnB1c2goe1xuICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIG1lc3NhZ2U6ICdOZXN0ZWQgbG9vcHMgZGV0ZWN0ZWQgLSBwb3RlbnRpYWwgcGVyZm9ybWFuY2UgaXNzdWUnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJy5tYXAoJykgJiYgY29udGVudC5pbmNsdWRlcygnLmZpbHRlcignKSkge1xuICAgICAgY29uc3QgbWFwRmlsdGVyQ291bnQgPSAoY29udGVudC5tYXRjaCgvXFwubWFwXFwoL2cpIHx8IFtdKS5sZW5ndGggKyAoY29udGVudC5tYXRjaCgvXFwuZmlsdGVyXFwoL2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgICBpZiAobWFwRmlsdGVyQ291bnQgPiAzKSB7XG4gICAgICAgIGlzc3Vlcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICAgIHNldmVyaXR5OiAnbG93JyxcbiAgICAgICAgICBtZXNzYWdlOiAnTXVsdGlwbGUgYXJyYXkgaXRlcmF0aW9ucyAtIGNvbnNpZGVyIGNvbWJpbmluZyBvcGVyYXRpb25zJyxcbiAgICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb2RlIHF1YWxpdHkgaXNzdWVzXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ2FueScpICYmIGNvbnRlbnQuaW5jbHVkZXMoJ2ludGVyZmFjZScpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb2RlLXF1YWxpdHknLFxuICAgICAgICBzZXZlcml0eTogJ2xvdycsXG4gICAgICAgIG1lc3NhZ2U6ICdBdm9pZCB1c2luZyBcImFueVwiIHR5cGUgaW4gaW50ZXJmYWNlcycsXG4gICAgICAgIGZpbGU6IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUZWNobmljYWwgZGVidCBtYXJrZXJzXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJy8vIEhBQ0s6JykgfHwgY29udGVudC5pbmNsdWRlcygnLyogSEFDSycpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb2RlLXF1YWxpdHknLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIG1lc3NhZ2U6ICdIQUNLIGNvbW1lbnQgaW5kaWNhdGVzIHRlY2huaWNhbCBkZWJ0JyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIERlZXAgbmVzdGluZyBkZXRlY3Rpb25cbiAgICBjb25zdCBuZXN0aW5nTGV2ZWwgPSAoY29udGVudC5tYXRjaCgvaWZcXHMqXFwoW14pXSpcXClcXHMqXFx7W159XSppZlxccypcXChbXildKlxcKVxccypcXHtbXn1dKmlmXFxzKlxcKFteKV0qXFwpXFxzKlxcey9nKSB8fCBbXSkubGVuZ3RoO1xuICAgIGlmIChuZXN0aW5nTGV2ZWwgPiAwKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb2RlLXF1YWxpdHknLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIG1lc3NhZ2U6ICdEZWVwIG5lc3RpbmcgZGV0ZWN0ZWQgKDMrIGxldmVscykgLSBjb25zaWRlciByZWZhY3RvcmluZycsXG4gICAgICAgIGZpbGU6IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgVE9ETyBjb21tZW50c1xuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCcvLyBUT0RPJykgfHwgY29udGVudC5pbmNsdWRlcygnLy8gRklYTUUnKSkge1xuICAgICAgd2FybmluZ3MucHVzaCgnVE9ETy9GSVhNRSBjb21tZW50cyBmb3VuZCBpbiBjb2RlJyk7XG4gICAgfVxuXG4gICAgY29uc3Qgc2NvcmUgPSBNYXRoLm1heCgwLCAxMDAgLSAoaXNzdWVzLmxlbmd0aCAqIDEwKSAtICh3YXJuaW5ncy5sZW5ndGggKiA1KSk7XG5cbiAgICAvLyBFeHRyYWN0IHNlY3VyaXR5IGNvbmNlcm5zXG4gICAgY29uc3Qgc2VjdXJpdHlDb25jZXJucyA9IGlzc3Vlc1xuICAgICAgLmZpbHRlcihpID0+IGkudHlwZSA9PT0gJ3NlY3VyaXR5LXJpc2snKVxuICAgICAgLm1hcChpID0+IGkubWVzc2FnZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2NvcmUsXG4gICAgICBpc3N1ZXMsXG4gICAgICB3YXJuaW5ncyxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXG4gICAgICBjcm9zc0ZpbGVBbmFseXNpczoge1xuICAgICAgICBpbmNvbnNpc3RlbmNpZXM6IFtdLFxuICAgICAgICBzdWdnZXN0aW9uczogW11cbiAgICAgIH0sXG4gICAgICBwZXJmb3JtYW5jZU1ldHJpY3M6IHtcbiAgICAgICAgYW5hbHlzaXNUaW1lOiBEYXRlLm5vdygpLFxuICAgICAgICBmaWxlc0FuYWx5emVkOiAxXG4gICAgICB9LFxuICAgICAgc2VjdXJpdHlDb25jZXJuc1xuICAgIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgcnVuQWdlbnRTcGVjaWZpY1ZhbGlkYXRpb24oY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFByb21pc2U8UGFydGlhbDxWYWxpZGF0aW9uUmVzdWx0cz4+IHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2VuZXJhdGVTdGFuZGFyZFJlY29tbWVuZGF0aW9ucyhyZXN1bHRzOiBWYWxpZGF0aW9uUmVzdWx0cyk6IFJlY29tbWVuZGF0aW9uW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogUmVjb21tZW5kYXRpb25bXSA9IFtdO1xuXG4gICAgaWYgKHJlc3VsdHMuaXNzdWVzICYmIHJlc3VsdHMuaXNzdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGNyaXRpY2FsSXNzdWVzID0gcmVzdWx0cy5pc3N1ZXMuZmlsdGVyKGkgPT4gaS5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyk7XG4gICAgICBjb25zdCBoaWdoSXNzdWVzID0gcmVzdWx0cy5pc3N1ZXMuZmlsdGVyKGkgPT4gaS5zZXZlcml0eSA9PT0gJ2hpZ2gnKTtcbiAgICAgIGNvbnN0IHNlY3VyaXR5SXNzdWVzID0gcmVzdWx0cy5pc3N1ZXMuZmlsdGVyKGkgPT5cbiAgICAgICAgaS50eXBlID09PSAnc2VjdXJpdHknIHx8IGkudHlwZSA9PT0gJ3NlY3VyaXR5LXJpc2snIHx8IGkudHlwZT8uaW5jbHVkZXMoJ3NlY3VyaXR5JylcbiAgICAgICk7XG5cbiAgICAgIGlmIChjcml0aWNhbElzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAnY3JpdGljYWwtZml4JyxcbiAgICAgICAgICBtZXNzYWdlOiBgRml4ICR7Y3JpdGljYWxJc3N1ZXMubGVuZ3RofSBjcml0aWNhbCBpc3N1ZXMgaW1tZWRpYXRlbHlgLFxuICAgICAgICAgIHByaW9yaXR5OiAnY3JpdGljYWwnLFxuICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoaGlnaElzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAnaGlnaC1wcmlvcml0eS1maXgnLFxuICAgICAgICAgIG1lc3NhZ2U6IGBBZGRyZXNzICR7aGlnaElzc3Vlcy5sZW5ndGh9IGhpZ2ggcHJpb3JpdHkgaXNzdWVzYCxcbiAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogJ21lZGl1bSdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzZWN1cml0eUlzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAnc2VjdXJpdHktaW1wcm92ZW1lbnQnLFxuICAgICAgICAgIG1lc3NhZ2U6IGBSZXNvbHZlICR7c2VjdXJpdHlJc3N1ZXMubGVuZ3RofSBzZWN1cml0eSB2dWxuZXJhYmlsaXRpZXNgLFxuICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXG4gICAgICAgICAgZXN0aW1hdGVkRWZmb3J0OiAnbWVkaXVtJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNhbGN1bGF0ZVN0YW5kYXJkUHJpb3JpdHkocmVzdWx0czogVmFsaWRhdGlvblJlc3VsdHMpOiBzdHJpbmcge1xuICAgIGlmIChyZXN1bHRzLmlzc3VlcyAmJiByZXN1bHRzLmlzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBoYXNDcml0aWNhbCA9IHJlc3VsdHMuaXNzdWVzLnNvbWUoaSA9PiBpLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKTtcbiAgICAgIGlmIChoYXNDcml0aWNhbCkgcmV0dXJuICdjcml0aWNhbCc7XG5cbiAgICAgIGNvbnN0IGhhc0hpZ2ggPSByZXN1bHRzLmlzc3Vlcy5zb21lKGkgPT4gaS5zZXZlcml0eSA9PT0gJ2hpZ2gnKTtcbiAgICAgIGlmIChoYXNIaWdoKSByZXR1cm4gJ2hpZ2gnO1xuXG4gICAgICBjb25zdCBoYXNNZWRpdW0gPSByZXN1bHRzLmlzc3Vlcy5zb21lKGkgPT4gaS5zZXZlcml0eSA9PT0gJ21lZGl1bScpO1xuICAgICAgaWYgKGhhc01lZGl1bSkgcmV0dXJuICdtZWRpdW0nO1xuICAgIH1cbiAgICByZXR1cm4gJ2xvdyc7XG4gIH1cblxuICBhc3luYyBhbmFseXplKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPEFnZW50UmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5hY3RpdmF0ZShjb250ZXh0KTtcbiAgfVxuXG4gIGFzeW5jIHJ1blRlc3RzKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdUZXN0cyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgYWdlbnQnIH07XG4gIH1cblxuICBhc3luYyBhbmFseXplQXJjaGl0ZWN0dXJlKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdBcmNoaXRlY3R1cmUgYW5hbHlzaXMgbm90IGltcGxlbWVudGVkIGZvciB0aGlzIGFnZW50JyB9O1xuICB9XG5cbiAgYXN5bmMgbWFuYWdlRGVwbG95bWVudChjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnRGVwbG95bWVudCBtYW5hZ2VtZW50IG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBhZ2VudCcgfTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhbmFseXplQ3Jvc3NGaWxlQ29uc2lzdGVuY3koY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIC8vIEV4dHJhY3QgZmlsZW5hbWUgZnJvbSBwYXRoXG4gICAgY29uc3QgZmlsZW5hbWUgPSBjb250ZXh0LmZpbGVQYXRoPy5zcGxpdCgnLycpLnBvcCgpIHx8IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nO1xuICAgIHJldHVybiB7XG4gICAgICBbZmlsZW5hbWVdOiB0aGlzLnNwZWNpYWxpemF0aW9uXG4gICAgfTtcbiAgfVxuXG4gIHByb3RlY3RlZCBoYXNDb25maWd1cmF0aW9uSW5jb25zaXN0ZW5jaWVzKGNvbnRleHQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIC8vIEhhbmRsZSBib3RoIHN0cmluZyBhbmQgb2JqZWN0IHdpdGggY29udGVudCBwcm9wZXJ0eVxuICAgIGNvbnN0IGNvbnRlbnQgPSB0eXBlb2YgY29udGV4dCA9PT0gJ3N0cmluZycgPyBjb250ZXh0IDogKGNvbnRleHQ/LmNvbnRlbnQgfHwgJycpO1xuXG4gICAgLy8gRGV0ZWN0IG1peGVkIGVudmlyb25tZW50IHZhcmlhYmxlIGFuZCBoYXJkY29kZWQgdmFsdWVzXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ3Byb2Nlc3MuZW52JykgJiYgY29udGVudC5tYXRjaCgvW1wiJ11odHRwOlxcL1xcL1teXCInXStbXCInXS8pKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBEZXRlY3QgaW5jb25zaXN0ZW50IGNvbmZpZ3VyYXRpb24gcGF0dGVybnNcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygnY29uc3QgY29uZmlnJykgJiYgY29udGVudC5pbmNsdWRlcygnZmFsbGJhY2snKSkge1xuICAgICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ3Byb2Nlc3MuZW52JykgJiYgY29udGVudC5tYXRjaCgvOlxccypbXCInXVteXCInXStbXCInXS8pKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBtZXJnZVZhbGlkYXRpb25SZXN1bHRzKHRhcmdldDogVmFsaWRhdGlvblJlc3VsdHMsIHNvdXJjZTogVmFsaWRhdGlvblJlc3VsdHMpOiB2b2lkIHtcbiAgICBpZiAoc291cmNlLmlzc3Vlcykge1xuICAgICAgdGFyZ2V0Lmlzc3VlcyA9IFsuLi4odGFyZ2V0Lmlzc3VlcyB8fCBbXSksIC4uLnNvdXJjZS5pc3N1ZXNdO1xuICAgIH1cbiAgICBpZiAoc291cmNlLndhcm5pbmdzKSB7XG4gICAgICB0YXJnZXQud2FybmluZ3MgPSBbLi4uKHRhcmdldC53YXJuaW5ncyB8fCBbXSksIC4uLnNvdXJjZS53YXJuaW5nc107XG4gICAgfVxuICAgIGlmIChzb3VyY2UucmVjb21tZW5kYXRpb25zKSB7XG4gICAgICB0YXJnZXQucmVjb21tZW5kYXRpb25zID0gWy4uLih0YXJnZXQucmVjb21tZW5kYXRpb25zIHx8IFtdKSwgLi4uc291cmNlLnJlY29tbWVuZGF0aW9uc107XG4gICAgfVxuICAgIGlmIChzb3VyY2Uuc2NvcmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGFyZ2V0LnNjb3JlID0gTWF0aC5taW4odGFyZ2V0LnNjb3JlLCBzb3VyY2Uuc2NvcmUpOyAvLyBUYWtlIHRoZSBsb3dlciBzY29yZVxuICAgIH1cbiAgICBpZiAoc291cmNlLmNyb3NzRmlsZUFuYWx5c2lzKSB7XG4gICAgICB0YXJnZXQuY3Jvc3NGaWxlQW5hbHlzaXMgPSB7XG4gICAgICAgIC4uLih0YXJnZXQuY3Jvc3NGaWxlQW5hbHlzaXMgfHwge30pLFxuICAgICAgICAuLi5zb3VyY2UuY3Jvc3NGaWxlQW5hbHlzaXNcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChzb3VyY2UucGVyZm9ybWFuY2VNZXRyaWNzKSB7XG4gICAgICB0YXJnZXQucGVyZm9ybWFuY2VNZXRyaWNzID0ge1xuICAgICAgICAuLi4odGFyZ2V0LnBlcmZvcm1hbmNlTWV0cmljcyB8fCB7fSksXG4gICAgICAgIC4uLnNvdXJjZS5wZXJmb3JtYW5jZU1ldHJpY3NcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChzb3VyY2Uuc2VjdXJpdHlDb25jZXJucykge1xuICAgICAgdGFyZ2V0LnNlY3VyaXR5Q29uY2VybnMgPSBbLi4uKHRhcmdldC5zZWN1cml0eUNvbmNlcm5zIHx8IFtdKSwgLi4uc291cmNlLnNlY3VyaXR5Q29uY2VybnNdO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBleHRyYWN0QWdlbnROYW1lKGlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIENvbnZlcnQgJ2VuaGFuY2VkLW1hcmlhLXFhJyB0byAnRW5oYW5jZWQgTWFyaWEgUWEnXG4gICAgcmV0dXJuIGlkLnNwbGl0KCctJykubWFwKHdvcmQgPT5cbiAgICAgIHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpLnRvTG93ZXJDYXNlKClcbiAgICApLmpvaW4oJyAnKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRTY29yZUVtb2ppKHNjb3JlOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChzY29yZSA+PSA5MCkgcmV0dXJuICfwn5+iJztcbiAgICBpZiAoc2NvcmUgPj0gODApIHJldHVybiAn8J+foSc7XG4gICAgaWYgKHNjb3JlID49IDcwKSByZXR1cm4gJ/Cfn6AnO1xuICAgIHJldHVybiAn8J+UtCc7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==