11cad5b0135280455830557e223d5129
"use strict";
/**
 * VERSATIL SDLC Framework - RAG-Enabled Agent Base Class
 *
 * Extends BaseAgent with direct RAG capabilities, allowing each agent to:
 * - Retrieve domain-specific context from vector memory
 * - Store successful patterns for future learning
 * - Generate context-aware prompts with historical knowledge
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.RAGEnabledAgent = void 0;
const base_agent_js_1 = require("./base-agent.js");
class RAGEnabledAgent extends base_agent_js_1.BaseAgent {
    constructor(vectorStore) {
        super();
        this.RAG_CACHE_TTL = 5 * 60 * 1000; // 5 minutes
        this.vectorStore = vectorStore;
        this.ragConfig = this.getDefaultRAGConfig();
        this.ragCache = new Map();
        // Cleanup expired cache entries every minute
        setInterval(() => this.cleanupExpiredCache(), 60 * 1000);
    }
    /**
     * Main analysis method with RAG enhancement
     */
    async activate(context) {
        // Level 1: Standard pattern analysis
        const patternAnalysis = await this.runPatternAnalysis(context);
        // Level 2: RAG enhancement (if vector store available)
        let ragContext;
        if (this.vectorStore) {
            ragContext = await this.retrieveRelevantContext(context, patternAnalysis);
        }
        // Level 3: Generate enhanced response
        const enhancedResponse = await this.generateRAGEnhancedResponse(context, patternAnalysis, ragContext);
        // Level 4: Store successful patterns for learning
        if (this.vectorStore && this.ragConfig.enableLearning) {
            await this.storeNewPatterns(context, patternAnalysis, enhancedResponse);
        }
        return enhancedResponse;
    }
    /**
     * Retrieve relevant context from vector memory (with caching)
     */
    async retrieveRelevantContext(context, analysis) {
        if (!this.vectorStore) {
            return this.getEmptyRAGContext();
        }
        // Generate cache key from file path and content hash
        const cacheKey = this.generateCacheKey(context);
        // Check cache first (5-minute TTL)
        const cached = this.ragCache.get(cacheKey);
        if (cached && Date.now() - cached.timestamp < this.RAG_CACHE_TTL) {
            console.log(`[${this.id}] RAG cache hit for ${context.filePath}`);
            return cached.context;
        }
        const retrievals = {
            similarCode: [],
            previousSolutions: {},
            projectStandards: [],
            agentExpertise: []
        };
        try {
            // 1. Find similar code patterns for this agent's domain
            retrievals.similarCode = await this.retrieveSimilarCodePatterns(context);
            // 2. Find previous solutions for similar issues
            retrievals.previousSolutions = await this.retrievePreviousSolutions(analysis);
            // 3. Get project-specific standards for this domain
            retrievals.projectStandards = await this.retrieveProjectStandards(context);
            // 4. Get agent-specific expertise
            retrievals.agentExpertise = await this.retrieveAgentExpertise(context);
            // Store in cache
            this.ragCache.set(cacheKey, {
                context: retrievals,
                timestamp: Date.now(),
                query: context.filePath || 'unknown'
            });
            console.log(`[${this.id}] RAG cache stored for ${context.filePath}`);
        }
        catch (error) {
            console.warn(`RAG retrieval failed for ${this.id}:`, error.message);
        }
        return retrievals;
    }
    /**
     * Generate cache key from context
     */
    generateCacheKey(context) {
        const filePath = context.filePath || 'unknown';
        const contentHash = this.hashContent(context.content || '');
        return `${this.id}:${filePath}:${contentHash}`;
    }
    /**
     * Simple content hash for cache key
     */
    hashContent(content) {
        let hash = 0;
        for (let i = 0; i < Math.min(content.length, 1000); i++) {
            const char = content.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return hash.toString(36);
    }
    /**
     * Cleanup expired cache entries
     */
    cleanupExpiredCache() {
        const now = Date.now();
        let expiredCount = 0;
        for (const [key, entry] of this.ragCache.entries()) {
            if (now - entry.timestamp >= this.RAG_CACHE_TTL) {
                this.ragCache.delete(key);
                expiredCount++;
            }
        }
        if (expiredCount > 0) {
            console.log(`[${this.id}] Cleaned up ${expiredCount} expired RAG cache entries`);
        }
    }
    /**
     * Clear all cache (useful for testing)
     */
    clearRAGCache() {
        this.ragCache.clear();
        console.log(`[${this.id}] RAG cache cleared`);
    }
    /**
     * Get cache statistics
     */
    getRAGCacheStats() {
        const entries = Array.from(this.ragCache.values());
        return {
            size: entries.length,
            oldest: entries.length > 0 ? Math.min(...entries.map(e => e.timestamp)) : null,
            newest: entries.length > 0 ? Math.max(...entries.map(e => e.timestamp)) : null
        };
    }
    /**
     * Retrieve similar code patterns based on content and domain
     */
    async retrieveSimilarCodePatterns(context) {
        if (!this.vectorStore)
            return [];
        const query = {
            query: this.createSemanticQuery(context.content, context.filePath),
            queryType: 'semantic',
            agentId: this.id,
            topK: this.ragConfig.maxExamples,
            filters: {
                tags: [this.ragConfig.agentDomain, 'pattern', this.detectLanguage(context.filePath)],
                contentTypes: ['code']
            }
        };
        const result = await this.vectorStore.queryMemories(query);
        return result.documents || [];
    }
    /**
     * Retrieve previous solutions for similar issues
     */
    async retrievePreviousSolutions(analysis) {
        if (!this.vectorStore)
            return {};
        const solutions = {};
        for (const issue of analysis.patterns) {
            const query = {
                query: `${issue.type} ${issue.message}`,
                queryType: 'semantic',
                agentId: this.id,
                topK: 2,
                filters: {
                    tags: [issue.type, 'solution', this.ragConfig.agentDomain],
                    contentTypes: ['text', 'code']
                }
            };
            try {
                const result = await this.vectorStore.queryMemories(query);
                solutions[issue.type] = result.documents || [];
            }
            catch (error) {
                console.warn(`Failed to retrieve solutions for ${issue.type}:`, error.message);
                solutions[issue.type] = [];
            }
        }
        return solutions;
    }
    /**
     * Retrieve project standards specific to this agent's domain
     */
    async retrieveProjectStandards(context) {
        if (!this.vectorStore)
            return [];
        const query = {
            query: `${context.filePath} ${this.ragConfig.agentDomain} standards conventions`,
            queryType: 'semantic',
            agentId: this.id,
            topK: 3,
            filters: {
                tags: [this.ragConfig.agentDomain, 'standard', 'convention'],
                contentTypes: ['text']
            }
        };
        const result = await this.vectorStore.queryMemories(query);
        return result.documents || [];
    }
    /**
     * Retrieve agent-specific expertise and insights
     */
    async retrieveAgentExpertise(context) {
        if (!this.vectorStore)
            return [];
        const query = {
            query: this.createSemanticQuery(context.content, context.filePath),
            queryType: 'semantic',
            agentId: this.id,
            topK: 3,
            filters: {
                tags: [this.id, 'expertise', this.ragConfig.agentDomain],
                contentTypes: ['text', 'code']
            }
        };
        const result = await this.vectorStore.queryMemories(query);
        return result.documents || [];
    }
    /**
     * Generate enhanced response with RAG context
     */
    async generateRAGEnhancedResponse(context, analysis, ragContext) {
        // Convert analysis to suggestions
        const suggestions = analysis.patterns.map(p => ({
            type: p.type,
            description: p.message,
            location: `${context.filePath}:${p.line}`,
            priority: p.severity,
            action: p.suggestion
        }));
        // Enhance suggestions with RAG context
        if (ragContext) {
            this.enhanceSuggestionsWithRAG(suggestions, ragContext);
        }
        // Generate domain-specific handoffs
        const handoffTo = this.generateDomainHandoffs(analysis);
        // Create enhanced message with RAG insights
        const message = this.generateEnhancedMessage(analysis, ragContext);
        return {
            agentId: this.id,
            message,
            suggestions,
            priority: this.calculatePriorityWithRAG(analysis, ragContext),
            handoffTo,
            context: {
                analysisScore: analysis.score,
                totalIssues: analysis.patterns.length,
                criticalIssues: analysis.patterns.filter(p => p.severity === 'critical').length,
                ragEnhanced: !!ragContext,
                ragInsights: ragContext ? this.summarizeRAGInsights(ragContext) : undefined,
                generatedPrompt: this.generateRAGEnhancedPrompt(context, analysis, ragContext),
                recommendations: analysis.recommendations,
                summary: analysis.summary
            }
        };
    }
    /**
     * Generate RAG-enhanced prompt with retrieved context
     */
    generateRAGEnhancedPrompt(context, analysis, ragContext) {
        let prompt = this.getBasePromptTemplate();
        if (ragContext) {
            prompt += '\n## Retrieved Context\n\n';
            // Similar Code Patterns
            if (ragContext.similarCode.length > 0) {
                prompt += '### Similar Code Patterns From This Project:\n';
                ragContext.similarCode.forEach((pattern, index) => {
                    const tags = pattern.metadata?.tags?.join(', ') || 'N/A';
                    const score = Math.round((pattern.metadata?.relevanceScore || 0) * 100);
                    prompt += `Example ${index + 1} (${score}% relevance, tags: ${tags}):\n`;
                    prompt += '```\n' + pattern.content.slice(0, 200) + '...\n```\n\n';
                });
            }
            // Previous Solutions
            const solutionEntries = Object.entries(ragContext.previousSolutions).filter(([_, solutions]) => solutions.length > 0);
            if (solutionEntries.length > 0) {
                prompt += '### Previous Solutions for Similar Issues:\n';
                solutionEntries.forEach(([issueType, solutions]) => {
                    prompt += `For ${issueType}:\n`;
                    solutions.forEach(solution => {
                        prompt += `- ${solution.content.slice(0, 150)}...\n`;
                    });
                    prompt += '\n';
                });
            }
            // Project Standards
            if (ragContext.projectStandards.length > 0) {
                prompt += '### Project Standards:\n';
                ragContext.projectStandards.forEach(standard => {
                    prompt += `- ${standard.content.slice(0, 100)}...\n`;
                });
                prompt += '\n';
            }
        }
        // Current context
        prompt += '## Current Context\n';
        prompt += `File: ${context.filePath}\n`;
        prompt += `Issues Found: ${JSON.stringify(analysis.patterns.map(p => ({ type: p.type, severity: p.severity, message: p.message })), null, 2)}\n\n`;
        // Code to analyze
        prompt += `## Code to Analyze\n`;
        prompt += '```' + this.detectLanguage(context.filePath) + '\n';
        prompt += context.content + '\n';
        prompt += '```\n\n';
        prompt += 'Using the retrieved context above as reference, provide your analysis and recommendations.\n';
        return prompt;
    }
    /**
     * Store successful patterns for future learning
     */
    async storeNewPatterns(context, analysis, response) {
        if (!this.vectorStore)
            return;
        try {
            const language = this.detectLanguage(context.filePath);
            // Store high-quality code patterns (score >= 80)
            if (analysis.score >= 80) {
                const patternDoc = {
                    id: `pattern_${this.id}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    content: context.content,
                    contentType: 'code',
                    metadata: {
                        agentId: this.id,
                        timestamp: Date.now(),
                        fileType: context.filePath.split('.').pop() || '',
                        projectContext: 'VERSATIL Framework',
                        tags: [language, this.ragConfig.agentDomain, 'pattern', 'high-quality'],
                        relevanceScore: analysis.score / 100,
                        language,
                        framework: this.detectFramework(context.content)
                    }
                };
                await this.vectorStore.storeMemory(patternDoc);
            }
            // Store successful solutions for detected issues
            for (const suggestion of response.suggestions) {
                if (suggestion.priority !== 'low') {
                    const solutionDoc = {
                        id: `solution_${this.id}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        content: suggestion.action,
                        contentType: 'text',
                        metadata: {
                            agentId: this.id,
                            timestamp: Date.now(),
                            projectContext: 'VERSATIL Framework',
                            tags: [language, this.ragConfig.agentDomain, suggestion.type, 'solution'],
                            relevanceScore: suggestion.priority === 'critical' ? 1.0 : suggestion.priority === 'high' ? 0.8 : 0.6,
                            language
                        }
                    };
                    await this.vectorStore.storeMemory(solutionDoc);
                }
            }
        }
        catch (error) {
            console.warn(`Failed to store patterns for ${this.id}:`, error.message);
        }
    }
    // Helper methods
    getEmptyRAGContext() {
        return {
            similarCode: [],
            previousSolutions: {},
            projectStandards: [],
            agentExpertise: []
        };
    }
    createSemanticQuery(content, filePath) {
        // Extract key concepts and create semantic query
        const lines = content.split('\n');
        const keywords = [];
        // Extract function/class names
        const functionMatches = content.match(/(?:function|class|const|let|var)\s+(\w+)/g);
        if (functionMatches) {
            keywords.push(...functionMatches.map(match => match.split(/\s+/)[1]));
        }
        // Add file path context
        const pathParts = filePath.split('/').filter(part => part && !part.includes('.'));
        keywords.push(...pathParts);
        // Create concise semantic query
        const uniqueKeywords = [...new Set(keywords)].filter(k => k && k.length > 2).slice(0, 8);
        return uniqueKeywords.join(' ') || content.slice(0, 150);
    }
    detectLanguage(filePath) {
        const ext = filePath.split('.').pop()?.toLowerCase() || '';
        const langMap = {
            'js': 'javascript', 'jsx': 'javascriptreact',
            'ts': 'typescript', 'tsx': 'typescriptreact',
            'py': 'python', 'vue': 'vue', 'svelte': 'svelte'
        };
        return langMap[ext] || 'plaintext';
    }
    detectFramework(content) {
        if (content.includes('react') || content.includes('useState'))
            return 'react';
        if (content.includes('vue') || content.includes('Vue'))
            return 'vue';
        if (content.includes('angular'))
            return 'angular';
        if (content.includes('express') || content.includes('app.get'))
            return 'express';
        return '';
    }
    enhanceSuggestionsWithRAG(suggestions, ragContext) {
        // Add RAG-derived suggestions
        if (ragContext.similarCode.length > 0) {
            suggestions.push({
                type: 'rag-pattern',
                description: `Found ${ragContext.similarCode.length} similar patterns in project history`,
                location: 'RAG Context',
                priority: 'info',
                action: 'Review similar implementations for consistency and best practices'
            });
        }
    }
    generateEnhancedMessage(analysis, ragContext) {
        let message = `${this.ragConfig.agentDomain} Analysis Complete: Score ${analysis.score}/100. ${analysis.patterns.length} issues found.`;
        if (ragContext) {
            const ragInsights = [];
            if (ragContext.similarCode.length > 0)
                ragInsights.push(`${ragContext.similarCode.length} similar patterns`);
            if (Object.keys(ragContext.previousSolutions).length > 0)
                ragInsights.push(`solutions for ${Object.keys(ragContext.previousSolutions).length} issue types`);
            if (ragContext.projectStandards.length > 0)
                ragInsights.push(`${ragContext.projectStandards.length} project standards`);
            if (ragInsights.length > 0) {
                message += ` RAG-Enhanced: ${ragInsights.join(', ')}.`;
            }
        }
        return message;
    }
    summarizeRAGInsights(ragContext) {
        return {
            similarPatterns: ragContext.similarCode.length,
            solutionTypes: Object.keys(ragContext.previousSolutions).length,
            projectStandards: ragContext.projectStandards.length,
            expertise: ragContext.agentExpertise.length
        };
    }
    calculatePriorityWithRAG(analysis, ragContext) {
        // Check for critical severity issues first
        const hasCritical = analysis.patterns.some(p => p.severity === 'critical');
        if (hasCritical)
            return 'critical';
        const hasHigh = analysis.patterns.some(p => p.severity === 'high');
        if (hasHigh)
            return 'high';
        // Fall back to score-based priority
        let basePriority = analysis.score < 60 ? 'high' : analysis.score < 80 ? 'medium' : 'low';
        // Boost priority if RAG context shows this is a recurring issue
        if (ragContext && Object.keys(ragContext.previousSolutions).length > 2) {
            if (basePriority === 'low')
                basePriority = 'medium';
            if (basePriority === 'medium')
                basePriority = 'high';
        }
        return basePriority;
    }
}
exports.RAGEnabledAgent = RAGEnabledAgent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL3JhZy1lbmFibGVkLWFnZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFFSCxtREFBbUY7QUE4Qm5GLE1BQXNCLGVBQWdCLFNBQVEseUJBQVM7SUFNckQsWUFBWSxXQUF1QztRQUNqRCxLQUFLLEVBQUUsQ0FBQztRQUhPLGtCQUFhLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxZQUFZO1FBSTFELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDNUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRTFCLDZDQUE2QztRQUM3QyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFPRDs7T0FFRztJQUNILEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBK0I7UUFDNUMscUNBQXFDO1FBQ3JDLE1BQU0sZUFBZSxHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRS9ELHVEQUF1RDtRQUN2RCxJQUFJLFVBQXVDLENBQUM7UUFDNUMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDckIsVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLHVCQUF1QixDQUFDLE9BQU8sRUFBRSxlQUFlLENBQUMsQ0FBQztRQUM1RSxDQUFDO1FBRUQsc0NBQXNDO1FBQ3RDLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxJQUFJLENBQUMsMkJBQTJCLENBQzdELE9BQU8sRUFDUCxlQUFlLEVBQ2YsVUFBVSxDQUNYLENBQUM7UUFFRixrREFBa0Q7UUFDbEQsSUFBSSxJQUFJLENBQUMsV0FBVyxJQUFJLElB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QUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsQ0FBQztRQUNuRSxJQUFJLE9BQU87WUFBRSxPQUFPLE1BQU0sQ0FBQztRQUUzQixvQ0FBb0M7UUFDcEMsSUFBSSxZQUFZLEdBQUcsUUFBUSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBRXpGLGdFQUFnRTtRQUNoRSxJQUFJLFVBQVUsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN2RSxJQUFJLFlBQVksS0FBSyxLQUFLO2dCQUFFLFlBQVksR0FBRyxRQUFRLENBQUM7WUFDcEQsSUFBSSxZQUFZLEtBQUssUUFBUTtnQkFBRSxZQUFZLEdBQUcsTUFBTSxDQUFDO1FBQ3ZELENBQUM7UUFFRCxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0NBS0Y7QUF2aUJELDBDQXVpQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL3JhZy1lbmFibGVkLWFnZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVkVSU0FUSUwgU0RMQyBGcmFtZXdvcmsgLSBSQUctRW5hYmxlZCBBZ2VudCBCYXNlIENsYXNzXG4gKlxuICogRXh0ZW5kcyBCYXNlQWdlbnQgd2l0aCBkaXJlY3QgUkFHIGNhcGFiaWxpdGllcywgYWxsb3dpbmcgZWFjaCBhZ2VudCB0bzpcbiAqIC0gUmV0cmlldmUgZG9tYWluLXNwZWNpZmljIGNvbnRleHQgZnJvbSB2ZWN0b3IgbWVtb3J5XG4gKiAtIFN0b3JlIHN1Y2Nlc3NmdWwgcGF0dGVybnMgZm9yIGZ1dHVyZSBsZWFybmluZ1xuICogLSBHZW5lcmF0ZSBjb250ZXh0LWF3YXJlIHByb21wdHMgd2l0aCBoaXN0b3JpY2FsIGtub3dsZWRnZVxuICovXG5cbmltcG9ydCB7IEJhc2VBZ2VudCwgQWdlbnRSZXNwb25zZSwgQWdlbnRBY3RpdmF0aW9uQ29udGV4dCB9IGZyb20gJy4vYmFzZS1hZ2VudC5qcyc7XG5pbXBvcnQgeyBFbmhhbmNlZFZlY3Rvck1lbW9yeVN0b3JlLCBNZW1vcnlEb2N1bWVudCwgUkFHUXVlcnkgfSBmcm9tICcuLi9yYWcvZW5oYW5jZWQtdmVjdG9yLW1lbW9yeS1zdG9yZS5qcyc7XG5pbXBvcnQgeyBBbmFseXNpc1Jlc3VsdCB9IGZyb20gJy4uL2ludGVsbGlnZW5jZS9wYXR0ZXJuLWFuYWx5emVyLmpzJztcblxuZXhwb3J0IGludGVyZmFjZSBSQUdDb25maWcge1xuICBtYXhFeGFtcGxlczogbnVtYmVyO1xuICBzaW1pbGFyaXR5VGhyZXNob2xkOiBudW1iZXI7XG4gIGFnZW50RG9tYWluOiBzdHJpbmc7XG4gIGVuYWJsZUxlYXJuaW5nOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50UkFHQ29udGV4dCB7XG4gIHNpbWlsYXJDb2RlOiBNZW1vcnlEb2N1bWVudFtdO1xuICBwcmV2aW91c1NvbHV0aW9uczogeyBbaXNzdWVUeXBlOiBzdHJpbmddOiBNZW1vcnlEb2N1bWVudFtdIH07XG4gIHByb2plY3RTdGFuZGFyZHM6IE1lbW9yeURvY3VtZW50W107XG4gIGFnZW50RXhwZXJ0aXNlOiBNZW1vcnlEb2N1bWVudFtdO1xuICBtZXRhZGF0YT86IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gIH07XG59XG5cbi8qKlxuICogUkFHIGNhY2hlIGVudHJ5IHdpdGggVFRMXG4gKi9cbmludGVyZmFjZSBSQUdDYWNoZUVudHJ5IHtcbiAgY29udGV4dDogQWdlbnRSQUdDb250ZXh0O1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgcXVlcnk6IHN0cmluZztcbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFJBR0VuYWJsZWRBZ2VudCBleHRlbmRzIEJhc2VBZ2VudCB7XG4gIHByb3RlY3RlZCB2ZWN0b3JTdG9yZT86IEVuaGFuY2VkVmVjdG9yTWVtb3J5U3RvcmU7XG4gIHByb3RlY3RlZCByYWdDb25maWc6IFJBR0NvbmZpZztcbiAgcHJpdmF0ZSByYWdDYWNoZTogTWFwPHN0cmluZywgUkFHQ2FjaGVFbnRyeT47XG4gIHByaXZhdGUgcmVhZG9ubHkgUkFHX0NBQ0hFX1RUTCA9IDUgKiA2MCAqIDEwMDA7IC8vIDUgbWludXRlc1xuXG4gIGNvbnN0cnVjdG9yKHZlY3RvclN0b3JlPzogRW5oYW5jZWRWZWN0b3JNZW1vcnlTdG9yZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy52ZWN0b3JTdG9yZSA9IHZlY3RvclN0b3JlO1xuICAgIHRoaXMucmFnQ29uZmlnID0gdGhpcy5nZXREZWZhdWx0UkFHQ29uZmlnKCk7XG4gICAgdGhpcy5yYWdDYWNoZSA9IG5ldyBNYXAoKTtcblxuICAgIC8vIENsZWFudXAgZXhwaXJlZCBjYWNoZSBlbnRyaWVzIGV2ZXJ5IG1pbnV0ZVxuICAgIHNldEludGVydmFsKCgpID0+IHRoaXMuY2xlYW51cEV4cGlyZWRDYWNoZSgpLCA2MCAqIDEwMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlIHRoaXMgaW4gZWFjaCBhZ2VudCB0byBkZWZpbmUgZG9tYWluLXNwZWNpZmljIFJBRyBjb25maWd1cmF0aW9uXG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0RGVmYXVsdFJBR0NvbmZpZygpOiBSQUdDb25maWc7XG5cbiAgLyoqXG4gICAqIE1haW4gYW5hbHlzaXMgbWV0aG9kIHdpdGggUkFHIGVuaGFuY2VtZW50XG4gICAqL1xuICBhc3luYyBhY3RpdmF0ZShjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogUHJvbWlzZTxBZ2VudFJlc3BvbnNlPiB7XG4gICAgLy8gTGV2ZWwgMTogU3RhbmRhcmQgcGF0dGVybiBhbmFseXNpc1xuICAgIGNvbnN0IHBhdHRlcm5BbmFseXNpcyA9IGF3YWl0IHRoaXMucnVuUGF0dGVybkFuYWx5c2lzKGNvbnRleHQpO1xuXG4gICAgLy8gTGV2ZWwgMjogUkFHIGVuaGFuY2VtZW50IChpZiB2ZWN0b3Igc3RvcmUgYXZhaWxhYmxlKVxuICAgIGxldCByYWdDb250ZXh0OiBBZ2VudFJBR0NvbnRleHQgfCB1bmRlZmluZWQ7XG4gICAgaWYgKHRoaXMudmVjdG9yU3RvcmUpIHtcbiAgICAgIHJhZ0NvbnRleHQgPSBhd2FpdCB0aGlzLnJldHJpZXZlUmVsZXZhbnRDb250ZXh0KGNvbnRleHQsIHBhdHRlcm5BbmFseXNpcyk7XG4gICAgfVxuXG4gICAgLy8gTGV2ZWwgMzogR2VuZXJhdGUgZW5oYW5jZWQgcmVzcG9uc2VcbiAgICBjb25zdCBlbmhhbmNlZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVJBR0VuaGFuY2VkUmVzcG9uc2UoXG4gICAgICBjb250ZXh0LFxuICAgICAgcGF0dGVybkFuYWx5c2lzLFxuICAgICAgcmFnQ29udGV4dFxuICAgICk7XG5cbiAgICAvLyBMZXZlbCA0OiBTdG9yZSBzdWNjZXNzZnVsIHBhdHRlcm5zIGZvciBsZWFybmluZ1xuICAgIGlmICh0aGlzLnZlY3RvclN0b3JlICYmIHRoaXMucmFnQ29uZmlnLmVuYWJsZUxlYXJuaW5nKSB7XG4gICAgICBhd2FpdCB0aGlzLnN0b3JlTmV3UGF0dGVybnMoY29udGV4dCwgcGF0dGVybkFuYWx5c2lzLCBlbmhhbmNlZFJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZW5oYW5jZWRSZXNwb25zZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW4gZG9tYWluLXNwZWNpZmljIHBhdHRlcm4gYW5hbHlzaXMgLSB0byBiZSBpbXBsZW1lbnRlZCBieSBlYWNoIGFnZW50XG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgcnVuUGF0dGVybkFuYWx5c2lzKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PjtcblxuICAvKipcbiAgICogUmV0cmlldmUgcmVsZXZhbnQgY29udGV4dCBmcm9tIHZlY3RvciBtZW1vcnkgKHdpdGggY2FjaGluZylcbiAgICovXG4gIHByb3RlY3RlZCBhc3luYyByZXRyaWV2ZVJlbGV2YW50Q29udGV4dChcbiAgICBjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0LFxuICAgIGFuYWx5c2lzOiBBbmFseXNpc1Jlc3VsdFxuICApOiBQcm9taXNlPEFnZW50UkFHQ29udGV4dD4ge1xuICAgIGlmICghdGhpcy52ZWN0b3JTdG9yZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RW1wdHlSQUdDb250ZXh0KCk7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgY2FjaGUga2V5IGZyb20gZmlsZSBwYXRoIGFuZCBjb250ZW50IGhhc2hcbiAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMuZ2VuZXJhdGVDYWNoZUtleShjb250ZXh0KTtcblxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0ICg1LW1pbnV0ZSBUVEwpXG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5yYWdDYWNoZS5nZXQoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQgJiYgRGF0ZS5ub3coKSAtIGNhY2hlZC50aW1lc3RhbXAgPCB0aGlzLlJBR19DQUNIRV9UVEwpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzLmlkfV0gUkFHIGNhY2hlIGhpdCBmb3IgJHtjb250ZXh0LmZpbGVQYXRofWApO1xuICAgICAgcmV0dXJuIGNhY2hlZC5jb250ZXh0O1xuICAgIH1cblxuICAgIGNvbnN0IHJldHJpZXZhbHM6IEFnZW50UkFHQ29udGV4dCA9IHtcbiAgICAgIHNpbWlsYXJDb2RlOiBbXSxcbiAgICAgIHByZXZpb3VzU29sdXRpb25zOiB7fSxcbiAgICAgIHByb2plY3RTdGFuZGFyZHM6IFtdLFxuICAgICAgYWdlbnRFeHBlcnRpc2U6IFtdXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyAxLiBGaW5kIHNpbWlsYXIgY29kZSBwYXR0ZXJucyBmb3IgdGhpcyBhZ2VudCdzIGRvbWFpblxuICAgICAgcmV0cmlldmFscy5zaW1pbGFyQ29kZSA9IGF3YWl0IHRoaXMucmV0cmlldmVTaW1pbGFyQ29kZVBhdHRlcm5zKGNvbnRleHQpO1xuXG4gICAgICAvLyAyLiBGaW5kIHByZXZpb3VzIHNvbHV0aW9ucyBmb3Igc2ltaWxhciBpc3N1ZXNcbiAgICAgIHJldHJpZXZhbHMucHJldmlvdXNTb2x1dGlvbnMgPSBhd2FpdCB0aGlzLnJldHJpZXZlUHJldmlvdXNTb2x1dGlvbnMoYW5hbHlzaXMpO1xuXG4gICAgICAvLyAzLiBHZXQgcHJvamVjdC1zcGVjaWZpYyBzdGFuZGFyZHMgZm9yIHRoaXMgZG9tYWluXG4gICAgICByZXRyaWV2YWxzLnByb2plY3RTdGFuZGFyZHMgPSBhd2FpdCB0aGlzLnJldHJpZXZlUHJvamVjdFN0YW5kYXJkcyhjb250ZXh0KTtcblxuICAgICAgLy8gNC4gR2V0IGFnZW50LXNwZWNpZmljIGV4cGVydGlzZVxuICAgICAgcmV0cmlldmFscy5hZ2VudEV4cGVydGlzZSA9IGF3YWl0IHRoaXMucmV0cmlldmVBZ2VudEV4cGVydGlzZShjb250ZXh0KTtcblxuICAgICAgLy8gU3RvcmUgaW4gY2FjaGVcbiAgICAgIHRoaXMucmFnQ2FjaGUuc2V0KGNhY2hlS2V5LCB7XG4gICAgICAgIGNvbnRleHQ6IHJldHJpZXZhbHMsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgcXVlcnk6IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nXG4gICAgICB9KTtcblxuICAgICAgY29uc29sZS5sb2coYFske3RoaXMuaWR9XSBSQUcgY2FjaGUgc3RvcmVkIGZvciAke2NvbnRleHQuZmlsZVBhdGh9YCk7XG5cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLndhcm4oYFJBRyByZXRyaWV2YWwgZmFpbGVkIGZvciAke3RoaXMuaWR9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiByZXRyaWV2YWxzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNhY2hlIGtleSBmcm9tIGNvbnRleHRcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDYWNoZUtleShjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogc3RyaW5nIHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nO1xuICAgIGNvbnN0IGNvbnRlbnRIYXNoID0gdGhpcy5oYXNoQ29udGVudChjb250ZXh0LmNvbnRlbnQgfHwgJycpO1xuICAgIHJldHVybiBgJHt0aGlzLmlkfToke2ZpbGVQYXRofToke2NvbnRlbnRIYXNofWA7XG4gIH1cblxuICAvKipcbiAgICogU2ltcGxlIGNvbnRlbnQgaGFzaCBmb3IgY2FjaGUga2V5XG4gICAqL1xuICBwcml2YXRlIGhhc2hDb250ZW50KGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgbGV0IGhhc2ggPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oY29udGVudC5sZW5ndGgsIDEwMDApOyBpKyspIHtcbiAgICAgIGNvbnN0IGNoYXIgPSBjb250ZW50LmNoYXJDb2RlQXQoaSk7XG4gICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaGFyO1xuICAgICAgaGFzaCA9IGhhc2ggJiBoYXNoOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXJcbiAgICB9XG4gICAgcmV0dXJuIGhhc2gudG9TdHJpbmcoMzYpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgZXhwaXJlZCBjYWNoZSBlbnRyaWVzXG4gICAqL1xuICBwcml2YXRlIGNsZWFudXBFeHBpcmVkQ2FjaGUoKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgZXhwaXJlZENvdW50ID0gMDtcblxuICAgIGZvciAoY29uc3QgW2tleSwgZW50cnldIG9mIHRoaXMucmFnQ2FjaGUuZW50cmllcygpKSB7XG4gICAgICBpZiAobm93IC0gZW50cnkudGltZXN0YW1wID49IHRoaXMuUkFHX0NBQ0hFX1RUTCkge1xuICAgICAgICB0aGlzLnJhZ0NhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICBleHBpcmVkQ291bnQrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZXhwaXJlZENvdW50ID4gMCkge1xuICAgICAgY29uc29sZS5sb2coYFske3RoaXMuaWR9XSBDbGVhbmVkIHVwICR7ZXhwaXJlZENvdW50fSBleHBpcmVkIFJBRyBjYWNoZSBlbnRyaWVzYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCBjYWNoZSAodXNlZnVsIGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgcHJvdGVjdGVkIGNsZWFyUkFHQ2FjaGUoKTogdm9pZCB7XG4gICAgdGhpcy5yYWdDYWNoZS5jbGVhcigpO1xuICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzLmlkfV0gUkFHIGNhY2hlIGNsZWFyZWRgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FjaGUgc3RhdGlzdGljc1xuICAgKi9cbiAgcHJvdGVjdGVkIGdldFJBR0NhY2hlU3RhdHMoKToge1xuICAgIHNpemU6IG51bWJlcjtcbiAgICBvbGRlc3Q6IG51bWJlciB8IG51bGw7XG4gICAgbmV3ZXN0OiBudW1iZXIgfCBudWxsO1xuICB9IHtcbiAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbSh0aGlzLnJhZ0NhY2hlLnZhbHVlcygpKTtcbiAgICByZXR1cm4ge1xuICAgICAgc2l6ZTogZW50cmllcy5sZW5ndGgsXG4gICAgICBvbGRlc3Q6IGVudHJpZXMubGVuZ3RoID4gMCA/IE1hdGgubWluKC4uLmVudHJpZXMubWFwKGUgPT4gZS50aW1lc3RhbXApKSA6IG51bGwsXG4gICAgICBuZXdlc3Q6IGVudHJpZXMubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLmVudHJpZXMubWFwKGUgPT4gZS50aW1lc3RhbXApKSA6IG51bGxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHNpbWlsYXIgY29kZSBwYXR0ZXJucyBiYXNlZCBvbiBjb250ZW50IGFuZCBkb21haW5cbiAgICovXG4gIHByb3RlY3RlZCBhc3luYyByZXRyaWV2ZVNpbWlsYXJDb2RlUGF0dGVybnMoY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFByb21pc2U8TWVtb3J5RG9jdW1lbnRbXT4ge1xuICAgIGlmICghdGhpcy52ZWN0b3JTdG9yZSkgcmV0dXJuIFtdO1xuXG4gICAgY29uc3QgcXVlcnk6IFJBR1F1ZXJ5ID0ge1xuICAgICAgcXVlcnk6IHRoaXMuY3JlYXRlU2VtYW50aWNRdWVyeShjb250ZXh0LmNvbnRlbnQsIGNvbnRleHQuZmlsZVBhdGgpLFxuICAgICAgcXVlcnlUeXBlOiAnc2VtYW50aWMnLFxuICAgICAgYWdlbnRJZDogdGhpcy5pZCxcbiAgICAgIHRvcEs6IHRoaXMucmFnQ29uZmlnLm1heEV4YW1wbGVzLFxuICAgICAgZmlsdGVyczoge1xuICAgICAgICB0YWdzOiBbdGhpcy5yYWdDb25maWcuYWdlbnREb21haW4sICdwYXR0ZXJuJywgdGhpcy5kZXRlY3RMYW5ndWFnZShjb250ZXh0LmZpbGVQYXRoKV0sXG4gICAgICAgIGNvbnRlbnRUeXBlczogWydjb2RlJ11cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy52ZWN0b3JTdG9yZS5xdWVyeU1lbW9yaWVzKHF1ZXJ5KTtcbiAgICByZXR1cm4gcmVzdWx0LmRvY3VtZW50cyB8fCBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBwcmV2aW91cyBzb2x1dGlvbnMgZm9yIHNpbWlsYXIgaXNzdWVzXG4gICAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgcmV0cmlldmVQcmV2aW91c1NvbHV0aW9ucyhhbmFseXNpczogQW5hbHlzaXNSZXN1bHQpOiBQcm9taXNlPHsgW2lzc3VlVHlwZTogc3RyaW5nXTogTWVtb3J5RG9jdW1lbnRbXSB9PiB7XG4gICAgaWYgKCF0aGlzLnZlY3RvclN0b3JlKSByZXR1cm4ge307XG5cbiAgICBjb25zdCBzb2x1dGlvbnM6IHsgW2lzc3VlVHlwZTogc3RyaW5nXTogTWVtb3J5RG9jdW1lbnRbXSB9ID0ge307XG5cbiAgICBmb3IgKGNvbnN0IGlzc3VlIG9mIGFuYWx5c2lzLnBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBxdWVyeTogUkFHUXVlcnkgPSB7XG4gICAgICAgIHF1ZXJ5OiBgJHtpc3N1ZS50eXBlfSAke2lzc3VlLm1lc3NhZ2V9YCxcbiAgICAgICAgcXVlcnlUeXBlOiAnc2VtYW50aWMnLFxuICAgICAgICBhZ2VudElkOiB0aGlzLmlkLFxuICAgICAgICB0b3BLOiAyLFxuICAgICAgICBmaWx0ZXJzOiB7XG4gICAgICAgICAgdGFnczogW2lzc3VlLnR5cGUsICdzb2x1dGlvbicsIHRoaXMucmFnQ29uZmlnLmFnZW50RG9tYWluXSxcbiAgICAgICAgICBjb250ZW50VHlwZXM6IFsndGV4dCcsICdjb2RlJ11cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy52ZWN0b3JTdG9yZS5xdWVyeU1lbW9yaWVzKHF1ZXJ5KTtcbiAgICAgICAgc29sdXRpb25zW2lzc3VlLnR5cGVdID0gcmVzdWx0LmRvY3VtZW50cyB8fCBbXTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHJldHJpZXZlIHNvbHV0aW9ucyBmb3IgJHtpc3N1ZS50eXBlfTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgc29sdXRpb25zW2lzc3VlLnR5cGVdID0gW107XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNvbHV0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBwcm9qZWN0IHN0YW5kYXJkcyBzcGVjaWZpYyB0byB0aGlzIGFnZW50J3MgZG9tYWluXG4gICAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgcmV0cmlldmVQcm9qZWN0U3RhbmRhcmRzKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHtcbiAgICBpZiAoIXRoaXMudmVjdG9yU3RvcmUpIHJldHVybiBbXTtcblxuICAgIGNvbnN0IHF1ZXJ5OiBSQUdRdWVyeSA9IHtcbiAgICAgIHF1ZXJ5OiBgJHtjb250ZXh0LmZpbGVQYXRofSAke3RoaXMucmFnQ29uZmlnLmFnZW50RG9tYWlufSBzdGFuZGFyZHMgY29udmVudGlvbnNgLFxuICAgICAgcXVlcnlUeXBlOiAnc2VtYW50aWMnLFxuICAgICAgYWdlbnRJZDogdGhpcy5pZCxcbiAgICAgIHRvcEs6IDMsXG4gICAgICBmaWx0ZXJzOiB7XG4gICAgICAgIHRhZ3M6IFt0aGlzLnJhZ0NvbmZpZy5hZ2VudERvbWFpbiwgJ3N0YW5kYXJkJywgJ2NvbnZlbnRpb24nXSxcbiAgICAgICAgY29udGVudFR5cGVzOiBbJ3RleHQnXVxuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnZlY3RvclN0b3JlLnF1ZXJ5TWVtb3JpZXMocXVlcnkpO1xuICAgIHJldHVybiByZXN1bHQuZG9jdW1lbnRzIHx8IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIGFnZW50LXNwZWNpZmljIGV4cGVydGlzZSBhbmQgaW5zaWdodHNcbiAgICovXG4gIHByb3RlY3RlZCBhc3luYyByZXRyaWV2ZUFnZW50RXhwZXJ0aXNlKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPE1lbW9yeURvY3VtZW50W10+IHtcbiAgICBpZiAoIXRoaXMudmVjdG9yU3RvcmUpIHJldHVybiBbXTtcblxuICAgIGNvbnN0IHF1ZXJ5OiBSQUdRdWVyeSA9IHtcbiAgICAgIHF1ZXJ5OiB0aGlzLmNyZWF0ZVNlbWFudGljUXVlcnkoY29udGV4dC5jb250ZW50LCBjb250ZXh0LmZpbGVQYXRoKSxcbiAgICAgIHF1ZXJ5VHlwZTogJ3NlbWFudGljJyxcbiAgICAgIGFnZW50SWQ6IHRoaXMuaWQsXG4gICAgICB0b3BLOiAzLFxuICAgICAgZmlsdGVyczoge1xuICAgICAgICB0YWdzOiBbdGhpcy5pZCwgJ2V4cGVydGlzZScsIHRoaXMucmFnQ29uZmlnLmFnZW50RG9tYWluXSxcbiAgICAgICAgY29udGVudFR5cGVzOiBbJ3RleHQnLCAnY29kZSddXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudmVjdG9yU3RvcmUucXVlcnlNZW1vcmllcyhxdWVyeSk7XG4gICAgcmV0dXJuIHJlc3VsdC5kb2N1bWVudHMgfHwgW107XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgZW5oYW5jZWQgcmVzcG9uc2Ugd2l0aCBSQUcgY29udGV4dFxuICAgKi9cbiAgcHJvdGVjdGVkIGFzeW5jIGdlbmVyYXRlUkFHRW5oYW5jZWRSZXNwb25zZShcbiAgICBjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0LFxuICAgIGFuYWx5c2lzOiBBbmFseXNpc1Jlc3VsdCxcbiAgICByYWdDb250ZXh0PzogQWdlbnRSQUdDb250ZXh0XG4gICk6IFByb21pc2U8QWdlbnRSZXNwb25zZT4ge1xuICAgIC8vIENvbnZlcnQgYW5hbHlzaXMgdG8gc3VnZ2VzdGlvbnNcbiAgICBjb25zdCBzdWdnZXN0aW9ucyA9IGFuYWx5c2lzLnBhdHRlcm5zLm1hcChwID0+ICh7XG4gICAgICB0eXBlOiBwLnR5cGUsXG4gICAgICBkZXNjcmlwdGlvbjogcC5tZXNzYWdlLFxuICAgICAgbG9jYXRpb246IGAke2NvbnRleHQuZmlsZVBhdGh9OiR7cC5saW5lfWAsXG4gICAgICBwcmlvcml0eTogcC5zZXZlcml0eSxcbiAgICAgIGFjdGlvbjogcC5zdWdnZXN0aW9uXG4gICAgfSkpO1xuXG4gICAgLy8gRW5oYW5jZSBzdWdnZXN0aW9ucyB3aXRoIFJBRyBjb250ZXh0XG4gICAgaWYgKHJhZ0NvbnRleHQpIHtcbiAgICAgIHRoaXMuZW5oYW5jZVN1Z2dlc3Rpb25zV2l0aFJBRyhzdWdnZXN0aW9ucywgcmFnQ29udGV4dCk7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgZG9tYWluLXNwZWNpZmljIGhhbmRvZmZzXG4gICAgY29uc3QgaGFuZG9mZlRvID0gdGhpcy5nZW5lcmF0ZURvbWFpbkhhbmRvZmZzKGFuYWx5c2lzKTtcblxuICAgIC8vIENyZWF0ZSBlbmhhbmNlZCBtZXNzYWdlIHdpdGggUkFHIGluc2lnaHRzXG4gICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuZ2VuZXJhdGVFbmhhbmNlZE1lc3NhZ2UoYW5hbHlzaXMsIHJhZ0NvbnRleHQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFnZW50SWQ6IHRoaXMuaWQsXG4gICAgICBtZXNzYWdlLFxuICAgICAgc3VnZ2VzdGlvbnMsXG4gICAgICBwcmlvcml0eTogdGhpcy5jYWxjdWxhdGVQcmlvcml0eVdpdGhSQUcoYW5hbHlzaXMsIHJhZ0NvbnRleHQpLFxuICAgICAgaGFuZG9mZlRvLFxuICAgICAgY29udGV4dDoge1xuICAgICAgICBhbmFseXNpc1Njb3JlOiBhbmFseXNpcy5zY29yZSxcbiAgICAgICAgdG90YWxJc3N1ZXM6IGFuYWx5c2lzLnBhdHRlcm5zLmxlbmd0aCxcbiAgICAgICAgY3JpdGljYWxJc3N1ZXM6IGFuYWx5c2lzLnBhdHRlcm5zLmZpbHRlcihwID0+IHAuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpLmxlbmd0aCxcbiAgICAgICAgcmFnRW5oYW5jZWQ6ICEhcmFnQ29udGV4dCxcbiAgICAgICAgcmFnSW5zaWdodHM6IHJhZ0NvbnRleHQgPyB0aGlzLnN1bW1hcml6ZVJBR0luc2lnaHRzKHJhZ0NvbnRleHQpIDogdW5kZWZpbmVkLFxuICAgICAgICBnZW5lcmF0ZWRQcm9tcHQ6IHRoaXMuZ2VuZXJhdGVSQUdFbmhhbmNlZFByb21wdChjb250ZXh0LCBhbmFseXNpcywgcmFnQ29udGV4dCksXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogYW5hbHlzaXMucmVjb21tZW5kYXRpb25zLFxuICAgICAgICBzdW1tYXJ5OiBhbmFseXNpcy5zdW1tYXJ5XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBSQUctZW5oYW5jZWQgcHJvbXB0IHdpdGggcmV0cmlldmVkIGNvbnRleHRcbiAgICovXG4gIHByb3RlY3RlZCBnZW5lcmF0ZVJBR0VuaGFuY2VkUHJvbXB0KFxuICAgIGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQsXG4gICAgYW5hbHlzaXM6IEFuYWx5c2lzUmVzdWx0LFxuICAgIHJhZ0NvbnRleHQ/OiBBZ2VudFJBR0NvbnRleHRcbiAgKTogc3RyaW5nIHtcbiAgICBsZXQgcHJvbXB0ID0gdGhpcy5nZXRCYXNlUHJvbXB0VGVtcGxhdGUoKTtcblxuICAgIGlmIChyYWdDb250ZXh0KSB7XG4gICAgICBwcm9tcHQgKz0gJ1xcbiMjIFJldHJpZXZlZCBDb250ZXh0XFxuXFxuJztcblxuICAgICAgLy8gU2ltaWxhciBDb2RlIFBhdHRlcm5zXG4gICAgICBpZiAocmFnQ29udGV4dC5zaW1pbGFyQ29kZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHByb21wdCArPSAnIyMjIFNpbWlsYXIgQ29kZSBQYXR0ZXJucyBGcm9tIFRoaXMgUHJvamVjdDpcXG4nO1xuICAgICAgICByYWdDb250ZXh0LnNpbWlsYXJDb2RlLmZvckVhY2goKHBhdHRlcm4sIGluZGV4KSA9PiB7XG4gICAgICAgICAgY29uc3QgdGFncyA9IHBhdHRlcm4ubWV0YWRhdGE/LnRhZ3M/LmpvaW4oJywgJykgfHwgJ04vQSc7XG4gICAgICAgICAgY29uc3Qgc2NvcmUgPSBNYXRoLnJvdW5kKChwYXR0ZXJuLm1ldGFkYXRhPy5yZWxldmFuY2VTY29yZSB8fCAwKSAqIDEwMCk7XG4gICAgICAgICAgcHJvbXB0ICs9IGBFeGFtcGxlICR7aW5kZXggKyAxfSAoJHtzY29yZX0lIHJlbGV2YW5jZSwgdGFnczogJHt0YWdzfSk6XFxuYDtcbiAgICAgICAgICBwcm9tcHQgKz0gJ2BgYFxcbicgKyBwYXR0ZXJuLmNvbnRlbnQuc2xpY2UoMCwgMjAwKSArICcuLi5cXG5gYGBcXG5cXG4nO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJldmlvdXMgU29sdXRpb25zXG4gICAgICBjb25zdCBzb2x1dGlvbkVudHJpZXMgPSBPYmplY3QuZW50cmllcyhyYWdDb250ZXh0LnByZXZpb3VzU29sdXRpb25zKS5maWx0ZXIoKFtfLCBzb2x1dGlvbnNdKSA9PiBzb2x1dGlvbnMubGVuZ3RoID4gMCk7XG4gICAgICBpZiAoc29sdXRpb25FbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcHJvbXB0ICs9ICcjIyMgUHJldmlvdXMgU29sdXRpb25zIGZvciBTaW1pbGFyIElzc3VlczpcXG4nO1xuICAgICAgICBzb2x1dGlvbkVudHJpZXMuZm9yRWFjaCgoW2lzc3VlVHlwZSwgc29sdXRpb25zXSkgPT4ge1xuICAgICAgICAgIHByb21wdCArPSBgRm9yICR7aXNzdWVUeXBlfTpcXG5gO1xuICAgICAgICAgIHNvbHV0aW9ucy5mb3JFYWNoKHNvbHV0aW9uID0+IHtcbiAgICAgICAgICAgIHByb21wdCArPSBgLSAke3NvbHV0aW9uLmNvbnRlbnQuc2xpY2UoMCwgMTUwKX0uLi5cXG5gO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHByb21wdCArPSAnXFxuJztcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFByb2plY3QgU3RhbmRhcmRzXG4gICAgICBpZiAocmFnQ29udGV4dC5wcm9qZWN0U3RhbmRhcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcHJvbXB0ICs9ICcjIyMgUHJvamVjdCBTdGFuZGFyZHM6XFxuJztcbiAgICAgICAgcmFnQ29udGV4dC5wcm9qZWN0U3RhbmRhcmRzLmZvckVhY2goc3RhbmRhcmQgPT4ge1xuICAgICAgICAgIHByb21wdCArPSBgLSAke3N0YW5kYXJkLmNvbnRlbnQuc2xpY2UoMCwgMTAwKX0uLi5cXG5gO1xuICAgICAgICB9KTtcbiAgICAgICAgcHJvbXB0ICs9ICdcXG4nO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEN1cnJlbnQgY29udGV4dFxuICAgIHByb21wdCArPSAnIyMgQ3VycmVudCBDb250ZXh0XFxuJztcbiAgICBwcm9tcHQgKz0gYEZpbGU6ICR7Y29udGV4dC5maWxlUGF0aH1cXG5gO1xuICAgIHByb21wdCArPSBgSXNzdWVzIEZvdW5kOiAke0pTT04uc3RyaW5naWZ5KGFuYWx5c2lzLnBhdHRlcm5zLm1hcChwID0+ICh7IHR5cGU6IHAudHlwZSwgc2V2ZXJpdHk6IHAuc2V2ZXJpdHksIG1lc3NhZ2U6IHAubWVzc2FnZSB9KSksIG51bGwsIDIpfVxcblxcbmA7XG5cbiAgICAvLyBDb2RlIHRvIGFuYWx5emVcbiAgICBwcm9tcHQgKz0gYCMjIENvZGUgdG8gQW5hbHl6ZVxcbmA7XG4gICAgcHJvbXB0ICs9ICdgYGAnICsgdGhpcy5kZXRlY3RMYW5ndWFnZShjb250ZXh0LmZpbGVQYXRoKSArICdcXG4nO1xuICAgIHByb21wdCArPSBjb250ZXh0LmNvbnRlbnQgKyAnXFxuJztcbiAgICBwcm9tcHQgKz0gJ2BgYFxcblxcbic7XG5cbiAgICBwcm9tcHQgKz0gJ1VzaW5nIHRoZSByZXRyaWV2ZWQgY29udGV4dCBhYm92ZSBhcyByZWZlcmVuY2UsIHByb3ZpZGUgeW91ciBhbmFseXNpcyBhbmQgcmVjb21tZW5kYXRpb25zLlxcbic7XG5cbiAgICByZXR1cm4gcHJvbXB0O1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIHN1Y2Nlc3NmdWwgcGF0dGVybnMgZm9yIGZ1dHVyZSBsZWFybmluZ1xuICAgKi9cbiAgcHJvdGVjdGVkIGFzeW5jIHN0b3JlTmV3UGF0dGVybnMoXG4gICAgY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCxcbiAgICBhbmFseXNpczogQW5hbHlzaXNSZXN1bHQsXG4gICAgcmVzcG9uc2U6IEFnZW50UmVzcG9uc2VcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLnZlY3RvclN0b3JlKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgbGFuZ3VhZ2UgPSB0aGlzLmRldGVjdExhbmd1YWdlKGNvbnRleHQuZmlsZVBhdGgpO1xuXG4gICAgICAvLyBTdG9yZSBoaWdoLXF1YWxpdHkgY29kZSBwYXR0ZXJucyAoc2NvcmUgPj0gODApXG4gICAgICBpZiAoYW5hbHlzaXMuc2NvcmUgPj0gODApIHtcbiAgICAgICAgY29uc3QgcGF0dGVybkRvYzogTWVtb3J5RG9jdW1lbnQgPSB7XG4gICAgICAgICAgaWQ6IGBwYXR0ZXJuXyR7dGhpcy5pZH1fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgICAgIGNvbnRlbnQ6IGNvbnRleHQuY29udGVudCxcbiAgICAgICAgICBjb250ZW50VHlwZTogJ2NvZGUnLFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICBhZ2VudElkOiB0aGlzLmlkLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgZmlsZVR5cGU6IGNvbnRleHQuZmlsZVBhdGguc3BsaXQoJy4nKS5wb3AoKSB8fCAnJyxcbiAgICAgICAgICAgIHByb2plY3RDb250ZXh0OiAnVkVSU0FUSUwgRnJhbWV3b3JrJyxcbiAgICAgICAgICAgIHRhZ3M6IFtsYW5ndWFnZSwgdGhpcy5yYWdDb25maWcuYWdlbnREb21haW4sICdwYXR0ZXJuJywgJ2hpZ2gtcXVhbGl0eSddLFxuICAgICAgICAgICAgcmVsZXZhbmNlU2NvcmU6IGFuYWx5c2lzLnNjb3JlIC8gMTAwLFxuICAgICAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgICAgICBmcmFtZXdvcms6IHRoaXMuZGV0ZWN0RnJhbWV3b3JrKGNvbnRleHQuY29udGVudClcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgYXdhaXQgdGhpcy52ZWN0b3JTdG9yZS5zdG9yZU1lbW9yeShwYXR0ZXJuRG9jKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RvcmUgc3VjY2Vzc2Z1bCBzb2x1dGlvbnMgZm9yIGRldGVjdGVkIGlzc3Vlc1xuICAgICAgZm9yIChjb25zdCBzdWdnZXN0aW9uIG9mIHJlc3BvbnNlLnN1Z2dlc3Rpb25zKSB7XG4gICAgICAgIGlmIChzdWdnZXN0aW9uLnByaW9yaXR5ICE9PSAnbG93Jykge1xuICAgICAgICAgIGNvbnN0IHNvbHV0aW9uRG9jOiBNZW1vcnlEb2N1bWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBgc29sdXRpb25fJHt0aGlzLmlkfV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgICAgICBjb250ZW50OiBzdWdnZXN0aW9uLmFjdGlvbixcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBhZ2VudElkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgICAgIHByb2plY3RDb250ZXh0OiAnVkVSU0FUSUwgRnJhbWV3b3JrJyxcbiAgICAgICAgICAgICAgdGFnczogW2xhbmd1YWdlLCB0aGlzLnJhZ0NvbmZpZy5hZ2VudERvbWFpbiwgc3VnZ2VzdGlvbi50eXBlLCAnc29sdXRpb24nXSxcbiAgICAgICAgICAgICAgcmVsZXZhbmNlU2NvcmU6IHN1Z2dlc3Rpb24ucHJpb3JpdHkgPT09ICdjcml0aWNhbCcgPyAxLjAgOiBzdWdnZXN0aW9uLnByaW9yaXR5ID09PSAnaGlnaCcgPyAwLjggOiAwLjYsXG4gICAgICAgICAgICAgIGxhbmd1YWdlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGF3YWl0IHRoaXMudmVjdG9yU3RvcmUuc3RvcmVNZW1vcnkoc29sdXRpb25Eb2MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHN0b3JlIHBhdHRlcm5zIGZvciAke3RoaXMuaWR9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEhlbHBlciBtZXRob2RzXG5cbiAgcHJvdGVjdGVkIGdldEVtcHR5UkFHQ29udGV4dCgpOiBBZ2VudFJBR0NvbnRleHQge1xuICAgIHJldHVybiB7XG4gICAgICBzaW1pbGFyQ29kZTogW10sXG4gICAgICBwcmV2aW91c1NvbHV0aW9uczoge30sXG4gICAgICBwcm9qZWN0U3RhbmRhcmRzOiBbXSxcbiAgICAgIGFnZW50RXhwZXJ0aXNlOiBbXVxuICAgIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlU2VtYW50aWNRdWVyeShjb250ZW50OiBzdHJpbmcsIGZpbGVQYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIEV4dHJhY3Qga2V5IGNvbmNlcHRzIGFuZCBjcmVhdGUgc2VtYW50aWMgcXVlcnlcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuICAgIGNvbnN0IGtleXdvcmRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLy8gRXh0cmFjdCBmdW5jdGlvbi9jbGFzcyBuYW1lc1xuICAgIGNvbnN0IGZ1bmN0aW9uTWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goLyg/OmZ1bmN0aW9ufGNsYXNzfGNvbnN0fGxldHx2YXIpXFxzKyhcXHcrKS9nKTtcbiAgICBpZiAoZnVuY3Rpb25NYXRjaGVzKSB7XG4gICAgICBrZXl3b3Jkcy5wdXNoKC4uLmZ1bmN0aW9uTWF0Y2hlcy5tYXAobWF0Y2ggPT4gbWF0Y2guc3BsaXQoL1xccysvKVsxXSkpO1xuICAgIH1cblxuICAgIC8vIEFkZCBmaWxlIHBhdGggY29udGV4dFxuICAgIGNvbnN0IHBhdGhQYXJ0cyA9IGZpbGVQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHBhcnQgPT4gcGFydCAmJiAhcGFydC5pbmNsdWRlcygnLicpKTtcbiAgICBrZXl3b3Jkcy5wdXNoKC4uLnBhdGhQYXJ0cyk7XG5cbiAgICAvLyBDcmVhdGUgY29uY2lzZSBzZW1hbnRpYyBxdWVyeVxuICAgIGNvbnN0IHVuaXF1ZUtleXdvcmRzID0gWy4uLm5ldyBTZXQoa2V5d29yZHMpXS5maWx0ZXIoayA9PiBrICYmIGsubGVuZ3RoID4gMikuc2xpY2UoMCwgOCk7XG4gICAgcmV0dXJuIHVuaXF1ZUtleXdvcmRzLmpvaW4oJyAnKSB8fCBjb250ZW50LnNsaWNlKDAsIDE1MCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZGV0ZWN0TGFuZ3VhZ2UoZmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgZXh0ID0gZmlsZVBhdGguc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKSB8fCAnJztcbiAgICBjb25zdCBsYW5nTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgJ2pzJzogJ2phdmFzY3JpcHQnLCAnanN4JzogJ2phdmFzY3JpcHRyZWFjdCcsXG4gICAgICAndHMnOiAndHlwZXNjcmlwdCcsICd0c3gnOiAndHlwZXNjcmlwdHJlYWN0JyxcbiAgICAgICdweSc6ICdweXRob24nLCAndnVlJzogJ3Z1ZScsICdzdmVsdGUnOiAnc3ZlbHRlJ1xuICAgIH07XG4gICAgcmV0dXJuIGxhbmdNYXBbZXh0XSB8fCAncGxhaW50ZXh0JztcbiAgfVxuXG4gIHByb3RlY3RlZCBkZXRlY3RGcmFtZXdvcmsoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygncmVhY3QnKSB8fCBjb250ZW50LmluY2x1ZGVzKCd1c2VTdGF0ZScpKSByZXR1cm4gJ3JlYWN0JztcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygndnVlJykgfHwgY29udGVudC5pbmNsdWRlcygnVnVlJykpIHJldHVybiAndnVlJztcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygnYW5ndWxhcicpKSByZXR1cm4gJ2FuZ3VsYXInO1xuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdleHByZXNzJykgfHwgY29udGVudC5pbmNsdWRlcygnYXBwLmdldCcpKSByZXR1cm4gJ2V4cHJlc3MnO1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHByb3RlY3RlZCBlbmhhbmNlU3VnZ2VzdGlvbnNXaXRoUkFHKHN1Z2dlc3Rpb25zOiBhbnlbXSwgcmFnQ29udGV4dDogQWdlbnRSQUdDb250ZXh0KTogdm9pZCB7XG4gICAgLy8gQWRkIFJBRy1kZXJpdmVkIHN1Z2dlc3Rpb25zXG4gICAgaWYgKHJhZ0NvbnRleHQuc2ltaWxhckNvZGUubGVuZ3RoID4gMCkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdyYWctcGF0dGVybicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgRm91bmQgJHtyYWdDb250ZXh0LnNpbWlsYXJDb2RlLmxlbmd0aH0gc2ltaWxhciBwYXR0ZXJucyBpbiBwcm9qZWN0IGhpc3RvcnlgLFxuICAgICAgICBsb2NhdGlvbjogJ1JBRyBDb250ZXh0JyxcbiAgICAgICAgcHJpb3JpdHk6ICdpbmZvJyxcbiAgICAgICAgYWN0aW9uOiAnUmV2aWV3IHNpbWlsYXIgaW1wbGVtZW50YXRpb25zIGZvciBjb25zaXN0ZW5jeSBhbmQgYmVzdCBwcmFjdGljZXMnXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2VuZXJhdGVFbmhhbmNlZE1lc3NhZ2UoYW5hbHlzaXM6IEFuYWx5c2lzUmVzdWx0LCByYWdDb250ZXh0PzogQWdlbnRSQUdDb250ZXh0KTogc3RyaW5nIHtcbiAgICBsZXQgbWVzc2FnZSA9IGAke3RoaXMucmFnQ29uZmlnLmFnZW50RG9tYWlufSBBbmFseXNpcyBDb21wbGV0ZTogU2NvcmUgJHthbmFseXNpcy5zY29yZX0vMTAwLiAke2FuYWx5c2lzLnBhdHRlcm5zLmxlbmd0aH0gaXNzdWVzIGZvdW5kLmA7XG5cbiAgICBpZiAocmFnQ29udGV4dCkge1xuICAgICAgY29uc3QgcmFnSW5zaWdodHMgPSBbXTtcbiAgICAgIGlmIChyYWdDb250ZXh0LnNpbWlsYXJDb2RlLmxlbmd0aCA+IDApIHJhZ0luc2lnaHRzLnB1c2goYCR7cmFnQ29udGV4dC5zaW1pbGFyQ29kZS5sZW5ndGh9IHNpbWlsYXIgcGF0dGVybnNgKTtcbiAgICAgIGlmIChPYmplY3Qua2V5cyhyYWdDb250ZXh0LnByZXZpb3VzU29sdXRpb25zKS5sZW5ndGggPiAwKSByYWdJbnNpZ2h0cy5wdXNoKGBzb2x1dGlvbnMgZm9yICR7T2JqZWN0LmtleXMocmFnQ29udGV4dC5wcmV2aW91c1NvbHV0aW9ucykubGVuZ3RofSBpc3N1ZSB0eXBlc2ApO1xuICAgICAgaWYgKHJhZ0NvbnRleHQucHJvamVjdFN0YW5kYXJkcy5sZW5ndGggPiAwKSByYWdJbnNpZ2h0cy5wdXNoKGAke3JhZ0NvbnRleHQucHJvamVjdFN0YW5kYXJkcy5sZW5ndGh9IHByb2plY3Qgc3RhbmRhcmRzYCk7XG5cbiAgICAgIGlmIChyYWdJbnNpZ2h0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG1lc3NhZ2UgKz0gYCBSQUctRW5oYW5jZWQ6ICR7cmFnSW5zaWdodHMuam9pbignLCAnKX0uYDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzdW1tYXJpemVSQUdJbnNpZ2h0cyhyYWdDb250ZXh0OiBBZ2VudFJBR0NvbnRleHQpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICBzaW1pbGFyUGF0dGVybnM6IHJhZ0NvbnRleHQuc2ltaWxhckNvZGUubGVuZ3RoLFxuICAgICAgc29sdXRpb25UeXBlczogT2JqZWN0LmtleXMocmFnQ29udGV4dC5wcmV2aW91c1NvbHV0aW9ucykubGVuZ3RoLFxuICAgICAgcHJvamVjdFN0YW5kYXJkczogcmFnQ29udGV4dC5wcm9qZWN0U3RhbmRhcmRzLmxlbmd0aCxcbiAgICAgIGV4cGVydGlzZTogcmFnQ29udGV4dC5hZ2VudEV4cGVydGlzZS5sZW5ndGhcbiAgICB9O1xuICB9XG5cbiAgcHJvdGVjdGVkIGNhbGN1bGF0ZVByaW9yaXR5V2l0aFJBRyhhbmFseXNpczogQW5hbHlzaXNSZXN1bHQsIHJhZ0NvbnRleHQ/OiBBZ2VudFJBR0NvbnRleHQpOiBzdHJpbmcge1xuICAgIC8vIENoZWNrIGZvciBjcml0aWNhbCBzZXZlcml0eSBpc3N1ZXMgZmlyc3RcbiAgICBjb25zdCBoYXNDcml0aWNhbCA9IGFuYWx5c2lzLnBhdHRlcm5zLnNvbWUocCA9PiBwLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKTtcbiAgICBpZiAoaGFzQ3JpdGljYWwpIHJldHVybiAnY3JpdGljYWwnO1xuXG4gICAgY29uc3QgaGFzSGlnaCA9IGFuYWx5c2lzLnBhdHRlcm5zLnNvbWUocCA9PiBwLnNldmVyaXR5ID09PSAnaGlnaCcpO1xuICAgIGlmIChoYXNIaWdoKSByZXR1cm4gJ2hpZ2gnO1xuXG4gICAgLy8gRmFsbCBiYWNrIHRvIHNjb3JlLWJhc2VkIHByaW9yaXR5XG4gICAgbGV0IGJhc2VQcmlvcml0eSA9IGFuYWx5c2lzLnNjb3JlIDwgNjAgPyAnaGlnaCcgOiBhbmFseXNpcy5zY29yZSA8IDgwID8gJ21lZGl1bScgOiAnbG93JztcblxuICAgIC8vIEJvb3N0IHByaW9yaXR5IGlmIFJBRyBjb250ZXh0IHNob3dzIHRoaXMgaXMgYSByZWN1cnJpbmcgaXNzdWVcbiAgICBpZiAocmFnQ29udGV4dCAmJiBPYmplY3Qua2V5cyhyYWdDb250ZXh0LnByZXZpb3VzU29sdXRpb25zKS5sZW5ndGggPiAyKSB7XG4gICAgICBpZiAoYmFzZVByaW9yaXR5ID09PSAnbG93JykgYmFzZVByaW9yaXR5ID0gJ21lZGl1bSc7XG4gICAgICBpZiAoYmFzZVByaW9yaXR5ID09PSAnbWVkaXVtJykgYmFzZVByaW9yaXR5ID0gJ2hpZ2gnO1xuICAgIH1cblxuICAgIHJldHVybiBiYXNlUHJpb3JpdHk7XG4gIH1cblxuICAvLyBBYnN0cmFjdCBtZXRob2RzIHRvIGJlIGltcGxlbWVudGVkIGJ5IHNwZWNpZmljIGFnZW50c1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0QmFzZVByb21wdFRlbXBsYXRlKCk6IHN0cmluZztcbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdlbmVyYXRlRG9tYWluSGFuZG9mZnMoYW5hbHlzaXM6IEFuYWx5c2lzUmVzdWx0KTogc3RyaW5nW107XG59Il0sInZlcnNpb24iOjN9