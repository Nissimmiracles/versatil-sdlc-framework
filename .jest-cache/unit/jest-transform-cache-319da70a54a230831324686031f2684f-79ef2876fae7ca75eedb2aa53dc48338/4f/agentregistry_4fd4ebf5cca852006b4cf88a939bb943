8833ca5d0281e1f22e2411b9dc7f2a63
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.agentRegistry = exports.log = exports.AgentRegistry = void 0;
const enhanced_maria_1 = require("./enhanced-maria");
const enhanced_james_1 = require("./enhanced-james");
const enhanced_marcus_1 = require("./enhanced-marcus");
const sarah_pm_1 = require("./sarah-pm");
const alex_ba_1 = require("./alex-ba");
const dr_ai_ml_1 = require("./dr-ai-ml");
const devops_dan_1 = require("./devops-dan");
const security_sam_1 = require("./security-sam");
const architecture_dan_1 = require("./architecture-dan");
const deployment_orchestrator_1 = require("./deployment-orchestrator");
const introspective_agent_1 = require("./introspective-agent");
const simulation_qa_1 = require("./simulation-qa");
class AgentRegistry {
    constructor() {
        this.agents = new Map();
        this.registerAllAgents();
    }
    registerAllAgents() {
        this.agents.set('enhanced-maria', new enhanced_maria_1.EnhancedMaria());
        this.agents.set('enhanced-james', new enhanced_james_1.EnhancedJames());
        this.agents.set('enhanced-marcus', new enhanced_marcus_1.EnhancedMarcus());
        this.agents.set('sarah-pm', new sarah_pm_1.SarahPm());
        this.agents.set('alex-ba', new alex_ba_1.AlexBa());
        this.agents.set('dr-ai-ml', new dr_ai_ml_1.DrAiMl());
        this.agents.set('devops-dan', new devops_dan_1.DevopsDan());
        this.agents.set('security-sam', new security_sam_1.SecuritySam());
        this.agents.set('architecture-dan', new architecture_dan_1.ArchitectureDan());
        this.agents.set('deployment-orchestrator', new deployment_orchestrator_1.DeploymentOrchestrator());
        this.agents.set('introspective-agent', new introspective_agent_1.IntrospectiveAgent());
        this.agents.set('simulation-qa', new simulation_qa_1.SimulationQa());
    }
    getAgent(id) {
        return this.agents.get(id);
    }
    getAllAgents() {
        return Array.from(this.agents.values());
    }
    listAgents() {
        return this.getAllAgents();
    }
    registerAgent(id, agent) {
        this.agents.set(id, agent);
    }
    getAgentsForFilePattern(pattern) {
        return this.getAllAgents();
    }
    getStatus() {
        return {
            totalAgents: this.agents.size,
            agents: Array.from(this.agents.entries()).map(([id, agent]) => ({
                id,
                name: agent.name,
                specialization: agent.specialization
            }))
        };
    }
    isHealthy() {
        return this.agents.size > 0;
    }
    getAgentMetadata(id) {
        const agent = this.agents.get(id);
        if (!agent)
            return undefined;
        const metadata = {
            name: agent.name,
            specialization: agent.specialization,
            autoActivate: false,
            priority: id === 'introspective-agent' ? 4 : 3,
            triggers: {
                keywords: this.getKeywordsForAgent(id),
                patterns: [],
                fileTypes: []
            },
            collaborators: this.getCollaboratorIds(id)
        };
        // Add MCP tools for introspective agent
        if (id === 'introspective-agent') {
            metadata.mcpTools = ['Read MCP', 'Bash MCP', 'WebFetch MCP'];
        }
        return metadata;
    }
    getCollaborators(id) {
        const collaboratorIds = this.getCollaboratorIds(id);
        return collaboratorIds
            .map(collabId => this.agents.get(collabId))
            .filter((agent) => agent !== undefined);
    }
    getKeywordsForAgent(id) {
        const keywordMap = {
            'introspective-agent': ['introspection', 'optimization', 'performance', 'learning'],
            'enhanced-maria': ['test', 'quality', 'coverage', 'validation'],
            'enhanced-james': ['ui', 'frontend', 'component', 'accessibility'],
            'enhanced-marcus': ['api', 'backend', 'security', 'database'],
            'sarah-pm': ['project', 'sprint', 'milestone', 'timeline'],
            'alex-ba': ['requirements', 'business', 'analysis', 'stakeholder'],
            'dr-ai-ml': ['machine learning', 'model', 'training', 'prediction']
        };
        return keywordMap[id] || [];
    }
    getCollaboratorIds(id) {
        const collabMap = {
            'introspective-agent': ['enhanced-maria', 'enhanced-james', 'enhanced-marcus'],
            'enhanced-maria': ['enhanced-james', 'enhanced-marcus'],
            'enhanced-james': ['enhanced-maria', 'enhanced-marcus'],
            'enhanced-marcus': ['enhanced-maria', 'enhanced-james'],
            'sarah-pm': ['enhanced-maria', 'enhanced-james', 'enhanced-marcus', 'alex-ba'],
            'alex-ba': ['sarah-pm', 'enhanced-maria'],
            'dr-ai-ml': ['enhanced-marcus', 'enhanced-maria']
        };
        return collabMap[id] || [];
    }
}
exports.AgentRegistry = AgentRegistry;
exports.log = console;
// Export singleton instance for easy import
exports.agentRegistry = new AgentRegistry();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2FnZW50LXJlZ2lzdHJ5LnRzIiwibWFwcGluZ3MiOiI7OztBQUVBLHFEQUFpRDtBQUNqRCxxREFBaUQ7QUFDakQsdURBQW1EO0FBQ25ELHlDQUFxQztBQUNyQyx1Q0FBbUM7QUFDbkMseUNBQW9DO0FBQ3BDLDZDQUF5QztBQUN6QyxpREFBNkM7QUFDN0MseURBQXFEO0FBQ3JELHVFQUFtRTtBQUNuRSwrREFBMkQ7QUFDM0QsbURBQStDO0FBRS9DLE1BQWEsYUFBYTtJQUd4QjtRQUZRLFdBQU0sR0FBRyxJQUFJLEdBQUcsRUFBcUIsQ0FBQztRQUc1QyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRU8saUJBQWlCO1FBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLElBQUksOEJBQWEsRUFBRSxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSw4QkFBYSxFQUFFLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLGdDQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLGtCQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxJQUFJLGdCQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLGlCQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxJQUFJLHNCQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxJQUFJLDBCQUFXLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLElBQUksa0NBQWUsRUFBRSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMseUJBQXlCLEVBQUUsSUFBSSxnREFBc0IsRUFBRSxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsSUFBSSx3Q0FBa0IsRUFBRSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLElBQUksNEJBQVksRUFBRSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELFFBQVEsQ0FBQyxFQUFVO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELFlBQVk7UUFDVixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRCxVQUFVO1FBQ1IsT0FBTyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVELGFBQWEsQ0FBQyxFQUFVLEVBQUUsS0FBZ0I7UUFDeEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCx1QkFBdUIsQ0FBQyxPQUFlO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxTQUFTO1FBQ1AsT0FBTztZQUNMLFdBQVcsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUk7WUFDN0IsTUFBTSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM5RCxFQUFFO2dCQUNGLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSTtnQkFDaEIsY0FBYyxFQUFFLEtBQUssQ0FBQyxjQUFjO2FBQ3JDLENBQUMsQ0FBQztTQUNKLENBQUM7SUFDSixDQUFDO0lBRUQsU0FBUztRQUNQLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxFQUFVO1FBQ3pCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxLQUFLO1lBQUUsT0FBTyxTQUFTLENBQUM7UUFFN0IsTUFBTSxRQUFRLEdBQVE7WUFDcEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO1lBQ2hCLGNBQWMsRUFBRSxLQUFLLENBQUMsY0FBYztZQUNwQyxZQUFZLEVBQUUsS0FBSztZQUNuQixRQUFRLEVBQUUsRUFBRSxLQUFLLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsUUFBUSxFQUFFO2dCQUNSLFFBQVEsRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsRUFBRSxDQUFDO2dCQUN0QyxRQUFRLEVBQUUsRUFBRTtnQkFDWixTQUFTLEVBQUUsRUFBRTthQUNkO1lBQ0QsYUFBYSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLENBQUM7U0FDM0MsQ0FBQztRQUVGLHdDQUF3QztRQUN4QyxJQUFJLEVBQUUsS0FBSyxxQkFBcUIsRUFBRSxDQUFDO1lBQ2pDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQy9ELENBQUM7UUFFRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQsZ0JBQWdCLENBQUMsRUFBVTtRQUN6QixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEQsT0FBTyxlQUFlO2FBQ25CLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQzFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBc0IsRUFBRSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRU8sbUJBQW1CLENBQUMsRUFBVTtRQUNwQyxNQUFNLFVBQVUsR0FBNkI7WUFDM0MscUJBQXFCLEVBQUUsQ0FBQyxlQUFlLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxVQUFVLENBQUM7WUFDbkYsZ0JBQWdCLEVBQUUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLENBQUM7WUFDL0QsZ0JBQWdCLEVBQUUsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxlQUFlLENBQUM7WUFDbEUsaUJBQWlCLEVBQUUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDN0QsVUFBVSxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDO1lBQzFELFNBQVMsRUFBRSxDQUFDLGNBQWMsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLGFBQWEsQ0FBQztZQUNsRSxVQUFVLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQztTQUNwRSxDQUFDO1FBQ0YsT0FBTyxVQUFVLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFTyxrQkFBa0IsQ0FBQyxFQUFVO1FBQ25DLE1BQU0sU0FBUyxHQUE2QjtZQUMxQyxxQkFBcUIsRUFBRSxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixDQUFDO1lBQzlFLGdCQUFnQixFQUFFLENBQUMsZ0JBQWdCLEVBQUUsaUJBQWlCLENBQUM7WUFDdkQsZ0JBQWdCLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQztZQUN2RCxpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDO1lBQ3ZELFVBQVUsRUFBRSxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLFNBQVMsQ0FBQztZQUM5RSxTQUFTLEVBQUUsQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLENBQUM7WUFDekMsVUFBVSxFQUFFLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUM7U0FDbEQsQ0FBQztRQUNGLE9BQU8sU0FBUyxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM3QixDQUFDO0NBQ0Y7QUFsSEQsc0NBa0hDO0FBRVksUUFBQSxHQUFHLEdBQUcsT0FBTyxDQUFDO0FBRTNCLDRDQUE0QztBQUMvQixRQUFBLGFBQWEsR0FBRyxJQUFJLGFBQWEsRUFBRSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaXNzaW1tZW5hc2hlL1ZFUlNBVElMIFNETEMgRlcvc3JjL2FnZW50cy9hZ2VudC1yZWdpc3RyeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWRVJTQVRJTExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBCYXNlQWdlbnQgfSBmcm9tICcuL2Jhc2UtYWdlbnQnO1xuaW1wb3J0IHsgRW5oYW5jZWRNYXJpYSB9IGZyb20gJy4vZW5oYW5jZWQtbWFyaWEnO1xuaW1wb3J0IHsgRW5oYW5jZWRKYW1lcyB9IGZyb20gJy4vZW5oYW5jZWQtamFtZXMnO1xuaW1wb3J0IHsgRW5oYW5jZWRNYXJjdXMgfSBmcm9tICcuL2VuaGFuY2VkLW1hcmN1cyc7XG5pbXBvcnQgeyBTYXJhaFBtIH0gZnJvbSAnLi9zYXJhaC1wbSc7XG5pbXBvcnQgeyBBbGV4QmEgfSBmcm9tICcuL2FsZXgtYmEnO1xuaW1wb3J0IHsgRHJBaU1sIH0gZnJvbSAnLi9kci1haS1tbCc7XG5pbXBvcnQgeyBEZXZvcHNEYW4gfSBmcm9tICcuL2Rldm9wcy1kYW4nO1xuaW1wb3J0IHsgU2VjdXJpdHlTYW0gfSBmcm9tICcuL3NlY3VyaXR5LXNhbSc7XG5pbXBvcnQgeyBBcmNoaXRlY3R1cmVEYW4gfSBmcm9tICcuL2FyY2hpdGVjdHVyZS1kYW4nO1xuaW1wb3J0IHsgRGVwbG95bWVudE9yY2hlc3RyYXRvciB9IGZyb20gJy4vZGVwbG95bWVudC1vcmNoZXN0cmF0b3InO1xuaW1wb3J0IHsgSW50cm9zcGVjdGl2ZUFnZW50IH0gZnJvbSAnLi9pbnRyb3NwZWN0aXZlLWFnZW50JztcbmltcG9ydCB7IFNpbXVsYXRpb25RYSB9IGZyb20gJy4vc2ltdWxhdGlvbi1xYSc7XG5cbmV4cG9ydCBjbGFzcyBBZ2VudFJlZ2lzdHJ5IHtcbiAgcHJpdmF0ZSBhZ2VudHMgPSBuZXcgTWFwPHN0cmluZywgQmFzZUFnZW50PigpO1xuICBcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5yZWdpc3RlckFsbEFnZW50cygpO1xuICB9XG4gIFxuICBwcml2YXRlIHJlZ2lzdGVyQWxsQWdlbnRzKCk6IHZvaWQge1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZW5oYW5jZWQtbWFyaWEnLCBuZXcgRW5oYW5jZWRNYXJpYSgpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2VuaGFuY2VkLWphbWVzJywgbmV3IEVuaGFuY2VkSmFtZXMoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdlbmhhbmNlZC1tYXJjdXMnLCBuZXcgRW5oYW5jZWRNYXJjdXMoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdzYXJhaC1wbScsIG5ldyBTYXJhaFBtKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnYWxleC1iYScsIG5ldyBBbGV4QmEoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdkci1haS1tbCcsIG5ldyBEckFpTWwoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdkZXZvcHMtZGFuJywgbmV3IERldm9wc0RhbigpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ3NlY3VyaXR5LXNhbScsIG5ldyBTZWN1cml0eVNhbSgpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2FyY2hpdGVjdHVyZS1kYW4nLCBuZXcgQXJjaGl0ZWN0dXJlRGFuKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZGVwbG95bWVudC1vcmNoZXN0cmF0b3InLCBuZXcgRGVwbG95bWVudE9yY2hlc3RyYXRvcigpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2ludHJvc3BlY3RpdmUtYWdlbnQnLCBuZXcgSW50cm9zcGVjdGl2ZUFnZW50KCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnc2ltdWxhdGlvbi1xYScsIG5ldyBTaW11bGF0aW9uUWEoKSk7XG4gIH1cbiAgXG4gIGdldEFnZW50KGlkOiBzdHJpbmcpOiBCYXNlQWdlbnQgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmFnZW50cy5nZXQoaWQpO1xuICB9XG4gIFxuICBnZXRBbGxBZ2VudHMoKTogQmFzZUFnZW50W10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuYWdlbnRzLnZhbHVlcygpKTtcbiAgfVxuXG4gIGxpc3RBZ2VudHMoKTogQmFzZUFnZW50W10ge1xuICAgIHJldHVybiB0aGlzLmdldEFsbEFnZW50cygpO1xuICB9XG5cbiAgcmVnaXN0ZXJBZ2VudChpZDogc3RyaW5nLCBhZ2VudDogQmFzZUFnZW50KTogdm9pZCB7XG4gICAgdGhpcy5hZ2VudHMuc2V0KGlkLCBhZ2VudCk7XG4gIH1cblxuICBnZXRBZ2VudHNGb3JGaWxlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBCYXNlQWdlbnRbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsQWdlbnRzKCk7XG4gIH1cblxuICBnZXRTdGF0dXMoKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxBZ2VudHM6IHRoaXMuYWdlbnRzLnNpemUsXG4gICAgICBhZ2VudHM6IEFycmF5LmZyb20odGhpcy5hZ2VudHMuZW50cmllcygpKS5tYXAoKFtpZCwgYWdlbnRdKSA9PiAoe1xuICAgICAgICBpZCxcbiAgICAgICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICAgICAgc3BlY2lhbGl6YXRpb246IGFnZW50LnNwZWNpYWxpemF0aW9uXG4gICAgICB9KSlcbiAgICB9O1xuICB9XG5cbiAgaXNIZWFsdGh5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmFnZW50cy5zaXplID4gMDtcbiAgfVxuXG4gIGdldEFnZW50TWV0YWRhdGEoaWQ6IHN0cmluZyk6IGFueSB7XG4gICAgY29uc3QgYWdlbnQgPSB0aGlzLmFnZW50cy5nZXQoaWQpO1xuICAgIGlmICghYWdlbnQpIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCBtZXRhZGF0YTogYW55ID0ge1xuICAgICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICAgIHNwZWNpYWxpemF0aW9uOiBhZ2VudC5zcGVjaWFsaXphdGlvbixcbiAgICAgIGF1dG9BY3RpdmF0ZTogZmFsc2UsXG4gICAgICBwcmlvcml0eTogaWQgPT09ICdpbnRyb3NwZWN0aXZlLWFnZW50JyA/IDQgOiAzLFxuICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAga2V5d29yZHM6IHRoaXMuZ2V0S2V5d29yZHNGb3JBZ2VudChpZCksXG4gICAgICAgIHBhdHRlcm5zOiBbXSxcbiAgICAgICAgZmlsZVR5cGVzOiBbXVxuICAgICAgfSxcbiAgICAgIGNvbGxhYm9yYXRvcnM6IHRoaXMuZ2V0Q29sbGFib3JhdG9ySWRzKGlkKVxuICAgIH07XG5cbiAgICAvLyBBZGQgTUNQIHRvb2xzIGZvciBpbnRyb3NwZWN0aXZlIGFnZW50XG4gICAgaWYgKGlkID09PSAnaW50cm9zcGVjdGl2ZS1hZ2VudCcpIHtcbiAgICAgIG1ldGFkYXRhLm1jcFRvb2xzID0gWydSZWFkIE1DUCcsICdCYXNoIE1DUCcsICdXZWJGZXRjaCBNQ1AnXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWV0YWRhdGE7XG4gIH1cblxuICBnZXRDb2xsYWJvcmF0b3JzKGlkOiBzdHJpbmcpOiBCYXNlQWdlbnRbXSB7XG4gICAgY29uc3QgY29sbGFib3JhdG9ySWRzID0gdGhpcy5nZXRDb2xsYWJvcmF0b3JJZHMoaWQpO1xuICAgIHJldHVybiBjb2xsYWJvcmF0b3JJZHNcbiAgICAgIC5tYXAoY29sbGFiSWQgPT4gdGhpcy5hZ2VudHMuZ2V0KGNvbGxhYklkKSlcbiAgICAgIC5maWx0ZXIoKGFnZW50KTogYWdlbnQgaXMgQmFzZUFnZW50ID0+IGFnZW50ICE9PSB1bmRlZmluZWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRLZXl3b3Jkc0ZvckFnZW50KGlkOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qga2V5d29yZE1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgJ2ludHJvc3BlY3RpdmUtYWdlbnQnOiBbJ2ludHJvc3BlY3Rpb24nLCAnb3B0aW1pemF0aW9uJywgJ3BlcmZvcm1hbmNlJywgJ2xlYXJuaW5nJ10sXG4gICAgICAnZW5oYW5jZWQtbWFyaWEnOiBbJ3Rlc3QnLCAncXVhbGl0eScsICdjb3ZlcmFnZScsICd2YWxpZGF0aW9uJ10sXG4gICAgICAnZW5oYW5jZWQtamFtZXMnOiBbJ3VpJywgJ2Zyb250ZW5kJywgJ2NvbXBvbmVudCcsICdhY2Nlc3NpYmlsaXR5J10sXG4gICAgICAnZW5oYW5jZWQtbWFyY3VzJzogWydhcGknLCAnYmFja2VuZCcsICdzZWN1cml0eScsICdkYXRhYmFzZSddLFxuICAgICAgJ3NhcmFoLXBtJzogWydwcm9qZWN0JywgJ3NwcmludCcsICdtaWxlc3RvbmUnLCAndGltZWxpbmUnXSxcbiAgICAgICdhbGV4LWJhJzogWydyZXF1aXJlbWVudHMnLCAnYnVzaW5lc3MnLCAnYW5hbHlzaXMnLCAnc3Rha2Vob2xkZXInXSxcbiAgICAgICdkci1haS1tbCc6IFsnbWFjaGluZSBsZWFybmluZycsICdtb2RlbCcsICd0cmFpbmluZycsICdwcmVkaWN0aW9uJ11cbiAgICB9O1xuICAgIHJldHVybiBrZXl3b3JkTWFwW2lkXSB8fCBbXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sbGFib3JhdG9ySWRzKGlkOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY29sbGFiTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7XG4gICAgICAnaW50cm9zcGVjdGl2ZS1hZ2VudCc6IFsnZW5oYW5jZWQtbWFyaWEnLCAnZW5oYW5jZWQtamFtZXMnLCAnZW5oYW5jZWQtbWFyY3VzJ10sXG4gICAgICAnZW5oYW5jZWQtbWFyaWEnOiBbJ2VuaGFuY2VkLWphbWVzJywgJ2VuaGFuY2VkLW1hcmN1cyddLFxuICAgICAgJ2VuaGFuY2VkLWphbWVzJzogWydlbmhhbmNlZC1tYXJpYScsICdlbmhhbmNlZC1tYXJjdXMnXSxcbiAgICAgICdlbmhhbmNlZC1tYXJjdXMnOiBbJ2VuaGFuY2VkLW1hcmlhJywgJ2VuaGFuY2VkLWphbWVzJ10sXG4gICAgICAnc2FyYWgtcG0nOiBbJ2VuaGFuY2VkLW1hcmlhJywgJ2VuaGFuY2VkLWphbWVzJywgJ2VuaGFuY2VkLW1hcmN1cycsICdhbGV4LWJhJ10sXG4gICAgICAnYWxleC1iYSc6IFsnc2FyYWgtcG0nLCAnZW5oYW5jZWQtbWFyaWEnXSxcbiAgICAgICdkci1haS1tbCc6IFsnZW5oYW5jZWQtbWFyY3VzJywgJ2VuaGFuY2VkLW1hcmlhJ11cbiAgICB9O1xuICAgIHJldHVybiBjb2xsYWJNYXBbaWRdIHx8IFtdO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBsb2cgPSBjb25zb2xlO1xuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlIGZvciBlYXN5IGltcG9ydFxuZXhwb3J0IGNvbnN0IGFnZW50UmVnaXN0cnkgPSBuZXcgQWdlbnRSZWdpc3RyeSgpO1xuIl0sInZlcnNpb24iOjN9