26aac05ef67e2b9793b062f314dc7413
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseAgent = exports.Recommendation = exports.Issue = exports.ValidationResults = exports.AgentActivationContext = exports.AgentResponse = void 0;
const types_js_1 = require("../types.js");
Object.defineProperty(exports, "AgentResponse", { enumerable: true, get: function () { return types_js_1.AgentResponse; } });
Object.defineProperty(exports, "AgentActivationContext", { enumerable: true, get: function () { return types_js_1.AgentActivationContext; } });
Object.defineProperty(exports, "ValidationResults", { enumerable: true, get: function () { return types_js_1.ValidationResults; } });
Object.defineProperty(exports, "Issue", { enumerable: true, get: function () { return types_js_1.Issue; } });
Object.defineProperty(exports, "Recommendation", { enumerable: true, get: function () { return types_js_1.Recommendation; } });
class BaseAgent {
    constructor(id, specialization) {
        this.id = id || 'base-agent';
        this.specialization = specialization || 'Base Agent';
        this.name = this.extractAgentName(this.id);
    }
    async runStandardValidation(context) {
        const issues = [];
        const warnings = [];
        const content = context.content || '';
        // Check for debugging code
        if (content.includes('console.log') || content.includes('console.warn')) {
            issues.push({
                type: 'debugging-code',
                severity: 'medium',
                message: 'Console.log detected in production code',
                file: context.filePath || 'unknown'
            });
        }
        if (content.includes('debugger')) {
            issues.push({
                type: 'debugging-code',
                severity: 'high',
                message: 'Debugger statement in production code',
                file: context.filePath || 'unknown'
            });
        }
        // Security issue detection
        if (content.includes('eval(') || content.includes('Function(')) {
            issues.push({
                type: 'security-risk',
                severity: 'high',
                message: 'Use of eval() detected - security risk',
                file: context.filePath || 'unknown'
            });
        }
        if (content.match(/innerHTML\s*=/)) {
            issues.push({
                type: 'security-risk',
                severity: 'high',
                message: 'Direct innerHTML assignment can lead to XSS',
                file: context.filePath || 'unknown'
            });
        }
        // Detect hardcoded passwords
        if (content.match(/password\s*=\s*["'][^"']+["']/i)) {
            issues.push({
                type: 'security-risk',
                severity: 'critical',
                message: 'Hardcoded password detected',
                file: context.filePath || 'unknown'
            });
        }
        // Performance issue detection
        if (content.match(/for\s*\([^)]*\)\s*\{[\s\S]*?for\s*\([^)]*\)\s*\{/)) {
            issues.push({
                type: 'performance',
                severity: 'medium',
                message: 'Nested loops detected - potential performance issue',
                file: context.filePath || 'unknown'
            });
        }
        if (content.includes('.map(') && content.includes('.filter(')) {
            const mapFilterCount = (content.match(/\.map\(/g) || []).length + (content.match(/\.filter\(/g) || []).length;
            if (mapFilterCount > 3) {
                issues.push({
                    type: 'performance',
                    severity: 'low',
                    message: 'Multiple array iterations - consider combining operations',
                    file: context.filePath || 'unknown'
                });
            }
        }
        // Code quality issues
        if (content.includes('any') && content.includes('interface')) {
            issues.push({
                type: 'code-quality',
                severity: 'low',
                message: 'Avoid using "any" type in interfaces',
                file: context.filePath || 'unknown'
            });
        }
        // Technical debt markers
        if (content.includes('// HACK:') || content.includes('/* HACK')) {
            issues.push({
                type: 'code-quality',
                severity: 'medium',
                message: 'HACK comment indicates technical debt',
                file: context.filePath || 'unknown'
            });
        }
        // Deep nesting detection
        const nestingLevel = (content.match(/if\s*\([^)]*\)\s*\{[^}]*if\s*\([^)]*\)\s*\{[^}]*if\s*\([^)]*\)\s*\{/g) || []).length;
        if (nestingLevel > 0) {
            issues.push({
                type: 'code-quality',
                severity: 'medium',
                message: 'Deep nesting detected (3+ levels) - consider refactoring',
                file: context.filePath || 'unknown'
            });
        }
        // AST-based TODO/FIXME detection using ts-morph
        const todos = await this.detectTODOsWithAST(content, context.filePath || 'unknown');
        if (todos.length > 0) {
            todos.forEach(todo => {
                warnings.push(`${todo.type} at line ${todo.line}: ${todo.text}`);
            });
        }
        const score = Math.max(0, 100 - (issues.length * 10) - (warnings.length * 5));
        // Extract security concerns
        const securityConcerns = issues
            .filter(i => i.type === 'security-risk')
            .map(i => i.message);
        return {
            score,
            issues,
            warnings,
            recommendations: [],
            crossFileAnalysis: {
                inconsistencies: [],
                suggestions: []
            },
            performanceMetrics: {
                analysisTime: Date.now(),
                filesAnalyzed: 1
            },
            securityConcerns
        };
    }
    async runAgentSpecificValidation(context) {
        return {};
    }
    generateStandardRecommendations(results) {
        const recommendations = [];
        if (results.issues && results.issues.length > 0) {
            const criticalIssues = results.issues.filter(i => i.severity === 'critical');
            const highIssues = results.issues.filter(i => i.severity === 'high');
            const securityIssues = results.issues.filter(i => i.type === 'security' || i.type === 'security-risk' || i.type?.includes('security'));
            if (criticalIssues.length > 0) {
                recommendations.push({
                    type: 'critical-fix',
                    message: `Fix ${criticalIssues.length} critical issues immediately`,
                    priority: 'critical',
                    estimatedEffort: 'high'
                });
            }
            if (highIssues.length > 0) {
                recommendations.push({
                    type: 'high-priority-fix',
                    message: `Address ${highIssues.length} high priority issues`,
                    priority: 'high',
                    estimatedEffort: 'medium'
                });
            }
            if (securityIssues.length > 0) {
                recommendations.push({
                    type: 'security-improvement',
                    message: `Resolve ${securityIssues.length} security vulnerabilities`,
                    priority: 'high',
                    estimatedEffort: 'medium'
                });
            }
        }
        return recommendations;
    }
    calculateStandardPriority(results) {
        if (results.issues && results.issues.length > 0) {
            const hasCritical = results.issues.some(i => i.severity === 'critical');
            if (hasCritical)
                return 'critical';
            const hasHigh = results.issues.some(i => i.severity === 'high');
            if (hasHigh)
                return 'high';
            const hasMedium = results.issues.some(i => i.severity === 'medium');
            if (hasMedium)
                return 'medium';
        }
        return 'low';
    }
    async analyze(context) {
        return this.activate(context);
    }
    async runTests(context) {
        return { success: true, message: 'Tests not implemented for this agent' };
    }
    async analyzeArchitecture(context) {
        return { success: true, message: 'Architecture analysis not implemented for this agent' };
    }
    async manageDeployment(context) {
        return { success: true, message: 'Deployment management not implemented for this agent' };
    }
    analyzeCrossFileConsistency(context) {
        // Extract filename from path
        const filename = context.filePath?.split('/').pop() || context.filePath || 'unknown';
        return {
            [filename]: this.specialization
        };
    }
    hasConfigurationInconsistencies(context) {
        // Handle both string and object with content property
        const content = typeof context === 'string' ? context : (context?.content || '');
        // Detect mixed environment variable and hardcoded values
        if (content.includes('process.env') && content.match(/["']http:\/\/[^"']+["']/)) {
            return true;
        }
        // Detect inconsistent configuration patterns
        if (content.includes('const config') && content.includes('fallback')) {
            if (content.includes('process.env') && content.match(/:\s*["'][^"']+["']/)) {
                return true;
            }
        }
        return false;
    }
    mergeValidationResults(target, source) {
        if (source.issues) {
            target.issues = [...(target.issues || []), ...source.issues];
        }
        if (source.warnings) {
            target.warnings = [...(target.warnings || []), ...source.warnings];
        }
        if (source.recommendations) {
            target.recommendations = [...(target.recommendations || []), ...source.recommendations];
        }
        if (source.score !== undefined) {
            target.score = Math.min(target.score, source.score); // Take the lower score
        }
        if (source.crossFileAnalysis) {
            target.crossFileAnalysis = {
                ...(target.crossFileAnalysis || {}),
                ...source.crossFileAnalysis
            };
        }
        if (source.performanceMetrics) {
            target.performanceMetrics = {
                ...(target.performanceMetrics || {}),
                ...source.performanceMetrics
            };
        }
        if (source.securityConcerns) {
            target.securityConcerns = [...(target.securityConcerns || []), ...source.securityConcerns];
        }
    }
    extractAgentName(id) {
        // Convert 'enhanced-maria-qa' to 'Enhanced Maria Qa'
        return id.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');
    }
    getScoreEmoji(score) {
        if (score >= 90)
            return 'ðŸŸ¢';
        if (score >= 80)
            return 'ðŸŸ¡';
        if (score >= 70)
            return 'ðŸŸ ';
        return 'ðŸ”´';
    }
    /**
     * AST-based TODO/FIXME detection using ts-morph
     */
    async detectTODOsWithAST(content, filePath) {
        try {
            const { Project } = await Promise.resolve().then(() => __importStar(require('ts-morph')));
            const project = new Project({ useInMemoryFileSystem: true });
            const sourceFile = project.createSourceFile(filePath, content);
            const todos = [];
            // Scan all comments in the AST
            sourceFile.forEachDescendant((node) => {
                const fullText = node.getFullText();
                const leadingComments = node.getLeadingCommentRanges();
                const trailingComments = node.getTrailingCommentRanges();
                [...leadingComments, ...trailingComments].forEach(comment => {
                    const commentText = fullText.slice(comment.getPos(), comment.getEnd());
                    const line = sourceFile.getLineAndColumnAtPos(comment.getPos()).line;
                    if (commentText.includes('TODO')) {
                        todos.push({
                            type: 'TODO',
                            line,
                            text: commentText.replace(/\/\*|\*\/|\/\//g, '').trim().substring(0, 100)
                        });
                    }
                    else if (commentText.includes('FIXME')) {
                        todos.push({
                            type: 'FIXME',
                            line,
                            text: commentText.replace(/\/\*|\*\/|\/\//g, '').trim().substring(0, 100)
                        });
                    }
                });
            });
            return todos;
        }
        catch (error) {
            // Fallback to simple string matching if AST parsing fails
            const lines = content.split('\n');
            const todos = [];
            lines.forEach((line, index) => {
                if (line.includes('// TODO') || line.includes('/* TODO')) {
                    todos.push({ type: 'TODO', line: index + 1, text: line.trim().substring(0, 100) });
                }
                if (line.includes('// FIXME') || line.includes('/* FIXME')) {
                    todos.push({ type: 'FIXME', line: index + 1, text: line.trim().substring(0, 100) });
                }
            });
            return todos;
        }
    }
    /**
     * Agent-specific warm-up method (can be overridden)
     */
    async warmUp() {
        // Default warm-up: load configuration, initialize caches
        // Subclasses should override with agent-specific logic
        console.log(`ðŸ”¥ Warming up ${this.name}...`);
        // Warm up common resources
        await Promise.all([
            this.loadAgentConfiguration(),
            this.initializeCache(),
            this.precompilePatterns()
        ]);
        console.log(`âœ… ${this.name} warm-up complete`);
    }
    /**
     * Load agent-specific configuration
     */
    async loadAgentConfiguration() {
        // Override in subclasses to load agent-specific config
    }
    /**
     * Initialize caching layer
     */
    async initializeCache() {
        // Override in subclasses to set up caching
    }
    /**
     * Precompile patterns and rules
     */
    async precompilePatterns() {
        // Override in subclasses to precompile regex patterns, rules, etc.
    }
}
exports.BaseAgent = BaseAgent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2Jhc2UtYWdlbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMENBQThHO0FBRXJHLDhGQUZBLHdCQUFhLE9BRUE7QUFBRSx1R0FGQSxpQ0FBc0IsT0FFQTtBQUFFLGtHQUZBLDRCQUFpQixPQUVBO0FBQUUsc0ZBRkEsZ0JBQUssT0FFQTtBQUFFLCtGQUZBLHlCQUFjLE9BRUE7QUFFeEYsTUFBc0IsU0FBUztJQU03QixZQUFZLEVBQVcsRUFBRSxjQUF1QjtRQUM5QyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxZQUFZLENBQUM7UUFDN0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLElBQUksWUFBWSxDQUFDO1FBQ3JELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBSVMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLE9BQStCO1FBQ25FLE1BQU0sTUFBTSxHQUFZLEVBQUUsQ0FBQztRQUMzQixNQUFNLFFBQVEsR0FBYSxFQUFFLENBQUM7UUFDOUIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFFdEMsMkJBQTJCO1FBQzNCLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7WUFDeEUsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDVixJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixRQUFRLEVBQUUsUUFBUTtnQkFDbEIsT0FBTyxFQUFFLHlDQUF5QztnQkFDbEQsSUFBSSxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksU0FBUzthQUNwQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7WUFDakMsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDVixJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsT0FBTyxFQUFFLHVDQUF1QztnQkFDaEQsSUFBSSxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksU0FBUzthQUNwQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsMkJBQTJCO1FBQzNCLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFDL0QsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDVixJQUFJLEVBQUUsZUFBZTtnQkFDckIsUUFBUSxFQUFFLE1BQU07Z0JBQ2hCLE9BQU8sRUFBRSx3Q0FBd0M7Z0JBQ2pELElBQUksRUFBRSxPQUFPLENBQUMsUUFBUSxJQUFJLFNBQVM7YUFDcEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ1YsSUFBSSxFQUFFLGVBQWU7Z0JBQ3JCLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixPQUFPLEVBQUUsNkNBQTZDO2dCQUN0RCxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCw2QkFBNkI7UUFDN0IsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLGdDQUFnQyxDQUFDLEVBQUUsQ0FBQztZQUNwRCxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNWLElBQUksRUFBRSxlQUFlO2dCQUNyQixRQUFRLEVBQUUsVUFBVTtnQkFDcEIsT0FBTyxFQUFFLDZCQUE2QjtnQkFDdEMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksU0FBUzthQUNwQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsOEJBQThCO1FBQzlCLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxrREFBa0QsQ0FBQyxFQUFFLENBQUM7WUFDdEUsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDVixJQUFJLEVBQUUsYUFBYTtnQkFDbkIsUUFBUSxFQUFFLFFBQVE7Z0JBQ2xCLE9BQU8sRUFBRSxxREFBcUQ7Z0JBQzlELElBQUksRUFBRSxPQUFPLENBQUMsUUFBUSxJQUFJLFNBQVM7YUFDcEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7WUFDOUQsTUFBTSxjQUFjLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQzlHLElBQUksY0FBYyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNWLElBQUksRUFBRSxhQUFhO29CQUNuQixRQUFRLEVBQUUsS0FBSztvQkFDZixPQUFPLEVBQUUsMkRBQTJEO29CQUNwRSxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTO2lCQUNwQyxDQUFDLENBQUM7WUFDTCxDQUFDO1FBQ0gsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ1YsSUFBSSxFQUFFLGNBQWM7Z0JBQ3BCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLE9BQU8sRUFBRSxzQ0FBc0M7Z0JBQy9DLElBQUksRUFBRSxPQUFPLENBQUMsUUFBUSxJQUFJLFNBQVM7YUFDcEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELHlCQUF5QjtRQUN6QixJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQ2hFLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ1YsSUFBSSxFQUFFLGNBQWM7Z0JBQ3BCLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixPQUFPLEVBQUUsdUNBQXVDO2dCQUNoRCxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCx5QkFBeUI7UUFDekIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNFQUFzRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQzFILElBQUksWUFBWSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ1YsSUFBSSxFQUFFLGNBQWM7Z0JBQ3BCLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixPQUFPLEVBQUUsMERBQTBEO2dCQUNuRSxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxnREFBZ0Q7UUFDaEQsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksU0FBUyxDQUFDLENBQUM7UUFDcEYsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3JCLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ25CLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxZQUFZLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7WUFDbkUsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUU5RSw0QkFBNEI7UUFDNUIsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNO2FBQzVCLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDO2FBQ3ZDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV2QixPQUFPO1lBQ0wsS0FBSztZQUNMLE1BQU07WUFDTixRQUFRO1lBQ1IsZUFBZSxFQUFFLEVBQUU7WUFDbkIsaUJBQWlCLEVBQUU7Z0JBQ2pCLGVBQWUsRUFBRSxFQUFFO2dCQUNuQixXQUFXLEVBQUUsRUFBRTthQUNoQjtZQUNELGtCQUFrQixFQUFFO2dCQUNsQixZQUFZLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDeEIsYUFBYSxFQUFFLENBQUM7YUFDakI7WUFDRCxnQkFBZ0I7U0FDakIsQ0FBQztJQUNKLENBQUM7SUFFUyxLQUFLLENBQUMsMEJBQTBCLENBQUMsT0FBK0I7UUFDeEUsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBRVMsK0JBQStCLENBQUMsT0FBMEI7UUFDbEUsTUFBTSxlQUFlLEdBQXFCLEVBQUUsQ0FBQztRQUU3QyxJQUFJLE9BQU8sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDaEQsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxLQUFLLFVBQVUsQ0FBQyxDQUFDO1lBQzdFLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsQ0FBQztZQUNyRSxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUMvQyxDQUFDLENBQUMsSUFBSSxLQUFLLFVBQVUsSUFBSSxDQUFDLENBQUMsSUFBSSxLQUFLLGVBQWUsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FDcEYsQ0FBQztZQUVGLElBQUksY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsZUFBZSxDQUFDLElBQUksQ0FBQztvQkFDbkIsSUFBSSxFQUFFLGNBQWM7b0JBQ3BCLE9BQU8sRUFBRSxPQUFPLGNBQWMsQ0FBQyxNQUFNLDhCQUE4QjtvQkFDbkUsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLGVBQWUsRUFBRSxNQUFNO2lCQUN4QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUMxQixlQUFlLENBQUMsSUFBSSxDQUFDO29CQUNuQixJQUFJLEVBQUUsbUJBQW1CO29CQUN6QixPQUFPLEVBQUUsV0FBVyxVQUFVLENBQUMsTUFBTSx1QkFBdUI7b0JBQzVELFFBQVEsRUFBRSxNQUFNO29CQUNoQixlQUFlLEVBQUUsUUFBUTtpQkFDMUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsZUFBZSxDQUFDLElBQUksQ0FBQztvQkFDbkIsSUFBSSxFQUFFLHNCQUFzQjtvQkFDNUIsT0FBTyxFQUFFLFdBQVcsY0FBYyxDQUFDLE1BQU0sMkJBQTJCO29CQUNwRSxRQUFRLEVBQUUsTUFBTTtvQkFDaEIsZUFBZSxFQUFFLFFBQVE7aUJBQzFCLENBQUMsQ0FBQztZQUNMLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVTLHlCQUF5QixDQUFDLE9BQTBCO1FBQzVELElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNoRCxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEtBQUssVUFBVSxDQUFDLENBQUM7WUFDeEUsSUFBSSxXQUFXO2dCQUFFLE9BQU8sVUFBVSxDQUFDO1lBRW5DLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsQ0FBQztZQUNoRSxJQUFJLE9BQU87Z0JBQUUsT0FBTyxNQUFNLENBQUM7WUFFM0IsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDO1lBQ3BFLElBQUksU0FBUztnQkFBRSxPQUFPLFFBQVEsQ0FBQztRQUNqQyxDQUFDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUErQjtRQUMzQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBK0I7UUFDNUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLHNDQUFzQyxFQUFFLENBQUM7SUFDNUUsQ0FBQztJQUVELEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxPQUErQjtRQUN2RCxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsc0RBQXNELEVBQUUsQ0FBQztJQUM1RixDQUFDO0lBRUQsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQStCO1FBQ3BELE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxzREFBc0QsRUFBRSxDQUFDO0lBQzVGLENBQUM7SUFFUywyQkFBMkIsQ0FBQyxPQUErQjtRQUNuRSw2QkFBNkI7UUFDN0IsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUM7UUFDckYsT0FBTztZQUNMLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxDQUFDLGNBQWM7U0FDaEMsQ0FBQztJQUNKLENBQUM7SUFFUywrQkFBK0IsQ0FBQyxPQUFZO1FBQ3BELHNEQUFzRDtRQUN0RCxNQUFNLE9BQU8sR0FBRyxPQUFPLE9BQU8sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRWpGLHlEQUF5RDtRQUN6RCxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLENBQUM7WUFDaEYsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsNkNBQTZDO1FBQzdDLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7WUFDckUsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsRUFBRSxDQUFDO2dCQUMzRSxPQUFPLElBQUksQ0FBQztZQUNkLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRVMsc0JBQXNCLENBQUMsTUFBeUIsRUFBRSxNQUF5QjtRQUNuRixJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNsQixNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUNELElBQUksTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3BCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBQ0QsSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDM0IsTUFBTSxDQUFDLGVBQWUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsZUFBZSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzFGLENBQUM7UUFDRCxJQUFJLE1BQU0sQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDL0IsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsdUJBQXVCO1FBQzlFLENBQUM7UUFDRCxJQUFJLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxpQkFBaUIsR0FBRztnQkFDekIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsSUFBSSxFQUFFLENBQUM7Z0JBQ25DLEdBQUcsTUFBTSxDQUFDLGlCQUFpQjthQUM1QixDQUFDO1FBQ0osQ0FBQztRQUNELElBQUksTUFBTSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLGtCQUFrQixHQUFHO2dCQUMxQixHQUFHLENBQUMsTUFBTSxDQUFDLGtCQUFrQixJQUFJLEVBQUUsQ0FBQztnQkFDcEMsR0FBRyxNQUFNLENBQUMsa0JBQWtCO2FBQzdCLENBQUM7UUFDSixDQUFDO1FBQ0QsSUFBSSxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUM1QixNQUFNLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLGdCQUFnQixJQUFJLEVBQUUsQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDN0YsQ0FBQztJQUNILENBQUM7SUFFUyxnQkFBZ0IsQ0FBQyxFQUFVO1FBQ25DLHFEQUFxRDtRQUNyRCxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FDM0QsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDZCxDQUFDO0lBRVMsYUFBYSxDQUFDLEtBQWE7UUFDbkMsSUFBSSxLQUFLLElBQUksRUFBRTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQzdCLElBQUksS0FBSyxJQUFJLEVBQUU7WUFBRSxPQUFPLElBQUksQ0FBQztRQUM3QixJQUFJLEtBQUssSUFBSSxFQUFFO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDN0IsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsa0JBQWtCLENBQUMsT0FBZSxFQUFFLFFBQWdCO1FBQ2hFLElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyx3REFBYSxVQUFVLEdBQUMsQ0FBQztZQUM3QyxNQUFNLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBQyxFQUFFLHFCQUFxQixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFDN0QsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUUvRCxNQUFNLEtBQUssR0FBd0QsRUFBRSxDQUFDO1lBRXRFLCtCQUErQjtZQUMvQixVQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDcEMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztnQkFDdkQsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztnQkFFekQsQ0FBQyxHQUFHLGVBQWUsRUFBRSxHQUFHLGdCQUFnQixDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUMxRCxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztvQkFDdkUsTUFBTSxJQUFJLEdBQUcsVUFBVSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFFckUsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7d0JBQ2pDLEtBQUssQ0FBQyxJQUFJLENBQUM7NEJBQ1QsSUFBSSxFQUFFLE1BQU07NEJBQ1osSUFBSTs0QkFDSixJQUFJLEVBQUUsV0FBVyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQzt5QkFDMUUsQ0FBQyxDQUFDO29CQUNMLENBQUM7eUJBQU0sSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7d0JBQ3pDLEtBQUssQ0FBQyxJQUFJLENBQUM7NEJBQ1QsSUFBSSxFQUFFLE9BQU87NEJBQ2IsSUFBSTs0QkFDSixJQUFJLEVBQUUsV0FBVyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQzt5QkFDMUUsQ0FBQyxDQUFDO29CQUNMLENBQUM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZiwwREFBMEQ7WUFDMUQsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLEtBQUssR0FBd0QsRUFBRSxDQUFDO1lBRXRFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7Z0JBQzVCLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7b0JBQ3pELEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3JGLENBQUM7Z0JBQ0QsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztvQkFDM0QsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDdEYsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLE1BQU07UUFDVix5REFBeUQ7UUFDekQsdURBQXVEO1FBQ3ZELE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDO1FBRTdDLDJCQUEyQjtRQUMzQixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUM7WUFDaEIsSUFBSSxDQUFDLHNCQUFzQixFQUFFO1lBQzdCLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDdEIsSUFBSSxDQUFDLGtCQUFrQixFQUFFO1NBQzFCLENBQUMsQ0FBQztRQUVILE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNPLEtBQUssQ0FBQyxzQkFBc0I7UUFDcEMsdURBQXVEO0lBQ3pELENBQUM7SUFFRDs7T0FFRztJQUNPLEtBQUssQ0FBQyxlQUFlO1FBQzdCLDJDQUEyQztJQUM3QyxDQUFDO0lBRUQ7O09BRUc7SUFDTyxLQUFLLENBQUMsa0JBQWtCO1FBQ2hDLG1FQUFtRTtJQUNyRSxDQUFDO0NBQ0Y7QUF4WUQsOEJBd1lDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9uaXNzaW1tZW5hc2hlL1ZFUlNBVElMIFNETEMgRlcvc3JjL2FnZW50cy9iYXNlLWFnZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFnZW50UmVzcG9uc2UsIEFnZW50QWN0aXZhdGlvbkNvbnRleHQsIFZhbGlkYXRpb25SZXN1bHRzLCBJc3N1ZSwgUmVjb21tZW5kYXRpb24gfSBmcm9tICcuLi90eXBlcy5qcyc7XG5cbmV4cG9ydCB7IEFnZW50UmVzcG9uc2UsIEFnZW50QWN0aXZhdGlvbkNvbnRleHQsIFZhbGlkYXRpb25SZXN1bHRzLCBJc3N1ZSwgUmVjb21tZW5kYXRpb24gfTtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VBZ2VudCB7XG4gIG5hbWU6IHN0cmluZztcbiAgaWQ6IHN0cmluZztcbiAgc3BlY2lhbGl6YXRpb246IHN0cmluZztcbiAgYWJzdHJhY3Qgc3lzdGVtUHJvbXB0OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoaWQ/OiBzdHJpbmcsIHNwZWNpYWxpemF0aW9uPzogc3RyaW5nKSB7XG4gICAgdGhpcy5pZCA9IGlkIHx8ICdiYXNlLWFnZW50JztcbiAgICB0aGlzLnNwZWNpYWxpemF0aW9uID0gc3BlY2lhbGl6YXRpb24gfHwgJ0Jhc2UgQWdlbnQnO1xuICAgIHRoaXMubmFtZSA9IHRoaXMuZXh0cmFjdEFnZW50TmFtZSh0aGlzLmlkKTtcbiAgfVxuXG4gIGFic3RyYWN0IGFjdGl2YXRlKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPEFnZW50UmVzcG9uc2U+O1xuXG4gIHByb3RlY3RlZCBhc3luYyBydW5TdGFuZGFyZFZhbGlkYXRpb24oY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdHM+IHtcbiAgICBjb25zdCBpc3N1ZXM6IElzc3VlW10gPSBbXTtcbiAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBjb250ZW50ID0gY29udGV4dC5jb250ZW50IHx8ICcnO1xuXG4gICAgLy8gQ2hlY2sgZm9yIGRlYnVnZ2luZyBjb2RlXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ2NvbnNvbGUubG9nJykgfHwgY29udGVudC5pbmNsdWRlcygnY29uc29sZS53YXJuJykpIHtcbiAgICAgIGlzc3Vlcy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2RlYnVnZ2luZy1jb2RlJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxuICAgICAgICBtZXNzYWdlOiAnQ29uc29sZS5sb2cgZGV0ZWN0ZWQgaW4gcHJvZHVjdGlvbiBjb2RlJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdkZWJ1Z2dlcicpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdkZWJ1Z2dpbmctY29kZScsXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCcsXG4gICAgICAgIG1lc3NhZ2U6ICdEZWJ1Z2dlciBzdGF0ZW1lbnQgaW4gcHJvZHVjdGlvbiBjb2RlJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNlY3VyaXR5IGlzc3VlIGRldGVjdGlvblxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdldmFsKCcpIHx8IGNvbnRlbnQuaW5jbHVkZXMoJ0Z1bmN0aW9uKCcpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzZWN1cml0eS1yaXNrJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbWVzc2FnZTogJ1VzZSBvZiBldmFsKCkgZGV0ZWN0ZWQgLSBzZWN1cml0eSByaXNrJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjb250ZW50Lm1hdGNoKC9pbm5lckhUTUxcXHMqPS8pKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzZWN1cml0eS1yaXNrJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbWVzc2FnZTogJ0RpcmVjdCBpbm5lckhUTUwgYXNzaWdubWVudCBjYW4gbGVhZCB0byBYU1MnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0IGhhcmRjb2RlZCBwYXNzd29yZHNcbiAgICBpZiAoY29udGVudC5tYXRjaCgvcGFzc3dvcmRcXHMqPVxccypbXCInXVteXCInXStbXCInXS9pKSkge1xuICAgICAgaXNzdWVzLnB1c2goe1xuICAgICAgICB0eXBlOiAnc2VjdXJpdHktcmlzaycsXG4gICAgICAgIHNldmVyaXR5OiAnY3JpdGljYWwnLFxuICAgICAgICBtZXNzYWdlOiAnSGFyZGNvZGVkIHBhc3N3b3JkIGRldGVjdGVkJyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm1hbmNlIGlzc3VlIGRldGVjdGlvblxuICAgIGlmIChjb250ZW50Lm1hdGNoKC9mb3JcXHMqXFwoW14pXSpcXClcXHMqXFx7W1xcc1xcU10qP2ZvclxccypcXChbXildKlxcKVxccypcXHsvKSkge1xuICAgICAgaXNzdWVzLnB1c2goe1xuICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIG1lc3NhZ2U6ICdOZXN0ZWQgbG9vcHMgZGV0ZWN0ZWQgLSBwb3RlbnRpYWwgcGVyZm9ybWFuY2UgaXNzdWUnLFxuICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJy5tYXAoJykgJiYgY29udGVudC5pbmNsdWRlcygnLmZpbHRlcignKSkge1xuICAgICAgY29uc3QgbWFwRmlsdGVyQ291bnQgPSAoY29udGVudC5tYXRjaCgvXFwubWFwXFwoL2cpIHx8IFtdKS5sZW5ndGggKyAoY29udGVudC5tYXRjaCgvXFwuZmlsdGVyXFwoL2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgICBpZiAobWFwRmlsdGVyQ291bnQgPiAzKSB7XG4gICAgICAgIGlzc3Vlcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICAgIHNldmVyaXR5OiAnbG93JyxcbiAgICAgICAgICBtZXNzYWdlOiAnTXVsdGlwbGUgYXJyYXkgaXRlcmF0aW9ucyAtIGNvbnNpZGVyIGNvbWJpbmluZyBvcGVyYXRpb25zJyxcbiAgICAgICAgICBmaWxlOiBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb2RlIHF1YWxpdHkgaXNzdWVzXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ2FueScpICYmIGNvbnRlbnQuaW5jbHVkZXMoJ2ludGVyZmFjZScpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb2RlLXF1YWxpdHknLFxuICAgICAgICBzZXZlcml0eTogJ2xvdycsXG4gICAgICAgIG1lc3NhZ2U6ICdBdm9pZCB1c2luZyBcImFueVwiIHR5cGUgaW4gaW50ZXJmYWNlcycsXG4gICAgICAgIGZpbGU6IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUZWNobmljYWwgZGVidCBtYXJrZXJzXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJy8vIEhBQ0s6JykgfHwgY29udGVudC5pbmNsdWRlcygnLyogSEFDSycpKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb2RlLXF1YWxpdHknLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIG1lc3NhZ2U6ICdIQUNLIGNvbW1lbnQgaW5kaWNhdGVzIHRlY2huaWNhbCBkZWJ0JyxcbiAgICAgICAgZmlsZTogY29udGV4dC5maWxlUGF0aCB8fCAndW5rbm93bidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIERlZXAgbmVzdGluZyBkZXRlY3Rpb25cbiAgICBjb25zdCBuZXN0aW5nTGV2ZWwgPSAoY29udGVudC5tYXRjaCgvaWZcXHMqXFwoW14pXSpcXClcXHMqXFx7W159XSppZlxccypcXChbXildKlxcKVxccypcXHtbXn1dKmlmXFxzKlxcKFteKV0qXFwpXFxzKlxcey9nKSB8fCBbXSkubGVuZ3RoO1xuICAgIGlmIChuZXN0aW5nTGV2ZWwgPiAwKSB7XG4gICAgICBpc3N1ZXMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb2RlLXF1YWxpdHknLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIG1lc3NhZ2U6ICdEZWVwIG5lc3RpbmcgZGV0ZWN0ZWQgKDMrIGxldmVscykgLSBjb25zaWRlciByZWZhY3RvcmluZycsXG4gICAgICAgIGZpbGU6IGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBU1QtYmFzZWQgVE9ETy9GSVhNRSBkZXRlY3Rpb24gdXNpbmcgdHMtbW9ycGhcbiAgICBjb25zdCB0b2RvcyA9IGF3YWl0IHRoaXMuZGV0ZWN0VE9ET3NXaXRoQVNUKGNvbnRlbnQsIGNvbnRleHQuZmlsZVBhdGggfHwgJ3Vua25vd24nKTtcbiAgICBpZiAodG9kb3MubGVuZ3RoID4gMCkge1xuICAgICAgdG9kb3MuZm9yRWFjaCh0b2RvID0+IHtcbiAgICAgICAgd2FybmluZ3MucHVzaChgJHt0b2RvLnR5cGV9IGF0IGxpbmUgJHt0b2RvLmxpbmV9OiAke3RvZG8udGV4dH1gKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHNjb3JlID0gTWF0aC5tYXgoMCwgMTAwIC0gKGlzc3Vlcy5sZW5ndGggKiAxMCkgLSAod2FybmluZ3MubGVuZ3RoICogNSkpO1xuXG4gICAgLy8gRXh0cmFjdCBzZWN1cml0eSBjb25jZXJuc1xuICAgIGNvbnN0IHNlY3VyaXR5Q29uY2VybnMgPSBpc3N1ZXNcbiAgICAgIC5maWx0ZXIoaSA9PiBpLnR5cGUgPT09ICdzZWN1cml0eS1yaXNrJylcbiAgICAgIC5tYXAoaSA9PiBpLm1lc3NhZ2UpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNjb3JlLFxuICAgICAgaXNzdWVzLFxuICAgICAgd2FybmluZ3MsXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxuICAgICAgY3Jvc3NGaWxlQW5hbHlzaXM6IHtcbiAgICAgICAgaW5jb25zaXN0ZW5jaWVzOiBbXSxcbiAgICAgICAgc3VnZ2VzdGlvbnM6IFtdXG4gICAgICB9LFxuICAgICAgcGVyZm9ybWFuY2VNZXRyaWNzOiB7XG4gICAgICAgIGFuYWx5c2lzVGltZTogRGF0ZS5ub3coKSxcbiAgICAgICAgZmlsZXNBbmFseXplZDogMVxuICAgICAgfSxcbiAgICAgIHNlY3VyaXR5Q29uY2VybnNcbiAgICB9O1xuICB9XG5cbiAgcHJvdGVjdGVkIGFzeW5jIHJ1bkFnZW50U3BlY2lmaWNWYWxpZGF0aW9uKGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBQcm9taXNlPFBhcnRpYWw8VmFsaWRhdGlvblJlc3VsdHM+PiB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdlbmVyYXRlU3RhbmRhcmRSZWNvbW1lbmRhdGlvbnMocmVzdWx0czogVmFsaWRhdGlvblJlc3VsdHMpOiBSZWNvbW1lbmRhdGlvbltdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IFJlY29tbWVuZGF0aW9uW10gPSBbXTtcblxuICAgIGlmIChyZXN1bHRzLmlzc3VlcyAmJiByZXN1bHRzLmlzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBjcml0aWNhbElzc3VlcyA9IHJlc3VsdHMuaXNzdWVzLmZpbHRlcihpID0+IGkuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpO1xuICAgICAgY29uc3QgaGlnaElzc3VlcyA9IHJlc3VsdHMuaXNzdWVzLmZpbHRlcihpID0+IGkuc2V2ZXJpdHkgPT09ICdoaWdoJyk7XG4gICAgICBjb25zdCBzZWN1cml0eUlzc3VlcyA9IHJlc3VsdHMuaXNzdWVzLmZpbHRlcihpID0+XG4gICAgICAgIGkudHlwZSA9PT0gJ3NlY3VyaXR5JyB8fCBpLnR5cGUgPT09ICdzZWN1cml0eS1yaXNrJyB8fCBpLnR5cGU/LmluY2x1ZGVzKCdzZWN1cml0eScpXG4gICAgICApO1xuXG4gICAgICBpZiAoY3JpdGljYWxJc3N1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgICAgdHlwZTogJ2NyaXRpY2FsLWZpeCcsXG4gICAgICAgICAgbWVzc2FnZTogYEZpeCAke2NyaXRpY2FsSXNzdWVzLmxlbmd0aH0gY3JpdGljYWwgaXNzdWVzIGltbWVkaWF0ZWx5YCxcbiAgICAgICAgICBwcmlvcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGhpZ2hJc3N1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgICAgdHlwZTogJ2hpZ2gtcHJpb3JpdHktZml4JyxcbiAgICAgICAgICBtZXNzYWdlOiBgQWRkcmVzcyAke2hpZ2hJc3N1ZXMubGVuZ3RofSBoaWdoIHByaW9yaXR5IGlzc3Vlc2AsXG4gICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJyxcbiAgICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6ICdtZWRpdW0nXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2VjdXJpdHlJc3N1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgICAgdHlwZTogJ3NlY3VyaXR5LWltcHJvdmVtZW50JyxcbiAgICAgICAgICBtZXNzYWdlOiBgUmVzb2x2ZSAke3NlY3VyaXR5SXNzdWVzLmxlbmd0aH0gc2VjdXJpdHkgdnVsbmVyYWJpbGl0aWVzYCxcbiAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogJ21lZGl1bSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIHByb3RlY3RlZCBjYWxjdWxhdGVTdGFuZGFyZFByaW9yaXR5KHJlc3VsdHM6IFZhbGlkYXRpb25SZXN1bHRzKTogc3RyaW5nIHtcbiAgICBpZiAocmVzdWx0cy5pc3N1ZXMgJiYgcmVzdWx0cy5pc3N1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgaGFzQ3JpdGljYWwgPSByZXN1bHRzLmlzc3Vlcy5zb21lKGkgPT4gaS5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyk7XG4gICAgICBpZiAoaGFzQ3JpdGljYWwpIHJldHVybiAnY3JpdGljYWwnO1xuXG4gICAgICBjb25zdCBoYXNIaWdoID0gcmVzdWx0cy5pc3N1ZXMuc29tZShpID0+IGkuc2V2ZXJpdHkgPT09ICdoaWdoJyk7XG4gICAgICBpZiAoaGFzSGlnaCkgcmV0dXJuICdoaWdoJztcblxuICAgICAgY29uc3QgaGFzTWVkaXVtID0gcmVzdWx0cy5pc3N1ZXMuc29tZShpID0+IGkuc2V2ZXJpdHkgPT09ICdtZWRpdW0nKTtcbiAgICAgIGlmIChoYXNNZWRpdW0pIHJldHVybiAnbWVkaXVtJztcbiAgICB9XG4gICAgcmV0dXJuICdsb3cnO1xuICB9XG5cbiAgYXN5bmMgYW5hbHl6ZShjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogUHJvbWlzZTxBZ2VudFJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZhdGUoY29udGV4dCk7XG4gIH1cblxuICBhc3luYyBydW5UZXN0cyhjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnVGVzdHMgbm90IGltcGxlbWVudGVkIGZvciB0aGlzIGFnZW50JyB9O1xuICB9XG5cbiAgYXN5bmMgYW5hbHl6ZUFyY2hpdGVjdHVyZShjb250ZXh0OiBBZ2VudEFjdGl2YXRpb25Db250ZXh0KTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnQXJjaGl0ZWN0dXJlIGFuYWx5c2lzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBhZ2VudCcgfTtcbiAgfVxuXG4gIGFzeW5jIG1hbmFnZURlcGxveW1lbnQoY29udGV4dDogQWdlbnRBY3RpdmF0aW9uQ29udGV4dCk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ0RlcGxveW1lbnQgbWFuYWdlbWVudCBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgYWdlbnQnIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgYW5hbHl6ZUNyb3NzRmlsZUNvbnNpc3RlbmN5KGNvbnRleHQ6IEFnZW50QWN0aXZhdGlvbkNvbnRleHQpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICAvLyBFeHRyYWN0IGZpbGVuYW1lIGZyb20gcGF0aFxuICAgIGNvbnN0IGZpbGVuYW1lID0gY29udGV4dC5maWxlUGF0aD8uc3BsaXQoJy8nKS5wb3AoKSB8fCBjb250ZXh0LmZpbGVQYXRoIHx8ICd1bmtub3duJztcbiAgICByZXR1cm4ge1xuICAgICAgW2ZpbGVuYW1lXTogdGhpcy5zcGVjaWFsaXphdGlvblxuICAgIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgaGFzQ29uZmlndXJhdGlvbkluY29uc2lzdGVuY2llcyhjb250ZXh0OiBhbnkpOiBib29sZWFuIHtcbiAgICAvLyBIYW5kbGUgYm90aCBzdHJpbmcgYW5kIG9iamVjdCB3aXRoIGNvbnRlbnQgcHJvcGVydHlcbiAgICBjb25zdCBjb250ZW50ID0gdHlwZW9mIGNvbnRleHQgPT09ICdzdHJpbmcnID8gY29udGV4dCA6IChjb250ZXh0Py5jb250ZW50IHx8ICcnKTtcblxuICAgIC8vIERldGVjdCBtaXhlZCBlbnZpcm9ubWVudCB2YXJpYWJsZSBhbmQgaGFyZGNvZGVkIHZhbHVlc1xuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdwcm9jZXNzLmVudicpICYmIGNvbnRlbnQubWF0Y2goL1tcIiddaHR0cDpcXC9cXC9bXlwiJ10rW1wiJ10vKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0IGluY29uc2lzdGVudCBjb25maWd1cmF0aW9uIHBhdHRlcm5zXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ2NvbnN0IGNvbmZpZycpICYmIGNvbnRlbnQuaW5jbHVkZXMoJ2ZhbGxiYWNrJykpIHtcbiAgICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdwcm9jZXNzLmVudicpICYmIGNvbnRlbnQubWF0Y2goLzpcXHMqW1wiJ11bXlwiJ10rW1wiJ10vKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcm90ZWN0ZWQgbWVyZ2VWYWxpZGF0aW9uUmVzdWx0cyh0YXJnZXQ6IFZhbGlkYXRpb25SZXN1bHRzLCBzb3VyY2U6IFZhbGlkYXRpb25SZXN1bHRzKTogdm9pZCB7XG4gICAgaWYgKHNvdXJjZS5pc3N1ZXMpIHtcbiAgICAgIHRhcmdldC5pc3N1ZXMgPSBbLi4uKHRhcmdldC5pc3N1ZXMgfHwgW10pLCAuLi5zb3VyY2UuaXNzdWVzXTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZS53YXJuaW5ncykge1xuICAgICAgdGFyZ2V0Lndhcm5pbmdzID0gWy4uLih0YXJnZXQud2FybmluZ3MgfHwgW10pLCAuLi5zb3VyY2Uud2FybmluZ3NdO1xuICAgIH1cbiAgICBpZiAoc291cmNlLnJlY29tbWVuZGF0aW9ucykge1xuICAgICAgdGFyZ2V0LnJlY29tbWVuZGF0aW9ucyA9IFsuLi4odGFyZ2V0LnJlY29tbWVuZGF0aW9ucyB8fCBbXSksIC4uLnNvdXJjZS5yZWNvbW1lbmRhdGlvbnNdO1xuICAgIH1cbiAgICBpZiAoc291cmNlLnNjb3JlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRhcmdldC5zY29yZSA9IE1hdGgubWluKHRhcmdldC5zY29yZSwgc291cmNlLnNjb3JlKTsgLy8gVGFrZSB0aGUgbG93ZXIgc2NvcmVcbiAgICB9XG4gICAgaWYgKHNvdXJjZS5jcm9zc0ZpbGVBbmFseXNpcykge1xuICAgICAgdGFyZ2V0LmNyb3NzRmlsZUFuYWx5c2lzID0ge1xuICAgICAgICAuLi4odGFyZ2V0LmNyb3NzRmlsZUFuYWx5c2lzIHx8IHt9KSxcbiAgICAgICAgLi4uc291cmNlLmNyb3NzRmlsZUFuYWx5c2lzXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoc291cmNlLnBlcmZvcm1hbmNlTWV0cmljcykge1xuICAgICAgdGFyZ2V0LnBlcmZvcm1hbmNlTWV0cmljcyA9IHtcbiAgICAgICAgLi4uKHRhcmdldC5wZXJmb3JtYW5jZU1ldHJpY3MgfHwge30pLFxuICAgICAgICAuLi5zb3VyY2UucGVyZm9ybWFuY2VNZXRyaWNzXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoc291cmNlLnNlY3VyaXR5Q29uY2VybnMpIHtcbiAgICAgIHRhcmdldC5zZWN1cml0eUNvbmNlcm5zID0gWy4uLih0YXJnZXQuc2VjdXJpdHlDb25jZXJucyB8fCBbXSksIC4uLnNvdXJjZS5zZWN1cml0eUNvbmNlcm5zXTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZXh0cmFjdEFnZW50TmFtZShpZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBDb252ZXJ0ICdlbmhhbmNlZC1tYXJpYS1xYScgdG8gJ0VuaGFuY2VkIE1hcmlhIFFhJ1xuICAgIHJldHVybiBpZC5zcGxpdCgnLScpLm1hcCh3b3JkID0+XG4gICAgICB3b3JkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKS50b0xvd2VyQ2FzZSgpXG4gICAgKS5qb2luKCcgJyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2NvcmVFbW9qaShzY29yZTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoc2NvcmUgPj0gOTApIHJldHVybiAn8J+foic7XG4gICAgaWYgKHNjb3JlID49IDgwKSByZXR1cm4gJ/Cfn6EnO1xuICAgIGlmIChzY29yZSA+PSA3MCkgcmV0dXJuICfwn5+gJztcbiAgICByZXR1cm4gJ/CflLQnO1xuICB9XG5cbiAgLyoqXG4gICAqIEFTVC1iYXNlZCBUT0RPL0ZJWE1FIGRldGVjdGlvbiB1c2luZyB0cy1tb3JwaFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RUT0RPc1dpdGhBU1QoY29udGVudDogc3RyaW5nLCBmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxBcnJheTx7IHR5cGU6IHN0cmluZzsgbGluZTogbnVtYmVyOyB0ZXh0OiBzdHJpbmcgfT4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBQcm9qZWN0IH0gPSBhd2FpdCBpbXBvcnQoJ3RzLW1vcnBoJyk7XG4gICAgICBjb25zdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoeyB1c2VJbk1lbW9yeUZpbGVTeXN0ZW06IHRydWUgfSk7XG4gICAgICBjb25zdCBzb3VyY2VGaWxlID0gcHJvamVjdC5jcmVhdGVTb3VyY2VGaWxlKGZpbGVQYXRoLCBjb250ZW50KTtcblxuICAgICAgY29uc3QgdG9kb3M6IEFycmF5PHsgdHlwZTogc3RyaW5nOyBsaW5lOiBudW1iZXI7IHRleHQ6IHN0cmluZyB9PiA9IFtdO1xuXG4gICAgICAvLyBTY2FuIGFsbCBjb21tZW50cyBpbiB0aGUgQVNUXG4gICAgICBzb3VyY2VGaWxlLmZvckVhY2hEZXNjZW5kYW50KChub2RlKSA9PiB7XG4gICAgICAgIGNvbnN0IGZ1bGxUZXh0ID0gbm9kZS5nZXRGdWxsVGV4dCgpO1xuICAgICAgICBjb25zdCBsZWFkaW5nQ29tbWVudHMgPSBub2RlLmdldExlYWRpbmdDb21tZW50UmFuZ2VzKCk7XG4gICAgICAgIGNvbnN0IHRyYWlsaW5nQ29tbWVudHMgPSBub2RlLmdldFRyYWlsaW5nQ29tbWVudFJhbmdlcygpO1xuXG4gICAgICAgIFsuLi5sZWFkaW5nQ29tbWVudHMsIC4uLnRyYWlsaW5nQ29tbWVudHNdLmZvckVhY2goY29tbWVudCA9PiB7XG4gICAgICAgICAgY29uc3QgY29tbWVudFRleHQgPSBmdWxsVGV4dC5zbGljZShjb21tZW50LmdldFBvcygpLCBjb21tZW50LmdldEVuZCgpKTtcbiAgICAgICAgICBjb25zdCBsaW5lID0gc291cmNlRmlsZS5nZXRMaW5lQW5kQ29sdW1uQXRQb3MoY29tbWVudC5nZXRQb3MoKSkubGluZTtcblxuICAgICAgICAgIGlmIChjb21tZW50VGV4dC5pbmNsdWRlcygnVE9ETycpKSB7XG4gICAgICAgICAgICB0b2Rvcy5wdXNoKHtcbiAgICAgICAgICAgICAgdHlwZTogJ1RPRE8nLFxuICAgICAgICAgICAgICBsaW5lLFxuICAgICAgICAgICAgICB0ZXh0OiBjb21tZW50VGV4dC5yZXBsYWNlKC9cXC9cXCp8XFwqXFwvfFxcL1xcLy9nLCAnJykudHJpbSgpLnN1YnN0cmluZygwLCAxMDApXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvbW1lbnRUZXh0LmluY2x1ZGVzKCdGSVhNRScpKSB7XG4gICAgICAgICAgICB0b2Rvcy5wdXNoKHtcbiAgICAgICAgICAgICAgdHlwZTogJ0ZJWE1FJyxcbiAgICAgICAgICAgICAgbGluZSxcbiAgICAgICAgICAgICAgdGV4dDogY29tbWVudFRleHQucmVwbGFjZSgvXFwvXFwqfFxcKlxcL3xcXC9cXC8vZywgJycpLnRyaW0oKS5zdWJzdHJpbmcoMCwgMTAwKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdG9kb3M7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIHNpbXBsZSBzdHJpbmcgbWF0Y2hpbmcgaWYgQVNUIHBhcnNpbmcgZmFpbHNcbiAgICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICBjb25zdCB0b2RvczogQXJyYXk8eyB0eXBlOiBzdHJpbmc7IGxpbmU6IG51bWJlcjsgdGV4dDogc3RyaW5nIH0+ID0gW107XG5cbiAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmIChsaW5lLmluY2x1ZGVzKCcvLyBUT0RPJykgfHwgbGluZS5pbmNsdWRlcygnLyogVE9ETycpKSB7XG4gICAgICAgICAgdG9kb3MucHVzaCh7IHR5cGU6ICdUT0RPJywgbGluZTogaW5kZXggKyAxLCB0ZXh0OiBsaW5lLnRyaW0oKS5zdWJzdHJpbmcoMCwgMTAwKSB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGluZS5pbmNsdWRlcygnLy8gRklYTUUnKSB8fCBsaW5lLmluY2x1ZGVzKCcvKiBGSVhNRScpKSB7XG4gICAgICAgICAgdG9kb3MucHVzaCh7IHR5cGU6ICdGSVhNRScsIGxpbmU6IGluZGV4ICsgMSwgdGV4dDogbGluZS50cmltKCkuc3Vic3RyaW5nKDAsIDEwMCkgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdG9kb3M7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFnZW50LXNwZWNpZmljIHdhcm0tdXAgbWV0aG9kIChjYW4gYmUgb3ZlcnJpZGRlbilcbiAgICovXG4gIGFzeW5jIHdhcm1VcCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBEZWZhdWx0IHdhcm0tdXA6IGxvYWQgY29uZmlndXJhdGlvbiwgaW5pdGlhbGl6ZSBjYWNoZXNcbiAgICAvLyBTdWJjbGFzc2VzIHNob3VsZCBvdmVycmlkZSB3aXRoIGFnZW50LXNwZWNpZmljIGxvZ2ljXG4gICAgY29uc29sZS5sb2coYPCflKUgV2FybWluZyB1cCAke3RoaXMubmFtZX0uLi5gKTtcblxuICAgIC8vIFdhcm0gdXAgY29tbW9uIHJlc291cmNlc1xuICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHRoaXMubG9hZEFnZW50Q29uZmlndXJhdGlvbigpLFxuICAgICAgdGhpcy5pbml0aWFsaXplQ2FjaGUoKSxcbiAgICAgIHRoaXMucHJlY29tcGlsZVBhdHRlcm5zKClcbiAgICBdKTtcblxuICAgIGNvbnNvbGUubG9nKGDinIUgJHt0aGlzLm5hbWV9IHdhcm0tdXAgY29tcGxldGVgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIGFnZW50LXNwZWNpZmljIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHByb3RlY3RlZCBhc3luYyBsb2FkQWdlbnRDb25maWd1cmF0aW9uKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIE92ZXJyaWRlIGluIHN1YmNsYXNzZXMgdG8gbG9hZCBhZ2VudC1zcGVjaWZpYyBjb25maWdcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGNhY2hpbmcgbGF5ZXJcbiAgICovXG4gIHByb3RlY3RlZCBhc3luYyBpbml0aWFsaXplQ2FjaGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gT3ZlcnJpZGUgaW4gc3ViY2xhc3NlcyB0byBzZXQgdXAgY2FjaGluZ1xuICB9XG5cbiAgLyoqXG4gICAqIFByZWNvbXBpbGUgcGF0dGVybnMgYW5kIHJ1bGVzXG4gICAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgcHJlY29tcGlsZVBhdHRlcm5zKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIE92ZXJyaWRlIGluIHN1YmNsYXNzZXMgdG8gcHJlY29tcGlsZSByZWdleCBwYXR0ZXJucywgcnVsZXMsIGV0Yy5cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9