8250bd27796694d81b0b8da95a31d5cf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.agentRegistry = exports.log = exports.AgentRegistry = void 0;
const enhanced_maria_js_1 = require("./enhanced-maria.js");
const enhanced_james_js_1 = require("./enhanced-james.js");
const enhanced_marcus_js_1 = require("./enhanced-marcus.js");
const sarah_pm_js_1 = require("./sarah-pm.js");
const alex_ba_js_1 = require("./alex-ba.js");
const dr_ai_ml_js_1 = require("./dr-ai-ml.js");
const devops_dan_js_1 = require("./devops-dan.js");
const security_sam_js_1 = require("./security-sam.js");
const architecture_dan_js_1 = require("./architecture-dan.js");
const deployment_orchestrator_js_1 = require("./deployment-orchestrator.js");
const introspective_agent_js_1 = require("./introspective-agent.js");
const simulation_qa_js_1 = require("./simulation-qa.js");
class AgentRegistry {
    constructor(logger, skipAutoRegister = false) {
        this.logger = logger;
        this.agents = new Map();
        if (!skipAutoRegister) {
            this.registerAllAgents();
        }
    }
    registerAllAgents() {
        this.agents.set('enhanced-maria', new enhanced_maria_js_1.EnhancedMaria());
        this.agents.set('enhanced-james', new enhanced_james_js_1.EnhancedJames());
        this.agents.set('enhanced-marcus', new enhanced_marcus_js_1.EnhancedMarcus());
        this.agents.set('sarah-pm', new sarah_pm_js_1.SarahPm());
        this.agents.set('alex-ba', new alex_ba_js_1.AlexBa());
        this.agents.set('dr-ai-ml', new dr_ai_ml_js_1.DrAiMl());
        this.agents.set('devops-dan', new devops_dan_js_1.DevopsDan());
        this.agents.set('security-sam', new security_sam_js_1.SecuritySam());
        this.agents.set('architecture-dan', new architecture_dan_js_1.ArchitectureDan());
        this.agents.set('deployment-orchestrator', new deployment_orchestrator_js_1.DeploymentOrchestrator());
        this.agents.set('introspective-agent', new introspective_agent_js_1.IntrospectiveAgent());
        this.agents.set('simulation-qa', new simulation_qa_js_1.SimulationQa());
    }
    getAgent(id) {
        return this.agents.get(id);
    }
    getAllAgents() {
        return Array.from(this.agents.values());
    }
    listAgents() {
        return this.getAllAgents();
    }
    registerAgent(agentOrId, agent) {
        let id;
        let agentToRegister;
        if (typeof agentOrId === 'string') {
            // Old signature: registerAgent(id, agent)
            id = agentOrId;
            agentToRegister = agent;
        }
        else {
            // New signature: registerAgent(agent)
            agentToRegister = agentOrId;
            id = agentToRegister.id;
        }
        if (this.agents.has(id)) {
            throw new Error(`Agent with ID ${id} is already registered`);
        }
        this.agents.set(id, agentToRegister);
    }
    getRegisteredAgents() {
        return this.getAllAgents();
    }
    getAgentForFile(filePath) {
        // Check each registered agent's activation patterns
        for (const agent of this.agents.values()) {
            const patterns = agent.activationPatterns;
            if (!patterns || !Array.isArray(patterns)) {
                continue;
            }
            for (const pattern of patterns) {
                if (this.matchesPattern(filePath, pattern)) {
                    return agent;
                }
            }
        }
        return null;
    }
    matchesPattern(filePath, pattern) {
        const regexPattern = pattern
            .replace(/\*\*/g, '.*')
            .replace(/\*/g, '[^/]*')
            .replace(/\./g, '\\.');
        return new RegExp(regexPattern).test(filePath);
    }
    getAgentsForFilePattern(pattern) {
        return this.getAllAgents();
    }
    getStatus() {
        return {
            totalAgents: this.agents.size,
            agents: Array.from(this.agents.entries()).map(([id, agent]) => ({
                id,
                name: agent.name,
                specialization: agent.specialization
            }))
        };
    }
    isHealthy() {
        return this.agents.size > 0;
    }
    getAgentMetadata(id) {
        const agent = this.agents.get(id);
        if (!agent)
            return undefined;
        const metadata = {
            name: agent.name,
            specialization: agent.specialization,
            autoActivate: false,
            priority: id === 'introspective-agent' ? 4 : 3,
            triggers: {
                keywords: this.getKeywordsForAgent(id),
                patterns: [],
                fileTypes: []
            },
            collaborators: this.getCollaboratorIds(id)
        };
        // Add MCP tools for introspective agent
        if (id === 'introspective-agent') {
            metadata.mcpTools = ['Read MCP', 'Bash MCP', 'WebFetch MCP'];
        }
        return metadata;
    }
    getCollaborators(id) {
        const collaboratorIds = this.getCollaboratorIds(id);
        return collaboratorIds
            .map(collabId => this.agents.get(collabId))
            .filter((agent) => agent !== undefined);
    }
    getKeywordsForAgent(id) {
        const keywordMap = {
            'introspective-agent': ['introspection', 'optimization', 'performance', 'learning'],
            'enhanced-maria': ['test', 'quality', 'coverage', 'validation'],
            'enhanced-james': ['ui', 'frontend', 'component', 'accessibility'],
            'enhanced-marcus': ['api', 'backend', 'security', 'database'],
            'sarah-pm': ['project', 'sprint', 'milestone', 'timeline'],
            'alex-ba': ['requirements', 'business', 'analysis', 'stakeholder'],
            'dr-ai-ml': ['machine learning', 'model', 'training', 'prediction']
        };
        return keywordMap[id] || [];
    }
    getCollaboratorIds(id) {
        const collabMap = {
            'introspective-agent': ['enhanced-maria', 'enhanced-james', 'enhanced-marcus'],
            'enhanced-maria': ['enhanced-james', 'enhanced-marcus'],
            'enhanced-james': ['enhanced-maria', 'enhanced-marcus'],
            'enhanced-marcus': ['enhanced-maria', 'enhanced-james'],
            'sarah-pm': ['enhanced-maria', 'enhanced-james', 'enhanced-marcus', 'alex-ba'],
            'alex-ba': ['sarah-pm', 'enhanced-maria'],
            'dr-ai-ml': ['enhanced-marcus', 'enhanced-maria']
        };
        return collabMap[id] || [];
    }
}
exports.AgentRegistry = AgentRegistry;
exports.log = console;
// Export singleton instance for easy import
exports.agentRegistry = new AgentRegistry();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2FnZW50LXJlZ2lzdHJ5LnRzIiwibWFwcGluZ3MiOiI7OztBQUVBLDJEQUFvRDtBQUNwRCwyREFBb0Q7QUFDcEQsNkRBQXNEO0FBQ3RELCtDQUF3QztBQUN4Qyw2Q0FBc0M7QUFDdEMsK0NBQXVDO0FBQ3ZDLG1EQUE0QztBQUM1Qyx1REFBZ0Q7QUFDaEQsK0RBQXdEO0FBQ3hELDZFQUFzRTtBQUN0RSxxRUFBOEQ7QUFDOUQseURBQWtEO0FBRWxELE1BQWEsYUFBYTtJQUd4QixZQUFvQixNQUFZLEVBQUUsbUJBQTRCLEtBQUs7UUFBL0MsV0FBTSxHQUFOLE1BQU0sQ0FBTTtRQUZ4QixXQUFNLEdBQUcsSUFBSSxHQUFHLEVBQXFCLENBQUM7UUFHNUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDM0IsQ0FBQztJQUNILENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxpQ0FBYSxFQUFFLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLGlDQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLElBQUksbUNBQWMsRUFBRSxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUkscUJBQU8sRUFBRSxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksbUJBQU0sRUFBRSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksb0JBQU0sRUFBRSxDQUFDLENBQUM7UUFD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Q0FBQyxjQUFjLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxhQUFhLENBQUM7WUFDbEUsVUFBVSxFQUFFLENBQUMsa0JBQWtCLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLENBQUM7U0FDcEUsQ0FBQztRQUNGLE9BQU8sVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRU8sa0JBQWtCLENBQUMsRUFBVTtRQUNuQyxNQUFNLFNBQVMsR0FBNkI7WUFDMUMscUJBQXFCLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQztZQUM5RSxnQkFBZ0IsRUFBRSxDQUFDLGdCQUFnQixFQUFFLGlCQUFpQixDQUFDO1lBQ3ZELGdCQUFnQixFQUFFLENBQUMsZ0JBQWdCLEVBQUUsaUJBQWlCLENBQUM7WUFDdkQsaUJBQWlCLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxnQkFBZ0IsQ0FBQztZQUN2RCxVQUFVLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsRUFBRSxTQUFTLENBQUM7WUFDOUUsU0FBUyxFQUFFLENBQUMsVUFBVSxFQUFFLGdCQUFnQixDQUFDO1lBQ3pDLFVBQVUsRUFBRSxDQUFDLGlCQUFpQixFQUFFLGdCQUFnQixDQUFDO1NBQ2xELENBQUM7UUFDRixPQUFPLFNBQVMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDN0IsQ0FBQztDQUNGO0FBbktELHNDQW1LQztBQUVZLFFBQUEsR0FBRyxHQUFHLE9BQU8sQ0FBQztBQUUzQiw0Q0FBNEM7QUFDL0IsUUFBQSxhQUFhLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbmlzc2ltbWVuYXNoZS9WRVJTQVRJTCBTRExDIEZXL3NyYy9hZ2VudHMvYWdlbnQtcmVnaXN0cnkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVkVSU0FUSUxMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXIuanMnO1xuaW1wb3J0IHsgQmFzZUFnZW50IH0gZnJvbSAnLi9iYXNlLWFnZW50LmpzJztcbmltcG9ydCB7IEVuaGFuY2VkTWFyaWEgfSBmcm9tICcuL2VuaGFuY2VkLW1hcmlhLmpzJztcbmltcG9ydCB7IEVuaGFuY2VkSmFtZXMgfSBmcm9tICcuL2VuaGFuY2VkLWphbWVzLmpzJztcbmltcG9ydCB7IEVuaGFuY2VkTWFyY3VzIH0gZnJvbSAnLi9lbmhhbmNlZC1tYXJjdXMuanMnO1xuaW1wb3J0IHsgU2FyYWhQbSB9IGZyb20gJy4vc2FyYWgtcG0uanMnO1xuaW1wb3J0IHsgQWxleEJhIH0gZnJvbSAnLi9hbGV4LWJhLmpzJztcbmltcG9ydCB7IERyQWlNbCB9IGZyb20gJy4vZHItYWktbWwuanMnO1xuaW1wb3J0IHsgRGV2b3BzRGFuIH0gZnJvbSAnLi9kZXZvcHMtZGFuLmpzJztcbmltcG9ydCB7IFNlY3VyaXR5U2FtIH0gZnJvbSAnLi9zZWN1cml0eS1zYW0uanMnO1xuaW1wb3J0IHsgQXJjaGl0ZWN0dXJlRGFuIH0gZnJvbSAnLi9hcmNoaXRlY3R1cmUtZGFuLmpzJztcbmltcG9ydCB7IERlcGxveW1lbnRPcmNoZXN0cmF0b3IgfSBmcm9tICcuL2RlcGxveW1lbnQtb3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IEludHJvc3BlY3RpdmVBZ2VudCB9IGZyb20gJy4vaW50cm9zcGVjdGl2ZS1hZ2VudC5qcyc7XG5pbXBvcnQgeyBTaW11bGF0aW9uUWEgfSBmcm9tICcuL3NpbXVsYXRpb24tcWEuanMnO1xuXG5leHBvcnQgY2xhc3MgQWdlbnRSZWdpc3RyeSB7XG4gIHByaXZhdGUgYWdlbnRzID0gbmV3IE1hcDxzdHJpbmcsIEJhc2VBZ2VudD4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvZ2dlcj86IGFueSwgc2tpcEF1dG9SZWdpc3RlcjogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgaWYgKCFza2lwQXV0b1JlZ2lzdGVyKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyQWxsQWdlbnRzKCk7XG4gICAgfVxuICB9XG4gIFxuICBwcml2YXRlIHJlZ2lzdGVyQWxsQWdlbnRzKCk6IHZvaWQge1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZW5oYW5jZWQtbWFyaWEnLCBuZXcgRW5oYW5jZWRNYXJpYSgpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2VuaGFuY2VkLWphbWVzJywgbmV3IEVuaGFuY2VkSmFtZXMoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdlbmhhbmNlZC1tYXJjdXMnLCBuZXcgRW5oYW5jZWRNYXJjdXMoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdzYXJhaC1wbScsIG5ldyBTYXJhaFBtKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnYWxleC1iYScsIG5ldyBBbGV4QmEoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdkci1haS1tbCcsIG5ldyBEckFpTWwoKSk7XG4gICAgdGhpcy5hZ2VudHMuc2V0KCdkZXZvcHMtZGFuJywgbmV3IERldm9wc0RhbigpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ3NlY3VyaXR5LXNhbScsIG5ldyBTZWN1cml0eVNhbSgpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2FyY2hpdGVjdHVyZS1kYW4nLCBuZXcgQXJjaGl0ZWN0dXJlRGFuKCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnZGVwbG95bWVudC1vcmNoZXN0cmF0b3InLCBuZXcgRGVwbG95bWVudE9yY2hlc3RyYXRvcigpKTtcbiAgICB0aGlzLmFnZW50cy5zZXQoJ2ludHJvc3BlY3RpdmUtYWdlbnQnLCBuZXcgSW50cm9zcGVjdGl2ZUFnZW50KCkpO1xuICAgIHRoaXMuYWdlbnRzLnNldCgnc2ltdWxhdGlvbi1xYScsIG5ldyBTaW11bGF0aW9uUWEoKSk7XG4gIH1cbiAgXG4gIGdldEFnZW50KGlkOiBzdHJpbmcpOiBCYXNlQWdlbnQgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmFnZW50cy5nZXQoaWQpO1xuICB9XG4gIFxuICBnZXRBbGxBZ2VudHMoKTogQmFzZUFnZW50W10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuYWdlbnRzLnZhbHVlcygpKTtcbiAgfVxuXG4gIGxpc3RBZ2VudHMoKTogQmFzZUFnZW50W10ge1xuICAgIHJldHVybiB0aGlzLmdldEFsbEFnZW50cygpO1xuICB9XG5cbiAgcmVnaXN0ZXJBZ2VudChhZ2VudE9ySWQ6IEJhc2VBZ2VudCB8IHN0cmluZywgYWdlbnQ/OiBCYXNlQWdlbnQpOiB2b2lkIHtcbiAgICBsZXQgaWQ6IHN0cmluZztcbiAgICBsZXQgYWdlbnRUb1JlZ2lzdGVyOiBCYXNlQWdlbnQ7XG5cbiAgICBpZiAodHlwZW9mIGFnZW50T3JJZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIC8vIE9sZCBzaWduYXR1cmU6IHJlZ2lzdGVyQWdlbnQoaWQsIGFnZW50KVxuICAgICAgaWQgPSBhZ2VudE9ySWQ7XG4gICAgICBhZ2VudFRvUmVnaXN0ZXIgPSBhZ2VudCE7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5ldyBzaWduYXR1cmU6IHJlZ2lzdGVyQWdlbnQoYWdlbnQpXG4gICAgICBhZ2VudFRvUmVnaXN0ZXIgPSBhZ2VudE9ySWQ7XG4gICAgICBpZCA9IGFnZW50VG9SZWdpc3Rlci5pZDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hZ2VudHMuaGFzKGlkKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBZ2VudCB3aXRoIElEICR7aWR9IGlzIGFscmVhZHkgcmVnaXN0ZXJlZGApO1xuICAgIH1cbiAgICB0aGlzLmFnZW50cy5zZXQoaWQsIGFnZW50VG9SZWdpc3Rlcik7XG4gIH1cblxuICBnZXRSZWdpc3RlcmVkQWdlbnRzKCk6IEJhc2VBZ2VudFtdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBbGxBZ2VudHMoKTtcbiAgfVxuXG4gIGdldEFnZW50Rm9yRmlsZShmaWxlUGF0aDogc3RyaW5nKTogQmFzZUFnZW50IHwgbnVsbCB7XG4gICAgLy8gQ2hlY2sgZWFjaCByZWdpc3RlcmVkIGFnZW50J3MgYWN0aXZhdGlvbiBwYXR0ZXJuc1xuICAgIGZvciAoY29uc3QgYWdlbnQgb2YgdGhpcy5hZ2VudHMudmFsdWVzKCkpIHtcbiAgICAgIGNvbnN0IHBhdHRlcm5zID0gKGFnZW50IGFzIGFueSkuYWN0aXZhdGlvblBhdHRlcm5zO1xuICAgICAgaWYgKCFwYXR0ZXJucyB8fCAhQXJyYXkuaXNBcnJheShwYXR0ZXJucykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBwYXR0ZXJucykge1xuICAgICAgICBpZiAodGhpcy5tYXRjaGVzUGF0dGVybihmaWxlUGF0aCwgcGF0dGVybikpIHtcbiAgICAgICAgICByZXR1cm4gYWdlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgbWF0Y2hlc1BhdHRlcm4oZmlsZVBhdGg6IHN0cmluZywgcGF0dGVybjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVnZXhQYXR0ZXJuID0gcGF0dGVyblxuICAgICAgLnJlcGxhY2UoL1xcKlxcKi9nLCAnLionKVxuICAgICAgLnJlcGxhY2UoL1xcKi9nLCAnW14vXSonKVxuICAgICAgLnJlcGxhY2UoL1xcLi9nLCAnXFxcXC4nKTtcblxuICAgIHJldHVybiBuZXcgUmVnRXhwKHJlZ2V4UGF0dGVybikudGVzdChmaWxlUGF0aCk7XG4gIH1cblxuICBnZXRBZ2VudHNGb3JGaWxlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBCYXNlQWdlbnRbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsQWdlbnRzKCk7XG4gIH1cblxuICBnZXRTdGF0dXMoKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxBZ2VudHM6IHRoaXMuYWdlbnRzLnNpemUsXG4gICAgICBhZ2VudHM6IEFycmF5LmZyb20odGhpcy5hZ2VudHMuZW50cmllcygpKS5tYXAoKFtpZCwgYWdlbnRdKSA9PiAoe1xuICAgICAgICBpZCxcbiAgICAgICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICAgICAgc3BlY2lhbGl6YXRpb246IGFnZW50LnNwZWNpYWxpemF0aW9uXG4gICAgICB9KSlcbiAgICB9O1xuICB9XG5cbiAgaXNIZWFsdGh5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmFnZW50cy5zaXplID4gMDtcbiAgfVxuXG4gIGdldEFnZW50TWV0YWRhdGEoaWQ6IHN0cmluZyk6IGFueSB7XG4gICAgY29uc3QgYWdlbnQgPSB0aGlzLmFnZW50cy5nZXQoaWQpO1xuICAgIGlmICghYWdlbnQpIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCBtZXRhZGF0YTogYW55ID0ge1xuICAgICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICAgIHNwZWNpYWxpemF0aW9uOiBhZ2VudC5zcGVjaWFsaXphdGlvbixcbiAgICAgIGF1dG9BY3RpdmF0ZTogZmFsc2UsXG4gICAgICBwcmlvcml0eTogaWQgPT09ICdpbnRyb3NwZWN0aXZlLWFnZW50JyA/IDQgOiAzLFxuICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAga2V5d29yZHM6IHRoaXMuZ2V0S2V5d29yZHNGb3JBZ2VudChpZCksXG4gICAgICAgIHBhdHRlcm5zOiBbXSxcbiAgICAgICAgZmlsZVR5cGVzOiBbXVxuICAgICAgfSxcbiAgICAgIGNvbGxhYm9yYXRvcnM6IHRoaXMuZ2V0Q29sbGFib3JhdG9ySWRzKGlkKVxuICAgIH07XG5cbiAgICAvLyBBZGQgTUNQIHRvb2xzIGZvciBpbnRyb3NwZWN0aXZlIGFnZW50XG4gICAgaWYgKGlkID09PSAnaW50cm9zcGVjdGl2ZS1hZ2VudCcpIHtcbiAgICAgIG1ldGFkYXRhLm1jcFRvb2xzID0gWydSZWFkIE1DUCcsICdCYXNoIE1DUCcsICdXZWJGZXRjaCBNQ1AnXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWV0YWRhdGE7XG4gIH1cblxuICBnZXRDb2xsYWJvcmF0b3JzKGlkOiBzdHJpbmcpOiBCYXNlQWdlbnRbXSB7XG4gICAgY29uc3QgY29sbGFib3JhdG9ySWRzID0gdGhpcy5nZXRDb2xsYWJvcmF0b3JJZHMoaWQpO1xuICAgIHJldHVybiBjb2xsYWJvcmF0b3JJZHNcbiAgICAgIC5tYXAoY29sbGFiSWQgPT4gdGhpcy5hZ2VudHMuZ2V0KGNvbGxhYklkKSlcbiAgICAgIC5maWx0ZXIoKGFnZW50KTogYWdlbnQgaXMgQmFzZUFnZW50ID0+IGFnZW50ICE9PSB1bmRlZmluZWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRLZXl3b3Jkc0ZvckFnZW50KGlkOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qga2V5d29yZE1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgJ2ludHJvc3BlY3RpdmUtYWdlbnQnOiBbJ2ludHJvc3BlY3Rpb24nLCAnb3B0aW1pemF0aW9uJywgJ3BlcmZvcm1hbmNlJywgJ2xlYXJuaW5nJ10sXG4gICAgICAnZW5oYW5jZWQtbWFyaWEnOiBbJ3Rlc3QnLCAncXVhbGl0eScsICdjb3ZlcmFnZScsICd2YWxpZGF0aW9uJ10sXG4gICAgICAnZW5oYW5jZWQtamFtZXMnOiBbJ3VpJywgJ2Zyb250ZW5kJywgJ2NvbXBvbmVudCcsICdhY2Nlc3NpYmlsaXR5J10sXG4gICAgICAnZW5oYW5jZWQtbWFyY3VzJzogWydhcGknLCAnYmFja2VuZCcsICdzZWN1cml0eScsICdkYXRhYmFzZSddLFxuICAgICAgJ3NhcmFoLXBtJzogWydwcm9qZWN0JywgJ3NwcmludCcsICdtaWxlc3RvbmUnLCAndGltZWxpbmUnXSxcbiAgICAgICdhbGV4LWJhJzogWydyZXF1aXJlbWVudHMnLCAnYnVzaW5lc3MnLCAnYW5hbHlzaXMnLCAnc3Rha2Vob2xkZXInXSxcbiAgICAgICdkci1haS1tbCc6IFsnbWFjaGluZSBsZWFybmluZycsICdtb2RlbCcsICd0cmFpbmluZycsICdwcmVkaWN0aW9uJ11cbiAgICB9O1xuICAgIHJldHVybiBrZXl3b3JkTWFwW2lkXSB8fCBbXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sbGFib3JhdG9ySWRzKGlkOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY29sbGFiTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7XG4gICAgICAnaW50cm9zcGVjdGl2ZS1hZ2VudCc6IFsnZW5oYW5jZWQtbWFyaWEnLCAnZW5oYW5jZWQtamFtZXMnLCAnZW5oYW5jZWQtbWFyY3VzJ10sXG4gICAgICAnZW5oYW5jZWQtbWFyaWEnOiBbJ2VuaGFuY2VkLWphbWVzJywgJ2VuaGFuY2VkLW1hcmN1cyddLFxuICAgICAgJ2VuaGFuY2VkLWphbWVzJzogWydlbmhhbmNlZC1tYXJpYScsICdlbmhhbmNlZC1tYXJjdXMnXSxcbiAgICAgICdlbmhhbmNlZC1tYXJjdXMnOiBbJ2VuaGFuY2VkLW1hcmlhJywgJ2VuaGFuY2VkLWphbWVzJ10sXG4gICAgICAnc2FyYWgtcG0nOiBbJ2VuaGFuY2VkLW1hcmlhJywgJ2VuaGFuY2VkLWphbWVzJywgJ2VuaGFuY2VkLW1hcmN1cycsICdhbGV4LWJhJ10sXG4gICAgICAnYWxleC1iYSc6IFsnc2FyYWgtcG0nLCAnZW5oYW5jZWQtbWFyaWEnXSxcbiAgICAgICdkci1haS1tbCc6IFsnZW5oYW5jZWQtbWFyY3VzJywgJ2VuaGFuY2VkLW1hcmlhJ11cbiAgICB9O1xuICAgIHJldHVybiBjb2xsYWJNYXBbaWRdIHx8IFtdO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBsb2cgPSBjb25zb2xlO1xuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlIGZvciBlYXN5IGltcG9ydFxuZXhwb3J0IGNvbnN0IGFnZW50UmVnaXN0cnkgPSBuZXcgQWdlbnRSZWdpc3RyeSgpO1xuIl0sInZlcnNpb24iOjN9