93e57dd0d6e727de8fd37ceb8e8a9213
"use strict";
/**
 * Three-Tier Handoff Helper
 *
 * Simplifies creating and managing three-tier architecture handoffs:
 * Alex-BA → (Dana-Database + Marcus-Backend + James-Frontend)
 *
 * This is the most common VERSATIL workflow for full-stack features.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ThreeTierHandoffBuilder = void 0;
exports.createThreeTierHandoff = createThreeTierHandoff;
const agent_handoff_contract_js_1 = require("./agent-handoff-contract.js");
const contract_validator_js_1 = require("./contract-validator.js");
const contract_tracker_js_1 = require("./contract-tracker.js");
/**
 * Three-tier handoff builder
 */
class ThreeTierHandoffBuilder {
    constructor(requirements) {
        this.endpoints = [];
        this.tables = [];
        this.components = [];
        this.requirements = requirements;
    }
    /**
     * Add API endpoint
     */
    addEndpoint(endpoint) {
        this.endpoints.push(endpoint);
        return this;
    }
    /**
     * Add database table
     */
    addTable(table) {
        this.tables.push(table);
        return this;
    }
    /**
     * Add UI component
     */
    addComponent(component) {
        this.components.push(component);
        return this;
    }
    /**
     * Set memory snapshot
     */
    setMemorySnapshot(snapshot) {
        this.memorySnapshot = snapshot;
        return this;
    }
    /**
     * Build the three-tier handoff contract
     */
    async build() {
        // Create base contract using ContractBuilder
        const baseBuilder = new agent_handoff_contract_js_1.ContractBuilder('alex-ba');
        // Add receivers (Dana, Marcus, James)
        baseBuilder
            .addReceiver('dana-database', 'database')
            .addReceiver('marcus-backend', 'api')
            .addReceiver('james-frontend', 'frontend');
        // Set handoff type to parallel
        baseBuilder.setType('parallel');
        // Create work items for each tier
        const workItems = [];
        // Dana's work: Database schema
        if (this.tables.length > 0) {
            workItems.push({
                id: `work-dana-${Date.now()}`,
                type: 'implementation',
                description: `Implement database schema for ${this.requirements.name}`,
                acceptanceCriteria: [
                    'All tables created with correct schema',
                    'Indexes added for performance',
                    'Foreign keys configured',
                    'RLS policies implemented',
                    'Migration scripts created'
                ],
                estimatedEffort: this.tables.length * 1.5, // 1.5 hours per table
                priority: 'high',
                metadata: {
                    tables: this.tables.map(t => t.name)
                }
            });
        }
        // Marcus's work: API implementation
        if (this.endpoints.length > 0) {
            workItems.push({
                id: `work-marcus-${Date.now()}`,
                type: 'implementation',
                description: `Implement API endpoints for ${this.requirements.name}`,
                acceptanceCriteria: [
                    'All endpoints implemented',
                    'Request/response validation with Zod',
                    'Authentication/authorization configured',
                    'Error handling implemented',
                    'OWASP security compliance',
                    'Response time < 200ms',
                    'Stress tests generated and passing'
                ],
                estimatedEffort: this.endpoints.length * 2, // 2 hours per endpoint
                priority: 'high',
                dependencies: this.tables.length > 0 ? [`work-dana-${Date.now()}`] : undefined,
                metadata: {
                    endpoints: this.endpoints.map(e => `${e.method} ${e.path}`)
                }
            });
        }
        // James's work: UI components
        if (this.components.length > 0) {
            workItems.push({
                id: `work-james-${Date.now()}`,
                type: 'implementation',
                description: `Implement UI components for ${this.requirements.name}`,
                acceptanceCriteria: [
                    'All components implemented',
                    'Responsive design (mobile, tablet, desktop)',
                    'WCAG 2.1 AA accessibility',
                    'Component tests with React Testing Library',
                    'Integration with API endpoints',
                    'Error states handled',
                    'Loading states implemented'
                ],
                estimatedEffort: this.components.length * 1.5, // 1.5 hours per component
                priority: 'normal',
                dependencies: this.endpoints.length > 0 ? [`work-marcus-${Date.now()}`] : undefined,
                metadata: {
                    components: this.components.map(c => c.name)
                }
            });
        }
        // Work items are part of the context, not a direct property
        // baseBuilder.workItems = workItems;
        // Set expected output
        baseBuilder.setExpectedOutput({
            artifacts: [
                { type: 'code', description: 'Database migration scripts', required: true },
                { type: 'code', description: 'API endpoint implementations', required: true },
                { type: 'code', description: 'UI components', required: true },
                { type: 'tests', description: 'Database tests (RLS policies)', required: true },
                { type: 'tests', description: 'API tests (unit + stress)', required: true },
                { type: 'tests', description: 'Component tests', required: true },
                { type: 'documentation', description: 'API documentation', required: false }
            ],
            qualityGates: [
                { name: 'Test Coverage', description: 'Minimum test coverage', threshold: 80 },
                { name: 'API Response Time', description: 'Maximum API response time', threshold: '200ms' },
                { name: 'Accessibility Score', description: 'WCAG 2.1 AA compliance', threshold: 95 },
                { name: 'Security Scan', description: 'OWASP Top 10 compliance', threshold: 'pass' }
            ],
            expectedDuration: workItems.reduce((sum, item) => sum + (item.estimatedEffort || 0), 0),
            successCriteria: [
                'All three tiers implemented and integrated',
                'End-to-end feature works correctly',
                'All quality gates pass',
                'User stories fulfilled'
            ]
        });
        // Set memory snapshot
        if (this.memorySnapshot) {
            baseBuilder.setMemorySnapshot(this.memorySnapshot);
        }
        else {
            // Create minimal snapshot
            baseBuilder.setMemorySnapshot({
                agentId: 'alex-ba',
                timestamp: new Date(),
                memoryFiles: {},
                criticalPatterns: [],
                contextSummary: `Three-tier implementation for ${this.requirements.name}`,
                estimatedTokens: 0
            });
        }
        // Set context
        baseBuilder.setContext({
            feature: {
                name: this.requirements.name,
                description: this.requirements.description,
                userStories: this.requirements.userStories
            },
            business: {
                goals: this.requirements.goals,
                constraints: this.requirements.constraints
            },
            technical: {
                apiContract: {
                    endpoints: this.endpoints
                },
                databaseSchema: {
                    tables: this.tables
                }
            }
        });
        // Set expiration (24 hours)
        baseBuilder.setExpiration(24);
        // Build base contract
        const baseContract = baseBuilder.build();
        // Convert to three-tier contract
        const threeTierContract = {
            ...baseContract,
            type: 'parallel',
            apiContract: {
                endpoints: this.endpoints,
                sharedTypes: {}
            },
            databaseSchema: {
                tables: this.tables,
                rlsPolicies: this.generateRLSPolicies(this.tables)
            },
            uiRequirements: {
                components: this.components,
                accessibility: 'AA',
                responsive: ['mobile', 'tablet', 'desktop']
            },
            integrationCheckpoints: [
                {
                    name: 'Database → API Integration',
                    description: 'Connect API to database with real queries',
                    participants: ['dana-database', 'marcus-backend'],
                    acceptanceCriteria: [
                        'API can read from database',
                        'API can write to database',
                        'RLS policies enforced'
                    ]
                },
                {
                    name: 'API → Frontend Integration',
                    description: 'Connect UI to API endpoints',
                    participants: ['marcus-backend', 'james-frontend'],
                    acceptanceCriteria: [
                        'UI can call API endpoints',
                        'Authentication flows work',
                        'Error handling works end-to-end'
                    ]
                },
                {
                    name: 'End-to-End Validation',
                    description: 'Full feature validation',
                    participants: ['dana-database', 'marcus-backend', 'james-frontend'],
                    acceptanceCriteria: [
                        'Complete user flow works',
                        'Data persists correctly',
                        'UI reflects data changes',
                        'All quality gates pass'
                    ]
                }
            ]
        };
        return threeTierContract;
    }
    /**
     * Build, validate, and track the contract
     */
    async buildAndValidate() {
        // Build contract
        const contract = await this.build();
        // Validate contract
        const validator = new contract_validator_js_1.ContractValidator({ strictMode: false });
        const validation = validator.validateThreeTier(contract);
        // Track contract creation
        const tracker = (0, contract_tracker_js_1.getGlobalContractTracker)();
        await tracker.trackContractCreated(contract, validation);
        if (!validation.valid) {
            console.warn('Contract validation failed:', validation.errors);
        }
        return { contract, validation };
    }
    /**
     * Generate RLS policies for tables
     */
    generateRLSPolicies(tables) {
        return tables.flatMap(table => [
            {
                table: table.name,
                operation: 'SELECT',
                using: 'auth.uid() IS NOT NULL' // Basic: user must be authenticated
            },
            {
                table: table.name,
                operation: 'INSERT',
                using: 'auth.uid() IS NOT NULL'
            },
            {
                table: table.name,
                operation: 'UPDATE',
                using: 'auth.uid() IS NOT NULL'
            },
            {
                table: table.name,
                operation: 'DELETE',
                using: 'auth.uid() IS NOT NULL'
            }
        ]);
    }
}
exports.ThreeTierHandoffBuilder = ThreeTierHandoffBuilder;
/**
 * Quick helper to create three-tier handoff
 */
async function createThreeTierHandoff(requirements, config) {
    const builder = new ThreeTierHandoffBuilder(requirements);
    config.endpoints.forEach(e => builder.addEndpoint(e));
    config.tables.forEach(t => builder.addTable(t));
    config.components.forEach(c => builder.addComponent(c));
    if (config.memorySnapshot) {
        builder.setMemorySnapshot(config.memorySnapshot);
    }
    const { contract, validation } = await builder.buildAndValidate();
    if (!validation.valid) {
        throw new Error(`Contract validation failed: ${validation.errors.map(e => e.message).join(', ')}`);
    }
    return contract;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2NvbnRyYWN0cy90aHJlZS10aWVyLWhhbmRvZmYudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7OztBQW9aSCx3REEwQkM7QUE1YUQsMkVBTXFDO0FBQ3JDLG1FQUE4RTtBQUM5RSwrREFBaUU7QUE2RWpFOztHQUVHO0FBQ0gsTUFBYSx1QkFBdUI7SUFPbEMsWUFBWSxZQUFpQztRQUxyQyxjQUFTLEdBQWtCLEVBQUUsQ0FBQztRQUM5QixXQUFNLEdBQW9CLEVBQUUsQ0FBQztRQUM3QixlQUFVLEdBQWtCLEVBQUUsQ0FBQztRQUlyQyxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxXQUFXLENBQUMsUUFBcUI7UUFDL0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxRQUFRLENBQUMsS0FBb0I7UUFDM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZLENBQUMsU0FBc0I7UUFDakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxpQkFBaUIsQ0FBQyxRQUF3QjtRQUN4QyxJQUFJLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQztRQUMvQixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxLQUFLO1FBQ1QsNkNBQTZDO1FBQzdDLE1BQU0sV0FBVyxHQUFHLElBQUksMkNBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVuRCxzQ0FBc0M7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R0FBRyxJQUFJLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTFELE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXhELElBQUksTUFBTSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQzFCLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLEdBQUcsTUFBTSxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUVsRSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQUMsK0JBQStCLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDckcsQ0FBQztJQUVELE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL25pc3NpbW1lbmFzaGUvVkVSU0FUSUwgU0RMQyBGVy9zcmMvYWdlbnRzL2NvbnRyYWN0cy90aHJlZS10aWVyLWhhbmRvZmYudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaHJlZS1UaWVyIEhhbmRvZmYgSGVscGVyXG4gKlxuICogU2ltcGxpZmllcyBjcmVhdGluZyBhbmQgbWFuYWdpbmcgdGhyZWUtdGllciBhcmNoaXRlY3R1cmUgaGFuZG9mZnM6XG4gKiBBbGV4LUJBIOKGkiAoRGFuYS1EYXRhYmFzZSArIE1hcmN1cy1CYWNrZW5kICsgSmFtZXMtRnJvbnRlbmQpXG4gKlxuICogVGhpcyBpcyB0aGUgbW9zdCBjb21tb24gVkVSU0FUSUwgd29ya2Zsb3cgZm9yIGZ1bGwtc3RhY2sgZmVhdHVyZXMuXG4gKi9cblxuaW1wb3J0IHtcbiAgQWdlbnRIYW5kb2ZmQ29udHJhY3QsXG4gIFRocmVlVGllckhhbmRvZmZDb250cmFjdCxcbiAgV29ya0l0ZW0sXG4gIE1lbW9yeVNuYXBzaG90LFxuICBDb250cmFjdEJ1aWxkZXJcbn0gZnJvbSAnLi9hZ2VudC1oYW5kb2ZmLWNvbnRyYWN0LmpzJztcbmltcG9ydCB7IENvbnRyYWN0VmFsaWRhdG9yLCB2YWxpZGF0ZUNvbnRyYWN0IH0gZnJvbSAnLi9jb250cmFjdC12YWxpZGF0b3IuanMnO1xuaW1wb3J0IHsgZ2V0R2xvYmFsQ29udHJhY3RUcmFja2VyIH0gZnJvbSAnLi9jb250cmFjdC10cmFja2VyLmpzJztcblxuLyoqXG4gKiBGZWF0dXJlIHJlcXVpcmVtZW50cyBmb3IgdGhyZWUtdGllciBoYW5kb2ZmXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmVhdHVyZVJlcXVpcmVtZW50cyB7XG4gIC8qKlxuICAgKiBGZWF0dXJlIG5hbWVcbiAgICovXG4gIG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogRmVhdHVyZSBkZXNjcmlwdGlvblxuICAgKi9cbiAgZGVzY3JpcHRpb246IHN0cmluZztcblxuICAvKipcbiAgICogVXNlciBzdG9yaWVzXG4gICAqL1xuICB1c2VyU3Rvcmllczogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIEJ1c2luZXNzIGdvYWxzXG4gICAqL1xuICBnb2Fscz86IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBUZWNobmljYWwgY29uc3RyYWludHNcbiAgICovXG4gIGNvbnN0cmFpbnRzPzogc3RyaW5nW107XG59XG5cbi8qKlxuICogQVBJIGVuZHBvaW50IGRlZmluaXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBUElFbmRwb2ludCB7XG4gIG1ldGhvZDogJ0dFVCcgfCAnUE9TVCcgfCAnUFVUJyB8ICdERUxFVEUnIHwgJ1BBVENIJztcbiAgcGF0aDogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICByZXF1ZXN0U2NoZW1hPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgcmVzcG9uc2VTY2hlbWE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBhdXRoZW50aWNhdGlvbj86IGJvb2xlYW47XG59XG5cbi8qKlxuICogRGF0YWJhc2UgdGFibGUgZGVmaW5pdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhdGFiYXNlVGFibGUge1xuICBuYW1lOiBzdHJpbmc7XG4gIGNvbHVtbnM6IEFycmF5PHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIG51bGxhYmxlPzogYm9vbGVhbjtcbiAgICB1bmlxdWU/OiBib29sZWFuO1xuICAgIGRlZmF1bHQ/OiBhbnk7XG4gIH0+O1xuICBpbmRleGVzPzogQXJyYXk8e1xuICAgIGNvbHVtbnM6IHN0cmluZ1tdO1xuICAgIHVuaXF1ZT86IGJvb2xlYW47XG4gIH0+O1xuICBmb3JlaWduS2V5cz86IEFycmF5PHtcbiAgICBjb2x1bW46IHN0cmluZztcbiAgICByZWZlcmVuY2VzOiBzdHJpbmc7XG4gICAgb25EZWxldGU/OiAnQ0FTQ0FERScgfCAnU0VUIE5VTEwnIHwgJ1JFU1RSSUNUJztcbiAgfT47XG59XG5cbi8qKlxuICogVUkgY29tcG9uZW50IGRlZmluaXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBVSUNvbXBvbmVudCB7XG4gIG5hbWU6IHN0cmluZztcbiAgdHlwZTogJ3BhZ2UnIHwgJ2NvbXBvbmVudCcgfCAnaG9vaycgfCAndXRpbCc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHByb3BzPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuLyoqXG4gKiBUaHJlZS10aWVyIGhhbmRvZmYgYnVpbGRlclxuICovXG5leHBvcnQgY2xhc3MgVGhyZWVUaWVySGFuZG9mZkJ1aWxkZXIge1xuICBwcml2YXRlIHJlcXVpcmVtZW50czogRmVhdHVyZVJlcXVpcmVtZW50cztcbiAgcHJpdmF0ZSBlbmRwb2ludHM6IEFQSUVuZHBvaW50W10gPSBbXTtcbiAgcHJpdmF0ZSB0YWJsZXM6IERhdGFiYXNlVGFibGVbXSA9IFtdO1xuICBwcml2YXRlIGNvbXBvbmVudHM6IFVJQ29tcG9uZW50W10gPSBbXTtcbiAgcHJpdmF0ZSBtZW1vcnlTbmFwc2hvdD86IE1lbW9yeVNuYXBzaG90O1xuXG4gIGNvbnN0cnVjdG9yKHJlcXVpcmVtZW50czogRmVhdHVyZVJlcXVpcmVtZW50cykge1xuICAgIHRoaXMucmVxdWlyZW1lbnRzID0gcmVxdWlyZW1lbnRzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBBUEkgZW5kcG9pbnRcbiAgICovXG4gIGFkZEVuZHBvaW50KGVuZHBvaW50OiBBUElFbmRwb2ludCk6IHRoaXMge1xuICAgIHRoaXMuZW5kcG9pbnRzLnB1c2goZW5kcG9pbnQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBkYXRhYmFzZSB0YWJsZVxuICAgKi9cbiAgYWRkVGFibGUodGFibGU6IERhdGFiYXNlVGFibGUpOiB0aGlzIHtcbiAgICB0aGlzLnRhYmxlcy5wdXNoKHRhYmxlKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgVUkgY29tcG9uZW50XG4gICAqL1xuICBhZGRDb21wb25lbnQoY29tcG9uZW50OiBVSUNvbXBvbmVudCk6IHRoaXMge1xuICAgIHRoaXMuY29tcG9uZW50cy5wdXNoKGNvbXBvbmVudCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0IG1lbW9yeSBzbmFwc2hvdFxuICAgKi9cbiAgc2V0TWVtb3J5U25hcHNob3Qoc25hcHNob3Q6IE1lbW9yeVNuYXBzaG90KTogdGhpcyB7XG4gICAgdGhpcy5tZW1vcnlTbmFwc2hvdCA9IHNuYXBzaG90O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkIHRoZSB0aHJlZS10aWVyIGhhbmRvZmYgY29udHJhY3RcbiAgICovXG4gIGFzeW5jIGJ1aWxkKCk6IFByb21pc2U8VGhyZWVUaWVySGFuZG9mZkNvbnRyYWN0PiB7XG4gICAgLy8gQ3JlYXRlIGJhc2UgY29udHJhY3QgdXNpbmcgQ29udHJhY3RCdWlsZGVyXG4gICAgY29uc3QgYmFzZUJ1aWxkZXIgPSBuZXcgQ29udHJhY3RCdWlsZGVyKCdhbGV4LWJhJyk7XG5cbiAgICAvLyBBZGQgcmVjZWl2ZXJzIChEYW5hLCBNYXJjdXMsIEphbWVzKVxuICAgIGJhc2VCdWlsZGVyXG4gICAgICAuYWRkUmVjZWl2ZXIoJ2RhbmEtZGF0YWJhc2UnLCAnZGF0YWJhc2UnKVxuICAgICAgLmFkZFJlY2VpdmVyKCdtYXJjdXMtYmFja2VuZCcsICdhcGknKVxuICAgICAgLmFkZFJlY2VpdmVyKCdqYW1lcy1mcm9udGVuZCcsICdmcm9udGVuZCcpO1xuXG4gICAgLy8gU2V0IGhhbmRvZmYgdHlwZSB0byBwYXJhbGxlbFxuICAgIGJhc2VCdWlsZGVyLnNldFR5cGUoJ3BhcmFsbGVsJyk7XG5cbiAgICAvLyBDcmVhdGUgd29yayBpdGVtcyBmb3IgZWFjaCB0aWVyXG4gICAgY29uc3Qgd29ya0l0ZW1zOiBXb3JrSXRlbVtdID0gW107XG5cbiAgICAvLyBEYW5hJ3Mgd29yazogRGF0YWJhc2Ugc2NoZW1hXG4gICAgaWYgKHRoaXMudGFibGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHdvcmtJdGVtcy5wdXNoKHtcbiAgICAgICAgaWQ6IGB3b3JrLWRhbmEtJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgSW1wbGVtZW50IGRhdGFiYXNlIHNjaGVtYSBmb3IgJHt0aGlzLnJlcXVpcmVtZW50cy5uYW1lfWAsXG4gICAgICAgIGFjY2VwdGFuY2VDcml0ZXJpYTogW1xuICAgICAgICAgICdBbGwgdGFibGVzIGNyZWF0ZWQgd2l0aCBjb3JyZWN0IHNjaGVtYScsXG4gICAgICAgICAgJ0luZGV4ZXMgYWRkZWQgZm9yIHBlcmZvcm1hbmNlJyxcbiAgICAgICAgICAnRm9yZWlnbiBrZXlzIGNvbmZpZ3VyZWQnLFxuICAgICAgICAgICdSTFMgcG9saWNpZXMgaW1wbGVtZW50ZWQnLFxuICAgICAgICAgICdNaWdyYXRpb24gc2NyaXB0cyBjcmVhdGVkJ1xuICAgICAgICBdLFxuICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6IHRoaXMudGFibGVzLmxlbmd0aCAqIDEuNSwgLy8gMS41IGhvdXJzIHBlciB0YWJsZVxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHRhYmxlczogdGhpcy50YWJsZXMubWFwKHQgPT4gdC5uYW1lKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBNYXJjdXMncyB3b3JrOiBBUEkgaW1wbGVtZW50YXRpb25cbiAgICBpZiAodGhpcy5lbmRwb2ludHMubGVuZ3RoID4gMCkge1xuICAgICAgd29ya0l0ZW1zLnB1c2goe1xuICAgICAgICBpZDogYHdvcmstbWFyY3VzLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogYEltcGxlbWVudCBBUEkgZW5kcG9pbnRzIGZvciAke3RoaXMucmVxdWlyZW1lbnRzLm5hbWV9YCxcbiAgICAgICAgYWNjZXB0YW5jZUNyaXRlcmlhOiBbXG4gICAgICAgICAgJ0FsbCBlbmRwb2ludHMgaW1wbGVtZW50ZWQnLFxuICAgICAgICAgICdSZXF1ZXN0L3Jlc3BvbnNlIHZhbGlkYXRpb24gd2l0aCBab2QnLFxuICAgICAgICAgICdBdXRoZW50aWNhdGlvbi9hdXRob3JpemF0aW9uIGNvbmZpZ3VyZWQnLFxuICAgICAgICAgICdFcnJvciBoYW5kbGluZyBpbXBsZW1lbnRlZCcsXG4gICAgICAgICAgJ09XQVNQIHNlY3VyaXR5IGNvbXBsaWFuY2UnLFxuICAgICAgICAgICdSZXNwb25zZSB0aW1lIDwgMjAwbXMnLFxuICAgICAgICAgICdTdHJlc3MgdGVzdHMgZ2VuZXJhdGVkIGFuZCBwYXNzaW5nJ1xuICAgICAgICBdLFxuICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6IHRoaXMuZW5kcG9pbnRzLmxlbmd0aCAqIDIsIC8vIDIgaG91cnMgcGVyIGVuZHBvaW50XG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXG4gICAgICAgIGRlcGVuZGVuY2llczogdGhpcy50YWJsZXMubGVuZ3RoID4gMCA/IFtgd29yay1kYW5hLSR7RGF0ZS5ub3coKX1gXSA6IHVuZGVmaW5lZCxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBlbmRwb2ludHM6IHRoaXMuZW5kcG9pbnRzLm1hcChlID0+IGAke2UubWV0aG9kfSAke2UucGF0aH1gKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBKYW1lcydzIHdvcms6IFVJIGNvbXBvbmVudHNcbiAgICBpZiAodGhpcy5jb21wb25lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHdvcmtJdGVtcy5wdXNoKHtcbiAgICAgICAgaWQ6IGB3b3JrLWphbWVzLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogYEltcGxlbWVudCBVSSBjb21wb25lbnRzIGZvciAke3RoaXMucmVxdWlyZW1lbnRzLm5hbWV9YCxcbiAgICAgICAgYWNjZXB0YW5jZUNyaXRlcmlhOiBbXG4gICAgICAgICAgJ0FsbCBjb21wb25lbnRzIGltcGxlbWVudGVkJyxcbiAgICAgICAgICAnUmVzcG9uc2l2ZSBkZXNpZ24gKG1vYmlsZSwgdGFibGV0LCBkZXNrdG9wKScsXG4gICAgICAgICAgJ1dDQUcgMi4xIEFBIGFjY2Vzc2liaWxpdHknLFxuICAgICAgICAgICdDb21wb25lbnQgdGVzdHMgd2l0aCBSZWFjdCBUZXN0aW5nIExpYnJhcnknLFxuICAgICAgICAgICdJbnRlZ3JhdGlvbiB3aXRoIEFQSSBlbmRwb2ludHMnLFxuICAgICAgICAgICdFcnJvciBzdGF0ZXMgaGFuZGxlZCcsXG4gICAgICAgICAgJ0xvYWRpbmcgc3RhdGVzIGltcGxlbWVudGVkJ1xuICAgICAgICBdLFxuICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6IHRoaXMuY29tcG9uZW50cy5sZW5ndGggKiAxLjUsIC8vIDEuNSBob3VycyBwZXIgY29tcG9uZW50XG4gICAgICAgIHByaW9yaXR5OiAnbm9ybWFsJyxcbiAgICAgICAgZGVwZW5kZW5jaWVzOiB0aGlzLmVuZHBvaW50cy5sZW5ndGggPiAwID8gW2B3b3JrLW1hcmN1cy0ke0RhdGUubm93KCl9YF0gOiB1bmRlZmluZWQsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgY29tcG9uZW50czogdGhpcy5jb21wb25lbnRzLm1hcChjID0+IGMubmFtZSlcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gV29yayBpdGVtcyBhcmUgcGFydCBvZiB0aGUgY29udGV4dCwgbm90IGEgZGlyZWN0IHByb3BlcnR5XG4gICAgLy8gYmFzZUJ1aWxkZXIud29ya0l0ZW1zID0gd29ya0l0ZW1zO1xuXG4gICAgLy8gU2V0IGV4cGVjdGVkIG91dHB1dFxuICAgIGJhc2VCdWlsZGVyLnNldEV4cGVjdGVkT3V0cHV0KHtcbiAgICAgIGFydGlmYWN0czogW1xuICAgICAgICB7IHR5cGU6ICdjb2RlJywgZGVzY3JpcHRpb246ICdEYXRhYmFzZSBtaWdyYXRpb24gc2NyaXB0cycsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgICAgIHsgdHlwZTogJ2NvZGUnLCBkZXNjcmlwdGlvbjogJ0FQSSBlbmRwb2ludCBpbXBsZW1lbnRhdGlvbnMnLCByZXF1aXJlZDogdHJ1ZSB9LFxuICAgICAgICB7IHR5cGU6ICdjb2RlJywgZGVzY3JpcHRpb246ICdVSSBjb21wb25lbnRzJywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgICAgeyB0eXBlOiAndGVzdHMnLCBkZXNjcmlwdGlvbjogJ0RhdGFiYXNlIHRlc3RzIChSTFMgcG9saWNpZXMpJywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgICAgeyB0eXBlOiAndGVzdHMnLCBkZXNjcmlwdGlvbjogJ0FQSSB0ZXN0cyAodW5pdCArIHN0cmVzcyknLCByZXF1aXJlZDogdHJ1ZSB9LFxuICAgICAgICB7IHR5cGU6ICd0ZXN0cycsIGRlc2NyaXB0aW9uOiAnQ29tcG9uZW50IHRlc3RzJywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgICAgeyB0eXBlOiAnZG9jdW1lbnRhdGlvbicsIGRlc2NyaXB0aW9uOiAnQVBJIGRvY3VtZW50YXRpb24nLCByZXF1aXJlZDogZmFsc2UgfVxuICAgICAgXSxcbiAgICAgIHF1YWxpdHlHYXRlczogW1xuICAgICAgICB7IG5hbWU6ICdUZXN0IENvdmVyYWdlJywgZGVzY3JpcHRpb246ICdNaW5pbXVtIHRlc3QgY292ZXJhZ2UnLCB0aHJlc2hvbGQ6IDgwIH0sXG4gICAgICAgIHsgbmFtZTogJ0FQSSBSZXNwb25zZSBUaW1lJywgZGVzY3JpcHRpb246ICdNYXhpbXVtIEFQSSByZXNwb25zZSB0aW1lJywgdGhyZXNob2xkOiAnMjAwbXMnIH0sXG4gICAgICAgIHsgbmFtZTogJ0FjY2Vzc2liaWxpdHkgU2NvcmUnLCBkZXNjcmlwdGlvbjogJ1dDQUcgMi4xIEFBIGNvbXBsaWFuY2UnLCB0aHJlc2hvbGQ6IDk1IH0sXG4gICAgICAgIHsgbmFtZTogJ1NlY3VyaXR5IFNjYW4nLCBkZXNjcmlwdGlvbjogJ09XQVNQIFRvcCAxMCBjb21wbGlhbmNlJywgdGhyZXNob2xkOiAncGFzcycgfVxuICAgICAgXSxcbiAgICAgIGV4cGVjdGVkRHVyYXRpb246IHdvcmtJdGVtcy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgKGl0ZW0uZXN0aW1hdGVkRWZmb3J0IHx8IDApLCAwKSxcbiAgICAgIHN1Y2Nlc3NDcml0ZXJpYTogW1xuICAgICAgICAnQWxsIHRocmVlIHRpZXJzIGltcGxlbWVudGVkIGFuZCBpbnRlZ3JhdGVkJyxcbiAgICAgICAgJ0VuZC10by1lbmQgZmVhdHVyZSB3b3JrcyBjb3JyZWN0bHknLFxuICAgICAgICAnQWxsIHF1YWxpdHkgZ2F0ZXMgcGFzcycsXG4gICAgICAgICdVc2VyIHN0b3JpZXMgZnVsZmlsbGVkJ1xuICAgICAgXVxuICAgIH0pO1xuXG4gICAgLy8gU2V0IG1lbW9yeSBzbmFwc2hvdFxuICAgIGlmICh0aGlzLm1lbW9yeVNuYXBzaG90KSB7XG4gICAgICBiYXNlQnVpbGRlci5zZXRNZW1vcnlTbmFwc2hvdCh0aGlzLm1lbW9yeVNuYXBzaG90KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIG1pbmltYWwgc25hcHNob3RcbiAgICAgIGJhc2VCdWlsZGVyLnNldE1lbW9yeVNuYXBzaG90KHtcbiAgICAgICAgYWdlbnRJZDogJ2FsZXgtYmEnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIG1lbW9yeUZpbGVzOiB7fSxcbiAgICAgICAgY3JpdGljYWxQYXR0ZXJuczogW10sXG4gICAgICAgIGNvbnRleHRTdW1tYXJ5OiBgVGhyZWUtdGllciBpbXBsZW1lbnRhdGlvbiBmb3IgJHt0aGlzLnJlcXVpcmVtZW50cy5uYW1lfWAsXG4gICAgICAgIGVzdGltYXRlZFRva2VuczogMFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGNvbnRleHRcbiAgICBiYXNlQnVpbGRlci5zZXRDb250ZXh0KHtcbiAgICAgIGZlYXR1cmU6IHtcbiAgICAgICAgbmFtZTogdGhpcy5yZXF1aXJlbWVudHMubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMucmVxdWlyZW1lbnRzLmRlc2NyaXB0aW9uLFxuICAgICAgICB1c2VyU3RvcmllczogdGhpcy5yZXF1aXJlbWVudHMudXNlclN0b3JpZXNcbiAgICAgIH0sXG4gICAgICBidXNpbmVzczoge1xuICAgICAgICBnb2FsczogdGhpcy5yZXF1aXJlbWVudHMuZ29hbHMsXG4gICAgICAgIGNvbnN0cmFpbnRzOiB0aGlzLnJlcXVpcmVtZW50cy5jb25zdHJhaW50c1xuICAgICAgfSxcbiAgICAgIHRlY2huaWNhbDoge1xuICAgICAgICBhcGlDb250cmFjdDoge1xuICAgICAgICAgIGVuZHBvaW50czogdGhpcy5lbmRwb2ludHNcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YWJhc2VTY2hlbWE6IHtcbiAgICAgICAgICB0YWJsZXM6IHRoaXMudGFibGVzXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNldCBleHBpcmF0aW9uICgyNCBob3VycylcbiAgICBiYXNlQnVpbGRlci5zZXRFeHBpcmF0aW9uKDI0KTtcblxuICAgIC8vIEJ1aWxkIGJhc2UgY29udHJhY3RcbiAgICBjb25zdCBiYXNlQ29udHJhY3QgPSBiYXNlQnVpbGRlci5idWlsZCgpO1xuXG4gICAgLy8gQ29udmVydCB0byB0aHJlZS10aWVyIGNvbnRyYWN0XG4gICAgY29uc3QgdGhyZWVUaWVyQ29udHJhY3Q6IFRocmVlVGllckhhbmRvZmZDb250cmFjdCA9IHtcbiAgICAgIC4uLmJhc2VDb250cmFjdCxcbiAgICAgIHR5cGU6ICdwYXJhbGxlbCcsXG4gICAgICBhcGlDb250cmFjdDoge1xuICAgICAgICBlbmRwb2ludHM6IHRoaXMuZW5kcG9pbnRzLFxuICAgICAgICBzaGFyZWRUeXBlczoge31cbiAgICAgIH0sXG4gICAgICBkYXRhYmFzZVNjaGVtYToge1xuICAgICAgICB0YWJsZXM6IHRoaXMudGFibGVzLFxuICAgICAgICBybHNQb2xpY2llczogdGhpcy5nZW5lcmF0ZVJMU1BvbGljaWVzKHRoaXMudGFibGVzKVxuICAgICAgfSxcbiAgICAgIHVpUmVxdWlyZW1lbnRzOiB7XG4gICAgICAgIGNvbXBvbmVudHM6IHRoaXMuY29tcG9uZW50cyxcbiAgICAgICAgYWNjZXNzaWJpbGl0eTogJ0FBJyxcbiAgICAgICAgcmVzcG9uc2l2ZTogWydtb2JpbGUnLCAndGFibGV0JywgJ2Rlc2t0b3AnXVxuICAgICAgfSxcbiAgICAgIGludGVncmF0aW9uQ2hlY2twb2ludHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdEYXRhYmFzZSDihpIgQVBJIEludGVncmF0aW9uJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0Nvbm5lY3QgQVBJIHRvIGRhdGFiYXNlIHdpdGggcmVhbCBxdWVyaWVzJyxcbiAgICAgICAgICBwYXJ0aWNpcGFudHM6IFsnZGFuYS1kYXRhYmFzZScsICdtYXJjdXMtYmFja2VuZCddLFxuICAgICAgICAgIGFjY2VwdGFuY2VDcml0ZXJpYTogW1xuICAgICAgICAgICAgJ0FQSSBjYW4gcmVhZCBmcm9tIGRhdGFiYXNlJyxcbiAgICAgICAgICAgICdBUEkgY2FuIHdyaXRlIHRvIGRhdGFiYXNlJyxcbiAgICAgICAgICAgICdSTFMgcG9saWNpZXMgZW5mb3JjZWQnXG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ0FQSSDihpIgRnJvbnRlbmQgSW50ZWdyYXRpb24nLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ29ubmVjdCBVSSB0byBBUEkgZW5kcG9pbnRzJyxcbiAgICAgICAgICBwYXJ0aWNpcGFudHM6IFsnbWFyY3VzLWJhY2tlbmQnLCAnamFtZXMtZnJvbnRlbmQnXSxcbiAgICAgICAgICBhY2NlcHRhbmNlQ3JpdGVyaWE6IFtcbiAgICAgICAgICAgICdVSSBjYW4gY2FsbCBBUEkgZW5kcG9pbnRzJyxcbiAgICAgICAgICAgICdBdXRoZW50aWNhdGlvbiBmbG93cyB3b3JrJyxcbiAgICAgICAgICAgICdFcnJvciBoYW5kbGluZyB3b3JrcyBlbmQtdG8tZW5kJ1xuICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdFbmQtdG8tRW5kIFZhbGlkYXRpb24nLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnVsbCBmZWF0dXJlIHZhbGlkYXRpb24nLFxuICAgICAgICAgIHBhcnRpY2lwYW50czogWydkYW5hLWRhdGFiYXNlJywgJ21hcmN1cy1iYWNrZW5kJywgJ2phbWVzLWZyb250ZW5kJ10sXG4gICAgICAgICAgYWNjZXB0YW5jZUNyaXRlcmlhOiBbXG4gICAgICAgICAgICAnQ29tcGxldGUgdXNlciBmbG93IHdvcmtzJyxcbiAgICAgICAgICAgICdEYXRhIHBlcnNpc3RzIGNvcnJlY3RseScsXG4gICAgICAgICAgICAnVUkgcmVmbGVjdHMgZGF0YSBjaGFuZ2VzJyxcbiAgICAgICAgICAgICdBbGwgcXVhbGl0eSBnYXRlcyBwYXNzJ1xuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgXVxuICAgIH07XG5cbiAgICByZXR1cm4gdGhyZWVUaWVyQ29udHJhY3Q7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQsIHZhbGlkYXRlLCBhbmQgdHJhY2sgdGhlIGNvbnRyYWN0XG4gICAqL1xuICBhc3luYyBidWlsZEFuZFZhbGlkYXRlKCk6IFByb21pc2U8e1xuICAgIGNvbnRyYWN0OiBUaHJlZVRpZXJIYW5kb2ZmQ29udHJhY3Q7XG4gICAgdmFsaWRhdGlvbjogYW55O1xuICB9PiB7XG4gICAgLy8gQnVpbGQgY29udHJhY3RcbiAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuYnVpbGQoKTtcblxuICAgIC8vIFZhbGlkYXRlIGNvbnRyYWN0XG4gICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IENvbnRyYWN0VmFsaWRhdG9yKHsgc3RyaWN0TW9kZTogZmFsc2UgfSk7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRvci52YWxpZGF0ZVRocmVlVGllcihjb250cmFjdCk7XG5cbiAgICAvLyBUcmFjayBjb250cmFjdCBjcmVhdGlvblxuICAgIGNvbnN0IHRyYWNrZXIgPSBnZXRHbG9iYWxDb250cmFjdFRyYWNrZXIoKTtcbiAgICBhd2FpdCB0cmFja2VyLnRyYWNrQ29udHJhY3RDcmVhdGVkKGNvbnRyYWN0LCB2YWxpZGF0aW9uKTtcblxuICAgIGlmICghdmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgY29uc29sZS53YXJuKCdDb250cmFjdCB2YWxpZGF0aW9uIGZhaWxlZDonLCB2YWxpZGF0aW9uLmVycm9ycyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgY29udHJhY3QsIHZhbGlkYXRpb24gfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBSTFMgcG9saWNpZXMgZm9yIHRhYmxlc1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJMU1BvbGljaWVzKHRhYmxlczogRGF0YWJhc2VUYWJsZVtdKSB7XG4gICAgcmV0dXJuIHRhYmxlcy5mbGF0TWFwKHRhYmxlID0+IFtcbiAgICAgIHtcbiAgICAgICAgdGFibGU6IHRhYmxlLm5hbWUsXG4gICAgICAgIG9wZXJhdGlvbjogJ1NFTEVDVCcgYXMgY29uc3QsXG4gICAgICAgIHVzaW5nOiAnYXV0aC51aWQoKSBJUyBOT1QgTlVMTCcgLy8gQmFzaWM6IHVzZXIgbXVzdCBiZSBhdXRoZW50aWNhdGVkXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0YWJsZTogdGFibGUubmFtZSxcbiAgICAgICAgb3BlcmF0aW9uOiAnSU5TRVJUJyBhcyBjb25zdCxcbiAgICAgICAgdXNpbmc6ICdhdXRoLnVpZCgpIElTIE5PVCBOVUxMJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGFibGU6IHRhYmxlLm5hbWUsXG4gICAgICAgIG9wZXJhdGlvbjogJ1VQREFURScgYXMgY29uc3QsXG4gICAgICAgIHVzaW5nOiAnYXV0aC51aWQoKSBJUyBOT1QgTlVMTCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRhYmxlOiB0YWJsZS5uYW1lLFxuICAgICAgICBvcGVyYXRpb246ICdERUxFVEUnIGFzIGNvbnN0LFxuICAgICAgICB1c2luZzogJ2F1dGgudWlkKCkgSVMgTk9UIE5VTEwnXG4gICAgICB9XG4gICAgXSk7XG4gIH1cbn1cblxuLyoqXG4gKiBRdWljayBoZWxwZXIgdG8gY3JlYXRlIHRocmVlLXRpZXIgaGFuZG9mZlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGhyZWVUaWVySGFuZG9mZihcbiAgcmVxdWlyZW1lbnRzOiBGZWF0dXJlUmVxdWlyZW1lbnRzLFxuICBjb25maWc6IHtcbiAgICBlbmRwb2ludHM6IEFQSUVuZHBvaW50W107XG4gICAgdGFibGVzOiBEYXRhYmFzZVRhYmxlW107XG4gICAgY29tcG9uZW50czogVUlDb21wb25lbnRbXTtcbiAgICBtZW1vcnlTbmFwc2hvdD86IE1lbW9yeVNuYXBzaG90O1xuICB9XG4pOiBQcm9taXNlPFRocmVlVGllckhhbmRvZmZDb250cmFjdD4ge1xuICBjb25zdCBidWlsZGVyID0gbmV3IFRocmVlVGllckhhbmRvZmZCdWlsZGVyKHJlcXVpcmVtZW50cyk7XG5cbiAgY29uZmlnLmVuZHBvaW50cy5mb3JFYWNoKGUgPT4gYnVpbGRlci5hZGRFbmRwb2ludChlKSk7XG4gIGNvbmZpZy50YWJsZXMuZm9yRWFjaCh0ID0+IGJ1aWxkZXIuYWRkVGFibGUodCkpO1xuICBjb25maWcuY29tcG9uZW50cy5mb3JFYWNoKGMgPT4gYnVpbGRlci5hZGRDb21wb25lbnQoYykpO1xuXG4gIGlmIChjb25maWcubWVtb3J5U25hcHNob3QpIHtcbiAgICBidWlsZGVyLnNldE1lbW9yeVNuYXBzaG90KGNvbmZpZy5tZW1vcnlTbmFwc2hvdCk7XG4gIH1cblxuICBjb25zdCB7IGNvbnRyYWN0LCB2YWxpZGF0aW9uIH0gPSBhd2FpdCBidWlsZGVyLmJ1aWxkQW5kVmFsaWRhdGUoKTtcblxuICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvbnRyYWN0IHZhbGlkYXRpb24gZmFpbGVkOiAke3ZhbGlkYXRpb24uZXJyb3JzLm1hcChlID0+IGUubWVzc2FnZSkuam9pbignLCAnKX1gKTtcbiAgfVxuXG4gIHJldHVybiBjb250cmFjdDtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==